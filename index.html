<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><title>Supercharge Power BI 3rd Edition</title></head><body><div id="calibre_link-0" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectlayout">
			<div id="calibre_link-395" class="calibre1">
				<img class="_idgenobjectattribute" src="images/000097.png" alt="" />
			</div>
		</div>
		<div id="calibre_link-396" class="_idgenobjectstyleoverride">
			<p class="_idgenobjectstyleoverride">Inside Front Cover - This page intentionally blank</p>
		</div>
		<div id="calibre_link-397" class="_idgenobjectstyleoverride">
			<p class="title-page">Supercharge Power BI</p>
			<p class="title-page">Power BI Is Better When You Learn to Write DAX</p>
			<p class="title-page">3rd Edition</p>
			<p class="title-page">by</p>
			<p class="title-page">Matt Allington</p>
			<p class="title-page">Holy Macro! Books</p>
			<p class="title-page">PO Box 541731</p>
			<p class="title-page">Merritt Island, FL 32954</p>
		</div>
	</div>


<div id="calibre_link-1" lang="en-US" lang="en-US" class="calibre">
		<div id="calibre_link-398" class="_idgenobjectstyleoverride">
			<p class="ch-notoc"><span class="b">Supercharge Power BI - 3rd Edition</span></p>
			<p class="normal">© 2021 Tickling Keys, Inc.</p>
			<p class="normal">All rights reserved. No part of this book may be reproduced or transmitted in any form or by any means, electronic or mechanical, including photocopying, recording, or by any information or storage retrieval system without permission from the publisher. Every effort has been made to make this book as complete and accurate as possible, but no warranty or fitness is implied. The information is provided on an "as is" basis. The authors and the publisher shall have neither liability nor responsibility to any person or entity with respect to any loss or damages arising from the information contained in this book.</p>
			<p class="normal">Author: Matt Allington</p>
			<p class="normal">Layout: Jill Bee</p>
			<p class="normal">Copyediting: Kitty Wilson</p>
			<p class="normal">Cover Design: Emrul Hasan, Shannon Travise &amp; Maddie Allington</p>
			<p class="normal">Cover Illustration: Freepik</p>
			<p class="normal">Indexing: Nellie Jay</p>
			<p class="normal">Published by: Holy Macro! Books, PO Box 541731, Merritt Island FL 32954, USA</p>
			<p class="normal">Distributed by: Independent Publishers Group, Chicago, IL</p>
			<p class="normal">First Printing: January, 2021. </p>
			<p class="normal">ISBN: 978-1-61547-069-3 Print, 978-1-61547-155-3 e-Book</p>
			<p class="normal">Library of Congress Control Number: 20211931632</p>
		</div>
	</div>


<div id="calibre_link-2" lang="en-US" lang="en-US" class="calibre">
		<div id="calibre_link-399" class="_idgenobjectstyleoverride" type="toc">
			<p class="ch-notoc"><span class="b">Table of Contents</span></p>
			<p class="toc-body-text"><a href="#calibre_link-3"><span class="b1">Introduction</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-4"><span class="b1">1: Concept: Introduction to Data Modelling</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-5"><span class="b1">2: Concept: Loading Data</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-6"><span class="b1">3: Concept: Measures</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-7"><span class="b1">4: DAX Topic: SUM(), COUNT(), COUNTROWS(), MIN(), MAX(), COUNTBLANK(), and DIVIDE()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-8"><span class="b1">5: Concept: Filter Propagation</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-9"><span class="b1">6: Concept: Lookup Tables and Data Tables</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-10"><span class="b1">7: DAX Topic: Calculated Columns</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-11"><span class="b1">8: DAX Topic: The Basic Iterators SUMX() and AVERAGEX()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-12"><span class="b1">9: DAX Topic: CALCULATE()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-13"><span class="b1">10: DAX Topic: Making </span><span class="b1">DAX Easy to Read</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-14"><span class="b1">11: Concept: Evaluation Context and Context Transition</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-15"><span class="b1">12: DAX Topic: IF(), SWITCH(), and FIND()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-16"><span class="b1">13: DAX Topic: VALUES(), HASONEVALUE(), SELECTEDVALUE(), and CONCATENATEX()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-17"><span class="b1">14: DAX Topic: ALL(), REMOVEFILTERS(), ALLEXCEPT(), and ALLSELECTED()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-18"><span class="b1">15: DAX Topic: FILTER()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-19"><span class="b1">16: DAX Topic: Time Intelligence</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-20"><span class="b1">17: DAX Topic: Variables in DAX</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-21"><span class="b1">18: DAX Topic: RANKX() and TOPN()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-22"><span class="b1">19: DAX Topic: RELATED() and RELATEDTABLE()</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-23"><span class="b1">20: Concept: Disconnected Tables</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-24"><span class="b1">21: Concept: Multiple Data Tables</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-25"><span class="b1">22: Concept: Using Analyze in Excel and Cube Formulas</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-26"><span class="b1">23: Concept: Transferring DAX Skills to Excel</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-27"><span class="b1">24: Concept: Next Steps on Your DAX Journey</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-28"><span class="b1">Appendix A: Answers to Practice Exercises</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-29"><span class="b1">Appendix B - DAX Quick Reference List</span></a></p>
			<p class="toc-body-text"><a href="#calibre_link-30">Index</a></p>
		</div>
	</div>


<div id="calibre_link-31" lang="en-US" lang="en-US" class="calibre">
		<div id="calibre_link-400" class="_idgenobjectstyleoverride">
			<p id="calibre_link-401" class="ch"><span class="b2"><a id="calibre_link-3"></a><a id="calibre_link-402"></a><a id="calibre_link-403"></a><a id="calibre_link-404"></a>Introduction</span></p>
			<p class="normal">In my view, Power BI is the best thing that has happened to business intelligence (BI) software since the introduction of Microsoft Excel. You might find this a strange comment as you may be thinking that Microsoft Excel is not a BI product. But I beg to differ. Prior to the introduction of the personal computer, there was only one type of BI solution possible: “enterprise BI” using enterprise BI software. Since the introduction of business-focused personal computers (e.g., early Apple devices and IBM-compatible PCs), there have been two types of BI solutions: enterprise BI and self-service BI. I would argue that Excel was one of the first self-service business intelligence software products broadly available to businesses. (There were several others, including VisiCalc and Lotus 123, before Excel, but Excel has been the most successful.)</p>
			<p class="normal">A self-service BI solution is a solution that an end user builds. Enterprise BI solutions are important and have their place; they are enterprise-wide, scalable, robust, certified, reliable, etc. They are also expensive, and they take time to build, deploy, and maintain. Not every business-reporting problem can&mdash;or should&mdash;be solved by using an enterprise solution. For example, say that you have a short-term need to report on some measurable activity in your business. You want to measure the progress toward a short-term target (say 1 month), and then the reporting need goes away. It would not be practicable to build an enterprise-grade BI solution to report on such an activity. Both the cost and time horizon would make enterprise BI impracticable for such a need. There will always be more demands for reporting in an organisation than can be met by enterprise BI&mdash;and that’s where self-service BI comes in. Self-service BI has existed since the late 1970s/early 1980s, when business personal computers became popular and software tools&mdash;including Microsoft Excel&mdash;began to enable business users to solve problems.</p>
			<p class="normal">Microsoft launched Power BI in July 2015 with little fanfare. There were plenty of competitive critics out there, saying that the product was immature and not a real competitor to their own products&mdash;and they were right. In fact, I didn’t love Power BI until it was almost 2 years old. At that point, I felt that Power BI had achieved the minimum level of maturity needed to be considered a serious BI product. When I look back now and compare the latest versions of Power BI with the 2-year-old version, I’m amazed at how far it has progressed. </p>
			<p class="normal">Power BI is still evolving, and there are so many great things about it that it is hard to know what to mention first. Perhaps one of the most important things to note about Power BI is that it is designed with business analysts and Excel users in mind. You do not need to be an IT professional to be able to use this software well. But it is not only a self-service BI tool; it is also a fully featured enterprise-grade BI software tool. Brilliant strategy, don’t you think?</p>
			<p class="normal">Power BI has everything needed to complete an enterprise or self-service BI project across four important phases:</p>
			<ul class="calibre2">
				<li class="bl"><span class="b3">Data acquisition: </span>Power BI has a powerful data acquisition engine that helps a user fetch and load the data needed. The underlying technology that supports data acquisition is called Power Query (accessed via the Transform Data menu inside Power BI Desktop). The programming language inside Power Query is called M.</li>
				<li class="bl"><span class="b3">Data modelling:</span> Power BI’s powerful data modelling engine allows a user to model loaded data to make it more useful than it is in the raw state. The underlying technology that facilitates data modelling has various names across different software products, including VertiPaq, SQL Server Analysis Services (SSAS) Tabular, and Power Pivot for Excel. (I refer to the modelling engine as SSAS Tabular in this book.) The programming language is called DAX (short for Data Analysis Expressions).</li>
				<li class="bl"><span class="b3">Data visualisation:</span> Power BI’s modern visualisation engine has been built using the latest web technologies so you can build interactive, engaging reports. The Power BI visualisation engine has been open sourced so that anyone with the necessary skills can build new custom visuals to use and share within Power BI.</li>
				<li class="bl"><span class="b3">Report distribution:</span> Finally, Power BI has a framework that supports multiple ways to share data and reports with others, including a cloud-based web environment and native mobile apps. The sharing framework makes it easy to share reports and dashboards with other people who need to see and interact with the data. The tool to share Power BI reports is called the Power BI service, or PowerBI.com.</li>
			</ul>
			<p class="normal">This book, Supercharge Power BI: Power BI Is Better When You Learn to Write DAX, teaches you the skills you need to use SSAS Tabular, the modelling engine at the core of Power BI, and the DAX language. SSAS Tabular brings everything that is good about enterprise-strength BI tools directly to you right inside Power BI Desktop without the time and cost impacts normally associated with large-scale BI projects. In addition, it is not just the time and money that matter. The fact that you can do everything yourself directly inside Power BI is very empowering. Analyses that you would never have considered viable in the past are now tasks that can be achieved within the current business cycle.</p>
			<p class="normal">It is worth pointing out that you can use Power BI without learning DAX and data modelling. However, Power BI is definitely better when you learn to write DAX. If you don’t invest time in learning DAX and data modelling, you will be able to take advantage of only the basic capabilities of Power BI. Imagine knowing how to use Excel basics like clicking on buttons and menus but not knowing how to write any formulas. Your limited knowledge would cause you to miss out on a lot of what Excel has to offer. You would be able to produce only very basic and simplistic spreadsheets. In much the same way, if you learn Power BI basics but don’t learn the DAX language and how SSAS Tabular works, you will be limited to simplistic capabilities that restrict the value you can get from the tool.</p>
			<p class="normal">There is another significant benefit to learning data modelling and DAX for Power BI. These skills are fully transferable to Power Pivot for Excel and also to Microsoft enterprise BI projects (using both Power BI and SSAS Tabular enterprise software). Although in this book you will be learning the DAX language using the Power BI user interface, you will be able to easily migrate your new skills into Power Pivot for Excel should you want to do that. And who wouldn’t?</p>
			<p class="h">Why You Need This Book</p>
			<p class="normal">I am a full-time Power BI consultant, trainer, and BI practitioner. I have taught many Excel users how to use Power Pivot for Excel and Power BI at live training classes (see <a href="http://xbi.com.au/live-training" class="calibre3"><span class="u">http://xbi.com.au/live-training</span></a>), and I have helped countless others online at various Power BI forums. This teaching experience has given me great insight into how Excel users learn Power BI and what resources they need to succeed. Power BI is very learnable, but it is very different from Excel; you definitely need some structured learning if you want to be good at using this tool. I have learnt that Excel users need practice, practice, practice. This book is designed to give you practice and to teach you how to write DAX. If you can’t write DAX, you will never be good at Power BI or Power Pivot for Excel.</p>
			<p class="normal">I refer above to Excel users, and that wording is quite deliberate. I have observed that Excel professionals learn DAX differently than do IT/SQL Server professionals. IT/SQL Server professionals are simply not the same as Excel business users. SQL Server professionals have solid knowledge of database design and principles, table relationships, how to efficiently aggregate data, etc. And of course there are some Excel users who also have knowledge about those things. But I believe IT/SQL Server professionals can take a much more technical path to learning DAX than most Excel users because they have the technical grounding to build upon. Excel users need a different approach, and this book is written with them in mind. I am not saying that an IT/SQL Server professional would not get any value from this book/approach; it really depends on your learning style. Further, I am not saying that IT/SQL Server professionals don’t need to learn in a structured way; indeed, most do. What I am saying is that if you are an Excel business user who is trying to learn DAX, this book was written with your specific needs in mind.</p>
			<p class="h"><span class="b2">Incremental Learning</span></p>
			<p class="normal">I am an Excel user from way back&mdash;a long way back actually. (I first learnt to use Lotus 123 before Microsoft Excel was released.) I’m not the kind of guy who can sit down and read a novel, but I love to buy Excel reference books and read them cover to cover. And I have learnt a lot about Excel over the years by using this approach. When I find some new concept that I love and want to try, most of the time I just remember it. But sometimes I add a sticky note to the page so I can I find it again in the future when I need it. In a way, I am incrementally learning a small number of new skills on top of the large base of skills I already have. When you incrementally learn like this, it is relatively easy to remember the detail of the new thing you just learnt.</p>
			<p class="normal">It’s a bit like when a new employee starts work at a company. Existing employees only have to learn the name of that one new person. But the new employee has to learn the name of each person in the entire company. It is relatively easy for the existing employees to remember one new name and a lot harder for the new person to start from scratch and learn all the names. Similarly, when you’re an experienced Excel user reading a regular Excel book, you already know a lot and need to learn only a few things that are new&mdash;and those new bits are likely to be gold. It is easy to remember those few new things because often they strike a chord with you. Even if you don’t remember the details, the next time you face a similar problem, you’ll remember that you read something about it once, and you’ll be able to go find your book to look it up.</p>
			<p class="normal">Well, unfortunately for seasoned Excel users, Power BI is a completely different piece of software from Excel. It shares some things in common (such as some common formulas), but many of the really useful concepts are very different and completely new. They are not super-difficult to learn, but indeed you will need to learn from scratch, just as that new employee has to learn the names of many people. Once you get a critical mass of new Power BI knowledge in your head, you will be off and running. At that point, you will be able to incrementally learn all you want, but until then, you need to read, learn, and, most importantly, practice, practice, practice.</p>
			<p class="h"><span class="b2">Passive vs. Active Learning</span></p>
			<p class="normal">I think about learning as being either passive or active. An example of passive learning is lying in bed, reading your Power BI book, nodding your head to indicate that you understand what is being covered. When you learn something completely new, you simply can’t take this approach. The DAX language was released in Power Pivot for Excel some 3 years before Power BI was first introduced, and I read a lot of Power Pivot books early in my discovery. Despite all my reading, the first time I sat in front of my computer and wanted to write some DAX, I was totally lost. What I really needed to do was change from a passive learning approach to an active approach, where I was participating in the learning process rather than being a spectator.</p>
			<p class="normal">Passive learning on its own is more suited to incrementally adding knowledge to a solid base. Passive learning is not a good approach when you are starting something completely new from scratch. I’m not saying that passive learning is bad. It is useful to do some passive learning in addition to active learning, but you shouldn’t try to learn a completely new skill from scratch using only passive learning.</p>
			<p class="h"><span class="b2">Learning to Play Golf</span></p>
			<p class="normal">I decided to take up golf when I was 53 years old. I had reached a stage in my career where I was working from home full time and had enormous flexibility as to when I did my work. I needed to find a new hobby to give me some downtime as my previous hobby&mdash;helping people on Excel forums in my spare time&mdash;was now my full-time job. I simply couldn’t relax by helping others on forums anymore (unfortunately). And I needed to get out of the house, as my work and home had become the same place. I decided to take up golf as it was a perfect fit for my needs.</p>
			<p class="normal">You’re probably wondering what my new golf habit has to do with Power BI. Well, I read a really good book about golfing techniques (a Tiger <a id="calibre_link-390" class="calibre3"></a>Woods book, so it should be good). I also watched countless YouTube videos of professionals playing the game and countless more videos on various techniques to help improve my golf. But none of these insights from others made as much of a difference in my golf game as getting out there and practicing and playing the game. You can read all the Power BI books you like, but you will not be any good at DAX or data modelling until you actually do it yourself.</p>
			<p class="h"><span class="b2">How to Get Value from This Book</span></p>
			<p class="normal">There are 46 “Here’s How” worked-through examples and 73 individual practices exercises in this book. That gives you almost 120 opportunities to learn and practice. (Did you see what I said there? These are opportunities for you to practice.) Make the most of these opportunities to develop your skills; after all, that is why you purchased this book.</p>
			<p class="normal">If you think you can get value from this book by reading it and not doing the practice exercises, let me tell you: You can’t. If you already know how to complete a task and you have done it before, then just reading is fine. However, if you don’t know how to do a task or an exercise, then you should practice in front of your computer. First, try to do an exercise without looking at the answers. If you can’t work it out, then reread the worked-through examples (labelled “Here’s How”) and then try to do the exercise again. Practice, practice, practice until you have the knowledge committed to memory and you can do it without looking.</p>
			<p class="h"><span class="b2">Don’t Treat This Like a Library Book</span></p>
			<p class="normal">As kids going to school, most of us were taught that we should not write in library books. And I guess that is fair enough. Other people will use a library book after you are finished, and they probably don’t want to read your scribbles. Unfortunately, the message that many of us took away was “Don’t write in any book ever.” I think it is a mistake to think that you can’t write in your own books. You bought it, you own it, so why can’t you write in it? In fact, I would go so far as to say you should write in the reference books you own. You bought them for a reason: to learn. If you are reading this book and want to make some notes to yourself for future reference, then you should definitely do that.</p>
			<p class="normal">But I guess I am forgetting the eBook revolution. You can’t write in an eBook, but I know you can highlight passages of text in a Kindle, and I assume you can do something similar in other eBooks. You can also type in your own notes and attach them to passages of text in many eBooks. There are lots of advantages of eBooks, and the one that means the most to me is the fact that I can have a new book in front of me just moments after I have decided to buy it.</p>
			<p class="normal">Personally, I prefer to read a tactile object so I can flip through the pages, add sticky notes, and so on. But that is just me, and we are all different. I am sure there are plenty of people in both camps. On the upside, eBooks are usually in colour, and printed books (like this one) are more often in black and white. Whichever camp you are in&mdash;eBook or physical book&mdash;I encourage you to write in this book and/or make notes to yourself using the eBook tools at your disposal. Doing so will make this book a more useful, personalised tool well into the future.</p>
			<p class="h"><span class="b2">Getting Help Along the Way</span></p>
			<p class="normal">Hopefully you will be able to complete the practice exercises in this book on your own. But sometimes you might need to ask someone a question before you can move forward. I encourage you to become a member of my community <a id="calibre_link-234" class="calibre3"></a>forum at <a href="http://xbi.com.au/scpbiforum" class="calibre3"><span class="u">http://xbi.com.au/scpbiforum</span></a> and participate as someone who asks questions and also as someone who helps others when they get stuck. Answering questions for other people is a great way to cement your learning and build depth of knowledge. You will notice from the URL that this is an Aussie forum; however, it is open to everyone. At this writing, only 15% of all traffic at the forum is from Australia, with the balance coming from more than 130 other countries around the world. I suggest that you sign up and get involved; your DAX will be better for it.</p>
			<p class="normal">You can find a subforum dedicated to this book at my community forum (linked above). In the unfortunate event that there are errors in this book, you can go to this subforum for details.</p>
			<p class="h"><span class="b2">How This Book Is Organised</span></p>
			<p class="normal">I’ve organised this book to make sense to a new Power BI user starting from the beginning as well as to be useful as a reference guide. The general structure of the chapters is as follows:</p>
			<ul class="calibre2">
				<li class="bl">Each chapter’s title begins with either “DAX Topic” or “Concept.” A “DAX Topic” chapter covers one or more specific DAX formulas, including the syntax and usage; a “Concept” chapter covers one or more principles that you need to understand in order to be competent with Power BI. I’ve ordered the chapters so that you can learn incrementally. Each “Concept” chapter starts with a description of the concept, and each “DAX Topic” chapter starts with some information about the DAX language to help you understand the topic.</li>
				<li class="bl">Almost every chapter provides at least one worked-through example. When you see “Here’s How,” you know you’re reading one of those, and it’s time to sit in front of your computer and follow along with me as I explain the concept. See the <a href="#calibre_link-32" class="calibre3">"Table of Here's How Sections" on page 284</a>.</li>
				<li class="bl">Almost every chapter includes a number of practice exercises that help you practice what you have learnt. You will find guidelines to complete the exercises, and you can also find the answers in Appendix A. I recommend that you complete the exercises first and only then look at the answers to ensure that you got the correct results. This way you can cement your learning as you work through the book.</li>
				<li class="bl">As in Excel, there is often more than one way to do something in DAX. If you do an exercise differently than I show how to do it, as long as you get the correct/same answer, all is good.</li>
			</ul>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-65"></a>Here’s How: </span><span class="b2"><a id="calibre_link-305"></a></span><span class="b2">Getting Power BI Desktop</span></p>
			<p class="normal">All the instructions in this book use Power BI Desktop as the data modelling tool. To download this free tool, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Navigate to <a href="http://powerbi.com"><span class="u1">http://powerbi.com</span></a>.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Go to the Products menu (see #1 below) and select Power BI Desktop (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute1" src="images/000105.png" alt="" /></p>
			<table id="calibre_link-405" class="note-table">
				<colgroup class="calibre4">
					<col class="calibre5"></col>
				</colgroup>
				<tbody class="calibre6">
					<tr class="note-table1">
						<td class="note-table2">
							<p class="normal"><span class="b3">Note: </span>At this writing, there are five other links under Power BI Desktop in the Products menu shown above (though this list changes quite often):</p>
							<ul class="calibre2">
								<li class="bl">Power BI Pro and Power BI Premium are licencing models for Power BI.</li>
								<li class="bl">Power BI Mobile links to the free Power BI apps for iOS and Android devices.</li>
								<li class="bl">Power BI Embedded allows developers to build Power BI reports directly inside their own custom software.</li>
								<li class="bl">Power BI Report Server is an on-premises version of Power BI for companies that do not wish to use a cloud-based solution.</li>
							</ul>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Once you arrive at the Power BI Desktop page, click the Download Free button.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000115.png" alt="Download button for the free download of Power BI Desktop" /></p>
			<table id="calibre_link-406" class="note-table">
				<colgroup class="calibre4">
					<col class="calibre5"></col>
				</colgroup>
				<tbody class="calibre6">
					<tr class="note-table1">
						<td class="note-table2">
							<p class="normal"><span class="b3">Note: </span>You need administrator rights on your PC to be able to install the software. Also, the default download is the 64-bit version of Power BI Desktop that is installed from the <a id="calibre_link-281" class="calibre3"></a>Microsoft Store. This is the best option for most people. Here are a few key points for consideration:</p>
							<ul class="calibre2">
								<li class="bl">Where possible, you should install Power BI Desktop 64-bit from the Microsoft Store. When you install the software this way, Windows will automatically keep the software up to date. The software changes monthly, and you need to keep up with the updates. Make sure you install the software with the name Power BI Desktop.</li>
								<li class="bl">The 64-bit version of Power BI will work even if you have 32-bit Microsoft Office on your PC. If for some reason you need the 32-bit version of Power BI, you can click See Download or Language Options and download it from there.</li>
								<li class="bl">If you can’t install from the Microsoft Store (some companies disable this feature), you can click See Download or Language Options and download a standalone installation package from there.</li>
							</ul>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="h"><span class="b2"><a id="calibre_link-377"></a></span><span class="b2">Updates to Power BI Desktop</span></p>
			<p class="normal">Power BI Desktop is constantly being updated, and new software updates are released every month. This is great because each month you will be able to access new and exciting features developed by the team at Microsoft. If you install Power BI Desktop from the Microsoft Store as outlined above, you will always have the latest version; there is nothing else you need to do. If, however, you use one of the standalone installation packages, you will need to keep the software up to date yourself.</p>
			<p class="normal">When there is a new version of Power BI Desktop available for you to install, you see a notification in the bottom-right corner of the application, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000123.png" alt="" /></p>
			<p class="normal">You can simply click on this notification to download the latest version. To complete the installation, you need to have admin rights, and you also need to close Power BI Desktop.</p>
			<p class="note"><span class="b1">Note: </span>One downside of Microsoft releasing new versions of Power BI Desktop every month is that it is inevitable that some of the screenshots in this book will look different from what you see on your screen, given that you will surely have a newer version of the software than I used while writing this book. Please keep this in mind as you read.</p>
			<p class="h"><span class="b2">Power BI </span><span class="b2"><a id="calibre_link-236"></a><a id="calibre_link-312"></a></span><span class="b2">Pro vs. Power BI Free Accounts</span></p>
			<p class="normal">Power BI Desktop is a free data model authoring tool that is used to build data models and reports. After you build a report, you can share it as a file with other Power BI Desktop users (just as you can an .xlsx file). With Power BI Desktop, you can also publish your reports to PowerBI.com, where the reports can be easily shared with other Power BI users; this is how reports are typically shared.</p>
			<p class="normal">You need a Power BI account in order to use PowerBI.com. There are two types of Power BI accounts: free and Pro. A free account allows you to use most of the functionality of PowerBI.com, but there are some significant exceptions. You cannot share your work with others other than through public (unsecure) sharing, and you can’t use some features, including Analyze in Excel, unless you have a Pro (or Premium) account. If you want to share reports and dashboards with other users, you need to either ensure that each of those users has a Power BI Pro account or post the reports on a Power BI Premium workspace. You can read more about Power BI licencing at <a href="https://powerbi.microsoft.com/en-us/pricing" class="calibre3"><span class="u">https://powerbi.microsoft.com/en-us/pricing</span></a>.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-339"></a><a id="calibre_link-211"></a><a id="calibre_link-112"></a></span><span class="b2">AdventureWorks Database</span></p>
			<p class="normal">It is surprisingly difficult to create your own database of meaningful data to use for data analysis practice. Think about the data that exists in a commercial retail business, for example: data on customers, finances, sales, products, territories, etc. And it is not a simple task to create a meaningful quantity of realistic data from scratch; it is a lot of work. Microsoft has created a number of sample databases that anyone can download and use for free. I use a modified version of the Microsoft AdventureWorks database throughout this book. You will need to download a copy of this modified version, in Microsoft Excel format, by going to <a href="http://xbi.com.au/sample-db" class="calibre3"><span class="u">http://xbi.com.au/sample-db</span></a>. (Note that you do not need to have Microsoft Excel installed to load this data into Power BI Desktop, although most people will have Excel anyway.) This is the same sample database I use in all my training classes.</p>
			<p class="normal">Not everyone who reads this book will want to learn about sales reporting, but virtually everyone is familiar with shopping, and the AdventureWorks database makes using Power BI relevant for all users. AdventureWorks is a worldwide chain of bicycle stores that has retail stores in countries including Australia, the United States, Canada, France, and the United Kingdom. You can probably imagine walking into a retail bicycle store, with products such as bikes, helmets, tubes and tyres, water bottles, and clothing displayed for sale. As a shopper, you can purchase one or more products by going to the cash register and paying for the goods. When you do this, the register operator typically scans your purchases, maybe takes your name, issues you a receipt, and charges you the total amount of the transaction.</p>
			<p class="normal">Below is a sample invoice (register receipt) for one customer (Jon Yang) in the AdventureWorks database. Jon purchased five products on 4 November 2018. (In this book I use the international date format dd Month yyyy or dd/mm/yyyy. Sorry in advance to U.S. readers.)</p>
			<p class="fp"><img class="_idgenobjectattribute3" src="images/000132.png" alt="" /></p>
			<p class="normal">The data that is produced during this transaction gets stored in the AdventureWorks database as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000140.png" alt="" /></p>
			<p class="normal">The data shown in the image above comes from the <span class="mono">Sales</span> table, but a lot more data related to the transaction is stored in other tables, such as the <span class="mono">Customers</span> table and the <span class="mono">Products</span> table.</p>
			<p class="h"><a id="calibre_link-290"></a><span class="b2">Naming Conventions</span></p>
			<p class="normal">This book uses best-practice naming conventions for DAX in Power BI:</p>
			<ul class="calibre2">
				<li class="bl">There are no spaces in table names, like this:<p class="codeindented"><span class="monoitalic">TableName</span></p></li>
				<li class="bl">Columns in tables always include the table name followed by the column name in square brackets, like this:<p class="codeindented"><span class="monoitalic">TableName</span><span class="mono1">[</span><span class="monoitalic">ColumnName</span><span class="mono1">]</span></p></li>
				<li class="bl">Measures never include a table name, they often include spaces, and they are wrapped in square brackets, like this:<p class="codeindented"><span class="mono1">[</span><span class="monoitalic">MeasureName</span><span class="mono1">]</span></p></li>
				<li class="bl">Measure and column formulas are written with the formula name (without the square brackets) followed by the formula, like this:<p class="codeindented"><span class="mono1">Total Sales = SUM(Sales[ExtendedAmount])</span></p></li>
			</ul>
		</div>
	</div>


<div id="calibre_link-33" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-407" class="ch"><span class="b2"><a id="calibre_link-4"></a>1: Concept: Introduction to </span><span class="b2"><a id="calibre_link-175"></a></span><span class="b2">Data Modelling</span></p>
			<p class="normal">In the past, the term data modelling was often unfamiliar to business users as data modelling tended to be the domain of IT BI professionals. But this is no longer the case, thanks to the introduction of self-service BI tools such as Power BI and Power Pivot for Excel.</p>
			<p class="h"><span class="b2">What Is Data Modelling?</span></p>
			<p class="normal">Data modelling is the process of taking data from various sources; loading, structuring, and relating data logically to other data; and enhancing, embellishing, and generally preparing the data for use. The objective is to allow the data to be used without having to write a custom query every time you want to look at a different subset of data.</p>
			<p class="normal">The data modelling process includes:</p>
			<ul class="calibre2">
				<li class="bl">Determining the optimal structure and shape of the source data to analyse, including whether to bring in all the data, a subset of the data, or summary data.</li>
				<li class="bl">Loading the data from the source into the data model (Power BI in this case).</li>
				<li class="bl">Defining the logical relationships between the various tables (which is similar to what you do with <span class="mono">VLOOKUP()</span> in Excel, except the data stays in the source table in Power BI).</li>
				<li class="bl">Defining data types (e.g., specifying whether a column of data is a column of decimal values or a column of currency values, a column of text, etc.).</li>
				<li class="bl">Creating new insights from the source data so that you can analyse concepts that don’t exist natively in the source data but that can be calculated or created inside the data model. For example, if you have a table of transactional data with cost price and selling price, you can extend the data model to include calculations for margin, margin percentage, etc., even though these concepts are not explicitly in the source data. Once you have modelled these new facts in the data model, they can be reused over and over by people using your workbook.</li>
				<li class="bl">Giving meaningful names to your new business insights (i.e., to your measures).</li>
			</ul>
			<p class="h"><span class="b2">Power BI, Power Pivot, and SSAS Tabular</span></p>
			<p class="normal">The data modelling engine that is used inside Power BI is the same one used in Power Pivot for Excel and SQL Server Analysis Services (SSAS) Tabular. The engine has quite a few names, including xVelocity, VertiPaq, SSAS Tabular, and Power Pivot. Despite the different names, the engine is essentially the same across all of these software products (with the exception of any version differences related to version release timing). It therefore follows that virtually everything you learn in this book about data modelling and DAX can be applied to <a id="calibre_link-307" class="calibre3"></a>Power Pivot for Excel and <a id="calibre_link-359" class="calibre3"></a>SSAS Tabular. In this book I most commonly refer to Power BI, but you should keep in mind that most of the content also applies to these other products.</p>
			<p class="h"><span class="b2">Remember: Power BI Is a </span><span class="b2"><a id="calibre_link-357"></a></span><span class="b2"><a id="calibre_link-173"></a></span><span class="b2">Database Tool, and Excel Is a Spreadsheet Tool</span></p>
			<p class="normal">One very important concept you simply must understand is that Power BI is a database tool, and Excel is a spreadsheet tool. A database and a spreadsheet are not the same. A database has structure; it consists of one or more tables of data. Each table has zero, one, or more rows of data and one or more columns. Each column has a defined data format, and the data in each column must conform to that format. A database does not have a column-and-row reference system. A spreadsheet (e.g., an Excel worksheet) lacks the structure of a database. A spreadsheet, like a database, has columns and rows, but these columns and rows lack structure. You can put any data you want into any cell in a spreadsheet, and you can refer to a cell by using a cell reference. You have to follow a lot of rules with a database that don’t apply to a spreadsheet.</p>
			<p class="normal">Remember that Power BI is not Excel. You need to think differently if you are to master Power BI than you need to think to master Excel.</p>
			<p class="h"><span class="b2">Power BI Is a </span><span class="b2"><a id="calibre_link-174"></a></span><span class="b2">Data Model&ndash;Based Tool</span></p>
			<p class="normal">Power BI is a data model&ndash;based BI reporting tool. Not all BI tools are data model based. One example of a non-data model&ndash;based BI tool is SQL Server Reporting Services (SSRS). Non-data model&ndash;based BI reporting tools require the report writer to first generate a query to fetch the data from a database (typically SQL Server) and return the results of that query to SSRS so the results can be rendered in a report. With a non-data model&ndash;based reporting tool, you can typically use a user interface that helps with the generation of the query, or you can use a scripting language such as T-SQL to fetch the data that you need for each report.</p>
			<p class="normal">Traditional Excel&mdash;that is, the spreadsheet tool without the modern BI add-ins of Power Query and Power Pivot&mdash;is also a non-data model&ndash;based BI tool. In the case of traditional Excel, the user loads data into the spreadsheet and then logically relates and aggregates the data using Excel formulas and builds a report (often on a new sheet) to summarise and present the results (the report).</p>
			<p class="normal">Now don’t confuse “a tool” here with “a data model&ndash;based tool.” Excel is definitely a tool; it is a very flexible tool that lets you build virtually any report without being a programmer. In fact, I think Excel is probably the best and most popular BI tool ever invented. But it is not a data model&ndash;based tool because traditional Excel doesn’t have a data model.</p>
			<p class="normal">There is nothing wrong with using a non-data model&ndash;based BI tool; it is just a different approach from using a data model&ndash;based tool. The biggest issue with non-data model&ndash;based reporting tools is that every time you need a new report, you have to start again, often from scratch. Each report has a single purpose, and there is very little reusability or extensibility.</p>
			<p class="normal">A data model&ndash;based tool like Power BI has many benefits, including the following:</p>
			<ul class="calibre2">
				<li class="bl">The author of the data model builds a reusable model that can be used to solve the current reporting requirements as well as (often) future requirements without the need to write further queries to retrieve a new subset of data.</li>
				<li class="bl">The author can often be a business user (normally with good Excel skills) and doesn’t have to be a professionally trained database administrator or SQL professional.</li>
				<li class="bl">The data model is conceptual in nature, supported by a user-friendly interface that lets you build the data model logically, with minimal coding. Keep in mind that you do need to do some coding (formula writing) for a good data model, but it is fairly easy&mdash;no harder than building a typical spreadsheet in Excel&mdash;when you have the skills, as you will see later in this book.</li>
			</ul>
			<p class="normal">The term data modelling can be a little bit scary, but there is no reason to be concerned. When you learn the DAX language and join your tables of data in Power BI, you are actually learning data modelling. By the time you have finished this book, you will be well on your way to being an accomplished data modeller using Power BI. Just use the techniques covered in this book and keep in mind that what you are actually doing is learning to be a data modeller.</p>
			<p class="normal">With all this in mind, it’s time to build your first simple data model.</p>
		</div>
	</div>


<div id="calibre_link-34" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-408" class="ch"><span class="b2"><a id="calibre_link-5"></a>2: Concept: </span><span class="b2"><a id="calibre_link-262"></a></span><span class="b2">Loading Data</span></p>
			<p class="normal">The first step in data modelling is to load data into Power BI Desktop. The image below shows the data connector that appears when you connect to a SQL Server database from Power BI Desktop. (There is a different data connector for each data source. You’ll see how to get to the various data connector screens later in this chapter.) There are two modes that you can use in Power BI Desktop when loading data from a database tool such as <a id="calibre_link-358" class="calibre3"></a>SQL Server: <a id="calibre_link-247" class="calibre3"></a>Import and <a id="calibre_link-195" class="calibre3"></a>DirectQuery.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000150.png" alt="Connecting Power BI Desktop to SQL Server database" /></p>
			<p class="normal">Most data sources do not provide these two options and instead only allow you to use Import mode. This book focuses on Import mode. When you use Import mode, Power BI Desktop loads a complete copy of the source data into the data model as the first step in the process. Once it is loaded, you can share your .pbix workbook with others, and there is no need for anyone else to have direct access to the source data. Alternatively, you can publish your reports to PowerBI.com and share the contents with others from there. When you publish a report to PowerBI.com, a complete copy of the data is loaded into the cloud also, without the need for it to access the source data. The data that is loaded into your data model retains a connection to the original source. It is a simple task to <a id="calibre_link-323" class="calibre3"></a>refresh the data when the data at the source changes. Such a refresh can either be triggered manually or set to automatically occur on a schedule.</p>
			<p class="normal">When you load data into Power BI Desktop, you have to decide which data to load, including which tables, which columns in each table, etc. I call this the shape of the data. The following “Here’s How” shows how to load data that has been prepared for you. But you need to be aware that the process of deciding which data to load is an important part of the data modelling process, as discussed later in this chapter.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-35"></a><a id="calibre_link-409"></a>Here’s How: Loading Data from a New Source</span></p>
			<p class="normal">If you don’t already have a copy of the custom version of the AdventureWorks database used in this book, you should download the sample Excel file now (from <a href="http://xbi.com.au/sample-db" class="calibre3"><span class="u">http://xbi.com.au/sample-db</span></a>), unzip it, and place it in a location that is easy for you to find. In the following steps, you will load the following tables from the AdventureWorks database:</p>
			<p class="code"><span class="mono1">Sales</span></p>
			<p class="code"><span class="mono1">Products</span></p>
			<p class="code"><span class="mono1">Territory</span></p>
			<p class="code"><span class="mono1">Calendar</span></p>
			<p class="code"><span class="mono1">Customers</span></p>
			<p class="normal">For convenience and ease of access, I have extracted all the relevant data from the AdventureWorks database into individual sheets inside an Excel workbook; that is what you will find inside the .zip file. The following steps show you how to load these database tables from the Excel workbook and prepare them for use in Power BI:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Open Power BI Desktop. You should see a blank Power BI Desktop file with a ribbon along the top, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000159.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>From the Home tab in Power BI Desktop, select Excel (see #1 above). Alternatively, select Get Data (#2 above), All, Excel (#1 below) and then click Connect (#2 below).</p>
			<p class="fp"><img class="_idgenobjectattribute4" src="images/000167.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Browse to the location of the sample Excel file you downloaded earlier and click Open.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>When Power Query connects to the file, you see a list of all objects that can be imported into Power BI. In this instance, you see a list of sheets inside Excel that contain data that can be loaded. You need to select the five sheets that contain the tables of data needed for this book, as shown below. At this point, you should not load the other sheets of data.</p>
			<p class="fp"><a id="calibre_link-291"></a><img class="_idgenobjectattribute2" src="images/000176.png" alt="" /></p>
			<p class="tip"><span class="b1">Tip: </span>The sample data for this book has been well prepared for learning how to use Power BI. You should not assume that a source database has the correct table structure for Power BI; few of them do. In most cases, you need to transform data as described in the following note.</p>
			<p class="note"><span class="b1">Note: </span>If you now click the Transform Data button shown above, you will launch the <a id="calibre_link-317"></a>Query Editor (in <a id="calibre_link-308"></a>Power Query), where you can transform the data prior to loading it into Power BI Desktop. Power Query is a tool in its own right and has its own language, called M, that facilitates data cleaning and shaping to prepare the data for use. Learning about <a id="calibre_link-309"></a>Power Query is beyond the scope of this book, but I have a comprehensive online training course specifically designed to teach you how to use this powerful tool. You can learn more about that training course at <a href="http://xbi.com.au/powerquerytraining"><span class="u1">http://xbi.com.au/pq-training</span>.</a><br class="calibre7" /><br class="calibre7" />Notice that two of the tables listed above have names that start with the prefix <span class="mono1">dim</span> (short for dimension): <span class="mono1">dimProductCategory</span> and <span class="mono1">dimProductSubCategory</span>. In database design, it is very common for tables to have prefixes like this. <span class="mono1">fct</span> (short for fact) is another example of a table prefix. It is best practice to remove any such prefixes from table names if they exist in the source data. These prefixes have meaning to IT folk and help identify the type of table, but given that these table names will be visible to business users who use your Power BI reports, it is best to remove the prefixes after import by simply right-clicking a table and renaming it (or by renaming the tables during loading from within Power Query).</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Click Load, and Power BI Desktop loads your data. After the Table Import Wizard is closed, you see the five tables you have just imported in Power BI on the right side, as shown below. Each of the tables is a complete copy of the data you imported from the source files (an Excel workbook, in this example). You don’t need the source files again until you are ready to refresh the data&mdash;typically when the data changes at some time in the future. This is one of the many great things about Power BI: You can simply refresh the data when the data changes, and your workbooks are updated with the new data.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000185.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Switch to the <a id="calibre_link-179"></a>Data view by clicking the Data icon (see #1 above). You can now see the data in the tables, as shown in the image below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000193.png" alt="Renaming a table in Power BI Desktop" /></p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>In the Data view, double-click the <span class="mono1">Territory</span> table name on the right, as shown below, and <a id="calibre_link-329"></a>rename it <span class="mono1">Territories</span> for consistency (e.g., naming all tables with plurals&mdash;except <span class="mono1">Calendar</span>, of course).</p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>For the next stage of the data modelling process, which involves creating the logical relationships between the tables, switch to the <a id="calibre_link-285"></a>Model view by clicking the Model icon (see #1 below).</p>
			<p class="fp"><img class="_idgenobjectattribute5" src="images/000202.png" alt="Switching to modelling view by clicking on the Model button in the left panel." /></p>
			<p class="nl1"><span class="_idgenbnmarker">9.</span>If you can’t see all five tables on the screen, click the <a id="calibre_link-229"></a>Fit to Screen button (#1 below). You can also collapse the tables (#2, #3, and #4) to save space in this view.</p>
			<p class="note"><span class="b1">Note:</span> You do not need to see all the columns in the Model view. The purpose of this view is to show how the tables are related. If you want to see the column names, switch to the Data view. Trust me.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000210.png" alt="" /></p>
			<p class="nlc">In the image shown below, two of the tables have automatically been joined. Power BI, by default, automatically attempts to logically join the tables of data together. These automatically created relationships may or may not be correct; in this case, they are indeed correct.</p>
			<p class="fp"><img class="_idgenobjectattribute6" src="images/000218.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">10.</span>If desired, change the layout of these tables by dragging and dropping. As you will learn later in this chapter, I recommend positioning the tables so that any transactional tables (there is only one, <span class="mono1">Sales</span>, in this case) are at the bottom of the screen and the lookup tables are at the top. </p>
			<p class="fp"><img class="_idgenobjectattribute7" src="images/000227.png" alt="" /></p>
			<p class="normal">When you’ve completed these steps, you need to create relationships between the <span class="mono">Sales</span> table and the other four tables. You’ll learn how to do so in the next “Here’s How” section.</p>
			<p class="h"><a id="calibre_link-176"></a><a id="calibre_link-158"></a><a id="calibre_link-297"></a><span class="b2">Other Data Sources</span></p>
			<p class="normal">In this book, I teach you how to import data from the AdventureWorks Excel sample file, but this file is only an example of the many data sources that you will likely need as you build your own reports. There are many other data source connectors available in Power BI (though technically they are part of Power Query). To see a full list, simply click on Get Data, More, All. You can then see the full list of currently supported data connectors in Power BI. The screenshot below shows some of the connectors in this list.</p>
			<p class="fp"><img class="_idgenobjectattribute8" src="images/000235.png" alt="" /></p>
			<p class="normal">The general process for importing data is the same for any data source you use: You simply select the appropriate data source and then follow the import wizard just as shown earlier in this chapter, under <a href="#calibre_link-35" class="calibre3">"Here’s How: Loading Data from a New Source" on page 9</a>.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-66"></a>Here’s How: Creating </span><span class="b2"><a id="calibre_link-255"></a><a id="calibre_link-327"></a></span><span class="b2">Relationships in Power BI Desktop</span></p>
			<p class="normal">The Introduction provides a high-level overview of the AdventureWorks database. Here we look more closely at some of the tables in that database. The <span class="mono">Sales</span> table holds records of sales transactions. It has the following features:</p>
			<ul class="calibre2">
				<li class="bl">One row of data is generated for each item scanned at the cash register and stored in the <span class="mono">Sales</span> table.</li>
				<li class="bl">There can be many rows of data in the <span class="mono">Sales</span> table that together make up a single customer invoice.</li>
				<li class="bl">Each customer can shop many times, so there may be more than one invoice for each customer in the <span class="mono">Sales</span> table.</li>
				<li class="bl">The date, the customer number, the product codes, the quantity, the cost price, and the selling price of each item sold (among other data) are stored in the <span class="mono">Sales</span> table.</li>
				<li class="bl">Only the absolute minimum amount of data needed to identify the customer, the product, the time period, and the store are recorded in the <span class="mono">Sales</span> table. This data is presented in “key” columns, such as <span class="mono">Customer Key</span> (e.g., customer number) and <span class="mono">Product Key</span> (e.g., product number).</li>
			</ul>
			<p class="note"><span class="b1">Note:</span> As described later in this chapter, I call the transaction tables data tables and the other tables lookup tables.</p>
			<p class="normal">Each transaction in the <span class="mono">Sales</span> table contains a customer key that uniquely identifies which customer purchased each item. All the other information about that customer (e.g., name, address) is stored in the <span class="mono">Customers</span> table. When using traditional Excel, it is common to write a <span class="mono">VLOOKUP()</span> formula to fetch the name of the customer who purchased each item and bring it back to the <span class="mono">Sales</span> table. This is not required in Power BI. Instead, the two tables of data (the <span class="mono">Sales</span> table and the <span class="mono">Customers</span> table) can be logically related using the common customer key that exists in both tables. When these tables are joined using the customer key, there is a one-to-many (<span class="mono">Customers</span> to <span class="mono">Sales</span>) relationship between these two tables. Exactly the same principle applies to the <span class="mono">Products</span>, <span class="mono">Calendar</span>, and <span class="mono">Territories</span> tables.</p>
			<p class="normal">To join a lookup table to a data table in Power BI Desktop, follow these steps:</p>
			<p class="note"><span class="b1">Note:</span> It is important to follow these steps now as doing so will create a foundation for all the practice in the rest of this book.</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Expand the <span class="mono1">Sales</span> and <span class="mono1">Calendar</span> tables to view all the columns (if needed).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Select a column from the data table (the table at the bottom of the Power BI Desktop screen, as shown below). To do this, click the <span class="mono1">OrderDate </span>column in the <span class="mono1">Sales </span>table and hold down the left mouse button (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Drag the column up and hover over the matching key in the lookup table (in this case, the <span class="mono1">Date</span> column in the <span class="mono1">Calendar</span> table) until you can see that you are hovering over the correct column in the <span class="mono1">Calendar</span> table (see #2 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Release the mouse button to complete the relationship.</p>
			<p class="nlc">The <span class="mono">Sales</span> and <span class="mono">Calendar</span> tables are now joined with a one-to-many relationship on the <span class="mono">Date</span> column.</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000244.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Complete the same process for the remaining tables. See if you can work out on your own which are the correct columns to join before you look at the answers below. Note that it is not mandatory for the key columns to have the same name, although it is good practice to name them the same.</p>
			<p class="fp"><img class="_idgenobjectattribute10" src="images/000309.png" alt="" /></p>
			<p class="nlc">Because these are one-to-many relationships, the joins are specifically single-directional (and you see an arrow pointing downward toward the <span class="mono">Sales</span> table). Always <a id="calibre_link-201" class="calibre3"></a>drag from the data table up to the lookup table rather than the other way around (as you would if you were writing a <span class="mono">VLOOKUP()</span> in Excel). It will work the other way, but this is the correct way to do it.</p>
			<p class="nlc">As you can see in the image below, an asterisk appears at the end of the relationship that points to the data table (<span class="mono">Sales</span>), and a 1 appears at the end that points to a lookup table. In each case, an arrow points toward the <span class="mono">Sales</span> table. (You’ll learn more about these arrows later in this chapter.)</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000252.png" alt="" /></p>
			<p class="nlc">By putting the data table at the bottom, you create a visual clue that the tables at the top of the screen are lookup tables. (Get it? You have to “look up” to see the lookup tables.)</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span><a id="calibre_link-340"></a>Save the Power BI Desktop file by clicking the Save icon, as shown below, and give your file a suitable name and location so you can find it again later.</p>
			<p class="fp"><img class="_idgenobjectattribute11" src="images/000261.png" alt="" /></p>
			<p class="h"><a id="calibre_link-40"></a><span class="b2"><a id="calibre_link-343"></a></span><span class="b2">Shaping Data</span></p>
			<p class="normal">It’s time to pause for a minute to discuss the optimal shape of data for Power BI. When I say “shape” of data, I am talking about things like how many tables you import, how many columns are in each table, how many rows are in each table, which columns are in each of the tables, etc.</p>
			<p class="normal">Shaping data is a huge topic, and I don’t have room here to discuss it fully. But I do want to give some foundational advice in this section and the sections that follow to get you started. One reason this advice is important is because the shape of data in transactional systems (and relational databases) is seldom the ideal shape for Power BI. When an IT department executes an enterprise BI project, one of the important first steps is to shape the data so it is optimal for reporting. This step is normally completely hidden from the end user (i.e., you), and hence the end user is shielded from the need for shaping. But I am sharing this important information with you here and now because you need to understand data shaping if you want to have efficient and effective Power BI data models. Just copying what you have in your source data is highly likely to cause you grief down the track. For more in-depth information about shaping data, I recommend this book: <a href="http://xbi.com.au/shaping-book" class="calibre3"><span class="u">http://xbi.com.au/shaping-book</span></a>.</p>
			<p class="h"><span class="b2">Choosing a Schema (Table Structure)</span></p>
			<p class="normal">The generally accepted approach to bringing data into Power BI is to bring in the data in what’s known as a <a id="calibre_link-360" class="calibre3"></a>star schema. This is a technical term that comes from the <a id="calibre_link-257" class="calibre3"></a>Kimball methodology (also known as dimensional modelling) and describes the logical way data should be structured for optimal reporting performance. The objective of dimensional modelling is to allow the user to produce reports and visuals from the data without the need to write a new query over the database for each new reporting requirement. The visual layout of the tables in the following image (which includes exactly the same data you just loaded) will help you see why it is called a star schema.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000269.png" alt="" /></p>
			<p class="normal">In a star schema, the data table or tables (<span class="mono">Sales</span> in this example) are surrounded by lookup tables (<span class="mono">Customers</span>, <span class="mono">Products</span>, <span class="mono">Territories</span>, and <span class="mono">Calendar</span> in this example), and together they visually make a star shape. You can find more comprehensive coverage of this topic in Chapter 6.</p>
			<p class="note"><span class="b1">Note:</span> <a id="calibre_link-194"></a>Dimensional modelling is a huge topic. I have a comprehensive online training course on dimensional modelling that I produced with Ken Puls and Miguel Escobar that you can find at <a href="http://xbi.com.au/dm-training"><span class="u1">http://xbi.com.au/dm-training</span></a>.</p>
			<p class="h1"><span class="b2">The Visual Layout of Tables in the Model View</span></p>
			<p class="normal">When it comes to visually positioning tables in the Model view, I teach business users to position the tables such that the lookup tables are located at the top of the window and the data tables are at the bottom of the window, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000277.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> While the optimum data model shape is a star schema, other shapes work, too. For example, you can use a <a id="calibre_link-352"></a>snowflake schema, with secondary lookup tables joined to the primary lookup tables; however, the extra relationships can come at the cost of degraded performance and possibly also confusion to users, particularly if they are building their own reports.</p>
			<p class="normal">If you compare the image above with the one just before it, you will see that they both have exactly the same logical relationships (links) between the tables: They are both star schemas, even though they have different visual layouts.</p>
			<p class="normal">The visual layout in the image just above is the one conceived and recommended by Rob <a id="calibre_link-152" class="calibre3"></a>Collie, and I call it the “<a id="calibre_link-151" class="calibre3"></a>Collie layout methodology.” The Collie layout methodology involves placing the lookup tables at the top of the window and the data tables at the bottom. The importance of this for business users learning Power BI will become evident later in the book. For now, just trust me and follow the Collie layout methodology.</p>
			<p class="h"><span class="b2">Understanding the Two Types of Tables: Lookup Tables and Data Tables</span></p>
			<p class="normal">In the IT world, lookup tables are referred to as dimension tables, and data tables are called fact tables. For business users, though, I suggest using the terminology lookup tables and data tables.</p>
			<p class="normal">A data table contains transactional information. The data table we use in this book, the <span class="mono">Sales</span> table, contains sales transactions. Lookup tables contain information about logical groups of objects, such as customers (<span class="mono">Customers</span> table), products (<span class="mono">Products</span> table), and time (<span class="mono">Calendar</span> table).</p>
			<p class="normal">Before Power BI, an Excel user needed to create one big flat table in Excel before creating a pivot table. Often that meant writing <span class="mono">VLOOKUP()</span> formulas to bring data from other tables into the one allowed big flat table. It is no longer necessary to bring data from the lookup tables into the data tables by using <span class="mono">VLOOKUP()</span> in Power BI. Instead, you can simply load the lookup tables and join them to the data table(s) with a relationship.</p>
			<p class="h1"><a id="calibre_link-263"></a><span class="b2">Lookup Tables</span></p>
			<p class="normal">You should have one lookup table for each “object” that you need for reporting purposes. For example, in the data being used here, these objects are customers, products, territories, and time (in the <span class="mono">Customers</span>, <span class="mono">Products</span>, <span class="mono">Territories</span>, and <span class="mono">Calendar</span> tables, respectively). A key feature of a lookup table is that it contains one and only one row for each individual item in the table, and it has as many columns as needed to describe the object.</p>
			<p class="normal">There is only one row for each unique customer in the <span class="mono">Customers</span> table. The <span class="mono">Customers</span> table has lots of columns describing each customer, such as customer number (key), customer name, and customer address, but there is only one row for each customer. Each row is unique, based on the customer number, and no duplicates of customer number (key) are allowed.</p>
			<p class="h1"><a id="calibre_link-177"></a><span class="b2">Data Tables</span></p>
			<p class="normal">It is possible to have many data tables, but there is only one in this example: the <span class="mono">Sales</span> table. This data table contains lots of rows (more than 60,000 in this case), which are all the transactional records of sales that occurred over multiple years. Importantly, the data table can be joined to each of the lookup tables. In this case, the <span class="mono">Sales</span> table contains one column (technically called a foreign key) that matches each of the keys in each lookup table (technically called a primary key). Stated differently, the <span class="mono">Sales</span> data table has four foreign key columns: a date key, a customer number key, a product number key, and a territory key. These columns allow the <span class="mono">Sales</span> data table to be logically joined to each of the lookup tables.</p>
			<p class="normal">Ideally, data tables should have very few columns but as many rows as needed to bring in all the data records. Data tables normally have lots of rows (sometimes in the tens of millions). It is common for lookup tables to have many more columns than data tables, with one column for each bit of information needed for reporting. I like to think of the extra columns in a lookup table as metadata as these columns provide more information about the unique primary key of the table. And I often say that data tables should be long and skinny, and lookup tables should be short and fat.</p>
			<p class="h"><span class="b2">The Shaping Bottom Line</span></p>
			<p class="normal">When it comes to shaping data, you need to remember the following:</p>
			<ul class="calibre2">
				<li class="bl">There are two types of tables: data tables, which contain the data you want to analyse, and lookup tables, which contain metadata about the objects you are going to analyse, such as the name, address, and city of each customer.</li>
				<li class="bl">The rule of thumb is to load one table for each object. This is both efficient for the database to process and easy for users to understand.</li>
				<li class="bl">The optimal way to shape your data is to use a star schema, but other schemas, such as a snowflake schema, can work, too, though they may be less efficient.</li>
				<li class="bl">For business users, I recommend positioning tables in the Power BI Model view, using the Collie layout methodology. (You’ll learn more about why you should do this in Chapter 5.)</li>
			</ul>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-67"></a>Here’s How: Making Changes to a Table That Is Already Loaded</span></p>
			<p class="normal">Sometimes you will want to make changes to the data that is loaded after the initial load is complete. This is a technical Power Query topic, but I cover it here so you will know what to do.</p>
			<p class="normal">Say that you want to make changes to the <span class="mono">Calendar</span> table so that you only bring in dates for the years 2017 and 2018, and you also want to remove the fiscal date columns from the table. You can do this by using the <a id="calibre_link-316" class="calibre3"></a>Query Editor. The following steps walk you through how to make changes like these to a table that is already loaded:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>In the Fields pane on the right (in the Report view or the Data view), right-click on the <span class="mono1">Calendar</span> table and select Edit Query.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the Power Query Editor that appears, navigate to the <span class="mono1">CalendarYear</span> column and click the drop-down arrow (see #1 below).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000285.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Deselect the years 2016 and 2019 from the drop-down list (see #2 and #3 above) and then click OK.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Remove the three fiscal columns by first selecting them all using either the Shift or Ctrl keys (see #1 below) and then right-clicking on one of the selected columns and selecting Remove Columns (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000293.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Click Close &amp; Apply and then save the .pbix workbook.</p>
			<p class="note"><span class="b1">Note: </span>When you are using the Power Query Editor as shown above, you are actually using the Power Query technology (the Data, Get Data menu options in Excel and the Home, Get Data menu options in Power BI). As mentioned earlier, using Power Query is a big topic that is not covered in detail in this book. I recommend that you refer to my online training course, at <a href="http://xbi.com.au/pq-training"><span class="u1">http://xbi.com.au/pq-training</span></a>, to learn more about this important topic.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-68"></a>Here’s How: </span><span class="b2"><a id="calibre_link-193"></a></span><span class="b2">Deleting Steps in a Query</span></p>
			<p class="normal">Now that you’ve seen how to make changes to a table that you have previously imported to the Power BI data model, you’re ready to get some practice. You need all the rows in the <span class="mono">Calendar</span> table for the practice exercises in this book, and the following steps walk you through how to clear the filters you applied on the <span class="mono">CalendarYear</span> column:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Right-click the <span class="mono1">Calendar</span> table and select Edit Query.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Click the X next to the step Filtered Rows, as shown in the image below, to remove the step.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Click Close &amp; Apply and save the .pbix workbook.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000301.png" alt="" /></p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-69"></a>Here’s How: </span><span class="b2"><a id="calibre_link-246"></a></span><span class="b2">Importing New Tables</span></p>
			<p class="normal">In this exercise, you will use Get Data to bring in the <span class="mono">ProductSubCategory</span> table from the source Excel workbook and join it to your data model. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>On the Home tab (see #1 below), click Recent Sources (#2) and then select the AdventureWorks workbook (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000310.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span><a id="calibre_link-315"></a>Select the <span class="mono1">dimProductSubCategory</span> table (see #1 below) and click Transform Data (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute12" src="images/000318.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Remove the <span class="mono1">dimProduct</span> prefix from the Name box on the right, as shown below, so you are left with <span class="mono1">SubCategory</span> as the query name, and then click Close &amp; Apply. Power BI automatically connects the new <span class="mono1">SubCategory</span> table to the existing <span class="mono1">Products</span> table. As mentioned earlier, Power BI attempts to do this by default where possible. Sometimes it gets it right, and sometimes it gets it wrong. It is best practice to always check the Model view for relationships after you load a table of data.</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000326.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>To apply the Collie layout methodology, place the <span class="mono1">SubCategory</span> table above the <span class="mono1">Products</span> table, as shown below (because <span class="mono1">SubCategory</span> is a lookup table of the <span class="mono1">Products</span> table).</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000335.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Save the .pbix workbook.</p>
			<p class="note"><span class="b1">Note: </span>Now that there is a second lookup table (<span class="mono1">SubCategory</span>) connected to another lookup table (<span class="mono1">Products</span>), this is technically a <a id="calibre_link-353"></a>snowflake schema. This shape will work, but it may be less efficient than a star schema. In addition, this shape may be confusing to users of the report because it does not follow the “one object, one table” rule; there are two tables that contain information about products. It is not wrong to do it this way. It is just a guideline to try to build models that follow the “one object, one table” rule where possible to keep the model easy to understand.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>To delete this <span class="mono1">SubCategory</span> table, right-click the table name in the Report view or the Data view and select Delete from Model. (You will not need this table again; the purpose of this exercise was simply to show you how to add new tables of data, when needed.)</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-70"></a>Here’s How: Changing the </span><span class="b2"><a id="calibre_link-217"></a></span><span class="b2">File Location of an Existing Connection</span></p>
			<p class="normal">It’s important to know how to move a source file to a new location and then point the existing data connection to that new location. You need to do this, for example, if you ever send a Power BI workbook as well as the data source to another user or if you need to change file locations on your own computer.</p>
			<p class="normal">The data connections you create in Power BI are relative to your computer. When you send a Power BI workbook and data source to another user, that person has to edit the data connection so that it will work on his or her own PC.</p>
			<p class="note"><span class="b1">Note: </span>You need to follow the steps in this section only if you send both a workbook and a data source to another user. But that is not normally what you do. Normally you don’t need to distribute the data at all because it is loaded in Power BI already.</p>
			<p class="normal">To simulate what can happen when a file location changes, the first thing you need to do in this case is to move the Excel file to a new location so the existing query cannot find it. Then you can change the file location of the existing connection. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>In Windows Explorer, create a new folder.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Navigate to your Excel file and move it into the new folder.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Try to refresh your queries (by clicking Refresh on the Home tab) and note that it doesn’t work, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute13" src="images/000343.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Click Close.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>On the Home tab, select Transform Data (see #1 below) and then Data Source Settings (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000351.png" alt="" /></p>
			<p class="tip"><span class="b1">Tip:</span> Be careful here. When a menu item (like the Transform Data menu above) has a small down arrow next to the description, it means that there is a drop-down menu just below the icon, and you will get different results if you click the icon than if you click on the down arrow below the icon.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Select the data source that relates to the Excel source file (see #1 below) and then click Change Source (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000000.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Browse to the new location by using File Explorer (see #1 below) and then click OK (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000007.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>Click Close in the Data Source Settings dialog and click Apply Changes to make the changes.</p>
			<p class="h"><span class="b2">There Are No </span><span class="b2"><a id="calibre_link-304"></a></span><span class="b2">Pivot Tables in Power BI</span></p>
			<p class="normal">The Power BI report canvas is very different from what you are used to using in Excel. This can be quite confronting to Excel users who are getting started with Power BI. But the good news is that you will be comfortable with it in no time. In October 2020, Microsoft updated the blank report canvas experience. Now, instead of seeing a blank page (as in PowerPoint), you see some watermark instructions that provide hints on how to load some data. This is a big step forward in helping beginners know what to do next.</p>
			<p class="normal">In Microsoft Excel, the most common way to aggregate data for BI-style reporting is to use a pivot table. But there are no pivot tables in Power BI. What’s worse (and confronting) is that you can’t even edit data inside the Data view in Power BI Desktop after the data is loaded; it is read only. Although Power BI has no pivot tables, it does allow you to use a matrix. A Power BI matrix is very similar to a pivot table and is (in my view) the best visual to use when you are learning to write DAX. Throughout this book, you will in many cases set up a matrix and then place your new measures inside that matrix so that you can visualise the results of your work. Once you have seen that the results of your measures are working as you expect, it is very easy to change the matrix into another type of visual to better display the data.</p>
			<p class="normal">At this writing, there is no pivot table object in Power BI, but there is a matrix that does pretty much the same thing. The matrix visual object is a very close substitute for a pivot table, and it is the best visualisation to use when you are beginning to build models. It allows you to “see” the results of your calculations in the form of numbers and text. There is also a table visual that you can use. The table is similar to a matrix, but it doesn’t have an option to cross-tabulate your data into rows and columns, as you can in a matrix and a pivot table. You can explore the difference by switching between the two visualisation types in a report.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-71"></a>Here’s How: </span><span class="b2"><a id="calibre_link-267"></a></span><span class="b2">Inserting a Matrix</span></p>
			<p class="normal">There are several ways to insert a matrix into a report. I suggest that you do it like this:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Ensure that you are in the Report view by clicking the Report icon (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Click the Matrix icon (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000015.png" alt="" /></p>
			<p class="nlc">A new matrix placeholder appears on the canvas (see #1 below). Note the Fields pane (#2) and the Rows (#3), Columns (#4), and Values (#5) drop zones on the right-hand side. If you have experience using pivot tables in Excel, you will recognise this as being very similar to the Excel pivot table experience.</p>
			<p class="fp"><img class="_idgenobjectattribute14" src="images/000023.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Expand the <span class="mono1">Products</span> table in the Fields pane and check the Category check box.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Expand the <span class="mono1">Sales</span> table in the Fields pane and check the ExtendedAmount check box.</p>
			<p class="normal">You should now have a matrix that looks like the one shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute15" src="images/000031.png" alt="" /></p>
		</div>
	</div>


<div id="calibre_link-36" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-410" class="ch"><span class="b2"><a id="calibre_link-6"></a>3: Concept: </span><span class="b2"><a id="calibre_link-143"></a><a id="calibre_link-270"></a></span><span class="b2">Measures</span></p>
			<p class="normal">Measures have been around for many years in the enterprise versions of Microsoft BI tools, such as SQL Server Analysis Services. Measures have now made it into the world of business users who want to create Power BI reports. There is nothing confusing or hard to learn about measures. A measure is simply a DAX formula that instructs Power BI to do a calculation on data. In a sense, a measure is a lot like a formula in a cell in Excel. The main difference between a formula in a cell in Excel and a measure is that a measure always operates over the entire data model, not over just a few cells in a spreadsheet. You’ll learn more about this later, but for now you can think of a measure as a formula that calculates a result from the loaded data.</p>
			<p class="h"><span class="b2">Techniques for Writing DAX Measures</span></p>
			<p class="normal">With Power BI, you write measures in the <a id="calibre_link-232" class="calibre3"></a>formula bar, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000039.png" alt="" /></p>
			<p class="normal">The formula bar is not visible unless you have a measure selected in the Fields pane on the right-hand side of Power BI. When you select a measure in the Fields pane, the formula bar appears just below the ribbon, as shown above.</p>
			<p class="note"><span class="b1">Note:</span> There is another way to write measures in Power BI: by using a third-party tool called Tabular Editor. Using Tabular Editor is a more advanced technique that has a lot of productivity benefits over using the formula bar. You can read more about <a id="calibre_link-369"></a>Tabular Editor at <a href="http://xbi.com.au/tabular-editor"><span class="u1">http://xbi.com.au/tabular-editor</span></a>.</p>
			<p class="normal">There are two ways you can start the process of writing a new measure in Power BI. One way is to select the Modeling tab (see #1 below) and then click the <a id="calibre_link-292" class="calibre3"></a>New Measure button (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000047.png" alt="" /></p>
			<p class="normal">I don’t recommend using this approach to create a new measure as it has one major problem: Any time you create a new measure by clicking the New Measure button (see #1 below), the measure is automatically added to the table that is in the Fields pane on the right (#2). It is far too easy to place the measure in the wrong table when you use this approach. I therefore recommend that you use the second approach, described next.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000055.png" alt="" /></p>
			<p class="normal">The second way to write a new measure in Power BI is to go to the Fields pane and right-click the table where you want to store the measure (see #1 below). (Best practice is to store the measure in the table the data comes from. You’ll learn more about this later.) Then select New Measure from the menu (#2) and write the measure from there.</p>
			<p class="fp"><img class="_idgenobjectattribute16" src="images/000065.png" alt="" /></p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-72"></a>Here’s How: Writing Measures</span></p>
			<p class="normal">The approach to writing new measures described here is the best approach I have found to ensure that you get the best possible outcome with the least amount of rework. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a new blank matrix on you report page (or use an existing one if you already have one set up from earlier). Make sure that you have the matrix selected on the report canvas. You can see the drag handles (see #1 below) when the matrix is selected.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Add some relevant data to the rows in your <a id="calibre_link-266"></a>matrix. For the sample database used in this book, I suggest that you go to the <span class="mono1">Products</span> table and place <span class="mono1">Products[Category]</span> on Rows in the matrix. To do this, in the Fields pane, select the <span class="mono1">Products[Category]</span> column (see #2 below) and then drag and drop the column into the Rows drop zone for the matrix (#3). Keep an eye out for the dotted line around the drop zone. When you see the dotted line, you can release the column, and it will be correctly placed in the matrix.</p>
			<p class="fp"><img class="_idgenobjectattribute17" src="images/000075.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> You should always place a measure in the table the data comes from. In this case, you will write the measure <span class="mono1">[Total</span> <span class="mono1">Sales]</span>, and the “data” you are using is in the <span class="mono1">Sales[ExtendedAmount]</span> column, which is in the <span class="mono1">Sales</span> table.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Right-click the <span class="mono1">Sales</span> table in the Fields pane (see #1 below) and select New Measure (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000085.png" alt="" /></p>
			<p class="nlc">You now see <span class="mono">Measure =</span> appear in the formula bar at the top of the page, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000092.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> The new measure has been given a <a id="calibre_link-272"></a>default name, <span class="mono1">Measure</span>, and an equals sign has been added automatically. Also note that the entire text <span class="mono1">Measure =</span> is highlighted in blue, which indicates that it has been selected. The easiest way to proceed now is to simply type over the top of this text. Don’t waste your time and effort trying to “save” the equals sign and edit the word <span class="mono1">Measure</span>. It is just not worth the effort. It is much faster and less error prone to simply type over the top.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>In the formula bar, type the following DAX formula directly over the highlighted text <span class="mono1">Measure =</span> (see #1 below):</p>
			<p class="codeindented1"><span class="mono1">Total Sales = SUM(Sales[ExtendedAmount])</span></p>
			<p class="nlc">Press Enter.</p>
			<p class="note"><span class="b1">Note: </span>If you are used to using IntelliSense in Excel, the editing experience here should be familiar to you. You can use the up and down arrows on the keyboard to select from an IntelliSense list and then press Tab to select an item from the list. You will read more about this later.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Apply the formatting you need before doing anything else. You will already be positioned on the Measure Tools tab on the ribbon (see #2 below). Apply the <a id="calibre_link-274"></a>formatting shown below (#3 and #4) and then press Enter again. </p>
			<p class="tip"><span class="b1">Tip: </span>Get used to applying formatting to a measure immediately so you don’t forget to do it.</p>
			<p class="note"><span class="b1">Note:</span> It is possible to set your own number formatting directly (see #5 below). You can learn more about this at <a href="http://xbi.com.au/format-strings"><span class="u1">http://xbi.com.au/format-strings</span></a><span class="u1">.</span></p>
			<p class="fp"><img class="_idgenobjectattribute18" src="images/000100.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Check to make sure you still have the matrix selected by ensuring that you can see the drag handles (see #1 below), navigate to the <span class="mono1">Sales</span> table in the Fields pane (#2), locate the new measure <span class="mono1">[Total Sales]</span> (#3), and drag and drop the measure into the Values drop zone for the matrix (#4). (You could also simply click in the check box next to Total Sales in the Fields pane.)</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000109.png" alt="" /></p>
			<p class="tip"><span class="b1">Tip:</span> Following this procedure will save you time because you will not have to go back and fix things you missed. Practice writing measures this way right from the start, and you will develop a good habit that will serve you well in the future.</p>
			<p class="normal">Your matrix should now look similar to the one shown on the left below. You may want to increase the font size of your matrix to make it easier to read, as shown on the right below.</p>
			<p class="fp"><img class="_idgenobjectattribute19" src="images/000118.png" alt="" /></p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-73"></a>Here’s How: Increasing the Matrix </span><span class="b2"><a id="calibre_link-231"></a></span><span class="b2">Font Size</span></p>
			<p class="normal">To increase the font size in a matrix, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Ensure that the matrix is selected (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Navigate to the Format pane (#2) and select Grid (#3).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Change the Text Size setting to an appropriate size or enter a new font size in the box (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute20" src="images/000126.png" alt="" /></p>
			<p class="h"><span class="b2">Avoiding </span><span class="b2"><a id="calibre_link-275"></a></span><span class="b2">Implicit Measures</span></p>
			<p class="normal">There are several ways to add up the values in a column. You can do it by simply dragging the name of a column of numbers from the Fields pane (see #1 below) and dropping it in the Values drop zone for the matrix (#2). That column now appears in the matrix (#3). When you use this method, you get the same answer you get by using the measure <span class="mono">[Total</span> <span class="mono">Sales]</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000135.png" alt="" /></p>
			<p class="normal">If you then click the drop-down arrow next to the column <span class="mono">[ExtendedAmount]</span> (see #1 below), you can see a few different options for aggregating the data, including the default <a id="calibre_link-114" class="calibre3"></a>aggregation Sum (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000143.png" alt="" /></p>
			<p class="normal">When you drag a column in this way, you create what I call an “implicit measure” (although Kasper <a id="calibre_link-192" class="calibre3"></a>de Jonge tells me this is not the official name). Doing it this way is not wrong, but personally I am not a fan of using implicit measures, and I recommend that you avoid using them&mdash;for a number of reasons:</p>
			<ul class="calibre2">
				<li class="bl">The name of an implicit measure is not very helpful. Compare the name of this implicit measure, <span class="mono">[ExtendedAmount]</span>, with the name <span class="mono">[Total Sales]</span> that you provided when you explicitly wrote the measure yourself. You can change the name of an implicit measure after you add the column to the visual, but the name changes only for the current visual (a matrix in this case). If you later add the same column again in a different visual, you need to change the name again if you want consistency.</li>
				<li class="bl">No formatting is applied when you drag to create an implicit measure. Again, you can use the formatting from the source column, but you cannot have different formatting for different visuals.</li>
				<li class="bl">You can’t reference implicit measures inside other measures, so implicit measures have limited use. Implicit measures work on single columns, but they cannot work if you need data from more than one column.</li>
				<li class="bl">You won’t learn how to write DAX if you always use implicit measures.</li>
			</ul>
			<p class="normal">So do yourself a favour and don’t drag and drop your table columns. Of course, if you just want a quick look at a column of data for some testing, then doing this is fine. But you should undo the change immediately after you have taken a look. If you want to keep a measure, you should write it from scratch, using your DAX skills. It will be your skill in writing DAX that will set you apart from other users of Power BI.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-38"></a><a id="calibre_link-411"></a>Here’s How: Using </span><span class="b2"><a id="calibre_link-250"></a></span><span class="b2">IntelliSense</span></p>
			<p class="normal">When you type a DAX formula in the formula bar, I recommend that you learn to leverage the IntelliSense tooltips that appear. Follow these steps to see how it works:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Begin typing a function name into the formula bar, as shown below, and you see the IntelliSense pop up to show you the syntax of the function (on the first line) and also what the function does (on the second line).</p>
			<p class="fp"><img class="_idgenobjectattribute21" src="images/000153.png" alt="" /></p>
			<p class="tip"><span class="b1">Tip: </span>IntelliSense is your friend. Reading the information it provides will help you build your DAX knowledge and skills.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Follow the DAX best practice of typing the table name before the column name. Power BI has a very good user interface that helps you do this. If you start typing the name of any column in your data model, as shown in the example below, where I’ve typed <span class="mono1">ex</span>, IntelliSense prompts you with the full name in the format <span class="mono1">TableName[ColumnName]</span>, as you can see below, highlighted in blue.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000162.png" alt="" /></p>
			<p class="tip"><span class="b1">Tip</span>: Always, always, always include the table name before the name of a column in your formulas. Doing so is best practice because it fully qualifies the column name in its home table, which makes it easier to differentiate columns from measures.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Simply use the up and down arrow keys to highlight the column you want from the list presented by IntelliSense and then press Tab to select the column highlighted in blue. The table name is then included automatically.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Type <span class="mono1">)</span> (a closing parenthesis) and press Enter.</p>
			<p class="tip"><span class="b1">Tip: </span>Try to use the keyboard and not the mouse to select from the tooltips, particularly if the list is short. This method may be slower for you to start with, but it will be faster in the long run if you learn to do it this way.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-74"></a>Here’s How: Editing </span><span class="b2"><a id="calibre_link-273"></a></span><span class="b2">Measures</span></p>
			<p class="normal">It is easy to go back and edit (or simply review) measures after you have written them. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Find the measure you want to edit in the Fields pane and click the measure once to select it. The formula bar reappears at the top of the page.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Click in the formula bar and edit the measure as required.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-75"></a>Here’s How: </span><span class="b2"><a id="calibre_link-271"></a></span><span class="b2">Adding Comments to Measures</span></p>
			<p class="normal">Power BI allows you to add notes and comments inside the measures you write. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Select a measure from the Fields pane, and it appears in the formula bar at the top of the page.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>If needed, expand the size of the <a id="calibre_link-233"></a>formula bar by clicking the down arrow (see #1 below).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000170.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Start a new line in the measure by pressing <a id="calibre_link-345"></a>Shift+Enter.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Add comments as shown below. Use a double slash <a id="calibre_link-111"></a>(<span class="mono1">//</span>) at the start of a single-line comment and use the <a id="calibre_link-110"></a><span class="mono1">/* */ </span>pattern to create a multi-line comment, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000179.png" alt="" /></p>
			<p class="h"><span class="b2">When Something </span><span class="b2"><a id="calibre_link-280"></a></span><span class="b2">Goes Wrong as You Write DAX</span></p>
			<p class="normal">At some point, you will start the process of creating a new measure, and something will go wrong. For one reason or another, you will need to stop what you are doing and go and do something else. In cases where you are partway through writing a formula but you need to stop, you can use the comments feature so that you don’t have to scrap your work in progress.</p>
			<p class="normal">The following figure shows a complex partially written measure (which is not from AdventureWorks).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000188.png" alt="" /></p>
			<p class="normal">The particular formula shown in this example is not important; the point is to show you an example of a partial formula that you would not want to lose. You can wrap the measure inside the multi-line comment indicators <span class="mono">/*</span> <span class="mono">*/</span> in order to make the entire measure a comment that can be stored in your table without throwing an error.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-76"></a>Here’s How: </span><span class="b2"><a id="calibre_link-299"></a><a id="calibre_link-298"></a><a id="calibre_link-344"></a></span><span class="b2">Creating New Pages in Power BI</span></p>
			<p class="normal">Power BI has a tabbed page navigator at the bottom of the Report view where you can see the various pages created. It is easy to create a new page by clicking the plus symbol. You can also duplicate an existing page by right-clicking any existing page and selecting Duplicate Page.</p>
			<p class="fp"><img class="_idgenobjectattribute22" src="images/000196.png" alt="" /></p>
			<p class="normal">Duplicating is a great approach, especially when you are writing DAX, because it means you get a new page that already has one or more visuals (e.g., a matrix) that you can use for the next measure. While learning from this book, I recommend that you rename the duplicated pages to something more descriptive so you can more easily find the exercises again later. You can duplicate instead of add new pages if you want to add similar visuals to a new page.</p>
			<p class="note"><span class="b1">Note:</span> When you have many pages in a report, you can see only some of them on the screen. Just as in Excel, if you right-click on the page navigator arrows, you can see a list of all pages and select from a list of all pages (see below).</p>
			<p class="fp"><img class="_idgenobjectattribute23" src="images/000205.png" alt="" /></p>
		</div>
	</div>


<div id="calibre_link-37" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-412" class="ch"><span class="b2"><a id="calibre_link-7"></a>4: DAX Topic: SUM(), COUNT(), <br class="calibre7" />COUNTROWS(), MIN(), MAX(), <br class="calibre7" />COUNTBLANK(), and DIVIDE()</span></p>
			<p class="normal">This chapter introduces some basic DAX functions to get you started with writing measures. Most of the DAX functions in this chapter accept a column as the only parameter, like this: <span class="mono">=FORMULA(</span><span class="monoitalic1">ColumnName</span><span class="mono">)</span>. The exceptions are <span class="mono">=COUNTROWS(</span><span class="monoitalic1">Table</span><span class="mono">)</span>, which takes a table (not a column) as the parameter, and <span class="mono">DIVIDE()</span>, covered later in this chapter.</p>
			<p class="normal">With the exception of <span class="mono">DIVIDE()</span>, all the functions in this chapter are aggregation functions, or aggregators. That is, they take inputs from a column or table and somehow aggregate the contents; these functions handle the aggregation differently for each formula.</p>
			<p class="normal">Think about the column <span class="mono">Sales[ExtendedAmount]</span>, which has more than 60,000 rows of data. You can’t simply put the entire column into a single cell in a matrix because Power BI can’t place a column of 60,000+ numbers into a single cell in the matrix.</p>
			<p class="normal">The following example shows a DAX formula that uses a “<a id="calibre_link-288" class="calibre3"></a>naked” column, without any aggregation function. This does not work when you’re writing a measure, as indicated by the error message.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000213.png" alt="" /></p>
			<p class="normal">You have to tell Power BI how to aggregate the data from this column so that it returns just a single value to each cell in the matrix. Each of the aggregators in this chapter effectively converts a column of values into a single value.</p>
			<p class="normal">The correct way to write this measure is shown below.<a id="calibre_link-362" class="calibre3"></a></p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000221.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>Did you notice that this example uses the table name and the column name in the formula? Remember that it is best practice to refer to the table name and the column name when referring to a column in DAX. Never refer to a column without specifying the table name first. Power BI does this for you automatically, but it is still possible to delete the table name manually (accidentally or deliberately)&mdash;and you should not do so! In just a bit, you will understand why I say this.</p>
			<p class="h"><a id="calibre_link-251"></a><span class="b2">IntelliSense Problems</span></p>
			<p class="normal">Sometimes IntelliSense can be confusing. IntelliSense prompts you with a list of the available functions, tables, columns, and measures only if you are writing a formula correctly. This can be very useful because you get a list of the valid syntax. But the downside is that it can be confusing if you can’t see the list of possible functions, tables, columns, and measures that you are looking for and you don’t know why. If at any time when you are writing a formula you can’t see the functions, measures, columns, or tables you are looking for, you should stop and check your syntax. If the syntax is incorrect, IntelliSense stops prompting you with suggestions. Over time, you will learn to trust IntelliSense, and you will learn to stop and check your syntax when it is not working as you expect it to.</p>
			<p class="h"><span class="b2">Reusing </span><span class="b2"><a id="calibre_link-279"></a></span><span class="b2">Measures</span></p>
			<p class="normal">One important shortcut in DAX is that you can reuse measures in order to write other measures. Say that you create a new measure called <span class="mono">[Total</span> <span class="mono">Sales]</span>. When this measure exists in the Power BI data model, it can be referenced and reused inside other measures. For example, after creating the measure <span class="mono">[Total</span> <span class="mono">Sales]</span>, you could use the following formula to create a new measure for 10% tax on the sale of goods:</p>
			<p class="code"><span class="mono1">Total Tax = [Total Sales] * 0.1</span></p>
			<p class="normal">Note that the new measure <span class="mono">[Total</span> <span class="mono">Tax]</span> is a calculation based on the original measure <span class="mono">[Total</span> <span class="mono">Sales]</span> multiplied by 0.1.</p>
			<p class="normal">It is good practice to reuse measures inside other measures.</p>
			<p class="note"><span class="b1">Note: </span>There is no table name in front of the measure name above: It is <span class="mono1">[Total Sales]</span> and not <span class="mono1">Sales[Total Sales]</span>. Remember that although you should always include the table name in front of a column (for example, <span class="mono1">Sales[ExtendedAmount]</span>), it is best practice to omit the table name before a measure. This convention provides an important clue: A reader can look at <span class="mono1">Sales[ExtendedAmount]</span> and <span class="mono1">[Total Sales]</span> and immediately tell that the first is a column and the second is a measure simply by the existence (or not) of the table name.</p>
			<p class="h"><span class="b2">Writing DAX</span></p>
			<p class="normal">It’s time to start to write some DAX of your own to get some practice. When I say write, I mean sit in front of your PC, open your workbook with the data from Chapter 1 loaded, and really write some DAX. Especially if you have never written formulas using these functions, you should physically do it now, as you read this section. Imagining yourself doing it in your mind is not enough.</p>
			<p class="normal">If you haven’t already done so, go ahead and load the test data by following the steps in Chapter 2. Once it is loaded and prepared, you are ready to create the new measures in the following practice exercises.</p>
			<p class="h"><span class="b2">Practice Exercises</span></p>
			<p class="normal">Periodically throughout the rest of this book, you will find practice exercises that are designed to help you learn. You should complete each exercise as you get to it. The answers to all these practice exercises are provided in Appendix A.</p>
			<p class="h1"><span class="b2">Practice Exercises: SUM()</span></p>
			<p class="normal">Try to write DAX formulas for the following measures without looking back at how it was done. If you have trouble, refer to Chapter 3 and then give it another go. Remember that you are here to practice! You can find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="normal">Write DAX formulas for the following columns, using <span class="mono">SUM()</span>.</p>
			<p class="h2"><span class="bi">1. [Total Sales]</span></p>
			<p class="normal">You should have already written this measure earlier in this book (see <a href="#calibre_link-38" class="calibre3">"Here’s How: Using IntelliSense" on page 38</a>). If you didn’t, write a new measure that is the total of the sales in the <span class="mono">ExtendedAmount</span> column from the <span class="mono">Sales</span> table.</p>
			<p class="h2"><span class="bi">2. [Total Cost]</span></p>
			<p class="normal">Create a measure that is the sum of one of the cost columns in the <span class="mono">Sales</span> table. This measure uses exactly the same structure as the <span class="mono">[Total</span> <span class="mono">Sales]</span> measure, but it adds the cost of the product instead of the sales amount. You can use any of the product cost columns in the <span class="mono">Sales</span> table; all the cost columns are the same in this sample database.</p>
			<p class="h2"><span class="bi">3. [Total Margin $]</span></p>
			<p class="normal">Create a new measure for the total margin&mdash;that is, the amount of profit AdventureWorks makes on the sale of each item, which is total sales minus total cost. Make sure you reuse the two measures you just created in this new measure.</p>
			<p class="h2"><span class="bi">4. [Total Margin %]</span></p>
			<p class="normal">Create a new measure that expresses the total margin from Practice Exercise 3 as a percentage of total sales. Once again, reuse the measures you created above. I don’t cover the <span class="mono">DIVIDE()</span> function until later in this chapter, but you can try to work out how to use it by using the IntelliSense if you like. Rely on your Excel experience to write the formula.</p>
			<p class="h2"><span class="bi">5. [Total Sales Tax Paid]</span></p>
			<p class="normal">Create a measure for total sales tax paid. Look for a tax column in the <span class="mono">Sales</span> table and add up the total for that column.</p>
			<p class="h2"><span class="bi">6. [Total Sales Including Tax]</span></p>
			<p class="normal">The <span class="mono">[Total</span> <span class="mono">Sales]</span> measure above excludes tax, and you need to add two measures together to create the <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">Including</span> <span class="mono">Tax]</span> measure.</p>
			<p class="h2"><span class="bi">7. [Total Order Quantity]</span></p>
			<p class="normal">This is similar to the other measures you’ve just created, but this time you add up the quantities purchased. Look for the correct column in the <span class="mono">Sales</span> table.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">As you worked through the practice exercises, did you do the following?</p>
			<ul class="calibre2">
				<li class="bl">Did you create a matrix first and put <span class="mono">Products[Category] </span>on Rows in your matrix? (Or did you put something else on Rows, as appropriate for these measures?) Creating a matrix is a best practice because it enables you to you get feedback immediately after you write a measure; it allows you to see the results right away.</li>
				<li class="bl">Did you right-click the <span class="mono">Sales</span> table in the Fields pane and select New Measure to start the process? Doing so guarantees that the measure gets placed in the correct table, so you don’t lose it. Remember that you should always put a measure in the table where the data is stored. Therefore, the measures in these practice exercises belong in the <span class="mono">Sales</span> table.</li>
				<li class="bl">Did you reference all columns in your measures in the format <span class="monoitalic1">TableName</span><span class="mono">[</span><span class="monoitalic1">ColumnName</span><span class="mono">]</span> (i.e., did you always reference the table name)? Remember that you should never reference a column in DAX without first specifying the table name; always use the table name and the column name. Power BI makes this easy for you most of the time.</li>
				<li class="bl">Did you apply formatting to your measure immediately after you wrote it?</li>
				<li class="bl">Did you use the keyboard and look at the IntelliSense when you typed the measures? Remember that you should try not to use the mouse. Doing so might be faster for you now, but relying on the mouse will prevent you from getting faster with the keyboard in the future. Learn to use the keyboard and follow the process covered in <a href="#calibre_link-38" class="calibre3">"Here’s How: Using IntelliSense" on page 38</a>.</li>
			</ul>
			<p class="normal">Remember that the answers to all the practice exercises in this book are provided in Appendix A. Try to avoid peeking at the appendix when you should be thinking and typing. If you do the thinking now, you will learn how to do it, and that will give you the skills and the solid foundation you need to master Power BI.</p>
			<p class="normal">Okay, it’s time to move on and learn about a new DAX function.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-161"></a></span><span class="b2">COUNT() Function</span></p>
			<p class="normal">As you write the formula shown below using <span class="mono">COUNT()</span>, take the time to consider again at how IntelliSense can help you write DAX.</p>
			<p class="fp"><img class="_idgenobjectattribute24" src="images/000230.png" alt="" /></p>
			<p class="normal">Remember that whenever you type a new formula, you can pause, and IntelliSense shows the syntax and a description of the function. The description includes some very useful information. For example, in the figure above, the tooltip says that this function “counts the numbers in a column.” This gives you three very useful pieces of information. You’ve already worked out the first one: It counts. In addition, this tooltip tells you that the function counts numbers and also that the numbers need to be in a column. This should be enough information about the <span class="mono">COUNT()</span> function for you to use it to write some measures.</p>
			<p class="h1"><span class="b2">Practice Exercises: COUNT()</span></p>
			<p class="normal">Now it is time to write some DAX formulas using the <span class="mono">COUNT()</span> function. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="note"><span class="b1">Note:</span> Don’t forget to set up a matrix before you work the following exercises. A good approach is to assign a name to the page in your last exercise, such as <span class="mono1">SUM()</span>, and then duplicate the page for the next exercise, giving it a different name, such as <span class="mono1">COUNT()</span>. This way, you can easily look back at your work later for a refresher. Whenever you set up a new matrix for a new exercise, make sure you have something meaningful on Rows, such as <span class="mono1">Products[Category]</span>. Look at the image in “How Did It Go?” after these practice exercises if you are not sure how to set up the matrix.</p>
			<p class="h2"><span class="bi">8. [Total Number of Products]</span></p>
			<p class="normal">Use the <span class="mono">Products</span> lookup table when writing this measure and count how many product numbers there are. Product numbers and product keys are the same thing in this example.</p>
			<p class="h2"><span class="bi">9. [Total Number of Customers]</span></p>
			<p class="normal">Use the <span class="mono">Customers</span> lookup table and just count the customer numbers. Customer numbers and customer keys are the same thing in this example.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with the following matrix?</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000239.png" alt="" /></p>
			<p class="normal">If not, check your answers against those in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="note"><span class="b1">Note: </span>The matrix above is a bit confusing because <span class="mono1">[Total Number of Customers]</span> doesn’t seem to be correct. It is returning the same value for every row in the matrix, and this is not something you are probably used to seeing. But if you think about it, it actually does make sense. You are not counting how many customers purchased these product categories; you are counting the number of customers in the master customer table, and the number of customers doesn’t change based on the product categories; the customers are either in the master table or not. (You’ll learn more about this in Chapter 5.)</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-164"></a></span><span class="b2">COUNTROWS() Function</span></p>
			<p class="normal">Let’s move on to another counting function, <span class="mono">COUNTROWS()</span>. I prefer to use <span class="mono">COUNTROWS()</span> instead of <span class="mono">COUNT()</span> as it just seems more natural to me. These functions are not exactly the same, even though they can be used interchangeably at times. If you use <span class="mono">COUNT()</span> with <span class="monoitalic1">TableName</span><span class="mono">[</span><span class="monoitalic1">ColumnName</span><span class="mono">]</span> and the column is missing a value in one of the rows (for some reason), then that row won’t get counted. <span class="mono">COUNTROWS()</span> counts every row in the table, regardless of whether every column has a value in every row. So be careful to select the best formula for the task at hand.</p>
			<p class="h1"><span class="b2">Practice Exercises: COUNTROWS()</span></p>
			<p class="normal">For these exercises, rewrite the two measures from Practice Exercises 8 and 9 using <span class="mono">COUNTROWS()</span> instead of <span class="mono">COUNT()</span>. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">10. [Total Number of Products COUNTROWS Version]</span></p>
			<p class="normal">Use the <span class="mono">COUNTROWS()</span> function to count the number of products in the <span class="mono">Products</span> table.</p>
			<p class="h2"><span class="bi">11. [Total Number of Customers COUNTROWS Version]</span></p>
			<p class="normal">Use the <span class="mono">COUNTROWS()</span> function to count the number of customers in the <span class="mono">Customers</span> table.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Not surprisingly, for Practice Exercises 10 and 11, you should get the same answer you got with <span class="mono">COUNT()</span>, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000247.png" alt="" /></p>
			<p class="h"><span class="b2">A Word on Naming Measures</span></p>
			<p class="normal">You may have noticed that I sometimes use very long and descriptive names for measures. I encourage you to make measure names as long as they need to be to make it clear what the measures actually are. You will be grateful you did down the track, when you are trying to work out the fine difference between two similar-sounding measures.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-77"></a>Here’s How: Changing </span><span class="b2"><a id="calibre_link-198"></a></span><span class="b2">Display Names in Visuals</span></p>
			<p class="normal">It is possible to change the display name of a measure or column once it is in a visual. Doing so will only change this single use of the measure inside this single visual; the change has no impact on the actual name of the measure. Here are the steps for changing a display name:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Select the visual.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Find the measure or column in the Values section of the Fields card on the Visualizations pane and click its down arrow (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Click Rename for This Visual (#2). As the name suggests, this renaming applies only to this single visual and does not change the actual name of the measure or column in the model.</p>
			<p class="fp"><img class="_idgenobjectattribute25" src="images/000256.png" alt="" /></p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-78"></a>Here’s How: </span><span class="b2"><a id="calibre_link-391"></a></span><span class="b2">Word Wrapping in a Visual</span></p>
			<p class="normal">Changing a measure’s name is useful when you want a shorter name to appear in a visual. Sometimes the name of a measure makes sense only in certain situations (i.e., in some visuals and not in other visuals). For such situations, if you want to keep using a longer descriptive name but want to make it fit in a matrix, you can resize the columns in the matrix. Here’s how:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Hover your mouse to the right side of the column header in the matrix.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span> Click and drag the <a id="calibre_link-154"></a>mouse to the left, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000264.png" alt="" /></p>
			<p class="normal">The following image shows the result of applying word wrap to the matrix shown earlier in this chapter.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000272.png" alt="" /></p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-199"></a></span><span class="b2">DISTINCTCOUNT() Function</span></p>
			<p class="normal"><span class="mono">DISTINCTCOUNT()</span> counts each value in a column once and only once. If a value appears more than once in a column, it is still counted only once. Consider the <span class="mono">Customers</span> table. In this case, the customer key is unique, and by definition, each customer key appears only once in the table. (Keep in mind that customer key = customer number.) So in this case, using <span class="mono">DISTINCTCOUNT()</span> with the customer key in the <span class="mono">Customers</span> table gives you the same answer as using <span class="mono">COUNTROWS()</span> with the <span class="mono">Customers</span> table. But if you were to use <span class="mono">DISTINCTCOUNT()</span> with the customer key in the <span class="mono">Sales</span> table, you would actually be counting the total number of customers that had ever purchased something. This is not the same thing as the number of customers in the <span class="mono">Customers</span> table. The answer may or may not be the same, but the business logic and hence the DAX logic are different.</p>
			<p class="h1"><span class="b2">Practice Exercises: DISTINCTCOUNT()</span></p>
			<p class="normal">To practice using <span class="mono">DISTINCTCOUNT()</span>, create a new matrix and put <span class="mono">Customers[Occupation]</span> on Rows in the matrix and <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values. Then use <span class="mono">DISTINCTCOUNT()</span> to write the following measures. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">12. [Total Customers in Database DISTINCTCOUNT Version]</span></p>
			<p class="normal">You need to count a column of unique values in the <span class="mono">Customers</span> table. Which column will you use? How will you know which column or columns are distinct? Is the customer name distinct? How can you be sure?</p>
			<p class="normal">Earlier you saw one possible way to count a column of unique values in the <span class="mono">Customers</span> table. Now you need to write a measure using the <span class="mono">DISTINCTCOUNT()</span> function to find out how many distinct customers there are in the <span class="mono">Customers</span> table. When you are done, add the <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> measure you created earlier to the matrix as well. You should end up with a matrix like the one below.</p>
			<p class="fp"><img class="_idgenobjectattribute26" src="images/000280.png" alt="" /></p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you get the same answer as above in the new measure? Did you remember to format the measure to something practical (e.g., a whole number with thousands separators)?</p>
			<p class="note"><span class="b1">Note: </span>You now know two ways to find how many distinct records there are in a lookup table: Use <span class="mono1">COUNTROWS()</span> for the table and use <span class="mono1">DISTINCTCOUNT()</span> for the primary key. These are not the only ways to solve this problem. In the case of the <span class="mono1">Customers</span> table, you could also use <span class="mono1">COUNT()</span> for <span class="mono1">Customers[CustomerKey]</span> to get the same result. This works because, by definition, the primary key column of a lookup/dimension table must be unique, so counting a primary key column must give the same result as using <span class="mono1">DISTINCTCOUNT()</span>.</p>
			<p class="h2"><span class="bi">13. [Count of Occupation]</span></p>
			<p class="normal">Create a new matrix and put <span class="mono">Customers[YearlyIncome]</span> on Rows. Then create the measure <span class="mono">[Count</span> <span class="mono">of</span> <span class="mono">Occupation]</span>.</p>
			<p class="normal">Even though the description of the measure is “Count of Occupation,” you need to use <span class="mono">DISTINCTCOUNT()</span> to count the values in the <span class="mono">Occupation</span> column in the <span class="mono">Customers</span> table. Don’t get confused with the business language “count of occupation” and the DAX formula. You want to end up with a matrix like the one shown below. The way to read this matrix is that there are customers in three different occupations that have incomes of $10,000, there are customers across four occupations that have incomes of $30,000, etc.</p>
			<p class="fp"><img class="_idgenobjectattribute27" src="images/000288.png" alt="" />  <img class="_idgenobjectattribute28" src="images/000296.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> The table on the right has some conditional formatting applied. The next “Here’s How” describes how to add conditional formatting.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-79"></a>Here’s How: Applying </span><span class="b2"><a id="calibre_link-157"></a></span><span class="b2">Conditional Formatting</span></p>
			<p class="normal">It is much easier to read a matrix if you apply some of the formatting features that come with Power BI. For example, compare the matrix above left with the conditionally formatted version above right. I am sure you agree that it is much easier to gather insights from the version on the right. Follow these steps to apply this type of conditional formatting:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Make sure you have the matrix selected (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Go to the Format pane (see #2 below), select Conditional Formatting (#3), and turn on the formatting effect you want to use, such as <a id="calibre_link-172"></a>Data Bars (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute29" src="images/000304.png" alt="" /></p>
			<p class="normal">As you can see in the matrix above (#1), using well-placed conditional formatting is a great way to make your matrixes easier to read and helps the important information jump out.</p>
			<p class="note"><span class="b1">Note:</span> This is not the only way to add conditional formatting. You can also go to the Fields card on the Visualizations pane (see #1 below), click the drop-down arrow next to the measure you want to format (#2), select Conditional Formatting (#3), and then choose the type of formatting you want (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000313.png" alt="" /></p>
			<p class="h1"><span class="b2">Practice Exercises: DISTINCTCOUNT(), Continued</span></p>
			<p class="normal">The following exercises give you more practice using <span class="mono">DISTINCTCOUNT()</span>. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">14. [Count of Country]</span></p>
			<p class="normal">Create a new matrix and put <span class="mono">Territories[Group]</span> on Rows. Write a new measure called <span class="mono">[Count</span> <span class="mono">of</span> <span class="mono">Country]</span>, using <span class="mono">DISTINCTCOUNT()</span> over the <span class="mono">Country</span> column in the <span class="mono">Territories</span> table. This matrix, as you can see below, shows you how many countries exist in each sales group.</p>
			<p class="fp"><img class="_idgenobjectattribute30" src="images/000321.png" alt="" /></p>
			<p class="h2"><span class="bi">15. [Total Customers That Have Purchased]</span></p>
			<p class="normal">Create a new matrix and put <span class="mono">Products[SubCategory]</span> on Rows. Then, using <span class="mono">DISTINCTCOUNT()</span> on data from the <span class="mono">Sales</span> table, create the new measure <span class="mono">[Total</span> <span class="mono">Customers</span> <span class="mono">That</span> <span class="mono">Have</span> <span class="mono">Purchased]</span>. Apply some conditional formatting to the matrix and then sort the column from largest to smallest (by clicking on the column heading to be sorted). You can see below that Tires and Tubes has the largest number of customers who have purchased at least once.</p>
			<p class="fp"><img class="_idgenobjectattribute31" src="images/000329.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> The measure <span class="mono1">[Total Customers That Have Purchased]</span> does not tell you how many times each customer has purchased. It simply tells you how many unique customers have purchased at least once, over all the sales data in the <span class="mono1">Sales</span> table.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-80"></a>Here’s How: </span><span class="b2"><a id="calibre_link-202"></a></span><span class="b2">Drilling Through Rows in a Matrix</span></p>
			<p class="normal">One of the features I really love about Power BI is the ability to nest columns and then drill through. Let’s look at how it works, using the matrix shown above:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Make sure you have the matrix selected and then locate the <span class="mono1">Products[Category]</span> column in the Fields pane (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Drag the column to the Rows drop zone (#2). Take care to check for the yellow line, as indicated below. This line tells you where the column will be dropped (above or below the existing column).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Drop the <span class="mono1">Products[Category]</span> column above the <span class="mono1">Products[SubCategory]</span> column, as indicated by the arrow below.</p>
			<p class="fp"><img class="_idgenobjectattribute32" src="images/000337.png" alt="" /></p>
			<p class="nlc">The matrix changes in a few subtle ways, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute33" src="images/000345.png" alt="" /></p>
			<p class="nlc">Note there are four new icons at the top right of the matrix as well as some + (plus) icons to the left of the product categories. In addition, if you right-click on a product category row (see #1 below), the submenu now has some new menu items that were previously not visible.</p>
			<p class="fp"><img class="_idgenobjectattribute34" src="images/000353.png" alt="" /></p>
			<p class="nlc">All these new icons and menu items provide new drill-through capabilities for the columns you have added to Rows. Don’t get confused here; you add the columns from the tables to Rows in your matrix (by stacking one on top of another), and then you can drill through.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Spend a few minutes trying out the various drill-through behaviours for each of these menus. You can drill down and drill up through the matrix.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Put <span class="mono1">'Calendar'[CalendarYear]</span> on Columns in your matrix and notice how the matrix changes again.</p>
			<p class="note"><span class="b1">Note:</span> <span class="mono1">Calendar</span> is a reserved word in DAX; it is also a name of a function, <a id="calibre_link-145"></a><span class="mono1">CALENDAR()</span>, which returns a calendar table. Personally, I never use the <span class="mono1">CALENDAR()</span> function as I think there are better ways to create calendar tables. It is okay to call a calendar table <span class="mono1">Calendar</span>, but you must always add single quotes when referencing the table inside your DAX formulas, as shown above.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Go back to the conditional formatting settings for the matrix, turn off the data bars, and turn on <a id="calibre_link-153"></a>colour scales. You should end up with a matrix like the one shown below.</p>
			<p class="note"><span class="b1">Note:</span> I have used the <a id="calibre_link-346"></a><a id="calibre_link-212"></a>Expand to Next Level drill-through feature in this matrix to get the nested layout shown below. This is very similar to how a pivot table looks.</p>
			<p class="fp"><img class="_idgenobjectattribute35" src="images/000002.png" alt="" /></p>
			<p class="h1"><span class="b2">Practice Exercises: </span><span class="b2"><a id="calibre_link-124"></a><a id="calibre_link-282"></a><a id="calibre_link-268"></a></span><span class="b2">MAX(), MIN(), and AVERAGE()</span></p>
			<p class="normal"><span class="mono">MAX()</span>, <span class="mono">MIN()</span>, and <span class="mono">AVERAGE()</span> are types of aggregating functions (aggregators). They take multiple values in a column as input and return a single value as the result. In the following few practice exercises, you will create new measures using these aggregators. </p>
			<p class="normal">You should use columns from the <span class="mono">Sales</span> table for these exercises. There are some additional pricing columns in the <span class="mono">Products</span> table, but those prices are only theoretical prices, or “list prices.” In this sample data, the actual price information related to a transaction is stored in the <span class="mono">Sales</span> table.</p>
			<p class="normal">Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">16. [Maximum Tax Paid on a Product]</span></p>
			<p class="normal">Use a suitable column from the <span class="mono">Sales</span> table along with the <span class="mono">MAX()</span> function.</p>
			<p class="h2"><span class="bi">17. [Minimum Price Paid for a Product]</span></p>
			<p class="normal">Use a suitable column from the <span class="mono">Sales</span> table along with the <span class="mono">MIN()</span> function.</p>
			<p class="h2"><span class="bi">18. [Average Price Paid for a Product]</span></p>
			<p class="normal">Use a suitable column from the <span class="mono">Sales</span> table along with the <span class="mono">AVERAGE()</span> function.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with a matrix like the one shown below?</p>
			<p class="normal"><img class="_idgenobjectattribute36" src="images/000009.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>Notice that when you add these measures directly to a matrix, you get immediate feedback about whether your measures look correct. This is only a “sense” check, and you should, of course, confirm that your formulas are correct as part of the process.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-81"></a>Here’s How: </span><span class="b2"><a id="calibre_link-277"></a></span><span class="b2">Moving an Existing Measure to a Different Home Table</span></p>
			<p class="normal">If you have been following my advice, to create a new measure, you first go to the Fields pane and right-click on the table where you want the measure to be placed, and then you select the New Measure option. However, even if you do it this way, it is possible that at some stage, you will end up with a measure being in the wrong table. This problem is fairly easy to fix. Follow these steps to move a measure to a different table:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Locate the measure in the Fields pane and select it. You can use the Search box at the top of the Fields pane, if necessary, to find the measure.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Make sure you are on the Measure Tools tab (see #1 below) and select the correct table from the Home Table drop-down list (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000017.png" alt="" /></p>
			<p class="normal"><span class="b3"><a id="calibre_link-413" class="calibre3"></a></span><span class="b4"><a id="calibre_link-414" class="calibre3"></a>Here’s How: Moving All Measures to a New Table</span></p>
			<p class="normal">It is possible to move all measures from one table to another table at once. To do this, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Switch to the Model view.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the Fields pane, expand the table that contains the measures you want to move (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Select one or more measures (see #2 below) that you wish to move from this table. You can use the Ctrl key or Shift key to multi-select measures.</p>
			<p class="fp"><img class="_idgenobjectattribute37" src="images/000025.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Drag the measures from the current table (#1 below) into the new table (#2). Look for the dotted yellow line (#3) to make sure you have selected the destination table correctly.</p>
			<p class="fp"><img class="_idgenobjectattribute38" src="images/000033.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> After moving the measures as shown here, make sure to move them back to the correct table before proceeding.</p>
			<p class="h1"><span class="b2">Practice Exercises: </span><span class="b2"><a id="calibre_link-163"></a></span><span class="b2">COUNTBLANK()</span></p>
			<p class="normal">In the following exercises, you use the <span class="mono">COUNTBLANK()</span> function to create a measure to check the completeness of the master data.</p>
			<p class="normal">Create a new matrix and put <span class="mono">Customers[Occupation]</span> on Rows. Then start to write the new measure. In these exercises, you need to create measures to find out two things:</p>
			<ul class="calibre2">
				<li class="bl">How many customers are missing Address Line 2 from the master data?</li>
				<li class="bl">For how many products in the <span class="mono">Products</span> table is there no weight value stored in the master data?</li>
			</ul>
			<p class="normal">Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">19. [Customers Without Address Line 2]</span></p>
			<p class="normal">The <span class="mono">AddressLine2</span> column is in the <span class="mono">Customers</span> table. As you write the measure <span class="mono">[Customers</span> <span class="mono">Without</span> <span class="mono">Address</span> <span class="mono">Line</span> <span class="mono">2]</span>, be sure you do the following:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Select the table where you want to store the measure and be sure to add it there.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Give the measure a suitable name.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Start typing the measure. Pause after you have started to type the formula and read the IntelliSense to see what the function does (if you don’t already know). As shown below, this measure does exactly what you want it to do: It counts how many blanks are in this column.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000041.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Complete the formula, apply the formatting, check the formula, and then click Enter.</p>
			<p class="h2"><span class="bi">20. [Products Without Weight Values]</span></p>
			<p class="normal">The column you need to use is in the <span class="mono">Products</span> table. You should end up with a matrix like the one shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute39" src="images/000049.png" alt="" /></p>
			<p class="normal">Note that the first measure, <span class="mono">[Customers</span> <span class="mono">Without</span> <span class="mono">Address</span> <span class="mono">Line</span> <span class="mono">2]</span>, is being filtered by the matrix (i.e., <span class="mono">Customers[Occupation]</span> on Rows), and the values in the matrix change with each row. However, the second measure, <span class="mono">[Products</span> <span class="mono">Without</span> <span class="mono">Weight</span> <span class="mono">Values]</span>, is not filtered; the values don’t change for each row in the matrix. You have seen this earlier in this book. The technical term for filtering behaviour in Power BI is filter context. Chapter 5 provides a detailed explanation of this filtering behaviour and will help you understand what is happening here and why.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-200"></a></span><span class="b2">DIVIDE() Function</span></p>
			<p class="normal"><span class="mono">DIVIDE()</span> is a simple yet powerful function that is also known as “safe divide.” <span class="mono">DIVIDE()</span> protects you against divide-by-zero errors in your visuals. A matrix, by design, hides any rows or columns that have no data (i.e., the formula returns <span class="mono">BLANK()</span>). If you get an error in a measure inside a matrix, it is possible that you will see lots of rows that you would otherwise not see, and you will possibly also see some error messages that you would rather not see. Power BI error messages include NaN, which means “not a number” and also infinity.</p>
			<p class="normal">The <span class="mono">DIVIDE()</span> function is specifically designed to prevent these error messages from appearing. If you use <span class="mono">DIVIDE()</span> instead of the slash operator (<span class="mono">/</span>) for division, DAX returns a <span class="mono">BLANK()</span> method where you would otherwise get a divide-by-zero error, such as NaN (not a number). Given that a matrix filters out blank rows by default, a blank result is preferable to an error.</p>
			<p class="normal">The syntax for this function is <span class="mono">DIVIDE(</span><span class="monoitalic1">numerator</span><span class="mono">,</span> <span class="monoitalic1">denominator</span><span class="mono">,</span> <span class="monoitalic1">optional-alternate-result</span><span class="mono">)</span>. If you don’t specify the alternate result, a blank value is returned when a divide-by-zero error occurs.</p>
			<p class="h1"><span class="b2">Practice Exercises: DIVIDE()</span></p>
			<p class="normal">Before you can write the following measures, you need to create a new matrix and put <span class="mono">Products[Category]</span> on Rows. Then add <span class="mono">[Total</span> <span class="mono">Sales]</span> and <span class="mono">[Total</span> <span class="mono">Margin</span> <span class="mono">$]</span> to the matrix so you have some data to look at. This helps set the context for the new measures you will write next.</p>
			<p class="normal">Write the following measures using <span class="mono">DIVIDE()</span>. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">21. [Margin %]</span></p>
			<p class="normal">Write a measure that calculates the margin on sales percentage (<span class="mono">[Total</span> <span class="mono">Margin</span> <span class="mono">$]</span> divided by <span class="mono">[Total</span> <span class="mono">Sales]</span>). To do so, reuse measures that you have already written.</p>
			<p class="note"><span class="b1">Note:</span> This is a duplicate of a measure, called <span class="mono1">[Total Margin %]</span>, that you wrote at the start of this chapter. This time, however, you write the formula by using the <span class="mono1">DIVIDE()</span> function and give it the name <span class="mono1">[Margin %]</span>. The result will be the same, of course, but technically this new version is safer because it will protect against the errors mentioned above.</p>
			<p class="h2"><span class="bi">22. [Markup %]</span></p>
			<p class="normal">Find <span class="mono">[Total</span> <span class="mono">Margin</span> <span class="mono">$]</span> divided by <span class="mono">[Total</span> <span class="mono">Cost]</span>.</p>
			<p class="h2"><span class="bi">23. [Tax %]</span></p>
			<p class="normal">Find <span class="mono">[Total</span> <span class="mono">Tax]</span> divided by <span class="mono">[Total</span> <span class="mono">Sales]</span>.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you format the last three measures as percentages, as shown below?</p>
			<p class="fp"><img class="_idgenobjectattribute40" src="images/000058.png" alt="" /></p>
		</div>
	</div>


<div id="calibre_link-39" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-415" class="ch"><span class="b2"><a id="calibre_link-8"></a>5: Concept: </span><span class="b2"><a id="calibre_link-225"></a></span><span class="b2">Filter Propagation</span></p>
			<p class="normal">In Chapter 4 we looked at the <span class="mono">COUNT()</span> function and saw some strange behaviour with the <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> measure. You need to understand the process of filter propagation before you can truly understand what is happening there.</p>
			<p class="normal">Consider the following matrix.</p>
			<p class="normal"><img class="_idgenobjectattribute41" src="images/000068.png" alt="" /></p>
			<p class="normal">The result <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products]</span> in this matrix is displaying a different value for each product category (i.e., each row in the matrix is showing a different number of products that exist in that category), but the value for <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> is the same for each product category in the matrix. This happens because the row labels in the matrix (highlighted above) are “filtering” the products in the <span class="mono">Products</span> table in the data model before this measure is evaluated. But these same rows (product categories) are not filtering the <span class="mono">Customers</span> table at all.</p>
			<p class="normal">The matrix above first “filters” the data model (in this case, it is the <span class="mono">Products[Category]</span> column), and then Power BI evaluates the measures for each row in the matrix with the filters applied; that’s what it’s designed to do. I call the filters coming from a matrix (or from any other visual or from the Filters pane) the initial filters&mdash;initial because it is possible to change the initial filtering behaviour later by using the <span class="mono">CALCULATE()</span> function. So the initial filter is the standard filtering coming from a matrix (and/or from any other visual and/or from the Filters pane) before any possible modifications are applied using DAX formulas that include <span class="mono">CALCULATE()</span>.</p>
			<p class="note"><span class="b1">Note:</span> <span class="mono1">CALCULATE()</span> is a massive and complex topic that is covered in depth in Chapter 9.</p>
			<p class="h"><a id="calibre_link-167"></a><span class="b2">Cross-Filtering Visuals</span></p>
			<p class="normal">So far in this book, we have used only a single visual on a report page. Now is a good time to add a second visual to the report canvas. Do you remember the process? It is important that you click on a blank section of the canvas before adding a new visual. For example, to add a slicer, after clicking on a blank area of your page, you can click on the slicer visual (shown below) to add a new slicer to your report.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000078.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>Before you try to add another visual to the report canvas, you should first click on a blank area of the canvas to ensure that you don’t accidently have an existing visual selected. If you try to add a new visual while you have an existing visual selected, you will replace the existing visual with the new one instead of adding another new visual to the canvas. If you make a mistake, you can always click Undo, but it’s best to get into the habit of clicking on a blank area of the canvas before adding a new visual.</p>
			<p class="normal">After adding the slicer, locate and drag the <span class="mono">Products[Size]</span> column onto the slicer, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute42" src="images/000087.png" alt="" /></p>
			<p class="normal">An initial filter in Power BI comes from different areas of the matrix, but it can also come from other areas in the report. Here are a few examples of where initial filters come from:</p>
			<ul class="calibre2">
				<li class="bl">Rows (see #1 below)</li>
				<li class="bl">Columns (#2)</li>
				<li class="bl">Slicers (#3)</li>
				<li class="bl">Filters (#4)</li>
			</ul>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000094.png" alt="" /></p>
			<p class="normal">In fact, with Power BI, instead of using a slicer (#3 above), you can use any visual on the canvas to filter any of the other visuals on the canvas. In addition, from the Filters pane (#4), you can choose a visual-level filter (which filters on this visual), a page-level filter (which filters on this page), or even a report-wide filter (which filters on all pages). There is a lot to look for when checking to see what initial filters are impacting the visuals in a Power BI report. Over time, you will learn to find all filtering behaviour quickly and easily.</p>
			<p class="h"><span class="b2">Reading the </span><span class="b2"><a id="calibre_link-224"></a><a id="calibre_link-249"></a></span><span class="b2">Initial Filter</span></p>
			<p class="normal">The following matrix, which first appeared in Chapter 4, shows <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> and <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products]</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000102.png" alt="" /></p>
			<p class="normal">In Chapter 4, this matrix was a bit confusing because it had the same value for <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> on every row in the matrix. When you learn to read the initial filters in a visual, you will be able to make more sense of what is going on here.</p>
			<p class="normal">Let’s step through the process of reading the initial filter from this matrix. Before we do that, though, you should add the <span class="mono">[Total</span> <span class="mono">Sales]</span> measure to the matrix so it looks as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute43" src="images/000112.png" alt="" /></p>
			<p class="normal">Then point to the cell that’s highlighted above and say this out loud (really): “The initial filter for this cell is <span class="mono">Products[Category]</span> <span class="mono">=</span> <span class="mono">Accessories</span>.” Then point to the cell underneath the highlighted cell; this cell has an initial filter of <span class="mono">Products[Category]</span> <span class="mono">=</span> <span class="mono">Bikes</span>. You can figure out the rest based on this pattern. It is important that you learn to “read” the initial filter from your visuals because it will help you understand how each value in a visual is calculated. And it is important to refer to the full table name and column name because that forces you to look, check, and confirm exactly which tables and columns you are using in your visuals.</p>
			<p class="h"><span class="b2">Understanding the Flow of the Initial </span><span class="b2"><a id="calibre_link-223"></a></span><span class="b2">Filters</span></p>
			<p class="normal">Once you know what the initial filters are&mdash;there may be more than one&mdash;you can mentally apply the following steps to your data model and track how the filters flow through relationships. Technically, the filters propagate from one table to another using the relationships:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>The initial filters coming from the visual are applied to the underlying tables in the data model. In this example, there is just one table involved, the <span class="mono1">Products</span> table (see #1 below), where <span class="mono1">Products[Category] = "Accessories"</span>. The <span class="mono1">Products</span> table is filtered so that only rows in the table that are equal to <span class="mono1">Accessories</span> remain; all other rows are filtered so that they are not in play. (Note that the initial filters can come from more than one table, but in this example, it is just the one table and one initial filter.)</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>The filter applied to the table (<span class="mono1">Products</span> in this case) automatically propagates through the relationship between the joined tables, flowing downhill in the direction of the arrow to the connected table (see #2 below). The filters automatically flow from the “one” side of the relationship to the “many” side of the relationship, in the direction of the arrow; or you can think of the filters as flowing from the lookup table to the data table. Whatever terms you use, it’s always downhill. This is one of the reasons it is good for beginners to lay out the tables using the Collie layout methodology (refer to <a href="#calibre_link-40">"Shaping Data" on page 18</a>), with the lookup tables above and the data tables below. This mental cue helps you instantly visualise how automatic filter propagation works.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>The connected table on the “many” side of the relationship, the <span class="mono1">Sales</span> table, is then also filtered (see #3 below). (Remember that there can be more than one connected table.) Only the products that are of the type <span class="mono1">Products[Category] = "Accessories"</span> remain in play in the <span class="mono1">Sales</span> table, and all the other products are filtered away. This is temporary&mdash;just for this calculation of this one single cell in the visual.</p>
			<p class="fp"><img class="_idgenobjectattribute44" src="images/000120.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>After the automatic filter propagation has been completed, then and only then does the measure get evaluated. In this case, the measure is <span class="mono1">Total Sales = SUM(Sales[ExtendedAmount])</span>. It returns the value $700,760 to the single matrix cell we started to look at in this example. </p>
			<p class="normal">This process is repeated for every single cell in the matrix, including any subtotal and grand total cells.</p>
			<p class="note"><span class="b1">Note: </span>A subtotal and a grand total do not simply add up the rows above. Rather, every cell goes through the same “filter and then evaluate” process described above, even if it is a subtotal or grand total row.</p>
			<p class="h"><span class="b2">Understanding </span><span class="b2"><a id="calibre_link-226"></a></span><span class="b2">Filter Propagation</span></p>
			<p class="normal">Keep in mind that you always evaluate each cell on its own, without regard for any other cell in the visual, even if the cell is a subtotal or grand total cell. To see how this works, look at the matrix below and read the initial filter for the highlighted cell out loud: “The initial filter for this cell is <span class="mono">Products[Category]</span> <span class="mono">=</span> <span class="mono">"Clothing"</span>.”</p>
			<p class="fp"><img class="_idgenobjectattribute45" src="images/000129.png" alt="" /></p>
			<p class="normal">The initial filter is applied to the tables in the data model using the following process:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>The initial filter is applied to the table(s). In this example, <span class="mono1">Products[Category] = "Clothing"</span>. The <span class="mono1">Products</span> table (see #1 below) is then filtered so that only rows in the table that are equal to <span class="mono1">Clothing</span> remain.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>This filter automatically propagates through the relationships that exist between the tables, flowing downhill only (in the direction of the arrow), to the connected table(s) (see #2 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>The connected table(s) (<span class="mono1">Sales</span> in this example) is then also filtered so that the same products in the <span class="mono1">Products</span> table will remain in the <span class="mono1">Sales</span> table (i.e., only clothing products will remain in the <span class="mono1">Sales</span> table after the filter propagates through the relationship) (see #3 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>The filter applied to the <span class="mono1">Sales</span> table does not automatically flow back uphill to the <span class="mono1">Customers</span> table (or to the other two tables, for that matter) (see #4 below). Filters only automatically propagate through the relationships downhill from the “one” side of the relationship to the “many” side, in the direction of the arrows. The arrow (see #4 below) indicates that the filters do not flow from the <span class="mono1">Sales</span> table to the <span class="mono1">Customers</span> table.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000137.png" alt="" /></p>
			<p class="normal">The net result is that the <span class="mono">Customers</span> table is completely unfiltered by the initial filter coming from the visual. Because the <span class="mono">Customers</span> table is unfiltered, the total 18,484 is returned to the matrix in this cell (and the same is true for every other cell for this measure in the current matrix).</p>
			<p class="normal">Even if this doesn’t seem right to you yet, realise that it is working as designed. Understanding gives you power, so stick with it until you are clear about how it works. Read this section a few times if you need to. You will eventually love the way it is designed and will learn to make it work for you.</p>
			<p class="tip"><span class="b1">Tip: </span>You simply must understand how filter propagation works in Power BI, or you will never be really good at writing DAX. I suggest that you read this chapter multiple times, if necessary, to make sure you are clear about it.</p>
		</div>
	</div>


<div id="calibre_link-41" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-416" class="ch"><span class="b2"><a id="calibre_link-9"></a>6: Concept: Lookup Tables and Data Tables</span></p>
			<p class="normal">All the sample and exercise data in this book has been prepared for you in advance; so far you have been able to simply follow the instructions, using the data provided. But the simplicity of following my instructions shields you from a deep and important topic: how you should structure the tables of your own data that you want to use in your own reports. This chapter covers this topic so that you can understand the various types of tables you can load into Power BI. </p>
			<p class="normal">Now, be warned: This topic is easy to skim over and dismiss as trivial, but in my experience, proper table structure is one of the things people most commonly get wrong, particularly if they don’t know why it is important or don’t know how to do it properly. If you get the table structure wrong, everything else becomes orders of magnitude harder.</p>
			<p class="tip"><span class="b1">Tip: </span>Don’t brush off this chapter as unimportant. You need to know this stuff if you want to proceed in Power BI with speed and confidence, using your own data.</p>
			<p class="h"><span class="b2">Data Tables vs. Lookup Tables</span></p>
			<p class="normal">As you have already learned, there are two main types of tables that can be loaded into Power BI: data tables (also called fact tables, or transaction tables) and lookup tables (also called dimension tables, reference tables, or master data tables). These two types of tables have some very important differences, as described in the following sections.</p>
			<p class="h1"><a id="calibre_link-178"></a><span class="b2">Data Tables</span></p>
			<p class="normal">Although data tables don’t have to be the largest tables loaded into Power BI, they typically are. The <span class="mono">Sales</span> table used in this book is a transactional table that contains details of individual cash register transactions that occurred in AdventureWorks retail outlets around the world. Every row in this table represents a line item on a register receipt for an individual shopping transaction. Data tables can consist of millions (or billions or even trillions) of rows of data. Some examples of data tables include <span class="mono">Sales</span>, <span class="mono">Budget</span>, <span class="mono">Exchange</span> <span class="mono">Rates</span>, <span class="mono">General</span> <span class="mono">Ledger</span>, <span class="mono">Exam</span> <span class="mono">Results</span>, and <span class="mono">Stock</span> <span class="mono">Count</span>.</p>
			<p class="normal">There is no limit on how often similar transactions can occur and be stored in a data table. Consider a fast-food chain selling burgers and fries. There could be literally hundreds of transactions each day that are all but identical because the same type of burger can be sold many times on any given day. In this scenario, what differentiates the transactions is often the time of day (time stamp) and also possibly a unique invoice/receipt number.</p>
			<p class="h1"><a id="calibre_link-264"></a><span class="b2">Lookup Tables</span></p>
			<p class="normal">Compared to data tables, lookup tables tend to be smaller (i.e., fewer rows) and often wider (i.e., more columns). Some examples of lookup tables include <span class="mono">Customers</span>, <span class="mono">Products</span>, <span class="mono">Calendar</span>, and <span class="mono">Chart</span> <span class="mono">of</span> <span class="mono">Accounts</span>.</p>
			<p class="normal">Lookup tables have a special feature that makes them different from data tables: A lookup table must have a uniquely identifying code of some type to uniquely differentiate each row in the table. This unique code is often called a key (or primary key in the database world). Let’s consider the <span class="mono">Products</span> table used in this book. AdventureWorks sells lots of different products&mdash;397 of them, to be precise. Each of these products has a unique product code (key), a three-digit number that is unique for that product. For example, product key 212 is a Sports 100 Helmet, Red. No other product in the <span class="mono">Products</span> table has the same code. If you think about it, this is the way it has to be; there would be chaos if a business used the same product code for different products. The same is true for customers and store ID numbers. In fact, the same is true for the <span class="mono">Calendar</span> table, given that the date field is a unique ID (key) for each day in the calendar.</p>
			<p class="h"><a id="calibre_link-230"></a><span class="b2">Flattened Tables</span></p>
			<p class="normal">To understand the importance of table structure and the different approaches you can take to loading data, it can be helpful to look at a single large flattened table. In the early days of Excel pivot tables (before Power Pivot for Excel), you could only create a pivot table on top of a single table of data. If you wanted to do some analysis over a table full of sales data, you could use a pivot table to aggregate the data.</p>
			<p class="normal">In the image below, the pivot table (see #2) has been built on the <span class="mono">Sales</span> table (#1), and the pivot table can easily summarise the total sales for each of the products, as identified in the <span class="mono">ProductKey</span> column.</p>
			<p class="fp"><img class="_idgenobjectattribute46" src="images/000146.png" alt="" /></p>
			<p class="normal">That is all well and good until a report needs some extra data that is not part of the <span class="mono">Sales</span> table. In the image above, what would happen if you wanted to know the name of the product, or the product category, or the subcategory, or anything else for that matter? Well, in the old days, you would find a <span class="mono">Products</span> table somewhere, and then you would write a <span class="mono">VLOOKUP()</span> (or an <span class="mono">INDEX()</span>/<span class="mono">MATCH()</span>) to go and fetch the extra columns of data that you needed for your reporting and bring it into the single <span class="mono">Sales</span> table. From there, it would be possible to use the new columns in your pivot tables. This process of bringing in the missing columns is called denormalising. After you have denormalised, your <span class="mono">Sales</span> table ends up looking something like the one below (but of course much wider if you need more columns).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000156.png" alt="" /></p>
			<p class="normal">Technically, you could load the table above into the Power BI data model and use it as is, but doing so is not best practice. If you have very simple requirements&mdash;that is, if you use simple functions such as <span class="mono">COUNT()</span> and <span class="mono">SUM()</span>&mdash;then a single flat table like the one above is fine. If you have a requirement for more complex calculations, such as <span class="mono">[SubCategory</span> <span class="mono">%</span> <span class="mono">of</span> <span class="mono">All</span> <span class="mono">Product</span> <span class="mono">Sales</span> <span class="mono">Variance</span> <span class="mono">by</span> <span class="mono">Year]</span> or using the <span class="mono">CALCULATE()</span> function (which is covered in Chapter 9), then you are well advised not to use a single flat table structure like this. Just because a single flat table is simple does not mean it is the best data model for Power BI. Power BI does not require you to bring all the columns into the one table, as was the case with old Excel pivot tables, and it is not best practice to do this, so you should generally avoid using a single table like this when using Power BI.</p>
			<p class="note"><span class="b1">Note: </span>The Power BI data modelling engine is a column store database that vertically <a id="calibre_link-155"></a>compresses the data it loads. (Now you see why this engine is also called <a id="calibre_link-381"></a>VertiPaq.) The details behind this are quite technical and beyond the scope of this book. However, there are a couple of key points you should be aware of. The more unique values in a column, the less the data will be compressed. In addition, the number of columns you have in your data tables is much more important than the number of rows; that is, fewer columns and more rows is better than more columns and fewer rows. This is particularly true for large tables.</p>
			<p class="h"><span class="b2">Joining Tables by Using </span><span class="b2"><a id="calibre_link-326"></a></span><span class="b2">Relationships</span></p>
			<p class="normal">A good approach to solving the problem of repetitive data is to keep the repeating data in separate lookup tables. In the case of products, only one column of information is needed in the <span class="mono">Sales</span> table to uniquely identify every single product: <span class="mono">ProductKey</span>, which contains the product code data. If the <span class="mono">Sales</span> table contains the unique product key, it is possible to fetch any extra information needed from a product master table when it is needed. So rather than requiring you to write a <span class="mono">VLOOKUP()</span> to go and bring the product information into the <span class="mono">Sales</span> table, Power BI allows you to load both tables into the data model and create a single relationship between them. Once the relationship has been created, the tables will work together as if they were a single unit, without the need to bring all that data into a single <span class="mono">Sales</span> table.</p>
			<p class="normal">As mentioned briefly in Chapter 2, the structure of the tables and any relationships between them in a data model is sometimes referred to as a schema. There are a few different classes of schemas, and the following sections cover the two most common types: star and snowflake schemas.</p>
			<p class="h1"><a id="calibre_link-361"></a><span class="b2">Star Schema</span></p>
			<p class="normal">The image below shows the star schema structure that is used in this book. In this case, the <span class="mono">Sales</span> table (see #1 below) is a data table and is located at the centre of the star. The other tables (#2, #3, #4, and #5) are lookup tables and are shown as points on the star. This structure is called a star schema due to its shape when laid out like this.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000164.png" alt="" /></p>
			<p class="normal">However, as you learnt in Chapter 2, you can reposition tables any way you choose, and I recommend using the Collie layout methodology, as shown below. You can see that the tables here are the same as in the diagram above, but the layout is different. The layout has no impact at all on the way Power BI operates, but it does give you a visual clue as to which tables are the lookup tables and which are the data tables because you have to “look up” to see the lookup tables. (Also, in the old days, you would write a <span class="mono">VLOOKUP()</span> to go and fetch those extra columns, so there is another link to the past between the words <span class="mono">VLOOKUP()</span> and lookup table.)</p>
			<p class="note"><span class="b1">Note:</span> In the database world, a lookup table is called a dimension table.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000277.png" alt="" /></p>
			<p class="h1"><a id="calibre_link-354"></a><span class="b2">Snowflake Schema</span></p>
			<p class="normal">An organisation is likely to have at least one database of some sort to manage some of its data. Such databases are normally built by internal IT staff or possibly by some third-party software company that builds the systems used by the organisation. In traditional relational database systems, the data is often split into many levels of lookup tables. Consider the image below. There is a single data table, <span class="mono">Sales</span> (see #1 below), and there are three lookup tables all chained together in a row (#2, #3, and #4). Table #4 is a lookup table of table #3, which is a lookup table of table #2, which is a lookup table of table #1.</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000172.png" alt="" /></p>
			<p class="normal">This data structure is common in traditional transactional databases as it is the most efficient way to store the data in those systems. However, this is not the best way to structure data in Power BI because Power BI is not a relational database. There are a few reasons this approach is not the best for Power BI:</p>
			<ul class="calibre2">
				<li class="bl">Every relationship comes at a cost. The extra relationships will potentially have negative performance impacts on the database.</li>
				<li class="bl">Business users will be building reports using the database design, and they will see all the tables in the data model. The structure above is confusing to and onerous on an end user who is trying to understand where to find information about products.</li>
				<li class="bl">Power BI was built from the ground up to be very efficient in the way it stores repetitive data in columns, particularly in the smaller lookup tables, so there is simply no reason to do it as shown in the image above.</li>
			</ul>
			<p class="h"><span class="b2">Advice on Loading Your Own Data</span></p>
			<p class="normal">There are a few things you can do to get off on the right track when it is time to build your own data models:</p>
			<ul class="calibre2">
				<li class="bl">Where possible, keep your data tables long and <a id="calibre_link-347" class="calibre3"></a>skinny. If necessary, get rid of extra columns of “data” by unpivoting your data, particularly if a data table is very wide (i.e., has a lot of columns). Each additional column of data compresses less well than the last one, which means long, wide data tables can be a real issue.</li>
				<li class="bl">Move repeating attribute columns from your data tables and create lookup tables instead. But be careful that you don’t overdo it. If a lookup table has only two columns (e.g., <span class="mono">Key</span> and <span class="mono">Description</span>), then it may be better to drop the <span class="mono">Key</span> column and just load the description directly into the data table. How to best handle this depends on the situation, and there is not a single correct way to do it.</li>
				<li class="bl">If you have lookup tables joined to other lookup tables, consider flattening them out into a single wider lookup table. This is generally a better design for Power BI.</li>
			</ul>
			<p class="note"><span class="b1">Note: </span>Definitely do not just accept the table shape and structure coming from your transactional systems. Transactional databases and reporting databases are not the same, and you shouldn’t try to use the table structure from your transactional system in Power BI.</p>
		</div>
	</div>


<div id="calibre_link-42" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-417" class="ch"><span class="b2"><a id="calibre_link-10"></a>7: DAX Topic: </span><span class="b2"><a id="calibre_link-140"></a></span><span class="b2">Calculated Columns</span></p>
			<p class="normal">It’s time for a change of pace. I have deliberately left the discussion of calculated columns until now to allow you to get accustomed to the power of measures. I have done this because the mistake I most commonly see Excel users make when learning Power BI is to use too many calculated columns. I’ll show you why I think this happens. The image below shows the Data view in Power BI.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000182.png" alt="" /></p>
			<p class="normal">As you can see, the Power BI Data view looks a lot like Excel. Most Excel users feel very comfortable when they switch to this view. The table shown above is the <span class="mono">Sales</span> table. Note that it has the columns <span class="mono">Sales[ExtendedAmount]</span> and <span class="mono">Sales[TaxAmt]</span>. But there is no column <span class="mono">Sales[Total</span> <span class="mono">Sales</span> <span class="mono">Plus</span> <span class="mono">Tax]</span>. What I observe Excel users do, over and over again, is think to themselves “I’ve got a sales amount, and I’ve got a tax amount, but I need sales including tax. I’ll add a calculated column for that.” The problem is that this is the wrong approach. Someone with an Excel background who is new to Power BI may think it’s easy to whip up such a formula without learning any new skills; self-taught users often fall into this trap. In order to understand how such a user might proceed, let’s create such a calculated column now. Keep in mind, though, that this is not the best way to do this calculation.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-82"></a>Here’s How: A Basic (but Wrong!) Calculated Column</span></p>
			<p class="normal">To write a calculated column, switch to the Data view and follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>In the Fields pane, right-click on the required table&mdash;<span class="mono1">Sales</span> in this case (see #1 below)&mdash;and then select New Column (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute47" src="images/000190.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the formula bar at the top of the table, write the following formula:</p>
			<p class="codeindented1"><span class="mono1">Total Sales Plus Tax Column =</span></p>
			<p class="codeindented1"><span class="mono1">    Sales[ExtendedAmount] + Sales[TaxAmt]</span></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>In the Column Tools tab, apply currency formatting with two decimal places.</p>
			<p class="fp"><img class="_idgenobjectattribute48" src="images/000199.png" alt="" /></p>
			<p class="normal">The image above shows the new column. Notice that each row in the new column has a number that is the total of the <span class="mono">Sales[ExtendedAmount]</span> column and the <span class="mono">Sales[TaxAmt]</span> column for that single row. The first row is $610.19, the second row is $26.45, etc. In fact, the <span class="mono">Sales</span> table contains more than 60,000 rows, and so there are now more than 60,000 new numbers stored in this new calculated column in the <span class="mono">Sales</span> table.</p>
			<p class="h"><span class="b2">Important Calculated Columns Concepts</span></p>
			<p class="normal">There are a few very important things you must understand before moving on. First, there is only a single formula for the entire calculated column written above. This single formula yields more than 60,000 different results. Keep in mind that with a calculated column, you write a single formula, and that formula is evaluated once for every row in the table.</p>
			<p class="normal">Take the illustration below as an example. The calculated column formula works through the table, one row at time. When it gets to each row, there is only a single value in each of the two input columns: one value in the <span class="mono">Sales[ExtendedAmount]</span> column (i.e., 742.35) and one value in the <span class="mono">Sales[TaxAmt]</span> column (i.e., 59.388). For each row, the single value from <span class="mono">Sales[ExtendedAmount]</span> is added to the single value from <span class="mono">Sales[TaxAmt]</span>, resulting in a single result that is stored in the same row of the new column in the table. This process is automatically repeated for every row in the table. If there are 60,000 rows, the formula is logically evaluated 60,000 times.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000207.png" alt="" /></p>
			<p class="normal">This is not how a traditional Excel spreadsheet works. In a traditional Excel spreadsheet, you write the formula once and copy the formula down the page 60,000 times to get the results for each row, and each row then has its own copy of the formula. The way traditional Excel handles this situation has a big implication. In Excel, if you want to change a row, you can simply change the formula for that row. This is not possible with Power BI calculated columns. You can only have a single formula for an entire calculated column.</p>
			<p class="note"><span class="b1">Note:</span> Excel has a feature called Excel Tables. It is possible to convert data from a regular Excel spreadsheet into an Excel Table. If you do this, the new Excel Table behaves the same way as a calculated column.</p>
			<p class="h1"><a id="calibre_link-334"></a><span class="b2">Row-by-Row Evaluation in Calculated Columns</span></p>
			<p class="normal">The way Power BI creates a calculated column is by using a trick I call row-by-row evaluation. It is not possible to perform this trick inside a regular measure in Power BI. To see what I mean, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Copy the formula you wrote above from the formula bar:</p>
			<p class="codeindented1"><span class="mono1">Total Sales Plus Tax Column =</span></p>
			<p class="codeindented1"><span class="mono1">    Sales[ExtendedAmount] + Sales[TaxAmt]</span></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the Fields pane, right-click the <span class="mono1">Sales</span> table and select New Measure.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Paste the formula you copied.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Change the name of the formula from <span class="mono1">Total Sales Plus Tax Column</span> to <span class="mono1">Total Sales Plus Tax Measure</span>, as shown below:</p>
			<p class="codeindented1"><span class="mono1">Total Sales Plus Tax Measure =</span></p>
			<p class="codeindented1"><span class="mono1">    Sales[ExtendedAmount] + Sales[TaxAmt]</span></p>
			<p class="nlc">Press Enter.</p>
			<p class="normal">When you try to write this measure using exactly the same DAX formula that worked as a calculated column, you get the error shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute49" src="images/000215.png" alt="" /></p>
			<p class="normal">There is a very important reason this DAX formula works in a calculated column and not in a measure: A calculated column has awareness of the presence of rows; it can do row-by-row evaluation. When you write a formula in a calculated column, the single formula is evaluated for every row in the table, one row at a time. A calculated column has the ability to do row-by-row evaluation, but a regular measure does not have this ability, as confirmed by the error message shown above.</p>
			<p class="normal">Here is a modified version of the invalid measure you just used that does work as a measure:</p>
			<p class="code"><span class="mono1">Total Sales Plus Tax Measure Correct =</span></p>
			<p class="code"><span class="mono1">    SUM(Sales[ExtendedAmount]) + SUM(Sales[TaxAmt])</span></p>
			<p class="normal">To see why this new version of the measure works, look at what is different: The new version above has every column name wrapped inside a DAX function&mdash;in this case, the <span class="mono">SUM()</span> function. In the original measure that was invalid, repeated below, there are no functions wrapped around the column names: </p>
			<p class="code"><span class="mono1">Total Sales Plus Tax Measure =</span></p>
			<p class="code"><span class="mono1">    Sales[ExtendedAmount] + Sales[TaxAmt]</span></p>
			<p class="tip"><span class="b1">Tip:</span> Compare the two versions of this measure so you are clear on the difference.</p>
			<p class="h1"><span class="b2">No </span><span class="b2"><a id="calibre_link-289"></a></span><span class="b2">Naked Columns in Measures</span></p>
			<p class="normal">You can’t write measures in DAX that contain what I call “naked columns.” A naked column is a reference to a column name that is not wrapped inside a DAX function; the invalid formula above contains one. Naked columns are allowed inside calculated columns because a calculated column has the ability to do row-by-row evaluation. However, whereas a calculated column understands the concept of row-by-row evaluation, a measure does not. A calculated column is able to work through the table, one row at a time, and find a single value in each of the naked columns (the intersection of the column and the row) in order to do the calculation for each and every row. A naked column is not allowed in a measure because a measure has no ability to do row-by-row evaluation. If you use a naked column in a measure, you are essentially asking DAX to add a column of more than 60,000 numbers to another column of 60,000 numbers. This is a lot like saying, “Take this spreadsheet and add it to this other spreadsheet.” You can’t add spreadsheets together, and you can’t add columns together. What you can do inside a measure, however, is add up all the numbers in a single column, add up all the numbers in a second column, and then add together the totals; this is perfectly fine, as shown with the correct version of the measure above.</p>
			<p class="note"><span class="b1">Note:</span> It is valid to refer to naked columns in a calculated column as long as the naked columns come from the same table where you are writing the calculated column. You cannot refer to naked columns in a calculated column if the naked columns come from another table.</p>
			<p class="h"><span class="b2">The Big Problem with </span><span class="b2"><a id="calibre_link-141"></a></span><span class="b2">Calculated Columns</span></p>
			<p class="normal">There is one big problem with calculated columns&mdash;and I do mean BIG. The problem is that a calculated column always evaluates every row and permanently stores the answer in the workbook as a value in the new column in the table. This takes up space in the workbook, making your files bigger and hindering their performance. What’s more, the compression applied to calculated columns is generally not as good as for imported columns, and so the data may be stored in the workbook less efficiently.</p>
			<p class="normal">As mentioned at the beginning of this chapter, the mistake I most commonly see Excel users make is to use too many calculated columns. There are two general reasons you should try to avoid them most of the time:</p>
			<ul class="calibre2">
				<li class="bl">Calculated columns make your tables and workbooks bigger.</li>
				<li class="bl">Mostly (though not always) you can get the same outcome by using a measure, which is a better way.</li>
			</ul>
			<p class="normal">Consciously avoiding using calculated columns and trying to find a measure-based solution will make you a stronger DAX user. Trust me. Over time, with experience, you will learn when it is best to use calculated columns instead.</p>
			<p class="h"><span class="b2">Sometimes a </span><span class="b2"><a id="calibre_link-142"></a></span><span class="b2">Calculated Column Is Your Friend</span></p>
			<p class="normal">Calculated columns exist for a reason. In some instances, you simply cannot use a measure&mdash;such as when you want to use the results in a slicer. Imagine that you want a slicer in a report so you can filter a chart for either weekdays or weekends. You cannot solve this problem by using a measure. If you want a slicer, you must have a column in a table.</p>
			<p class="normal">Wait a minute. I just finished telling you not to create calculated columns, and now I am telling you it’s okay to do so. Allow me to clarify. In general, you should not use a calculated column if you can:</p>
			<ul class="calibre2">
				<li class="bl">Use a measure instead</li>
				<li class="bl">Bring the data into a table directly from the source data</li>
				<li class="bl">Create the column during data load by using Power Query</li>
			</ul>
			<p class="normal">If you are missing a column of data that you need (e.g., for a slicer, where a measure will not do the job), I recommend that you prefer the following order to source the missing column:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Add it at the source and import it from there.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Create it in Power Query on data load.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Use a calculated column.</p>
			<p class="normal">By pushing the column as far back to the source as possible, you increase the possibility of reusability&mdash;for yourself and for others&mdash;down the track. But the truth is that this is a purist view, and the method you use doesn’t really matter that much. If you know how to do something in a calculated column and you don’t know how to do it in Power Query, then there is generally no harm in using a calculated column. Indeed, you can and should use calculated columns when you need them. You should definitely use a calculated column when both of the following conditions are satisfied at the same time:</p>
			<ul class="calibre2">
				<li class="bl">You need to filter/slice a visual based on the results of a column (i.e., you want to use the column on Filters, Slicer, Rows, or Columns). Measures don’t work in this case.</li>
				<li class="bl">You can’t bring the column of data you need in from your source data or by using Power Query (for whatever reason).</li>
			</ul>
			<p class="normal">These are the most common reasons for not being able to get a column you need from your source data:</p>
			<ul class="calibre2">
				<li class="bl">The column doesn’t exist.</li>
				<li class="bl">You can’t arrange to get the column added (e.g., you don’t have access to the source system and/or those who do have access can’t or won’t do it for you).</li>
				<li class="bl">You can get the column added, but not in a timely manner.</li>
				<li class="bl">You want to use measures that exist in your data model as part of the formula needed to create the new column (e.g., annual customer sales to determine small, medium, and large customer classifications).</li>
			</ul>
			<p class="normal">As mentioned earlier, if possible, you should try to get the column you need added to the source data. When you do this, you get the full benefit of compression on data import; in addition, the column is available for reuse in all future workbooks created by you and others. But sometimes this simply isn’t possible; other times, it is possible, but you can’t wait two weeks (or two years!) to get it done. Calculated columns are useful in such cases. And if a new column becomes available in the future, you can simply delete your calculated column and replace it with the new column coming in from the source.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-83"></a>Here’s How: Creating a </span><span class="b2"><a id="calibre_link-191"></a></span><span class="b2">Day Type Calculated Column</span></p>
			<p class="normal">Let’s look at an example of where you should use a calculated column instead of a measure. Let’s say that you extract the <span class="mono">Calendar</span> table from your enterprise database, and you want a new column that shows whether each date is a weekend, but you can’t arrange to have this column added right now. Of course, you could use Power Query, but this book is about DAX, so this section discusses how to create a calculated column to solve this problem.</p>
			<p class="normal">Follow these steps to create a calculated column called <span class="mono">Day</span> <span class="mono">Type</span> in the <span class="mono">Calendar</span> table:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>In the Power BI Fields pane, right-click on the <span class="mono1">Calendar</span> table and then select New Column.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Immediately start typing the following over the top of <span class="mono1">Column =</span> in the formula bar:</p>
			<p class="codeindented1"><span class="mono1">Day Type =</span></p>
			<p class="codeindented1"><span class="mono1">    IF(</span></p>
			<p class="codeindented1"><span class="mono1">    'Calendar'[DayNumberOfWeek] = 1 || 'Calendar'[DayNumberOfWeek]=7,</span></p>
			<p class="codeindented1"><span class="mono1">    "Weekend","Weekday"</span></p>
			<p class="codeindented1"><span class="mono1">    )</span></p>
			<p class="note"><span class="b1">Note: </span>Note the use of the two pipe symbols <a id="calibre_link-106"></a>(<span class="mono1">||</span>) in the formula above. This is the inline text version of a logical <span class="mono1">OR</span> function. If you are using a U.S. keyboard, the pipe can be found above the backslash (<span class="mono1">\</span>) key (which is right above the Enter/Return key). If you are using another keyboard, you simply have to go hunting.</p>
			<p class="nlc">You can also write an <span class="mono">OR</span> function in DAX as follows:</p>
			<p class="codeindented1"><span class="mono1">IF(</span></p>
			<p class="codeindented1"><span class="mono1">    </span><span class="mono1"><a id="calibre_link-296"></a></span><span class="mono1">OR('Calendar'[DayNumberOfWeek] = 1, 'Calendar'[DayNumberOfWeek] = 7)</span></p>
			<p class="codeindented1"><span class="mono1">    "Weekend","Weekday")</span></p>
			<p class="note"><span class="b1">Note:</span> You can see here that the <span class="mono1">OR</span> function in DAX accepts only two parameters&mdash;and this is different from the <span class="mono1">OR</span> function in Excel.</p>
			<p class="nlc">You can also use the <a id="calibre_link-248" class="calibre3"></a><span class="mono">IN</span> syntax, like this:</p>
			<p class="codeindented1"><span class="mono1">IF(</span></p>
			<p class="codeindented1"><span class="mono1">    'Calendar'[DayNumberOfWeek] IN {1,7},</span></p>
			<p class="codeindented1"><span class="mono1">    "Weekend","Weekday"</span></p>
			<p class="codeindented1"><span class="mono1">    )</span></p>
			<p class="nlc"><span class="mono"><a id="calibre_link-387" class="calibre3"></a></span>Personally, I prefer to use the <span class="mono">IN</span> syntax because you only have to mention the column name once, and the list of possible values is very easy to maintain. The <span class="mono">OR()</span> function above accepts only two parameters as inputs; if you have more than two logical inputs, you need to use multiple nested <span class="mono">OR()</span> functions to make it work.</p>
			<p class="note"><span class="b1">Note: </span>The inline version of the logical <a id="calibre_link-122"></a><span class="mono1">AND</span> is the double ampersand <a id="calibre_link-109"></a>(<span class="mono1">&amp;&amp;</span>), which equates to the <span class="mono1">AND()</span> function.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>If you are not currently in the Data view, switch to it and check to make sure your column is calculating correctly.</p>
			<p class="note"><span class="b1">Note:</span> It is very important that you test your measures after you write them. You are a data modeller now! Along with this title comes the responsibility to check that the measures you write are returning the expected results. Switching to the Data view can help you validate this.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Note that the formula you just created, as shown below, is a single formula for the entire column. This is not traditional Excel; there can be only one formula in a single calculated column. You therefore have to write the one formula so that it evaluates and handles all the possible scenarios you need.</p>
			<p class="fp"><img class="_idgenobjectattribute50" src="images/000224.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Now that you have the new calculated column, go to a new page in your workbook and create a new matrix. Place <span class="mono1">Products[Category]</span> on Rows, place your new column <span class="mono1">'Calendar'[Day Type]</span> on Columns, and then add <span class="mono1">[Total</span> <span class="mono1">Sales]</span> to the Values section. You end up with the matrix shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute51" src="images/000232.png" alt="" /></p>
			<p class="normal">You have successfully extracted some new insights from the data that didn’t exist before: You have used data modelling techniques to enhance the data for weekday/weekend analysis. You could also use the new column on a new slicer as an alternate way to filter the data. You cannot use a measure in a slicer, so if you want to use a slicer, you must create a column.</p>
			<p class="h1"><span class="b2">Practice Exercise: Calculated Columns</span></p>
			<p class="normal">Write the following calculated column in the <span class="mono">Calendar</span> table. Find the solution to this practice exercise in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">24. Creating a </span><span class="bi"><a id="calibre_link-238"></a></span><span class="bi">Half-Year Column</span></p>
			<p class="normal">In the <span class="mono">Calendar</span> table, write a calculated column that returns the value <span class="mono">H1</span> for the first half of each year (January through June) and returns <span class="mono">H2</span> for the second half of each year (July through December). Hint: You might want to use an <span class="mono">IF</span> statement to do this.</p>
		</div>
	</div>


<div id="calibre_link-43" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-418" class="ch"><span class="b2"><a id="calibre_link-11"></a>8: DAX Topic: The Basic </span><span class="b2"><a id="calibre_link-254"></a></span><span class="b2">Iterators SUMX() and AVERAGEX()</span></p>
			<p class="normal">The functions covered in Chapter 4&mdash;<span class="mono">SUM()</span>, <span class="mono">COUNT()</span>, <span class="mono">COUNTROWS()</span>, <span class="mono">MIN()</span>, <span class="mono">MAX()</span>, <span class="mono">COUNTBLANK()</span>, and <span class="mono">DIVIDE()</span>&mdash;are what I call “aggregation functions.” An aggregation function acts on an entire column or table and uses a specific aggregating technique to return a single value to a cell in a visual on a report.</p>
			<p class="normal">There is another class of functions that can possibly return the same answers as the aggregation functions&mdash;but using a different logical approach. These “X-functions” (so called because each one has an <span class="mono">X</span> at the end of its name) are part of the iterator family.</p>
			<p class="h"><span class="b2">Iterators Use Row-by-Row Evaluation</span></p>
			<p class="normal">The main difference between iterators and the other functions we have looked at so far is that iterators are functions that are “aware” of the existence of rows in tables and columns of data. Exactly like a calculated column, an iterating function can do row-by-row evaluation. Iterating functions step through every row in a table, one row at a time, and evaluate the formula for every row.</p>
			<p class="h1"><span class="b2">Iterating Functions vs. Calculated Columns</span></p>
			<p class="normal">The big difference between iterating functions like <span class="mono">SUMX()</span> and calculated columns is that a calculated column permanently stores the results in the new column. An iterating function generates exactly the same row-by-row results, but it does not permanently store these results anywhere in the workbook.</p>
			<p class="normal">I have been teaching people DAX for many years. Trust me here: The easiest way to understand how a <span class="mono">SUMX()</span> function works is to first build a calculated column so you can “see” what it is doing and then replace the calculated column with the <a id="calibre_link-364" class="calibre3"></a><span class="mono">SUMX()</span> version equivalent. To see how this works, let’s look at how to write a new version of the <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">Plus</span> <span class="mono">Tax</span> <span class="mono">Column]</span> equation by using <span class="mono">SUMX()</span>. As mentioned earlier, we can start with the calculated column from early in Chapter 7:</p>
			<p class="code"><span class="mono1">Total Sales Plus Tax Column =</span></p>
			<p class="code"><span class="mono1">    Sales[ExtendedAmount] + Sales[TaxAmt]</span></p>
			<p class="normal">The image below shows (again) the column that is added to the <span class="mono">Sales</span> table as a result. You can see the row-by-row results in the new column.</p>
			<p class="fp"><img class="_idgenobjectattribute52" src="images/000241.png" alt="" /></p>
			<p class="normal">After creating this new calculated column, you could add the new column to the Values section in a matrix (see #1 below). You would then see the total of the column in the matrix (#2) because Power BI automatically sums the total of this column for you (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000249.png" alt="" /></p>
			<p class="normal">Let me recap the key points of this process before we move on to <span class="mono">SUMX()</span>:</p>
			<ul class="calibre2">
				<li class="bl">The calculated column shown in the first of the two images above has the ability to do row-by-row evaluation.</li>
				<li class="bl">Because the calculated column can do row-by-row evaluation, it is perfectly okay to refer to naked columns (from the same table) in the formula expression. It is not valid to write exactly the same formula as in a regular measure because naked columns (i.e., columns not wrapped in functions) are not allowed in measures.</li>
				<li class="bl">The <span class="mono">Sales</span> table is evaluated one row at a time, and the result from each row is permanently stored in the new column (shown above).</li>
				<li class="bl">When you add this new column to a visual, Power BI automatically sums the column of values to show you the total. This is what I call an “implicit measure.” If you don’t want the sum of the column, you can change the implicit calculation to be something different, such as an average.</li>
			</ul>
			<p class="h"><span class="b2">Using SUMX(</span><span class="bi">table</span><span class="b2">, </span><span class="bi">expression</span><span class="b2">)</span></p>
			<p class="normal">Now that you have gotten a fresh reminder of how a calculated column works, let’s switch to <span class="mono">SUMX()</span>. Remember that the goal here is to look at how <span class="mono">SUMX()</span> and a calculated column are almost identical in behaviour. The difference is that a calculated column permanently stores the results, and <span class="mono">SUMX()</span> does not.</p>
			<p class="normal"><span class="mono">SUMX()</span> takes two parameters: a table name and the expression to be evaluated. <span class="mono">SUMX()</span> steps through every row in the specified table (parameter 1), one row at a time, and evaluates the expression (parameter 2) for each row, generating an interim result for each row. Finally, it adds together the interim results for each row. <span class="mono">SUMX()</span> can do row-by-row evaluation, just as a calculated column can, working through the rows one at a time to complete the evaluation. However, the interim results are not permanently stored. This is a good thing because it makes Power BI more efficient, but it can be challenging when learning DAX because you can’t see what is going on. This is why I suggest that before you write a formula, you write an equivalent calculated column; doing so helps you visualise what is happening so you can get your head around the concept.</p>
			<p class="normal">To write the new measure from the preceding section by using <span class="mono">SUMX()</span>, you need to create a new matrix, put <span class="mono">Products[Category]</span> on Rows, and then write this measure, as shown below, and place it in the <span class="mono">Sales</span> table.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000258.png" alt="" /></p>
			<p class="normal">Note the two parameters inside this measure in the image above. The first parameter (see #1 above) is the table name, <span class="mono">Sales</span>. Imagine that you are adding a calculated column to the <span class="mono">Sales</span> table. The second parameter (#2) is identical to the calculated column from before. <span class="mono">SUMX()</span> does exactly the same calculation as that calculated column: It steps through the <span class="mono">Sales</span> table (parameter 1), one row at a time, and for each row, it takes the single value in the <span class="mono">Sales[ExtendedAmount]</span> column and adds it to the single value in the <span class="mono">Sales[TaxAmt]</span> column. It repeats this process for each of the more than 60,000 rows in the <span class="mono">Sales</span> table and keeps the interim results in memory only. It does not permanently store these results, so you can’t see them to validate what is happening. When it is done evaluating all rows, it sums the interim results into a total.</p>
			<p class="note"><span class="b1">Note:</span> The <span class="mono1">SUMX()</span> function sums the interim results. The <a id="calibre_link-126"></a><span class="mono1">AVERAGEX()</span> function averages the interim results.</p>
			<p class="normal">If you add both the new <span class="mono">SUMX()</span> measure and the original calculated column to a matrix, you see that they give exactly the same results, as shown below.</p>
			<p class="normal"><img class="_idgenobjectattribute53" src="images/000266.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>I have talked extensively about how calculated columns and iterators work “one row at a time.” It is convenient to think of the process working in this way, and indeed that is the logical execution approach. In reality, though, the Power BI engine has been built and optimised to work very efficiently under the hood. In many circumstances, the actual physical execution is much more efficient than is implied by the “one row at a time” logical execution explanation. This is a very deep technical topic and is beyond the scope of this book. The key thing to note is that you should not think that iterators are inherently inefficient because they are working one row at a time; the Power BI engine optimisations normally make the physical execution much more efficient than is implied by the phrase “one row at a time.”</p>
			<p class="h1"><span class="b2">Parameter 2 Can Be Any Valid DAX</span></p>
			<p class="normal">The second parameter of <span class="mono">SUMX()</span> (and, for that matter, the syntax for calculated columns) does not have to be a simple addition; it can be any valid formula you can write. Consider the following data structure, which could exist in a typical sales table.</p>
			<p class="normal"><img class="_idgenobjectattribute54" src="images/000274.png" alt="" /></p>
			<p class="normal">This sales table stores the quantity of items sold and the unit price. In order to calculate the total sales ($23.00), you would first need to generate the <span class="mono">Extended</span> <span class="mono">Amount</span> column by multiplying <span class="mono">Order</span> <span class="mono">Quantity</span> by <span class="mono">Unit</span> <span class="mono">Price</span> (if it didn’t already exist in the sales table). Then you could add up the <span class="mono">Extended</span> <span class="mono">Amount</span> column to get the total sales of $23.00. There is no other way to generate the <span class="mono">Total</span> <span class="mono">Sales</span> value; you simply must evaluate the quantity multiplied by the unit price for every row in the table and then add up the total. This is the only way to get the correct answer. However, you have a choice of how to calculate the sales total: You could load an extended amount column from the source, you could create an extended amount column as a calculated column after the source data is loaded, or you could generate the extended amount values on the fly inside <span class="mono">SUMX()</span> without ever permanently storing the extra column. Generally speaking, you should prefer the <span class="mono">SUMX()</span> approach.</p>
			<p class="normal">In the AdventureWorks database <span class="mono">Sales</span> table, there is a <span class="mono">Quantity</span> column, a <span class="mono">Unit</span> <span class="mono">Price</span> column, and an <span class="mono">Extended</span> <span class="mono">Amount</span> column. Technically, the <span class="mono">Extended</span> <span class="mono">Amount</span> column is not needed; if you ever want to know the total of the <span class="mono">Extended</span> <span class="mono">Amount</span> column, you can generate the required calculation by using <span class="mono">SUMX()</span> without the need to ever store this column in your data model.</p>
			<p class="note"><span class="b1">Note:</span> It is best practice to load into your data model only the columns of data you need and not to load columns that can be calculated on demand inside a measure.</p>
			<p class="h1"><span class="b2">Practice Exercises: SUMX()</span></p>
			<p class="normal">Write the following measures for practice. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">25. [Total Sales SUMX Version]</span></p>
			<p class="normal">Multiply quantity by unit price from the appropriate columns in the <span class="mono">Sales</span> table. This will give you the same result as the <span class="mono">[Total</span> <span class="mono">Sales]</span> measure from before but will give you an opportunity to practice the concept that was just explained.</p>
			<p class="h2"><span class="bi">26. [Total Sales Including Tax SUMX Version]</span></p>
			<p class="normal">Add the <span class="mono">ExtendedAmount</span> column together with the appropriate tax column in the <span class="mono">Sales</span> table.</p>
			<p class="h2"><span class="bi">27. [Total Sales Including Freight]</span></p>
			<p class="normal">Add the <span class="mono">ExtendedAmount</span> column to the freight cost.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you get the following matrix?</p>
			<p class="fp"><img class="_idgenobjectattribute22" src="images/000282.png" alt="" /></p>
			<p class="normal">Make sure you are following these steps to minimise rework:</p>
			<ul class="calibre2">
				<li class="bl">Put the measures in the correct table by right-clicking the target table and selecting New Measure. (Do not select New Measure from the Modeling tab!)</li>
				<li class="bl">Give the measure a meaningful name that includes spaces.</li>
				<li class="bl">Apply suitable formatting immediately after writing the measure.</li>
				<li class="bl">Write the formula and then check to ensure that it was written correctly by adding it to a matrix to check your results.</li>
			</ul>
			<p class="h2"><span class="bi">28. [Dealer Margin]</span></p>
			<p class="normal">Create a new matrix. From the <span class="mono">Products</span> table, put <span class="mono">Category</span> on Filters for this matrix and then select <span class="mono">Accessories</span> from this filter. Then put <span class="mono">ProductName</span> on Rows. You should have something like what is shown below (although what is shown here is truncated). Note that I have used a filter from the Filters pane on this visual section to apply the filter on <span class="mono">Products[Category]</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000290.png" alt="" /></p>
			<p class="normal">Write a measure that shows the theoretical margin the dealer gets (i.e., the difference between the product’s list price and the product’s dealer price). Both columns you need for this measure are in the <span class="mono">Products</span> table. Did you get the answers shown below? (Once again, the matrix in the image below is truncated; it shows only the first nine rows, though in reality it is longer.)</p>
			<p class="fp"><img class="_idgenobjectattribute55" src="images/000298.png" alt="" /></p>
			<p class="h"><span class="b2">When to Use </span><span class="b2"><a id="calibre_link-392"></a><a id="calibre_link-115"></a></span><span class="b2">X-Functions vs. Aggregators</span></p>
			<p class="normal">Now you know that you can use X-functions such as <span class="mono">SUMX()</span>, and you can also use aggregators such as <span class="mono">SUM()</span>, and they do similar things but take different approaches. The following examples will help you figure out when to use X-functions and when to use aggregators. These examples use simplistic tiny tables for illustration purposes only. In real life, tables of data are, of course, much larger.</p>
			<p class="h1"><span class="b2">Example 1: When the Data Doesn’t Contain the Line Total</span></p>
			<p class="normal">If your <span class="mono">Sales</span> table contains a column for quantity (<span class="mono">Qty</span> in the image below) and another column for price per unit, you need to multiply the quantity by the price per unit (<span class="mono">Price</span> <span class="mono">Per</span> <span class="mono">Unit</span> in the image below) to calculate total sales (because the actual total doesn’t exist at the line level in the table).</p>
			<p class="fp"><img class="_idgenobjectattribute13" src="images/000306.png" alt="" /></p>
			<p class="normal">If this is the structure of your data, you simply must use <span class="mono">SUMX()</span>, like this:</p>
			<p class="code"><span class="mono1">Total Sales 1 = SUMX(Sales, Sales[Qty] * Sales[Price Per Unit])</span></p>
			<p class="normal">In this example, you have to calculate the totals for the rows first, one row at a time. This is what the iterator functions are designed to do.</p>
			<p class="h1"><span class="b2">Example 2: When the Data Does Contain a Line Total</span></p>
			<p class="normal">If your data contains a single column with the extended total sales for that line item, you can use <span class="mono">SUM()</span> to add up the values:</p>
			<p class="code"><span class="mono1">Total Sales 2 = SUM(Sales[Total Sales])</span></p>
			<p class="fp"><img class="_idgenobjectattribute13" src="images/000315.png" alt="" /></p>
			<p class="normal">There is no need for an iterator in this example. Note, however, that you could still use <span class="mono">SUMX()</span>, like this, to get the same answer:</p>
			<p class="code"><span class="mono1">Total Sales 2 alternate = SUMX(Sales, Sales[Total Sales])</span></p>
			<p class="note"><span class="b1">Note: </span>In the formula above, there is only a single column for the expression parameter: <span class="mono1">Sales[Total Sales]</span>. This is a valid DAX expression, and it will work just fine. For each row in the iteration of <span class="mono1">SUMX()</span>, the formula just takes the line-level total for this column. At the end, it simply adds up all the values.</p>
			<p class="h"><span class="b2">So Which Should You Use, SUM() or SUMX()?</span></p>
			<p class="normal">There is technically no difference in the operation of the following two formulas:</p>
			<p class="code"><span class="mono1">Measure 1 = SUM(Sales[Total Sales])</span></p>
			<p class="code"><span class="mono1">Measure 2 = SUMX(Sales, Sales[Total Sales])</span></p>
			<p class="normal">Measure 1 should be familiar to Excel users because it is virtually the same syntax used in Excel. The syntax of Measure 2 is harder to understand. But the truth is, these two formulas are evaluated in exactly the same way. Technically, Measure 1 is converted to Measure 2 prior to evaluation. Microsoft wants to make it as easy as possible for Excel users to start using DAX, so where possible, it provides simple functions with similar syntax to Excel to help you get started. (Microsoft calls this similarity and simplicity “<a id="calibre_link-367" class="calibre3"></a>syntax sugar.”) But under the hood, Microsoft converts this simple syntax into the more advanced syntax required to get the job done.</p>
			<p class="normal">Whether you use <span class="mono">SUM()</span> or <span class="mono">SUMX()</span> comes down to personal preference and the structure of your data. If, for example, you have an extended amount column, you can choose either option. If, however, you have only a quantity column and a unit price column, you must use <span class="mono">SUMX()</span>.</p>
			<p class="h1"><span class="b2">Performance Implications</span></p>
			<p class="normal">As a general rule, the more unique values loaded in a column (i.e., the higher the cardinality of the column), the worse the calculation performance will be. But don’t panic. Power BI is generally super-fast at doing calculations. If you have 200 million rows of data, you might start to see a problem with a high-cardinality column, but if you have fewer than several million rows of data, it is unlikely that you will experience any measurable performance impact.</p>
			<p class="h"><span class="b2">Avoiding Data You Don’t Need</span></p>
			<p class="normal">One important point to note before moving on is that you should definitely not load redundant data. It should be apparent that if you have a quantity column and price per unit column in a table, you can “calculate” the value of total sales any time you need by using a measure. Similarly, if you have total sales and quantity in a table, you can calculate price per unit any time you like. Generally speaking, you should not load columns of redundant data that can be calculated on the fly with a measure. Doing so increases file size and can make everything refresh and perform more slowly. The general rule is to bring in the minimum number of columns you need to do the job, and it is best to bring in the columns with the lowest numbers of unique values, where possible.</p>
			<p class="normal">Now take a look at the <a id="calibre_link-149" class="calibre3"></a>cardinality of the three numeric columns below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000332.png" alt="" /></p>
			<p class="normal">There are duplicate values in the <span class="mono">Qty</span> column and also in the <span class="mono">Price</span> <span class="mono">Per</span> <span class="mono">Unit</span> column, but there are no duplicates in the <span class="mono">Total</span> <span class="mono">Sales</span> column. The cardinalities of the <span class="mono">Qty</span> and the <span class="mono">Price</span> <span class="mono">Per</span> <span class="mono">Unit</span> columns are therefore lower than the cardinality of the <span class="mono">Total</span> <span class="mono">Sales</span> column. As a general rule, it is better to load the first two columns and not the third column and to use an iterating function such as <span class="mono">SUMX()</span> or <span class="mono">AVERAGEX()</span> to generate the results on the fly. This may seem counterintuitive if you think about iteration as being a slow, row-by-row evaluation (and it is understandable that you might think of it that way). However, the underlying Power BI engine is optimised to work this way. There are exceptions to this rule, but they are beyond the scope of this book.</p>
			<p class="h"><span class="b2">When Totals Don’t Add Up</span></p>
			<p class="normal">There is another use case that requires you to use <span class="mono">SUMX()</span> or some other iterator. The following small table of sample data will help illustrate the problem and the preferred solution.</p>
			<p class="fp"><img class="_idgenobjectattribute56" src="images/000340.png" alt="" /></p>
			<p class="normal">This table shows four customers, with the average amount of money they have spent each time they have shopped as well as the number of times they have shopped. If you load this data into Power BI and then try to use aggregating functions to find the average amount spent across all customers as well as the total amount spent, you get the wrong answers, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute57" src="images/000348.png" alt="" /></p>
			<p class="normal">The following measures are used above:</p>
			<p class="code"><span class="mono1">Total Number of Visits = SUM(VisitData[Number of Visits])</span></p>
			<p class="code"><span class="mono1">Avg Spent per visit Wrong= AVERAGE(VisitData[Spend per Visit])</span></p>
			<p class="code"><span class="mono1">Total Spent Wrong =</span></p>
			<p class="code"><span class="mono1">    [Avg Spent per visit Wrong] * [Total Number of Visits]</span></p>
			<p class="normal">The first measure, <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Visits]</span>, is correct because the data is additive, but the other two measures give the wrong results. This is a classic situation where you can’t perform multiplication on the <a id="calibre_link-125" class="calibre3"></a>averages at the grand total level. Given the original sample data, the only way to calculate the correct answer is to complete a row-by-row evaluation for each customer, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute58" src="images/000356.png" alt="" /></p>
			<p class="normal">The table above includes a <span class="mono">SUMX()</span> function to find the total spent, row by row. Only then does the matrix calculate the average spent per visit. Here is the complete set of correct formulas:</p>
			<p class="code"><span class="mono1">Total Number of Visits = SUM(VisitData[Number of Visits])</span></p>
			<p class="code"><span class="mono1">Total Spent SUMX =</span></p>
			<p class="code"><span class="mono1">    SUMX(VisitData,</span></p>
			<p class="code"><span class="mono1">        VisitData[Spend per Visit] * VisitData[Number of Visits]</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="code"><span class="mono1">Avg Spent per visit Correct =</span></p>
			<p class="code"><span class="mono1">    DIVIDE([Total Spent SUMX], [Total Number of Visits])</span></p>
			<p class="normal">Whenever you see that the totals in your visuals don’t add up, you should try to figure out what is happening row by row in the visual that is not happening in the total row. Such a problem is almost always caused by the fact that the visual is doing some filtering inside the matrix that is not occurring at the total level. You should look at the visual and consider how you can simulate the row-by-row filtering that you see inside the visual in the total row. When you determine the answer, you will know how to solve the problem of totals not adding up. It normally involves using an iterating function like <span class="mono">SUMX()</span>.</p>
			<p class="h"><span class="b2">Are You Writing Measures Correctly?</span></p>
			<p class="normal">It’s time to practice using some new functions. Before you get into the following practice exercises, here is a refresher on the process you should use to write measures:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a new matrix on a new sheet.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Put a column (such as <span class="mono1">Products[Category]</span>) on Rows.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>In the Fields pane, right-click the table where the measure will be stored and select New Measure.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Give the measure a descriptive name.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Start typing the DAX formula. To check the syntax as you go, pause to read the IntelliSense description of the function and the syntax, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000005.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Write the complete formula you need for the task at hand.</p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Immediately after writing the formula, apply any formatting you want to use.</p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>Add the measure to your matrix so you can see the results before moving on.</p>
			<p class="h1"><span class="b2">Practice Exercises: </span><span class="b2"><a id="calibre_link-127"></a></span><span class="b2">AVERAGEX()</span></p>
			<p class="normal">Set up a new matrix and put <span class="mono">Products[Category]</span> on Rows. Then write the following measures by using <span class="mono">AVERAGEX()</span>. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">29. [Average Selling Price Including Tax per Item]</span></p>
			<p class="normal">You need to find the sales amount column and the tax column in the <span class="mono">Sales</span> table. Then use <span class="mono">AVERAGEX()</span> to find the average selling price, including tax. Note that there is more than one sales amount column you can use; you can choose any one of them for this exercise.</p>
			<p class="h2"><span class="bi">30. [Average Profit Per Item Sold]</span></p>
			<p class="normal">To work out the profit per item sold, you need to work out the profit per item and then find the average. There is no column in the <span class="mono">Sales</span> table for profit, so you need to use <span class="mono">AVERAGEX()</span> to do the calculation. Profit is simply the selling price minus the cost price.</p>
			<p class="h2"><span class="bi">31. [Average Value of Safety Stock Per Product]</span></p>
			<p class="normal">There are safety stock level and list price columns in the <span class="mono">Products</span> table. Calculate what the average value of the safety stock will be. You should put the results in a matrix, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute59" src="images/000013.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>There are other X-functions that are not covered in this book, such as <a id="calibre_link-269"></a><span class="mono1">MAXX()</span>, <a id="calibre_link-284"></a><span class="mono1">MINX()</span>, <a id="calibre_link-162"></a><span class="mono1">COUNTAX()</span>, and <a id="calibre_link-165"></a><span class="mono1">COUNTX()</span>. You can find out how to use them by typing one of them at a time into the formula bar and reading the IntelliSense.</p>
		</div>
	</div>


<div id="calibre_link-44" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-419" class="ch"><span class="b2"><a id="calibre_link-12"></a>9: DAX Topic: </span><span class="b2"><a id="calibre_link-136"></a></span><span class="b2">CALCULATE()</span></p>
			<p class="normal"><span class="mono">CALCULATE()</span> is the most important and powerful function in the DAX language. It is important because it is the only function that has the ability to modify the natural filtering behaviour of visuals.</p>
			<p class="note"><span class="b1">Note:</span> Actually, there are some other functions that can modify filter behaviour, including <br class="calibre7" /><span class="mono1">CALCULATETABLE()</span>. However, those functions are typically used in DAX queries, and DAX queries are beyond the scope of this book.</p>
			<p class="normal">I am going to teach you everything you need to know about how to use <span class="mono">CALCULATE()</span>. But keep in mind that <span class="mono">CALCULATE()</span> seems simple on the surface, but in reality there is a lot to learn, and there are traps hiding in plain sight. You will need to concentrate hard (and possibly read this chapter more than once), and you definitely need to practice writing DAX formulas using <span class="mono">CALCULATE()</span> in order to build your depth of knowledge and understanding.</p>
			<p class="h"><span class="b2">Altering the Standard Offering</span></p>
			<p class="normal">Have you ever gone into a restaurant and looked at the menu, only to discover that the standard offering is not quite what you are after? Lots of people love <a id="calibre_link-135" class="calibre3"></a>Caesar salad, for example, but many people do not like anchovies. Say that you’re one of them, and you read the following description on the menu:</p>
			<p class="normal">Caesar Salad: Romaine lettuce, croutons, parmesan cheese, anchovies, and egg tossed in a creamy Caesar dressing.</p>
			<p class="normal">When you order the salad, you alter the standard menu option by saying, “I’ll have the Caesar salad, no anchovies.” <span class="mono">CALCULATE()</span> is a lot like that: It allows you to alter the standard offering that you get from a visual in order to get some variation that ends up being exactly what you want.</p>
			<p class="normal"><span class="mono">CALCULATE()</span> alters the natural filtering behaviour of visuals. It modifies an expression (which can be a measure or another DAX formula) by applying, removing, or modifying filters. The syntax of <span class="mono">CALCULATE()</span> is:</p>
			<p class="code"><span class="mono1">= CALCULATE(</span><span class="monoitalic">expression</span><span class="mono1">, </span><span class="monoitalic">filter 1</span><span class="mono1">, </span><span class="monoitalic">filter 2</span><span class="mono1">, ..., </span><span class="monoitalic">filter n</span><span class="mono1">)</span></p>
			<p class="normal"><span class="mono">CALCULATE()</span> alters the filtering behaviour of a visual by applying zero, one, or more filters prior to evaluating the expression. <span class="mono">CALCULATE()</span> then “reruns” the built-in filter propagation engine in Power BI&mdash;the one that makes the filters automatically propagate from the lookup tables and flow downhill to the data tables in the direction of the arrows. When <span class="mono">CALCULATE()</span> reruns the filter engine, if there are any filters inside the <span class="mono">CALCULATE()</span> function, these filters are included as part of the overall filters before the expression is evaluated. (You’ll read more about how this works in Chapter 11.)</p>
			<p class="note"><span class="b1">Note: </span>I just said that you can use zero, one, or more filters inside <span class="mono1">CALCULATE()</span>. It might seem strange that you can use none at all. Why would you want to do this? Using no filters is a special use case that is covered in Chapter 11.</p>
			<p class="h"><span class="b2">Simple Filters</span></p>
			<p class="normal"><span class="mono">CALCULATE()</span> can use two types of filters: simple filters and table filters. A simple filter has a column name on the left and a value on the right, as in these examples:</p>
			<p class="code"><span class="mono1">Customers[Gender] = "F"</span></p>
			<p class="code"><span class="mono1">Products[Color] = "Blue"</span></p>
			<p class="code"><span class="mono1">'Calendar'[Date] = "1/1/2017"</span></p>
			<p class="code"><span class="mono1">'Calendar'[Calendar Year] = 2018</span></p>
			<p class="normal">The first parameter to the <span class="mono">CALCULATE()</span> function is always an expression. You can use simple filters like the ones shown above as the second and subsequent parameters to <span class="mono">CALCULATE()</span> to alter the original meaning of the expression. Simple filters are designed to be easy to use and understand. They operate a bit like <span class="mono">SUMIF()</span> or <a id="calibre_link-363" class="calibre3"></a><span class="mono">SUMIFS()</span> in Excel.</p>
			<table id="calibre_link-420" class="note-table">
				<colgroup class="calibre4">
					<col class="calibre5"></col>
				</colgroup>
				<tbody class="calibre6">
					<tr class="note-table1">
						<td class="note-table2">
							<p class="normal"><span class="b3">Note: </span>Under the hood, Power BI converts a simple filter into a much more complex formula that is harder for beginners to learn and understand. Consider the following measure, using a simple filter:</p>
							<p class="code"><span class="mono1">Total Sales to Females =</span></p>
							<p class="code"><span class="mono1">    CALCULATE([Total Sales], Customers[Gender] = "F")</span></p>
							<p class="normal">Under the hood, Power BI converts this into the following formula prior to execution:</p>
							<p class="code"><span class="mono1">Total Sales to Females =</span></p>
							<p class="code"><span class="mono1">    CALCULATE([Total Sales],</span></p>
							<p class="code"><span class="mono1">        FILTER(ALL(Customers[Gender]), Customers[Gender] = "F")</span></p>
							<p class="code"><span class="mono1">    )</span></p>
							<p class="normal">I am sure you will agree that the first formula is easier to read and understand than the second. As mentioned earlier, Microsoft developers call this type of simple syntax “syntax sugar.” The simple syntax is provided to make it easier for people to use Power BI without having to first become experts in DAX.</p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="normal">When you have more experience and have learnt some new table functions like <span class="mono">ALL()</span> (in Chapter 14) and <span class="mono">FILTER()</span> (in Chapter 15), you will be able to write the more advanced <span class="mono">CALCULATE()</span> formulas that use table filters instead of a simple filters. (Table filters are discussed later in this chapter.)</p>
			<p class="normal">To see <span class="mono">CALCULATE()</span> in action (with simple syntax), set up a new matrix like the one below, with <span class="mono">Products[Category]</span> on Rows and <span class="mono">Products[Total</span> <span class="mono">Sales]</span> on Values. (You should be getting used to this by now!)</p>
			<p class="fp"><img class="_idgenobjectattribute60" src="images/000020.png" alt="" /></p>
			<p class="normal">Then write the following measure:</p>
			<p class="code"><span class="mono1">Total Sales of Blue Products =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales], Products[Color]="Blue")</span></p>
			<p class="normal">In the image below, can you see how the simple filter used here, <span class="mono">Products[Color]="Blue"</span>, has altered the initial filter behaviour coming from the matrix and given a variation to the regular measure <span class="mono">[Total</span> <span class="mono">Sales]</span>? It is as if you have changed the recipe for the standard product on the menu and received a variation of that regular menu item. Think Caesar salad without anchovies.</p>
			<p class="fp"><img class="_idgenobjectattribute61" src="images/000028.png" alt="" /></p>
			<p class="h1"><span class="b2">Practice Exercises: CALCULATE() with a Single Table</span></p>
			<p class="normal">It’s time for you to write some simple <span class="mono">CALCULATE()</span> examples that filter a single table using simple syntax. Set up a new matrix with <span class="mono">Customers[Occupation]</span> on Rows and <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> on Values. (You should have already written the <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> measure for Practice Exercise 9.) You should have the matrix shown below as your starting point.</p>
			<p class="fp"><img class="_idgenobjectattribute62" src="images/000036.png" alt="" /></p>
			<p class="normal">Then write the following measures, using <span class="mono">CALCULATE()</span>. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">32. [Total Male Customers]</span></p>
			<p class="normal">Write a new measure that modifies the <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> measure you wrote in Practice Exercise 9 to find a total for male customers only. You need to look for a suitable column from the <span class="mono">Customers</span> table to use in your filter.</p>
			<p class="h2"><span class="bi">33. [Total Customers Born Before 1970]</span></p>
			<p class="normal">In this case, you need to enter the date <span class="mono">&lt;</span> <span class="mono">January</span> <span class="mono">1,</span> <span class="mono">1970,</span> into the formula as the filter parameter. You need to use the <span class="mono">DATE()</span> function in order to refer to a date. Remember that you can get help from the tooltips that IntelliSense provides when writing the measure. Just start typing <span class="mono">=DATE</span> inside the formula bar, and a tooltip pops up, explaining the purpose and syntax of the function, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute63" src="images/000044.png" alt="" /></p>
			<p class="normal">Now that you know how to write a date inside a formula, you can go ahead and write the measure <span class="mono">[Total</span> <span class="mono">Customers</span> <span class="mono">Born</span> <span class="mono">Before</span> <span class="mono">1970]</span>.</p>
			<p class="h2"><span class="bi">34. [Total Customers Born in January]</span></p>
			<p class="normal">This exercise is similar to Practice Exercise 33, but this time you need to use the <span class="mono">MONTH()</span> function to turn the information in the <span class="mono">Customers[BirthDate]</span> column into a month.</p>
			<p class="h2"><span class="bi">35. [Customers Earning at Least $100,000 per Year]</span></p>
			<p class="normal">Write a measure that counts the number of customers who earn $100,000 or more per year. Look for a suitable column to use for the filter in the <span class="mono">Customers</span> table.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with the following matrix?</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000052.png" alt="" /></p>
			<p class="h"><span class="b2">Using </span><span class="b2"><a id="calibre_link-138"></a></span><span class="b2">CALCULATE() over Multiple Tables</span></p>
			<p class="normal">In Practice Exercises 32&ndash;35, the <span class="mono">CALCULATE()</span> function touches only a single table; the filtering is applied to a table, and the expression is evaluated on the same table. However, <span class="mono">CALCULATE()</span> can work over multiple tables, too. When you use the <span class="mono">CALCULATE()</span> function, it first applies the filters to the relevant tables, and then it reruns the filter propagation engine and makes sure that any new filters inside the <span class="mono">CALCULATE()</span> function automatically propagate from the “one” side of the relationship to the “many” side (i.e., the filters flow downhill) before the expression is evaluated. So you can apply a filter to one or more of the lookup tables, and these filters will propagate to the data tables, and any expression that evaluates over the connected data tables will reflect the filters from the lookup tables. (Are you feeling supercharged now?!)</p>
			<p class="h1"><span class="b2">Practice Exercises: CALCULATE() with Multiple Tables</span></p>
			<p class="normal">Set up a new matrix. Put <span class="mono">Territories[Region]</span> on Rows and <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values. Note that there are now two tables involved. The initial filter in the visual is coming from the <span class="mono">Territories</span> table (see #1 below), and the calculation <span class="mono">[Total</span> <span class="mono">Sales]</span> is operating over the <span class="mono">Sales</span> table (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute64" src="images/000062.png" alt="" /></p>
			<p class="normal">With your matrix set up like this, write the following new measures. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">36. [Total Sales of Clothing]</span></p>
			<p class="normal">Use the <span class="mono">Products[Category]</span> column in your simple filter. The filter gets applied to the lookup table, but then the measure <span class="mono">[Total</span> <span class="mono">Sales]</span> is modified by the filter (and <span class="mono">Total</span> <span class="mono">Sales</span> comes from the <span class="mono">Sales</span> table), so you use <span class="mono">CALCULATE()</span> with multiple tables in this formula.</p>
			<p class="h2"><span class="bi">37. [Sales to Female Customers]</span></p>
			<p class="normal">Use <span class="mono">CALCULATE()</span> to modify the measure <span class="mono">[Total</span> <span class="mono">Sales]</span> and create a new measure that is for sales to female customers.</p>
			<p class="h2"><span class="bi">38. [Sales of Bikes to Married Men]</span></p>
			<p class="normal">You need to use multiple filters on two tables for this one. <span class="mono">CALCULATE()</span> can accept as many filters as you pass to it. Just separate the filters with commas.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with the following matrix?</p>
			<p class="fp"><img class="_idgenobjectattribute65" src="images/000072.png" alt="" /></p>
			<p class="h"><a id="calibre_link-139"></a><a id="calibre_link-368"></a><span class="b2">Table Filters</span></p>
			<p class="normal">So far you have used only simple filters inside <span class="mono">CALCULATE()</span>, in this format:</p>
			<p class="code"><span class="monoitalic">TableName</span><span class="mono1">[</span><span class="monoitalic">ColumnName</span><span class="mono1">] = </span><span class="monoitalic">some value</span></p>
			<p class="normal">You can also use a table filter, which is a more advanced type of filter that is passed in the form of a table that contains values that are required for the filter. This table can be either a physical table or a function that returns a table (e.g., <span class="mono">ALL()</span>, <span class="mono">VALUES()</span>, <span class="mono">FILTER()</span>). Importantly, both types of tables used as table filter parameters retain all relationships that exist in the data model. Table filters and the way the tables retain their relationships in the data model are complex topics that are covered in more detail in the coming chapters. For now, it is enough to know that so far you have only learnt about simple filters for <span class="mono">CALCULATE()</span>, and the more advanced table filters are discussed later.</p>
		</div>
	</div>


<div id="calibre_link-45" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-421" class="ch"><span class="b2"><a id="calibre_link-13"></a>10: DAX Topic: Making </span><span class="b2"><a id="calibre_link-203"></a><a id="calibre_link-183"></a></span><span class="b2">DAX Easy to Read</span></p>
			<p class="normal">Now is a good time to pause and talk about how to lay out your DAX so it is easy to read. Consider this example:</p>
			<p class="code">Total Sales to Single Males in Australia = </p>
			<p class="code">    CALCULATE([Total Sales], Customers[MaritalStatus]="S",</p>
			<p class="code">    Customers[Gender]="M", Territories[Country]="Australia")</p>
			<p class="normal">Long formulas like this one can be difficult to read. The generally accepted approach is to lay out a formula by using line breaks and spaces so it is easier to see which parts of the formula belong together. There is no single right way to do this. Here is one way that I find useful:</p>
			<p class="code"><span class="mono1">Total Sales to Single Males in Australia =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales],</span></p>
			<p class="code"><span class="mono1">        Customers[MaritalStatus] = "S",</span></p>
			<p class="code"><span class="mono1">        Customers[Gender] = "M",</span></p>
			<p class="code"><span class="mono1">        Territories[Country] = "Australia"</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">In this example, I put the first parameter in <span class="mono">CALCULATE()</span> (which is the expression) on the first line, followed by a comma. Then I placed each filter on a new line and indented the filters so it is easy to see that they belong to the <span class="mono">CALCULATE()</span> function.</p>
			<p class="note"><span class="b1">Note:</span> To create a new line in the formula bar, you need to press Shift+Enter on the keyboard. Then you can use the Tab key to indent the next line of the formula from the left-hand side.</p>
			<p class="normal">The final closing parenthesis for the <span class="mono">CALCULATE()</span> function in this example is on a new line of its own, aligned with the <span class="mono">C</span> in <span class="mono">CALCULATE()</span> so that I know that this bracket closes the <span class="mono">CALCULATE()</span> function.</p>
			<p class="h"><span class="b2">Using </span><span class="b2"><a id="calibre_link-184"></a></span><span class="b2">DAX Formatter</span></p>
			<p class="normal">DAX Formatter is a very useful (and free) tool that you can use to help format your DAX. Marco <a id="calibre_link-214" class="calibre3"></a><a id="calibre_link-336" class="calibre3"></a>Russo and Alberto Ferrari from SQLBI developed the free <a href="http://daxformatter.com" class="calibre3"><span class="u">http://daxformatter.com</span></a> website. You simply paste your DAX code into the website, and DAX Formatter formats the code for you. You can then cut and paste it back into the formula bar in Power BI.</p>
			<p class="normal">When you use DAX Formatter, you have a choice about whether to include the measure name. You can omit the name if you like, but it is just as easy to copy the entire formula, including the measure name.</p>
			<p class="normal">The image below shows the <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">to</span> <span class="mono">Single</span> <span class="mono">Males</span> <span class="mono">in</span> <span class="mono">Australia]</span> formula from DAX Formatter, including the measure name.</p>
			<p class="fp"><img class="_idgenobjectattribute66" src="images/000082.png" alt="" /></p>
			<p class="normal">The image below shows the same formula after DAX Formatter has applied formatting.</p>
			<p class="fp"><img class="_idgenobjectattribute67" src="images/000090.png" alt="" /></p>
			<p class="h"><a id="calibre_link-206"></a><span class="b2">Error Checking</span></p>
			<p class="normal">DAX Formatter does another important job for you: It checks whether a DAX formula is valid and written correctly. If it is not, DAX Formatter does its best to find the error. To see this in action, try removing one of the commas from the DAX code above, such as the one after <span class="mono">Gender</span> <span class="mono">=</span> <span class="mono">"M"</span>, so it looks like this:</p>
			<p class="code"><span class="mono1">Total Sales to Single Males in Australia =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales],</span></p>
			<p class="code"><span class="mono1">        Customers[MaritalStatus] = "S",</span></p>
			<p class="code"><span class="mono1">        Customers[Gender] = "M"</span></p>
			<p class="code"><span class="mono1">        Territories[Country] = "Australia"</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">In this case, DAX Formatter is expecting a comma but instead finds the letter <span class="mono">T</span> (on the next line). As you can see in the following image, DAX Formatter describes the syntax error at the bottom of the screen and places a triangle next to the character where it found the error.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000098.png" alt="" /></p>
			<p class="normal">Although it was not strictly designed for debugging, DAX Formatter is a great tool for helping you debug your DAX code when you can’t work out what is wrong. I use DAX Formatter all the time to help me with my DAX. I suggest you do, too.</p>
			<p class="note"><span class="b1">Note: </span>Marco Russo told me that DAX Formatter was not designed to be an official error-checking tool, as I describe using it above. As a result, the error checking is not perfect, but in my view, it is worth trying this approach if you are stuck.</p>
		</div>
	</div>


<div id="calibre_link-46" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-422" class="ch"><span class="b2"><a id="calibre_link-14"></a>11: Concept: Evaluation Context and </span><span class="b2"><a id="calibre_link-159"></a></span><span class="b2">Context Transition</span></p>
			<p class="normal">This chapter covers one of the hardest topics to understand and master in DAX: evaluation contexts. There are a few reasons I think this topic is confusing and hard to learn; one of them is simply that the name is confusing. What does evaluation contexts mean? A good place to start is with the word context.</p>
			<p class="h"><span class="b2">What Does </span><span class="bi">Context</span><span class="b2"> Mean?</span></p>
			<p class="normal">You have certainly heard the term context before but possibly not as it relates to DAX. The concept of context is very important in language; the same words can mean different things in a different contexts. Take the phrase “I’m hot.” Now, what does this mean? Well, it depends on the context:</p>
			<ul class="calibre2">
				<li class="bl">If I were running a marathon on a midsummer’s day and I said “I’m hot,” you would have no misunderstanding of what I meant; the context would make it clear.</li>
				<li class="bl">If you caught me at the casino late at night, and I had a happy smile on my face while sitting at the poker table (and a big pile of chips in front of me), and I said “I’m hot,” you would probably realise I meant that I was having a winning streak at the table. You would not think that I was physically hot and sweaty, as I would be while running a marathon.</li>
			</ul>
			<p class="normal">The point I am making is that the same phrase can have different meanings, depending on the context. In DAX, the same formula (e.g., a measure) can evaluate to a different result depending on the context&mdash;hence the term evaluation context. <a id="calibre_link-207" class="calibre3"></a>Evaluation context means that every formula can evaluate to different results in different circumstances.</p>
			<p class="normal">In DAX there are two types of context, or circumstances that can cause a formula to evaluate to a different result: filter context and row context.</p>
			<p class="h"><span class="b2">An Introduction to </span><span class="b2"><a id="calibre_link-221"></a></span><span class="b2">Filter Context</span></p>
			<p class="normal">In Chapter 5, I introduced the concept of filtering behaviour. When you write a measure and place it in a visual, the visual can filter the data model. The net result of this filtering behaviour is that any single measure can return different results due to the filters coming from the visual.</p>
			<p class="normal">The following matrix is one I first showed in Chapter 4.</p>
			<p class="fp"><img class="_idgenobjectattribute23" src="images/000106.png" alt="" /></p>
			<p class="normal">The <span class="mono">Category</span> column in this matrix (see #1 above) is a column that comes from the <span class="mono">Products</span> table in the data model. When the <span class="mono">Category</span> column is filtered by the visual, the entire <span class="mono">Products</span> table is filtered, too. That is why you can see a different result for the measure <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products]</span> in each row of the matrix. But the <span class="mono">Products</span> table does not filter the <span class="mono">Customers</span> table, either directly or indirectly. The following image shows the Model view again so you can verify this.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000116.png" alt="" /></p>
			<p class="normal">Note that the <span class="mono">Products</span> table (see #1 above) directly filters the <span class="mono">Sales</span> table (#3) through the relationship. You can verify this based on the arrow from <span class="mono">Products</span> to <span class="mono">Sales</span> (#2). But the <span class="mono">Sales</span> table does not filter the <span class="mono">Customers</span> table; there is no arrow pointing from the <span class="mono">Sales</span> table to the <span class="mono">Customers</span> table, so you know that the <span class="mono">Customers</span> table is not filtered. The implication is that the measure <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> does not show a different result for each row in the matrix visual above.</p>
			<p class="normal">The filtering behaviour I’m describing here and elsewhere in this book has a formal name: filter context. Filter context refers to any filtering that is applied to the data model in Power BI. Filter context can be created by a visual (e.g., a matrix) and also by the <span class="mono">CALCULATE()</span> function. The initial filter context is the natural filtering behaviour that comes from a visual or a report. The initial filter context can come from the following areas:</p>
			<ul class="calibre2">
				<li class="bl">Rows in a visual, such as a matrix (see #1 below)</li>
				<li class="bl">Columns in a matrix (#2)</li>
				<li class="bl">Filters in the Filters pane (#3)</li>
				<li class="bl">Slicers (#4)</li>
				<li class="bl">Any other visual on the canvas, such as a column chart ( #5)</li>
			</ul>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000124.png" alt="" /></p>
			<p class="normal">The initial filter context is the natural filtering behaviour that comes from the combination of all the filters applied in a report.</p>
			<p class="normal">The filter context coming from a report filters the underlying tables in the data model. If the tables are joined, the filters automatically propagate from the “one” side of the relationship to the “many” side of the relationship. But the filter does not automatically propagate in the other direction, from the “many” side to the “one” side of a relationship. This is why I recommend (for Excel users anyway) laying out the data model using what I called the Collie layout methodology, described in Chapter 2 and shown again below. When you use this layout, you have less to get your head around. You can simply visualise filter propagation flowing downhill like water: The top tables filter the bottom tables, but the bottom tables do not filter the top tables.</p>
			<p class="normal"><img class="_idgenobjectattribute68" src="images/000133.png" alt="" /></p>
			<p class="normal">This setup provides a visual clue that the filters flow downhill through the relationships but do not flow uphill through the relationships.</p>
			<p class="normal">In summary, filter context comes from:</p>
			<ul class="calibre2">
				<li class="bl">A visual in a report</li>
				<li class="bl">The Filters pane in a report</li>
				<li class="bl">The <span class="mono">CALCULATE()</span> function</li>
			</ul>
			<p class="normal">If you don’t have a visual with a filter, and you don’t have a <span class="mono">CALCULATE()</span> function, then you don’t have filter context; it’s as simple as that.</p>
			<p class="note"><span class="b1">Note: </span>It is possible to filter lookup tables (the tables at the top in the Collie layout methodology) based on the results in a data table (the tables below) by using DAX instead of automatic filter propagation. It is also possible to change the default direction of the filter behaviour by making changes to the relationships. But by default, <a id="calibre_link-222"></a>filters propagate in one direction, from the “one” side to the “many” side of a relationship, and this is the best way to leave it unless you have a reason to make a change.</p>
			<p class="h"><span class="b2">An Introduction to Row Context</span></p>
			<p class="normal">In Chapter 7, I introduced calculated columns and explained that a calculated column has a special skill: It knows how to do row-by-row evaluation. When you write a calculated column in DAX, you write a single formula for the entire column, and it is evaluated once for every row in the table.</p>
			<p class="normal">The following image, which is repeated from Chapter 7, shows a table in the Data view (not a matrix in a report).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000207.png" alt="" /></p>
			<p class="normal">The third column in the table above is a calculated column with a single formula:</p>
			<p class="code"><span class="mono1">Total Sales Plus Tax Column =</span></p>
			<p class="code"><span class="mono1">    Sales[ExtendedAmount] + Sales[TaxAmt]</span></p>
			<p class="normal">With only a single formula, there is a different result for every row in the new column in this table. This single formula works because a calculated column has a special skill of being able to complete row-by-row evaluation. It evaluates the same formula, over and over again, for every row in the table, often returning a different result for each row. There’s that reference again: Every formula can return a different result, depending on the context. In the case of calculated columns, the context is called row context. Row context is simply the awareness and ability of DAX to complete row-by-row evaluation, often returning a different result each time.</p>
			<p class="normal">As I mentioned in Chapter 8, there are some special DAX functions that also have the ability to do row-by-row evaluation (i.e., they have row context). All of the X-functions, such as <span class="mono">SUMX()</span> and <span class="mono">AVERAGEX()</span>, have row context, just as a calculated column does. (So do some other functions that are covered later in this book.)</p>
			<p class="normal">When you think about row context, think of the function (or calculated column) stepping through the table one row at a time and selecting the single values at the intersection between the columns and row (highlighted in the image above) and then acting on the single values in each column (#1 and #2 in the image above) for a single row. Regular measures can’t do this; only functions that have row context and calculated columns can perform this trick.</p>
			<p class="normal">Do you remember the following measure formula?</p>
			<p class="code"><span class="mono1">Total Sales Plus Tax Measure =</span></p>
			<p class="code"><span class="mono1">    Sales[ExtendedAmount] + Sales[TaxAmt]</span></p>
			<p class="normal">This measure returns an error; it is not legal syntax to write this measure in DAX. This formula contains “naked columns”&mdash;columns with no functions wrapped around them. It is not legal DAX syntax to write a measure that has naked columns. Such a measure returns an error. Every formula in DAX can return a different result depending on the context; in this case, the different result is an error because there is no row context for this formula when it is written as a measure.</p>
			<p class="normal">Let’s look again at the <span class="mono">SUMX()</span> measure from Chapter 8, shown below.</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000141.png" alt="" /></p>
			<p class="normal"><span class="mono">SUMX()</span> first creates row context over the <span class="mono">Sales</span> table (see #1 above). It then steps through this table one row at a time. At each row, it takes the single value that is the intersection of the <span class="mono">Sales[ExtendedAmount]</span> column (#2) and the current row and adds it to the single value that is the intersection of the <span class="mono">Sales[TaxAmt]</span> column (#3) and the current row. It does this for each row in the table (#1) and then adds up all the values (#4). These same columns from the earlier measure example now return a valid result because they exist inside a <span class="mono">SUMX()</span> function that has row context.</p>
			<p class="normal">Remember that if you can’t visualise what a <span class="mono">SUMX()</span> function is doing in the formula above, you can write a test formula as a calculated column instead so you can better visualise how it works. A calculated column and a <span class="mono">SUMX()</span> function essentially do the same thing; the only difference is that the calculated column permanently stores the row-by-row results in the table, and the <span class="mono">SUMX()</span> function does not.</p>
			<p class="note"><span class="b1">Note: </span>One thing I often get asked about the formula above is “Why does the formula refer to the table name twice&mdash;once in the first parameter and again in the second parameter?” Remember that it is best practice to always fully qualify a column name by prepending the table name. Technically, the formula above would work without the table names in front of <span class="mono1">ExtendedAmount</span> (see #2 above) and <span class="mono1">TaxAmt</span> (#3), but including the table names is a best practice authoring technique that ensures clarity.</p>
			<p class="h"><a id="calibre_link-335"></a><span class="b2">Row Context Does Not Automatically Create Filter <br class="calibre7" />Context</span></p>
			<p class="normal">This is a very important point that you must understand clearly: Row context does not automatically create filter context. Row context and filter context are two concepts that are completely independent. To understand this better, you can create a new calculated column in the <span class="mono">Products</span> table. In the Data view, go to the Fields pane, right-click the <span class="mono">Products</span> table (see #1 below), and select New Column (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute69" src="images/000151.png" alt="" /></p>
			<p class="normal">Add the following calculated column to the table but don’t press Enter yet:</p>
			<p class="code"><span class="mono1">Total Sales Column = SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">You should recognise the right side of this formula because it is part of the first formula in this book.</p>
			<p class="normal">What value do you think will appear in every row of this new column when you press Enter? Do you expect it to be the total for the product in each row? Do you expect it to be the total for all products? Well, the answer might surprise you, and it is directly related to the point that row context does not automatically create filter context. Press Enter and take a look at the new calculated column in the Data view.</p>
			<p class="normal">As you can see in the figure below, the value is the same for every single row in the table. There is no filtering on the <span class="mono">Sales</span> table (or any other table, for that matter) as a result of this formula, and hence the answer is always the same for every row. There is row context in this formula because it is a calculated column: The rows are evaluated one at a time. But that row context does not create filter context. Again, row context has nothing to do with filter context; row context and filter context are completely independent concepts. Earlier in this chapter, you learnt that there are only three places filter context can come from: a visual, the Filters pane, or a <span class="mono">CALCULATE()</span> function. In the calculated column in the example shown below, there is neither a visual nor a <span class="mono">CALCULATE()</span> function, so there simply cannot be filter context. Given that there is no filter context, the <span class="mono">Sales</span> table is completely unfiltered, and hence <span class="mono">SUM(Sales[ExtendedAmount])</span> must return the result of the unfiltered <span class="mono">Sales</span> table. This is not intuitive, but it is how it works.</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000160.png" alt="" /></p>
			<p class="h"><span class="b2">Creating Context Transition</span></p>
			<p class="normal">It is possible to convert the row context from a calculated column into filter context through a process called context transition. To do this, simply wrap the formula from the previous section in a <span class="mono">CALCULATE()</span> function, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000168.png" alt="" /></p>
			<p class="normal">When you do this, the row context that exists in the calculated column is transformed into an equivalent filter context. The <span class="mono">CALCULATE()</span> function then tells the Power BI filter to add a new filter on the <span class="mono">Products</span> table, and then that filter propagates through the relationship to the <span class="mono">Sales</span> table before the calculation is completed, and it does so for each row in the table. You will therefore potentially end up with a different value in each row of the column. The value returned to each row of this new column in the <span class="mono">Products</span> table is the total sales for that product.</p>
			<p class="note"><span class="b1">Note:</span> Some rows are blank because there are no sales.</p>
			<p class="normal">You can think of the formula working like this:</p>
			<p class="code"><span class="mono1">= CALCULATE(</span></p>
			<p class="code"><span class="mono1">    SUM(Sales[ExtendedAmount]),</span></p>
			<p class="code"><span class="mono1">    Products[ProductKey] = the product represented by this row in the table</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">This pseudocode is illustrative only, but it shows that the concept of context transition can work anywhere that row context exists&mdash;that is, in calculated columns as well as in iterators like <span class="mono">SUMX()</span> and other functions covered later in this book. This is the special use case mentioned in Chapter 9, where there are no filters at all needed inside <span class="mono">CALCULATE()</span> but instead <span class="mono">CALCULATE()</span> creates a new filter context from the row context by using context transition. You can add additional filters inside <span class="mono">CALCULATE()</span>, too, if you want or need to, but none are required to trigger context transition.</p>
			<p class="h"><span class="b2">The Hidden Implicit CALCULATE()</span></p>
			<p class="normal">Now that you know that you can use <span class="mono">CALCULATE()</span> to convert row context into filter context, there is one more thing you need to know. Consider this measure from earlier in the book:</p>
			<p class="code"><span class="mono1">Total Sales (the measure) = SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">Now think back to the first version of the calculated column above. What happened when we added a new column in the <span class="mono">Products</span> table, as follows?</p>
			<p class="code"><span class="mono1">Total Sales Column =SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">Do you remember? We got the value $29.4 million all the way down the new column in the <span class="mono">Products</span> table. Why? Because there is row context in a calculated column, but there is no filter context. The <span class="mono">Sales</span> table is therefore completely unfiltered, and hence <span class="mono">SUM(Sales[ExtendedAmount])</span> simply must return $29.4 million for every row.</p>
			<p class="normal">Now back to this measure:</p>
			<p class="code"><span class="mono1">Total Sales (the measure) = SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">Notice that the formula for this measure is identical to the calculated column (the first example above but with a different name, of course). So if the formula inside the measure is identical to the formula in the calculated column, you can be excused for thinking that you could substitute the formula in the calculated column with the actual measure, adjusted as follows:</p>
			<p class="code"><span class="mono1">Total Sales Column = [Total Sales]</span></p>
			<p class="normal">If the measure <span class="mono">[Total</span> <span class="mono">Sales]</span> has the same formula embedded, won’t we get the same result? Well, actually no; we get a different result from before, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute70" src="images/000177.png" alt="" /></p>
			<p class="normal">Go back and look again. Here is a summary of what you will find:</p>
			<p class="code"><span class="mono1">Total Sales Column (Ver 1) = SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">This calculated column returns $29.4 million all the way down the column. There is row context but no filter context, so the formula must return $29.4 million for each row in the table.</p>
			<p class="normal">This next calculated column returns the total sales for each product in the <span class="mono">Products</span> table (a different number for each product):</p>
			<p class="code"><span class="mono1">Total Sales Column (Ver 2) = CALCULATE(SUM(Sales[ExtendedAmount]))</span></p>
			<p class="normal">There is row context, and because of the <span class="mono">CALCULATE()</span> function, the row context is converted to an equivalent filter context through the process of context transition; there is row context and filter context. <span class="mono">CALCULATE()</span> converts the row context from the <span class="mono">Products</span> table into an equivalent filter context, and this new filter context propagates to the <span class="mono">Sales</span> table for each row of the calculated column.</p>
			<p class="normal">The following calculated column also returns the total sales for each product in the <span class="mono">Products</span> table:</p>
			<p class="code"><span class="mono1">Total Sales Column (Ver 3) = [Total Sales]</span></p>
			<p class="normal">The calculated column <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Column</span> <span class="mono">(Ver</span> <span class="mono">3)</span> returns exactly the same result as <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Column</span> <span class="mono">(Ver</span> <span class="mono">2)</span>. If you take a look inside the measure <span class="mono">[Total</span> <span class="mono">Sales]</span>, you can’t see a <span class="mono">CALCULATE()</span> function; the measure does not include <span class="mono">CALCULATE()</span>. But there is an implicit <span class="mono">CALCULATE()</span> that you can’t see. Every measure has an implicit <span class="mono">CALCULATE()</span> automatically added by Power BI; that is why <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Column</span> <span class="mono">(Ver</span> <span class="mono">3)</span> behaves like <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Column</span> <span class="mono">(Ver</span> <span class="mono">2)</span> and not like <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Column</span> <span class="mono">(Ver</span> <span class="mono">1)</span>.</p>
			<p class="note"><span class="b1">Note: </span>If you’ve arrived at this point and don’t fully understand context transition, don’t worry, you are not alone. This is one of the hardest topics in this book to learn and understand well. Sleep on it for a few nights, get some practice, and then come back and reread this chapter again (along with Chapter 9, on <span class="mono1">CALCULATE()</span>). You may need to reread this content many times before it completely sinks in. If you get confused, go back to the lay terms I used for the first nine chapters of this book: Filter behaviour is the same as filter context; row-by-row evaluation is the same as row context.<br class="calibre7" />When you have more experience under your belt (in, say, 6 to 18 months), you may be interested in expanding your skills and depth of knowledge further. I offer a great training course called “Demystifying DAX” that can help you go to the next level of understanding, if and when you a ready. You can learn more at <a href="http://xbi.com.au/adv-dax-training"><span class="u1">http://xbi.com.au/adv-dax-training</span></a>.</p>
		</div>
	</div>


<div id="calibre_link-47" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-423" class="ch"><span class="b2"><a id="calibre_link-15"></a>12: DAX Topic: IF(), SWITCH(), and FIND()</span></p>
			<p class="normal">DAX has a number of useful functions that allow you to apply a test and then branch the formula based on the results from that test. You will most likely be familiar with this concept from the <span class="mono">IF()</span> function in Excel. This chapter covers a few functions that are useful in DAX.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-243"></a></span><span class="b2">IF() Function</span></p>
			<p class="normal">The <span class="mono">IF()</span> function in DAX, which uses the following syntax, is almost identical to <span class="mono">IF()</span> in Excel:</p>
			<p class="code"><span class="mono1">IF(</span><span class="monoitalic">Logical Test</span><span class="mono1">, </span><span class="monoitalic">Result if True</span><span class="mono1">, [</span><span class="monoitalic">Result if False</span><span class="mono1">])</span></p>
			<p class="normal">Note that the last parameter, <span class="mono">[</span><span class="monoitalic1">Result if False</span><span class="mono">]</span>, is optional. If you omit this parameter and the result is <span class="mono">False</span>, the <span class="mono">IF()</span> formula returns <span class="mono">BLANK()</span>. This is very useful because a matrix or chart in Power BI will not show values if the result in the Values section is <span class="mono">BLANK()</span>.</p>
			<p class="h"><span class="b2">The SWITCH() Function</span></p>
			<p class="normal">The <a id="calibre_link-365" class="calibre3"></a><span class="mono">SWITCH()</span> function is a lot like <a id="calibre_link-341" class="calibre3"></a><span class="mono">Select</span> <span class="mono">Case</span> in VBA programming. The syntax of the <span class="mono">SWITCH()</span> function is as follows:</p>
			<p class="code"><span class="mono1">SWITCH(</span><span class="monoitalic">expression</span><span class="mono1">, </span><span class="monoitalic">value</span><span class="mono1">, </span><span class="monoitalic">result</span><span class="mono1">[, </span><span class="monoitalic">value</span><span class="mono1">, </span><span class="monoitalic">result</span><span class="mono1">]...[, </span><span class="monoitalic">else</span><span class="mono1">])</span></p>
			<p class="normal">This syntax is a little confusing, so let’s go through a simple example with another calculated column. To begin the example, right-click on the <span class="mono">Customers</span> table in the Fields pane, select New Column, and enter the following formula:</p>
			<p class="code"><span class="mono1">House Ownership =</span></p>
			<p class="code"><span class="mono1">    SWITCH(Customers[HouseOwnerFlag],</span></p>
			<p class="code"><span class="mono1">        1,"Owns their house",</span></p>
			<p class="code"><span class="mono1">        0,"Doesn't own their house",</span></p>
			<p class="code"><span class="mono1">        "Unknown"</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">It is much easier to understand <span class="mono">SWITCH()</span> if you use DAX Formatter to improve the layout, as shown below. You can see in this figure that line 3 is the branching point. The possible values in the <span class="mono">HouseOwnerFlag</span> column are <span class="mono">0</span> and <span class="mono">1</span> in this instance. Lines 4 and 5 offer up pairs of input and output values. So if the value of <span class="mono">HouseOwnerFlag</span> is <span class="mono">1</span>, the result <span class="mono">"Owns</span> <span class="mono">their</span> <span class="mono">house"</span> is returned. If the value of <span class="mono">HouseOwnerFlag</span> is <span class="mono">0</span>, the result <span class="mono">"Doesn't</span> <span class="mono">own</span> <span class="mono">their</span> <span class="mono">house"</span> is returned.</p>
			<p class="fp"><img class="_idgenobjectattribute71" src="images/000186.png" alt="" /></p>
			<p class="normal">Line 6 is a single value, and it applies to all other possible values of <span class="mono">HouseOwnerFlag</span> (although there are no other values in this example).</p>
			<p class="note"><span class="b1">Note: </span>You will see a much more exciting use of the <span class="mono1">SWITCH()</span> function in Chapter 20.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-227"></a></span><span class="b2">FIND() Function</span></p>
			<p class="normal">The <span class="mono">FIND()</span> function in DAX is almost identical to the <span class="mono">FIND()</span> function in Excel. In DAX, it has this format:</p>
			<p class="code"><span class="mono1">= FIND(</span><span class="monoitalic">FindText</span><span class="mono1">, </span><span class="monoitalic">WithinText</span><span class="mono1">, [</span><span class="monoitalic">StartPos</span><span class="mono1">], [</span><span class="monoitalic">NotFoundValue</span><span class="mono1">])</span></p>
			<p class="normal">Even though this syntax suggests that <span class="mono">[</span><span class="monoitalic1">StartPos</span><span class="mono">]</span> and <span class="mono">[</span><span class="monoitalic1">NotFoundValue</span><span class="mono">]</span> are optional, in my experience (as of this writing), you actually do need to provide values for these parameters, or the result returned is <span class="mono">#ERROR</span>.</p>
			<p class="h"><span class="b2">Example: Using IF() and FIND()</span></p>
			<p class="normal">In this section, you will see how to create a calculated column in one of your lookup tables. As I have said previously, it is perfectly valid to create calculated columns in lookup tables, but wherever possible, it is a better practice to create these columns in your source data or by using Power Query. Remember why this is important:</p>
			<ul class="calibre2">
				<li class="bl">Calculated columns may take up more space than imported columns (but this is generally not a major issue for lookup tables).</li>
				<li class="bl">If you are manually creating a calculated column, it exists only in that single workbook, and you need to re-create it over and over for every other workbook where you need the column.</li>
			</ul>
			<p class="normal">If it is not possible to create a column in your source data for some reason, then creating a calculated column instead is a great solution, particularly for lookup tables.</p>
			<p class="normal">In this example, you are going to create a <span class="mono">Mountain</span> <span class="mono">Products</span> column that doesn’t exist in your lookup table (<span class="mono">Products</span>). In this new column, any product with the word mountain in the description will be flagged as a mountain product.</p>
			<p class="normal">Right-click the <span class="mono">Products</span> table in the Fields pane, select New Column, and type the following formula:</p>
			<p class="code"><span class="mono1">Mountain Products = FIND("Mountain", Products[ModelName],1, 0)</span></p>
			<p class="normal">Switch to the Data view so you can check the results of your new column.</p>
			<p class="note"><span class="b1">Note:</span> Remember that it is your responsibility to check that your formulas give the expected results, and switching to the Data view can help you validate this.</p>
			<p class="normal">This formula searches for the word mountain in the <span class="mono">ModelName</span> column. Remember that because a calculated column has row context, it is possible to refer to the column in this way, and it will calculate a result for every row in the <span class="mono">Products</span> table and store the answer in the column.</p>
			<p class="normal">The result is an integer representing the starting position where the word mountain is found. If the word mountain is not found, the last parameter in the formula (which is the value <span class="mono">0</span> in this case) is returned. So you get something like the <span class="mono">Mountain</span> <span class="mono">Products</span> column shown in the image below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000194.png" alt="" /></p>
			<p class="normal">This table is not overly useful as is, but you can wrap an <span class="mono">IF()</span> statement around this formula to make it more useful. As shown below, you can use the <span class="mono">IF()</span> statement to return <span class="mono">True</span> if the number is greater than zero (i.e., if it is a mountain product) and return <span class="mono">False</span> if it is equal to zero (i.e., it is not a mountain product).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000203.png" alt="" /></p>
			<p class="normal">Now you have a new calculated column, and you have further enhanced your data model to make it more useful. Remember that this calculated column takes up some space in your file and disk. However, given the small number of unique values (only <span class="mono">True</span> and <span class="mono">False</span> in this case) and the fact that this column is in a lookup table, the space this particular column takes up is minimal.</p>
			<p class="note"><span class="b1">Note:</span> The greater the number of unique values in a column, the more disk space and memory the column consumes. If a column is small and adds value to your model, then there is no reason not to create it.</p>
			<p class="normal">You can now use this new column anywhere in your Power BI report to produce new insights that weren’t previously visible in the data. Because this formula is a column in the data model, it can be used to filter a matrix, or it can be used in a chart, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000211.png" alt="" /></p>
			<p class="h"><span class="b2">Enhancing Your Data Models</span></p>
			<p class="normal">Let me just pause for a brief moment and reflect on an important point: The role of a data modeller is to build a model that adds value to the data. Raw data is useful, but a well-designed data model is gold. Your job as a data modeller is to build a data model that enhances the raw data and makes it more useful than the raw data alone. The example above does just this. There is nothing explicit in the raw data that allows you to visualise sales based on the concept of a mountain product. If you want to have this ability, you have to create the capability in the tool. In doing so, you are enhancing the raw data and building a useful (and possibly invaluable) asset that can be used and reused as needed.</p>
		</div>
	</div>


<div id="calibre_link-48" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-424" class="ch"><span class="b2"><a id="calibre_link-16"></a>13: DAX Topic: VALUES(), HASONEVALUE(), <br class="calibre7" />SELECTEDVALUE(), and CONCATENATEX()</span></p>
			<p class="normal">Before we get to the new functions in this chapter, you need to understand the concept of virtual tables. Before we actually get to virtual tables, though, let me step back and talk first about physical tables. A physical table is a table that is loaded and materialised inside the Power BI data model. If you switch to the Model view, you can see <a id="calibre_link-384" class="calibre3"></a><a id="calibre_link-303" class="calibre3"></a>physical tables. In the case of the standard AdventureWorks database used in this book, there are five physical tables (<span class="mono">Calendar</span>, <span class="mono">Customers</span>, <span class="mono">Products</span>, <span class="mono">Territories</span>, and <span class="mono">Sales</span>).</p>
			<p class="normal">In the DAX language, there are special functions called table functions that create tables of data. These functions create “virtual” tables in that these tables are not materialised and physically stored and visible inside the Model view in Power BI. Virtual tables behave exactly like physical tables, but the tables are simply not materialised or visible to you.</p>
			<p class="h"><span class="b2">Table Functions Inside CALCULATE()</span></p>
			<p class="normal">The most common place (but not the only place) to use a table function in DAX is inside a <span class="mono">CALCULATE()</span> function. In Chapter 9 I introduced the idea that <span class="mono">CALCULATE()</span> can use two types of filters: simple filters and table filters. Simple filters are in this form:</p>
			<p class="code"><span class="monoitalic">TableName</span><span class="mono1">[</span><span class="monoitalic">ColumnName</span><span class="mono1">] = </span><span class="monoitalic">some value</span></p>
			<p class="normal">As its name suggests, a table filter takes a table as a filter input. In other words, you use an existing table (or create a virtual table on the fly) that contains the rows you want included in the filter parameter, and then <span class="mono">CALCULATE()</span> applies that filter to the data model before completing the evaluation of the main expression.</p>
			<p class="h"><span class="b2">Using Virtual Tables</span></p>
			<p class="normal">The tables you create using DAX table functions inside measures can be thought of as being virtual because they are not physically stored as part of the data model. They are created on the fly inside your DAX measure formulas and can be used to filter your formulas to just the rows of data that exist in the virtual table. Importantly, when you create a virtual table using a formula, the new virtual table has a virtual relationship to the data model, and that virtual relationship propagates the filters in exactly the same way that the permanent relationships do. (You’ll hear more about this shortly.) Virtual tables are said to retain lineage with their source tables.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-379"></a></span><span class="b2">VALUES() Function</span></p>
			<p class="normal"><span class="mono">VALUES()</span> is the first function you have come to in this book that returns a (virtual) table. If you type the word <span class="mono">VALUES</span> into the formula bar and read the IntelliSense, you can see that this function returns a table, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000219.png" alt="" /></p>
			<p class="normal">One important thing to note about <span class="mono">VALUES()</span> is that it respects the initial filter context coming from your visuals. So if you combine this fact that <span class="mono">VALUES()</span> respects the current filter context with the information provided by IntelliSense in the image above, you can see that <span class="mono">VALUES()</span> returns a table that contains the list of all possible values in the current filter context (i.e., after the filters have been applied from the visuals).</p>
			<p class="normal">It’s time to work through some examples to demonstrate the point.</p>
			<p class="h"><span class="b2">A </span><span class="b2"><a id="calibre_link-146"></a></span><span class="b2">Calendar Example</span></p>
			<p class="normal">Set up a new matrix like the one shown below by putting <span class="mono">Calendar</span> <span class="mono">Year</span> on Rows.</p>
			<p class="fp"><img class="_idgenobjectattribute72" src="images/000228.png" alt="" /></p>
			<p class="normal">Then write the following measure in the <span class="mono">Calendar</span> table:</p>
			<p class="code"><span class="mono1">Total Months in Calendar = COUNTROWS(VALUES('Calendar'[MonthName]))</span></p>
			<table id="calibre_link-425" class="note-table">
				<colgroup class="calibre4">
					<col class="calibre5"></col>
				</colgroup>
				<tbody class="calibre6">
					<tr class="note-table1">
						<td class="note-table2">
							<p class="normal"><span class="b3">Note: </span>The following formula does not work here:</p>
							<p class="code"><span class="mono1">Total Months in Calendar wrong = COUNTROWS('Calendar'[MonthName])</span></p>
							<p class="normal">This formula doesn’t work because <span class="mono">COUNTROWS()</span> expects a table as the input, but <span class="mono">'Calendar'[MonthName]</span> is not a table; rather, it is a column that is part of a bigger table (the <span class="mono">Calendar</span> table, in this case).</p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="normal">Say that you wrap <span class="mono">'Calendar'[MonthName]</span> inside the <span class="mono">VALUES()</span> function, like this:</p>
			<p class="code"><span class="mono1">VALUES('Calendar'[MonthName])</span></p>
			<p class="normal">The original single column that is part of the <span class="mono">Calendar</span> table is converted into a virtual table in its own right, and the new virtual table retains a relationship (i.e., lineage) to the original <span class="mono">Calendar</span> table. This new table returned by <span class="mono">VALUES()</span> is still a single column, but now it is technically a table with a single a column instead of simply being a single column that is part of some other table (<span class="mono">Calendar</span>, in this case).</p>
			<p class="normal">So <span class="mono">VALUES('Calendar'[MonthName])</span> returns a virtual single-column table of possible values that respects the initial filter context coming from the matrix. It is not possible to put this new table created by <span class="mono">VALUES()</span> into a measure on its own unless you wrap it inside some other formula that returns a single value (e.g., an aggregator function like <span class="mono">COUNTROWS()</span>). In the earlier example (shown again below), the <span class="mono">VALUES()</span> part of the formula creates the virtual table, and then the <span class="mono">COUNTROWS()</span> function counts how many rows are in the table:</p>
			<p class="code"><span class="mono1">Total Months in Calendar = COUNTROWS(VALUES('Calendar'[MonthName]))</span></p>
			<p class="fp"><img class="_idgenobjectattribute73" src="images/000236.png" alt="" /></p>
			<p class="normal">Notice that the year 2016 has only 6 months, and each of the other years has 12. This is proof that the <span class="mono">VALUES()</span> function respects the initial filter context from the matrix. In the AdventureWorks database, the first year of data starts on 1 July 2016, so there are only 6 months in the <span class="mono">Calendar</span> table for the year 2016. The initial filter for the first row in the matrix is <span class="mono">'Calendar'[Year]</span> <span class="mono">=</span> <span class="mono">2016</span>. That filter is applied first, and then the measure <span class="mono">[Total</span> <span class="mono">Months</span> <span class="mono">in</span> <span class="mono">Calendar]</span> is evaluated. <span class="mono">VALUES()</span> respects the filter coming from the visual prior to the calculation.</p>
			<p class="h"><span class="b2">Conceptualising Virtual Tables</span></p>
			<p class="normal"><span class="mono">VALUES()</span> can take a column or a table as its only parameter. When you use a column as the parameter, <span class="mono">VALUES()</span> generates a virtual single-column table that contains all the unique values that exist in that source column. The image below conceptualises this process.</p>
			<p class="normal"><img class="_idgenobjectattribute74" src="images/000245.png" alt="" /></p>
			<p class="normal">Remember that this is just an illustration of a concept to help you understand what is happening under the hood. There is no actual physical table materialised, but this image helps you conceptualise what the virtual table would look like if it were materialised in your model. In the image, the virtual table (see #1 above) has a virtual relationship (#2) to the original table it comes from; this is its lineage. The new virtual table respects the current filter context coming from the visual in the report.</p>
			<p class="h"><span class="b2">Returning a Single Value</span></p>
			<p class="normal">There is another very cool feature of <span class="mono">VALUES()</span> that is very powerful: In the special case where <span class="mono">VALUES()</span> returns just a single row (i.e., there is just one value), you can refer to this value directly in your formulas.</p>
			<p class="normal">If you start with the example created above, remove <span class="mono">CalendarYear</span> from Rows, and put <span class="mono">MonthName</span> on Rows instead, you should get a matrix like the one shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute75" src="images/000253.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>See how the month names above are sorted in alphabetical order? Yes, this is a problem. I will show you how to fix this at the end of this chapter. For now, let’s just stay focused on the <span class="mono1">VALUES()</span> function.</p>
			<p class="normal">Now you can see that with the exception of the grand total, each row in the matrix has only a single value for <span class="mono">[Total</span> <span class="mono">Months</span> <span class="mono">in</span> <span class="mono">Calendar]</span>. So as long as you write the formula in such a way that it operates over only a single row of the table, you can create a measure that returns the name of the month into the matrix, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute76" src="images/000262.png" alt="" /></p>
			<p class="normal">This use case for <span class="mono">VALUES()</span> works only if there is a single value in the <span class="mono">VALUES()</span> virtual table. If there is more than one value in the <span class="mono">VALUES()</span> virtual table, the formula returns an error. Therefore, to write this formula, you need to provide protection for the possible scenario where <span class="mono">VALUES('Calendar'[MonthName])</span> has more than one row in the table. This is done using the function <a id="calibre_link-240" class="calibre3"></a><span class="mono">HASONEVALUE()</span>, like so:</p>
			<p class="code"><span class="mono1">Month Name (Values) =</span></p>
			<p class="code"><span class="mono1">    IF(HASONEVALUE('Calendar'[MonthName],</span></p>
			<p class="code"><span class="mono1">        VALUES('Calendar'[MonthName])</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">Remember that the structure of an <span class="mono">IF()</span> statement is as follows:</p>
			<p class="code"><span class="mono1">= IF(</span><span class="monoitalic">Logical Test</span><span class="mono1">, </span><span class="monoitalic">Result if True</span><span class="mono1">, [</span><span class="monoitalic">Result if False</span><span class="mono1">])</span></p>
			<p class="normal">The last parameter is optional. If you leave it out, then you are accepting the default value, <a id="calibre_link-131" class="calibre3"></a><span class="mono">BLANK()</span>.</p>
			<p class="normal">To see this more clearly, set up a matrix with the columns <span class="mono">Products[ModelName]</span> and <span class="mono">Products[ProductName]</span> on Rows and the measure <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products</span> <span class="mono">COUNTROWS</span> <span class="mono">Version]</span> (from Chapter 4) on Values. Your matrix should look as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000270.png" alt="" /></p>
			<p class="normal">Note that there is only one product for some models (see #1 above), and there are multiple products for some other models (#2 and #3).</p>
			<p class="normal">Now write the following measure:</p>
			<p class="code"><span class="mono1">Product Name(Values) =</span></p>
			<p class="code"><span class="mono1">    IF(HASONEVALUE(Products[ProductName]),</span></p>
			<p class="code"><span class="mono1">        VALUES(Products[ProductName])</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">If you add this measure to the matrix, the matrix looks as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute77" src="images/000278.png" alt="" /></p>
			<p class="normal">Notice that when there is only one product for a model, the product name is displayed (see #1 and #2 above). If there are multiple products for a model, a blank is returned for <span class="mono">ModelName</span> (#3, #4, and #5).</p>
			<p class="normal">Now write the following incorrect formula, which omits <span class="mono">HASONEVALUE()</span>:</p>
			<p class="code"><span class="mono1">Product Name(Values) Wrong = VALUES(Products[ProductName])</span></p>
			<p class="normal">If you put this measure in the matrix, you get the error shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute78" src="images/000286.png" alt="" /></p>
			<p class="normal">The key information in this error message is “A table of multiple values was supplied where a single value was expected.” You can use <span class="mono">VALUES()</span> in a measure only if it returns a single value. If <span class="mono">VALUES()</span> returns more than a single value, it throws an error. The <span class="mono">HASONEVALUE()</span> function is used to protect against the specific case where <span class="mono">VALUES()</span> returns more than a single value, and the <span class="mono">IF(HASONEVALUE())</span> pattern prevents this error from occurring.</p>
			<p class="h"><span class="b2">The SELECTEDVALUE() Function</span></p>
			<p class="normal">Power BI has a function called <span class="mono">SELECTEDVALUE()</span> that is another example of the syntax sugar concept that has come up several times. Here is the syntax for this function:</p>
			<p class="code"><a id="calibre_link-342"></a><span class="mono1">SELECTEDVALUE(</span><span class="monoitalic">ColumnName</span><span class="mono1">, </span><span class="monoitalic">AlternateResult</span><span class="mono1">)</span></p>
			<p class="normal"><span class="mono">SELECTEDVALUE()</span> was created to replace the following complex formula from the previous section:</p>
			<p class="code"><span class="mono1">Product Name(Values) =</span></p>
			<p class="code"><span class="mono1">    IF(HASONEVALUE(Products[ProductName]),</span></p>
			<p class="code"><span class="mono1">        VALUES(Products[ProductName])</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">The <span class="mono">SELECTEDVALUE()</span> function allows you to rewrite this formula as follows:</p>
			<p class="code"><span class="mono1">Product Name Alternate = SELECTEDVALUE(Products[ProductName])</span></p>
			<p class="normal">Under the hood, <span class="mono">SELECTEDVALUE()</span> performs the <span class="mono">IF(HASONEVALUE())</span> test, and it returns the single value in the column if there is just one. <span class="mono">AlternateResult</span> is <span class="mono">BLANK()</span> by default.</p>
			<p class="note"><span class="b1">Note: </span>The <span class="mono1">SELECTEDVALUE()</span> function is not available in Power Pivot for Excel at the time of this writing, so you need to use the <span class="mono1">IF(HASONEVALUE())</span> formula instead when using Excel.</p>
			<p class="h"><a id="calibre_link-156"></a><span class="b2">CONCATENATEX() to the Rescue</span></p>
			<p class="normal">Power BI has a special DAX function called <span class="mono">CONCATENATEX()</span> that iterates over a list of values in a table and concatenates them together into a single value. By using this function, you can write a formula that returns the single value when there is just one value but concatenate all the values into a single value when there are multiple values. You could write the earlier <span class="mono">VALUES()</span> formula like this:</p>
			<p class="code"><span class="mono1">Product Name(Values) ConcatenateX =</span></p>
			<p class="code"><span class="mono1">    CONCATENATEX(</span></p>
			<p class="code"><span class="mono1">        VALUES(Products[ProductName]),</span></p>
			<p class="code"><span class="mono1">        [ProductName],</span></p>
			<p class="code"><span class="mono1">        ", "</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">With this formula, you get the result shown below. I have added a slicer here to make it possible to change the number of items visible in the matrix.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000294.png" alt="" /></p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-84"></a>Here’s How: Changing the Month Name </span><span class="b2"><a id="calibre_link-355"></a></span><span class="b2">Sort Order</span></p>
			<p class="normal">Earlier in this chapter I placed the month names from the <span class="mono">Calendar</span> table into a matrix (shown again below). In this matrix, the month names are sorted in alphabetical order rather than in the logical calendar order.</p>
			<p class="fp"><img class="_idgenobjectattribute79" src="images/000302.png" alt="" /></p>
			<p class="normal">In Power BI (and many other software tools), by default, all columns in all tables sort in alphanumeric order. It is, however, possible to change the sort order. To do so, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Go to the Data view and navigate to the <span class="mono1">Calendar</span> table. (It is not really necessary to switch to the Data view, but it is a good idea to do that in this learning example so you can see what is going on.)</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Click in the <span class="mono1">MonthName</span> column (see #1 below), click the Sort by Column button (#2), and then select the <span class="mono1">MonthNumberOfYear</span> column to make it the sort column (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute80" src="images/000311.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Return to your matrix in the Report view, and you see that the rows are sorted in logical month order, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute81" src="images/000319.png" alt="" /></p>
			<p class="normal">It is best practice to load a sort column in a lookup table for every column that needs to be sorted in an order other than alphabetic order. You should therefore always include a sort column in your <span class="mono">Calendar</span> table for data such as days of the week and months of the year. If you operate over a financial year that does not start in January, then you should, of course, make sure your sort column reflects that.</p>
			<p class="note"><span class="b1">Note: </span>When you create a sort column in a table, there must be a one-to-one match between the values in the sort order and the values in the column to be sorted.</p>
			<p class="h1"><span class="b2">Practice Exercises: VALUES()</span></p>
			<p class="normal">Create a new matrix and put <span class="mono">Products[Category]</span> on Rows and the measure <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products]</span> on Values. Then write the following measures by first creating a <span class="mono">VALUES()</span> table and then wrapping this table inside a <span class="mono">COUNTROWS()</span> function, as in the example shown earlier in this chapter. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">39. [Number of Color Variants]</span></p>
			<p class="h2"><span class="bi">40. [Number of SubCategories]</span></p>
			<p class="h2"><span class="bi">41. [Number of Size Ranges]</span></p>
			<p class="normal">Use the column <span class="mono">Products[SizeRange]</span> for this one.</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with the following matrix?</p>
			<p class="fp"><img class="_idgenobjectattribute82" src="images/000327.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>Each of these measures is the equivalent of dragging the column name and dropping it into the Values drop zone for the matrix. When you drop a text field into the Values drop zone for a matrix in Power BI, the matrix creates an implicit measure and uses <span class="mono1">COUNT()</span> as the aggregating method. But recall that I recommended that you avoid using implicit measures. The names created by implicit measures are not user friendly, and values are not formatted. In addition, you need DAX practice at this point, so I recommend that you write explicit DAX measures, particularly while you are learning.</p>
			<p class="h1"><span class="b2">The New Table Button</span></p>
			<p class="normal">Business Power BI users (i.e., those who don’t have a professional IT background) often find it somewhat difficult to understand the <span class="mono">VALUES()</span> function because you can’t actually see the table it creates. So far I have shown you that even though you can’t see the table, you can wrap the table inside a <span class="mono">COUNTROWS()</span> function so that at least you can see the number of rows in the table.</p>
			<p class="normal">Power BI Desktop has a feature called <a id="calibre_link-293" class="calibre3"></a>New Table that is not currently available in Power Pivot for Excel. The New Table button is on the Modeling tab (see #1 below).</p>
			<p class="fp"><img class="_idgenobjectattribute83" src="images/000336.png" alt="" /></p>
			<p class="normal">When you click the New Table button (see #2 above), you see that you can write a formula in the formula bar, as shown below.</p>
			<p class="normal"><img class="_idgenobjectattribute84" src="images/000344.png" alt="" /></p>
			<p class="normal">When you create a new table by using this button, you can write a formula (e.g., using <span class="mono">VALUES()</span>) that returns a table, and the table is added to the data model; that is, it is physically materialised into the model.</p>
			<p class="normal">Say that you write a table with the following DAX formula:</p>
			<p class="code"><span class="mono1">Product Colors = VALUES(Products[Color])</span></p>
			<p class="normal">You get the new table shown below in the data model (visible in the Data view).</p>
			<p class="fp"><img class="_idgenobjectattribute85" src="images/000352.png" alt="" /></p>
			<p class="normal">Recall that <span class="mono">VALUES()</span> returns all the unique values in the current filter context. A new table doesn’t respond to filters from the Report view, so there is no initial filter context for a new table. The table above therefore shows a complete list of all possible values for <span class="mono">Products[color]</span> in the entire <span class="mono">Products</span> table (with no filters applied).</p>
			<p class="normal">The New Table button is very useful for materialising any virtual table so you can “see” the contents of the table. Later in the book, when you learn about the <span class="mono">FILTER()</span> function, you will see how you can add your own filter to one of these tables so you can see a subset of a table with a filter applied. For now, it is just good to know that if you ever can’t get your head around a virtual table, you can always materialise it by using this feature so you can take a peek, and then you can delete it when you are done.</p>
			<p class="h1"><span class="b2">Practice Exercises: VALUES(), Continued</span></p>
			<p class="normal">For the following practice exercises, begin with the matrix from Practice Exercises 39&ndash;41 but remove the measure <span class="mono">[Number</span> <span class="mono">of</span> <span class="mono">Size</span> <span class="mono">Ranges]</span> from the matrix. Then write the following measures, each of which returns a single value (the text name) into a cell in the matrix. Each formula has the word <span class="mono">(Values)</span> in the name, so it is clear that the formulas are written using the <span class="mono">VALUES()</span> function; this is just a “note to self.” In each example, make sure you wrap your <span class="mono">VALUES()</span> function in an <span class="mono">IF(HASONEVALUE())</span> function, as in the example earlier in this chapter. Alternatively, you can use the <span class="mono">SELECTEDVALUE()</span> function if you prefer. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">42. [Product Category (Values)]</span></p>
			<p class="h2"><span class="bi">43. [Product SubCategory (Values)]</span></p>
			<p class="h2"><span class="bi">44. [Product Color (Values)]</span></p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with the following matrix? </p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000001.png" alt="" /></p>
			<p class="normal">Notice that two of these measures are blank. This is because the <span class="mono">VALUES()</span> formula has more than one value, and hence the <span class="mono">IF(HASONEVALUE()</span>) (or <span class="mono">SELECTEDVALUE()</span>) part of the formula returns <span class="mono">BLANK()</span>; this is the default if you omit the last parameter.</p>
			<p class="h2"><span class="bi">45. Modifying Practice Exercise 43</span></p>
			<p class="normal">Try editing the <span class="mono">IF()</span> statement for <span class="mono">[Product</span> <span class="mono">SubCategory</span> <span class="mono">(Values)]</span>  so that it returns the value <span class="mono">More</span> <span class="mono">than</span> <span class="mono">1</span> <span class="mono">SubCategory</span> instead of <span class="mono">BLANK()</span>. Recall that the syntax for <span class="mono">IF()</span>  is <span class="mono">IF(</span><span class="monoitalic1">Logical</span> <span class="monoitalic1">Test</span>, <span class="monoitalic1">Result if True</span>, <span class="monoitalic1">Result if False</span><span class="mono">)</span>.</p>
			<p class="h2"><span class="bi">46. Modifying Practice Exercise 44</span></p>
			<p class="normal">Now try editing the <span class="mono">IF()</span>  statement for <span class="mono">[Product</span> <span class="mono">Color</span> <span class="mono">(Values)]</span> so that it returns <span class="mono">More</span> <span class="mono">than</span> <span class="mono">1</span> <span class="mono">Color</span> instead of <span class="mono">BLANK()</span>. </p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with the following matrix?</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000008.png" alt="" /></p>
			<p class="normal">Finally, you can add to your report a couple of slicers&mdash;for color and subcategory&mdash;from the <span class="mono">Products</span> table. When you click on these slicers, the values in the matrix update to reflect the filtering in the slicer(s), as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000016.png" alt="" /></p>
		</div>
	</div>


<div id="calibre_link-49" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-426" class="ch"><span class="b2"><a id="calibre_link-17"></a>14: DAX Topic: ALL(), REMOVEFILTERS(), <br class="calibre7" />ALLEXCEPT(), and ALLSELECTED()</span></p>
			<p class="normal">The DAX functions <span class="mono">ALL()</span>, <span class="mono">ALLEXCEPT()</span>, <span class="mono">ALLSELECTED()</span>, and <span class="mono">REMOVEFILTERS()</span> are very similar in what they do. Let’s start with <span class="mono">ALL()</span> and then look at the differences between this function and the others.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-116"></a></span><span class="b2">ALL() Function</span></p>
			<p class="normal">Basically, the <span class="mono">ALL()</span> function creates a virtual table that contains all possible unique values from the source. This can be tricky to understand because you can’t see a virtual table, and if you can’t see it, then how can you understand it? The easiest way to understand the way <span class="mono">ALL()</span> behaves as a virtual table is with a couple of examples.</p>
			<p class="h1"><span class="b2">ALL() Compared to VALUES()</span></p>
			<p class="normal">In Chapter 13, I showed how to materialise the <span class="mono">VALUES()</span> function by going to the Modeling tab, clicking on the New Table button, and adding the following formula:</p>
			<p class="code"><span class="mono1">Product Colors Values = VALUES(Products[Color])</span></p>
			<p class="normal"><span class="mono">VALUES()</span> is a table function, so you can materialise a table by using the New Table button in Power BI. You can use the same technique with the <span class="mono">ALL()</span> function:</p>
			<p class="code"><span class="mono1">Product Colors All = ALL(Products[Color])</span></p>
			<p class="normal">In this case, when you use the New Table button to materialise the table, <span class="mono">ALL()</span> returns exactly the same table as <span class="mono">VALUES()</span>. But even though these two functions deliver the same table in this scenario, there is a very important difference between them. The <span class="mono">VALUES()</span> function respects the filter context prior to returning a table, and the <span class="mono">ALL()</span> function ignores (or removes) the filter context. In the case of the table materialised using the New Table button, no filter context exists, so the two functions return the same result. But if there were filter context, these two functions would behave differently.</p>
			<p class="normal">There is a second difference between <span class="mono">VALUES()</span> and <span class="mono">ALL()</span>: <span class="mono">ALL()</span> can take more than one parameter, so it can combine more than one column at a time into a new table. You can see this by looking at the IntelliSense, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute17" src="images/000024.png" alt="" /></p>
			<p class="normal">Consider the following formula:</p>
			<p class="code"><span class="mono1">Product Color/Category ALL = ALL(Products[Color],Products[Category])</span></p>
			<p class="normal">If you write this as a new table, you can “see” what it does. You get a new table that looks like the one in the image below (which shows only the first 12 rows of many).</p>
			<p class="fp"><img class="_idgenobjectattribute86" src="images/000032.png" alt="" /></p>
			<p class="normal">The <span class="mono">ALL()</span> formula above creates a table containing all the unique combinations that exist in the table from the specified columns with all filters removed.</p>
			<p class="note"><span class="b1">Note:</span> In the examples above, I have materialised these tables so you can see the result, but this is just for testing purposes. Under normal circumstances, you use the <span class="mono1">ALL()</span> function as a virtual table function inside another DAX formula. The virtual table behaves exactly as it would if it existed as a physical table inside your model, including as if it had a relationship between the new table and the source table. But because it is a virtual table, you never actually “see” the result. This is what makes table functions difficult to learn in DAX.</p>
			<p class="h1"><span class="b2">Using ALL() Inside Measures</span></p>
			<p class="normal">The most common use of the <span class="mono">ALL()</span> function is as a table function inside a measure. The <span class="mono">ALL()</span> function is really useful because it can remove filters coming from visuals. (Remember that <span class="mono">VALUES()</span> respects the filters coming from a visual, and <span class="mono">ALL()</span> ignores or removes the filters.)</p>
			<p class="normal">To see how <span class="mono">ALL()</span> works, create a new matrix and put <span class="mono">Products[Category]</span> on Rows and put the <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products]</span> measure you created earlier into the Values drop zone for the visual. You get the matrix shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute87" src="images/000040.png" alt="" /></p>
			<p class="normal">Technically, what is happening here is that the first row in the matrix is filtering the <span class="mono">Products</span> table so that only products that are of type <span class="mono">Products[Category]="Accessories"</span> are unfiltered in the source table (i.e., the <span class="mono">Products</span> table); the other products are all filtered out. You can’t see that the table is filtered, but you can imagine what the underlying table in your data model would look like with a filter applied to Accessories behind the scenes. In fact, let’s take a diversion and go and see what that actually looks like. Switch to the Data view, navigate to the <span class="mono">Products</span> table, and go to the <span class="mono">Category</span> column. From the drop-down arrow at the top of the column (see #1 below), you can select Accessories (#2) to place a filter on it and then click OK (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute88" src="images/000048.png" alt="" /></p>
			<p class="normal">You now have a filter on the <span class="mono">Products</span> table so that it shows just the products that are accessories. After you apply this filter, you see some very important information in the bottom-left corner of the screen, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000056.png" alt="" /></p>
			<p class="normal">You can see in this image that there are 397 rows in the <span class="mono">Products</span> table, but after the filter is applied, just 35 rows remain. This is exactly the number that appears in the matrix visual (shown again below for convenience).</p>
			<p class="fp"><img class="_idgenobjectattribute89" src="images/000066.png" alt="Table  Description automatically generated" /></p>
			<p class="note"><span class="b1">Note:</span> Using the filters on the tables in the Data view is a great way to audit your data and visualise what your formulas are doing. Placing filters on your tables in this way has no effect on the results in your actual reports. These filters are for auditing, debugging, testing, and learning purposes only.</p>
			<p class="normal">After the matrix applies a filter (such as <span class="mono">Accessories</span> in this matrix) to the underlying tables, the measure <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products]</span> counts the rows that remain after the filter is applied. It does this for each of the five value cells in the matrix above, one at a time, including the total cell. There is no filter on <span class="mono">Products[Category]</span> applied to the total row in the matrix, so the measure counts all rows in the table (a completely unfiltered copy of the table). You could validate the rest of these numbers by using the filters in the Data view if you like, but of course they are correct.</p>
			<p class="normal">Now create a new measure that uses the <span class="mono">ALL()</span> function:</p>
			<p class="code"><span class="mono1">Total All Products = COUNTROWS(ALL(Products))</span></p>
			<p class="note"><span class="b1">Note: </span>This time the <span class="mono1">ALL()</span> function is not using one or more columns as parameters; instead, it is using the entire <span class="mono1">Products</span> table as the only parameter. This is valid syntax for both <span class="mono1">ALL()</span> and <span class="mono1">VALUES()</span>.</p>
			<p class="normal">The <span class="mono">ALL()</span> function returns a table. You cannot add a table inside a measure unless it is wrapped inside another function. You can wrap <span class="mono">COUNTROWS()</span> around any table in order to be able to find the number of rows in the table. When you have finished typing this formula, you can add the measure to your matrix, and you should get the results shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute90" src="images/000076.png" alt="" /></p>
			<p class="normal">You can see from this matrix that the new measure is always returning <span class="mono">397</span>, regardless of the filters coming from the rows in the matrix. The matrix is placing a filter on the <span class="mono">Products[Category]</span> column, but the <span class="mono">ALL()</span> function is removing that filter. By the time <span class="mono">COUNTROWS()</span> kicks in, the <span class="mono">ALL()</span> function has removed all the filters coming from the visual, and hence this measure always returns the total products in the <span class="mono">Products</span> table. In this use case, you can see that <span class="mono">ALL()</span> has the ability to remove the filters coming from the initial filter context.</p>
			<p class="h"><span class="b2">Using </span><span class="b2"><a id="calibre_link-117"></a></span><span class="b2">ALL() as a Table Filter Inside CALCULATE()</span></p>
			<p class="normal">One common use of <span class="mono">ALL()</span> is as a table filter inside a <span class="mono">CALCULATE()</span> function so that it removes the filters that are coming from the visual. This has the effect of giving you direct access to the total row in the visual so you can use it inside another formula. Let’s look at an example for clarity.</p>
			<p class="h1"><span class="b2">Calculating the Country </span><span class="b2"><a id="calibre_link-301"></a></span><span class="b2">Percentage of Total Sales</span></p>
			<p class="normal">Say that you want to calculate the country percentage of global sales. First, you need to set up a matrix with <span class="mono">Territories[Country]</span> on Rows and <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute91" src="images/000086.png" alt="" /></p>
			<p class="normal">It is then possible (as shown below) to select the matrix (see #1 below), click on the drop-down arrow next to the measure <span class="mono">[Total</span> <span class="mono">Sales]</span> (#2), and then select Show Value As (#3) and Percent of Grand Total (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000093.png" alt="" /></p>
			<p class="normal">If you do this, you indeed see the country percentage of global sales, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute92" src="images/000101.png" alt="" /></p>
			<p class="normal">If this solves your problem, then you are done. But doing it this way does not give you access to the percentages for use in further calculations. For example, what if you want to write a formula that counts the number of countries that each represent more than 10% of global sales? You cannot do this calculation by using the visualisation technique shown above. If you want to use the results (percentage of global sales in this case) inside another formula, you have to write a measure.</p>
			<p class="tip"><span class="b1">Tip:</span> Of course, in this case, you are trying to learn to write DAX, so I recommend that you invest the time to learn how to write the measure yourself rather than resorting to using the visualisation feature shown above. The following section explains how to write a measure by using <span class="mono1">ALL()</span>.</p>
			<p class="h"><span class="b2">Writing Your Own DAX Measures by Using ALL()</span></p>
			<p class="normal">Instead of using the visualisation technique described above, you can write a new measure that returns the actual percentage value by country, and this measure can become a reusable asset in your data model. You can do this in two steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a grand total measure.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Create the percentage of total.</p>
			<p class="tip"><span class="b1">Tip: </span>Remember that it is good practice to break a problem you are trying to solve into pieces and solve one piece of the puzzle at a time.</p>
			<p class="h1"><span class="b2">Step 1: Create a Grand Total Measure</span></p>
			<p class="normal">To complete the first step, right-click the <span class="mono">Sales</span> table in the Fields pane, select New Measure, and create the following new measure:</p>
			<p class="code"><span class="mono1">Total Global Sales =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales], All(Territories))</span></p>
			<p class="note"><span class="b1">Note: </span>Don’t forget to apply suitable formatting immediately before moving on.</p>
			<p class="normal">As you know, the first parameter to <span class="mono">CALCULATE()</span> is an expression, and the subsequent parameters are filters that modify the filter context. In this case, you are passing a table as a filter modifier. This table is <span class="mono">ALL(Territories)</span>, which is actually an unfiltered copy of the entire <span class="mono">Territories</span> table.</p>
			<p class="normal">After you add the new measure to the matrix, your matrix looks as shown below. Do you see that the new measure is ignoring the initial filter context coming from the matrix? <span class="mono">CALCULATE()</span> is the only function that can modify the filter context. In this case, <span class="mono">CALCULATE()</span> is replacing the initial filter context from the visual on <span class="mono">Territories[Country]</span> with a new filter context by using an unfiltered copy of the <span class="mono">Territories</span> table instead.</p>
			<p class="normal"><img class="_idgenobjectattribute93" src="images/000110.png" alt="" /></p>
			<p class="normal">I call this <span class="mono">[Total</span> <span class="mono">Global</span> <span class="mono">Sales]</span> measure an “interim measure” because it was created to help break the problem into manageable pieces.</p>
			<p class="tip"><span class="b1">Tip:</span> It is a good idea to determine whether the interim measure works as expected before you move on.</p>
			<p class="h1"><span class="b2">Step 2: Create the Percentage of Total</span></p>
			<p class="normal">After you have created the measure <span class="mono">[Total</span> <span class="mono">Global</span> <span class="mono">Sales]</span>, it is easy to create a new measure to calculate the country percentage of global sales. Right-click the <span class="mono">Sales</span> table in the Fields pane, select New Measure, and create the measure as follows:</p>
			<p class="code"><span class="mono1">% of Global Sales =</span></p>
			<p class="code"><span class="mono1">    DIVIDE([Total Sales], [Total Global Sales])</span></p>
			<p class="normal">Make sure you format this measure so that Format is set to Percentage and Decimal Places is set to 1. You end up with the matrix shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute94" src="images/000119.png" alt="" /></p>
			<p class="normal">The final step is to remove the <span class="mono">[Total</span> <span class="mono">Global</span> <span class="mono">Sales]</span> interim measure from the matrix.</p>
			<p class="note"><span class="b1">Note:</span> You don’t actually need the interim measures to be placed in the matrix in order for the <span class="mono1">[% of Global Sales]</span> measure to work. But you should notice how much easier it is to visualise what is happening when you write an interim measure and place it in a matrix. When you do it this way, you can easily see that the <span class="mono1">[Total Global Sales]</span> value is the same, regardless of the country in the matrix, and hence you can immediately see that you just need to divide the country sales by this total global sales amount, and it is going to work. Doing it this way is very similar to how you would do it in regular Excel, and it can be helpful to step through the DAX formulas like this to get the same experience.</p>
			<p class="normal">The final matrix is shown below, with some conditional formatting applied to make it easier to read.</p>
			<p class="fp"><img class="_idgenobjectattribute95" src="images/000127.png" alt="" /></p>
			<p class="h"><span class="b2">Using the New Quick </span><span class="b2"><a id="calibre_link-319"></a><a id="calibre_link-278"></a></span><span class="b2">Measure Option</span></p>
			<p class="normal">You may already know (or may have noticed in one of the earlier images) that there is a New Quick Measure option available in Power BI. If you click the drop-down arrow next to Total Sales (see #1 below), you see the New Quick Measure option (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute96" src="images/000136.png" alt="" /></p>
			<p class="normal">If you select the New Quick Measure option, Power BI helps you write a measure, and you don’t have to have any knowledge of DAX at all. Using a new quick measure is much better than creating implicit measures (by dragging the column to the Values drop zone for the visual, as discussed earlier in this chapter). Using quick measures is better than using implicit measures for several reasons. For example, you can rename a quick measure, edit the measure, format the measure, and reuse the measure inside other measures.</p>
			<p class="normal">The image below shows the wizard for creating a new quick measure that calculates the total for a category (without filters). All you have to do is drag a column or measure from the Fields list on the right into the relevant placeholder areas on the left. In the example below, I have added <span class="mono">[Total</span> <span class="mono">Sales]</span> to Base Value and <span class="mono">Territories[Country]</span> to Category.</p>
			<p class="note"><span class="b1">Note: </span>Did you notice that I didn’t need to tell you that <span class="mono1">[Total Sales]</span> is a measure and <span class="mono1">Territories[Country]</span> is a column? Remember that it is a best practice to omit the table name from a measure and always include the table name in front of a column; if you do, others in the DAX authoring community who follow best practices will understand what you mean.</p>
			<p class="fp"><img class="_idgenobjectattribute97" src="images/000144.png" alt="" /></p>
			<p class="normal">Power BI creates the quick measure shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute98" src="images/000154.png" alt="" /></p>
			<p class="normal">This is a functioning measure, and it is almost identical to the one that was hand-written above.</p>
			<p class="note"><span class="b1">Note: </span>Using the New Quick Measure option is a great help for writing complex DAX functions quickly and without a lot of knowledge about how it all works. However, I do not spend any more time talking about the feature in this book because this is a book about writing your own DAX formulas. If you want to use quick measures, then do so by all means. I don’t, however, recommend that you use quick measures instead of learning how the DAX language works; rather, I recommend that you use quick measures as a tool to help you learn the DAX language.</p>
			<p class="h"><span class="b2">Passing a Table or a Column to ALL()</span></p>
			<p class="normal">Before we finish with <span class="mono">ALL()</span>, it is worth noting that the following measure would return exactly the same result as <span class="mono">[Total</span> <span class="mono">Global</span> <span class="mono">Sales]</span> in the matrix example in the earlier section “Step 1: Create a Grand Total Measure”:</p>
			<p class="code"><span class="mono1">Total All Country Sales =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(</span></p>
			<p class="code"><span class="mono1">        [Total Sales],</span></p>
			<p class="code"><span class="mono1">        ALL(Territories[Country])</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">Notice that this measure passes a single column instead of the entire table to the <span class="mono">ALL()</span> function, just like the formula created by the quick measure. In this specific matrix, which is shown below, <span class="mono">[Total</span> <span class="mono">Global</span> <span class="mono">Sales]</span> and <span class="mono">[Total</span> <span class="mono">All</span> <span class="mono">Country</span> <span class="mono">Sales]</span> return the same result.</p>
			<p class="fp"><img class="_idgenobjectattribute99" src="images/000163.png" alt="" /></p>
			<p class="normal">However, the measure <span class="mono">[Total</span> <span class="mono">All</span> <span class="mono">Country</span> <span class="mono">Sales]</span> would not show the same result (i.e., it would not remove the filter) if there were some other column on Rows in the matrix (i.e., something other than <span class="mono">Country</span>). To test this, remove <span class="mono">Territories[Country]</span> from Rows in the matrix and replace it with <span class="mono">Territories[Region]</span>. You get the result shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute100" src="images/000171.png" alt="" /></p>
			<p class="normal">Notice the difference between passing the entire table name to the <span class="mono">ALL()</span> function and passing a single column. <span class="mono">[Total</span> <span class="mono">Global</span> <span class="mono">Sales]</span> removes the filter from the entire <span class="mono">Territories</span> table, but <span class="mono">[Total</span> <span class="mono">All</span> <span class="mono">Country</span> <span class="mono">Sales]</span> removes the filter only from the <span class="mono">Territories[Country]</span> column of the table. In the matrix visual above, there is no filter on the <span class="mono">Territories[Country]</span> column of the table, and hence <span class="mono">ALL()</span> has no effect on the visual.</p>
			<p class="normal">Remove <span class="mono">[Total</span> <span class="mono">All</span> <span class="mono">Country</span> <span class="mono">Sales]</span> from the matrix before proceeding.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-328"></a></span><span class="b2">REMOVEFILTERS() Function</span></p>
			<p class="normal">Several times so far in this book, I have discussed the concept of syntax sugar. As a recap, this is a term that describes variations to functions that Microsoft developers sometimes create to make DAX easier to learn and understand. The <span class="mono">REMOVEFILTERS()</span> function is an example of syntax sugar. When I first learnt DAX, I learnt that the <span class="mono">ALL()</span> function is the “remove filters” function. In fact, I still teach this concept to my students today. So as you may have guessed, the <span class="mono">REMOVEFILTERS()</span> function is actually just syntax sugar for the <span class="mono">ALL()</span> function that you can use when you want to remove filters in the way shown above. Personally I never use <span class="mono">REMOVEFILTERS()</span> because I just learnt to do it using <span class="mono">ALL()</span>, but of course you can use it if you like.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-119"></a></span><span class="b2">ALLEXCEPT() Function</span></p>
			<p class="normal">The <span class="mono">ALL()</span> function has a few siblings that are very similar but with a few important differences. <span class="mono">ALLEXCEPT()</span> allows you to remove filters from all columns in a table except the ones that you explicitly specify. Say that you want to remove filters for every column in the <span class="mono">Products</span> table except for the <span class="mono">Products[Category]</span> column. There are 21 columns in the <span class="mono">Products</span> table, so if you use the <span class="mono">ALL()</span> function, you have to specify the 20 columns from which you want to remove the filter so that <span class="mono">ALL()</span> can do what you want for those 20, while retaining the filter on <span class="mono">Products[Category]</span>. This is what it looks like:</p>
			<p class="code"><span class="mono1">Total Sales of ALL Products except Category =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(</span></p>
			<p class="code"><span class="mono1">        [Total Sales],</span></p>
			<p class="code"><span class="mono1">        All(Products[color],Products[Size],Products[Weight],</span></p>
			<p class="code"><span class="mono1">            &lt;+ 17 more that are not listed here&gt;)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal"><span class="mono">ALLEXCEPT()</span> makes it easier to write a formula to remove filters from most but not all columns in a table. You can use it to write the <span class="mono">ALL()</span> formula shown above as follows:</p>
			<p class="code"><span class="mono1">Total Sales of ALL Products except Category 2 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(</span></p>
			<p class="code"><span class="mono1">        [Total Sales],</span></p>
			<p class="code"><span class="mono1">        ALLEXCEPT(Products, Products[Category])</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">When using <span class="mono">ALLEXCEPT()</span>, you must first specify the table that contains the columns to be removed and then specify the columns that are not to be removed.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-120"></a></span><span class="b2">ALLSELECTED() Function</span></p>
			<p class="normal">The <span class="mono">ALLSELECTED()</span> function works much like <span class="mono">ALL()</span> except in the way it works with other visuals and the Filters pane. The <span class="mono">ALLSELECTED()</span> function is useful when you want to calculate percentages, as shown above, and you have a filter applied from somewhere else in your report (say, via a slicer, the Filters pane, or cross-filtering from another visual) and you want the total in your matrix to add up to 100%.</p>
			<p class="normal">Look at the example below. Say that you’re working with the same matrix used earlier in this chapter but now with a slicer that filters on <span class="mono">Territories[Group]</span>. Notice below that <span class="mono">[%</span> <span class="mono">of</span> <span class="mono">Global</span> <span class="mono">Sales]</span> adds up to 38.7%; this is correct because the other countries that make up the remaining 61.3% have been filtered out using the Group slicer.</p>
			<p class="fp"><img class="_idgenobjectattribute101" src="images/000180.png" alt="" /></p>
			<p class="normal">But what if you want to see the percentage for each region in a group in the matrix, such as for each region in the group North America? This is where <span class="mono">ALLSELECTED()</span> comes in. <span class="mono">ALLSELECTED()</span> removes the filters coming from the matrix but respects the filters coming from the slicer (or any other type of cross-filtering).</p>
			<p class="normal">Add the following interim measure to the matrix above:</p>
			<p class="code"><span class="mono1">Total Selected Territories =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales], ALLSELECTED(Territories))</span></p>
			<p class="normal">In the <a id="calibre_link-302" class="calibre3"></a>image below, notice that <span class="mono">[Total</span> <span class="mono">Selected</span> <span class="mono">Territories]</span> returns the same value as the total of the region sales in the matrix. </p>
			<p class="fp"><img class="_idgenobjectattribute102" src="images/000189.png" alt="" /></p>
			<p class="normal">Using the same steps as before, you can now write the new measure <span class="mono">[%</span> <span class="mono">of</span> <span class="mono">Selected</span> <span class="mono">Territories]</span> and then remove the interim measure <span class="mono">[Total</span> <span class="mono">Selected</span> <span class="mono">Territories]</span> from the matrix. Here’s how you write the new measure:</p>
			<p class="code"><span class="mono1">% of Selected Territories =</span></p>
			<p class="code"><span class="mono1">    DIVIDE([Total Sales], [Total Selected Territories])</span></p>
			<p class="normal">If you format this new measure by using percentage and one decimal place and apply conditional formatting to the measure, the matrix that results looks as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute103" src="images/000197.png" alt="" /></p>
			<p class="h"><span class="b2">The Value of </span><span class="b2"><a id="calibre_link-276"></a><a id="calibre_link-253"></a></span><span class="b2">Interim Measures</span></p>
			<p class="normal">Remember that it is good practice to split a problem into pieces and solve one piece of the problem at a time. My advice is to get used to creating interim measures first and then writing the final measure that you actually need. Doing this helps you visualise each step of the process and makes it easier to get each part of the end-state formula correct before you proceed to the next step.</p>
			<p class="normal">It is, of course, possible to write one single measure that carries out a number of steps. This is what it would look like, for example, for the process described above:</p>
			<p class="code"><span class="mono1">% of Selected Territories ONE STEP =</span></p>
			<p class="code"><span class="mono1">    DIVIDE(</span></p>
			<p class="code"><span class="mono1">        [Total Sales],</span></p>
			<p class="code"><span class="mono1">        CALCULATE([Total Sales], ALLSELECTED(Territories))</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">But an all-in-one formula like this one can be difficult to write, read, and debug&mdash;particularly when you are learning to write DAX. It’s not wrong; it can just be difficult when you are starting out, and life is too short to do things that are harder than they need to be.</p>
			<p class="h1"><span class="b2">Practice Exercises: ALL(), ALLEXCEPT(), and ALLSELECTED()</span></p>
			<p class="normal">It’s time for you to get some practice. Create a new matrix and put <span class="mono">Customers[Occupation]</span> on Rows and <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values. You get the matrix shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute104" src="images/000206.png" alt="" /></p>
			<p class="normal">Then, using the principles covered in this chapter, create the following measures by first creating the interim measure you need and then creating the final measure. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">47. [Total Sales to All Customers]</span></p>
			<p class="h2"><span class="bi">48. [% of All Customer Sales]</span></p>
			<p class="normal">Add a slicer for <span class="mono">Customers[Gender]</span> to the report you just created and filter by male gender, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000214.png" alt="" /></p>
			<p class="normal">Note that <span class="mono">[%</span> <span class="mono">of</span> <span class="mono">All</span> <span class="mono">Customer</span> <span class="mono">Sales]</span> doesn’t add to 100%. This is correct because the other 50.5% of customers are filtered out with the slicer.</p>
			<p class="normal">Set up another matrix with <span class="mono">Customers[NumberCarsOwned]</span> on Rows, <span class="mono">Customers[Occupation]</span> on Slicer, and <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values. Your job is to create the other measure in this matrix: <span class="mono">[%</span> <span class="mono">of</span> <span class="mono">Sales</span> <span class="mono">to</span> <span class="mono">Selected</span> <span class="mono">Customers]</span>. When you are done, your matrix should look like the one below, with the last column showing the percentage of sales to customers based on the number of cars they own.</p>
			<p class="fp"><img class="_idgenobjectattribute105" src="images/000222.png" alt="" /></p>
			<p class="normal">Remember that in this case, you want to create an interim measure first, so you actually need to create the following two measures and then remove the first of them from the matrix.</p>
			<p class="h2"><span class="bi">49. [Total Sales to Selected Customers]</span></p>
			<p class="h2"><span class="bi">50. [% of Sales to Selected Customers]</span></p>
			<p class="normal">Next, your objective is to try to understand how sales per day varies across the week (i.e., Monday is x%, Tuesday is y%, etc.). But you also need to allow the user to select a particular date range and have the report update to show the daily sales mix for the selected date range. First, you need to make sure you set up a suitable visual so you can determine whether your measures are performing as expected. Then you should create the following two measures. The first one is an interim formula that you can remove from the matrix once you have finished the second formula.</p>
			<p class="h2"><span class="bi">51. [Total Sales for All Days Selected Dates]</span></p>
			<p class="h2"><span class="bi">52. [% Sales for All Days Selected Dates]</span></p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with the following matrix?</p>
			<p class="fp"><img class="_idgenobjectattribute40" src="images/000231.png" alt="" /></p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-85"></a>Here’s How: Using ALLEXCEPT()</span></p>
			<p class="normal">I don’t use <span class="mono">ALLEXCEPT()</span> much, and you may not either, but it is still good to work through an example of how it can be used. This section will give you some practice while also demonstrating one possible use case.</p>
			<p class="normal">Say that you want to compare the percentage of sales across all occupations and see how it changes depending on the other customer filters. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Set up a new matrix by placing <span class="mono1">Customers[Occupation]</span> on Rows.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Add <span class="mono1">Gender</span> and <span class="mono1">NumberCarsOwned</span> slicers.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Put <span class="mono1">[Total Order Quantity]</span> on Values. </p>
			<p class="normal">Your setup should look as shown below. Note that the total order quantity will change as you click on the slicers.</p>
			<p class="normal">Here I have set the <span class="mono">NumberCarsOwned</span> slicer to be horizontal by selecting the slicer (see #1 below), going to the Format pane (#2), selecting General (#3), and then setting Orientation to Horizontal (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000240.png" alt="" /></p>
			<p class="normal">In the following practice exercises, you will create a number of measures; they are all needed to produce the final table visual, but only some of them will be visible in the final visual. As you create each measure, ensure that the results you see in your matrix make sense. Remember that writing DAX and then immediately adding it to a matrix helps you get your head around what you are doing.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000248.png" alt="" /></p>
			<p class="normal">After writing the above measures, you will be able to build the final visual, shown below, with just the final measures included.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000257.png" alt="" /></p>
			<p class="normal">As you can imagine, with this matrix, it is possible to select different combinations of gender and number of cars and then compare the variation between the baseline order quantity and the order quantities for the selected filter.</p>
			<p class="h1"><span class="b2">Practice Exercises: ALL(), ALLEXCEPT(), and ALLSELECTED(), Continued</span></p>
			<p class="normal">Based on the background just provided, you should now write the following DAX formulas, one at a time, and check to make sure each looks correct before moving to the next one. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">53. [Total Orders All Customers]</span></p>
			<p class="normal">To check this measure, click on the slicers and note that <span class="mono">[Total</span> <span class="mono">Order</span> <span class="mono">Quantity]</span> should change, but <span class="mono">[Total</span> <span class="mono">Orders</span> <span class="mono">All</span> <span class="mono">Customers]</span> should not change based on the slicers.</p>
			<p class="h2"><span class="bi">54. [Baseline Orders for All Customers with This Occupation]</span></p>
			<p class="normal">This measure should also not change when you make changes to the slicers. However, note that you should get a different value for each occupation (unlike with <span class="mono">[Total</span> <span class="mono">Orders</span> <span class="mono">All</span> <span class="mono">Customers]</span> above). This measure provides the baseline for comparison.</p>
			<p class="h2"><span class="bi">55. [Baseline % This Occupation of All Customer Orders]</span></p>
			<p class="normal">This measure converts the measure in Practice Exercise 54 into a percentage of the baseline for all orders. The description of this measure should help you work out how to write the DAX. Test the slicers again and make sure this new baseline percentage doesn’t change with the slicers.</p>
			<p class="h2"><span class="bi">56. [Total Orders Selected Customers]</span></p>
			<p class="normal">This measure should adjust depending on the selections you have in the slicers. Hint: Use <span class="mono">ALLSELECTED()</span>.</p>
			<p class="h2"><span class="bi">57. [Occupation % of Selected Customers]</span></p>
			<p class="normal">You can use the interim measures above to create this measure. Click the slicers a few times and see which values change. This new measure should change based on the values you select in the slicers.</p>
			<p class="h2"><span class="bi">58. [Percentage Point Variation to Baseline]</span></p>
			<p class="normal">This measure is the percentage of selected customers (Practice Exercise 57) minus the baseline (Practice Exercise 55).</p>
			<p class="normal">Now you should have an interactive report that allows you to drill into the customer attributes gender and number of cars owned to see the impact on the mix of business compared to the baseline of all customers.</p>
			<p class="normal">Sometimes it is useful to change the descriptions of the final measures as they appear in a matrix. For example, while <span class="mono">[Baseline</span> <span class="mono">%</span> <span class="mono">This</span> <span class="mono">Occupation</span> <span class="mono">of</span> <span class="mono">All</span> <span class="mono">Customer</span> <span class="mono">Orders]</span> is a good name for your measure because you know what it means, when you use this measure in a specific matrix, you might want to rename it. You can do this by selecting the matrix, going to the Values section on the right-hand side of the screen, and double-clicking the measure name you want to change. The name changes just for the particular visual that is selected (the matrix in this case).</p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">After giving your measures new names, did you end up with something like the matrix shown below?</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000265.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>If you change the description of a measure in the matrix, the easiest way to change it back is to remove the measure from the visual and then add it back again. However, when you do this, you lose any conditional formatting.</p>
		</div>
	</div>


<div id="calibre_link-50" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-427" class="ch"><span class="b2"><a id="calibre_link-18"></a>15: DAX Topic: </span><span class="b2"><a id="calibre_link-218"></a></span><span class="b2">FILTER()</span></p>
			<p class="normal"><span class="mono">FILTER()</span> is a very powerful table function in DAX. As you’ve seen in the last two chapters, the primary purpose of a table function is to allow you to create and use a virtual table inside your measures. It’s not the only use, but it is the most common use of table functions in DAX. These virtual tables are super useful because you get all the benefits of a new table without actually having to materialise it in your physical model. When <span class="mono">FILTER()</span> and <span class="mono">CALCULATE()</span> are combined, these two functions allow you to alter the filter behaviour (aka filter context) in your formulas any way you want. Before we move to using <span class="mono">FILTER()</span> within <span class="mono">CALCULATE()</span>, I think it is worth looking at a couple of concepts that illustrate how <span class="mono">FILTER()</span> works.</p>
			<p class="normal">The syntax of <span class="mono">FILTER()</span> is as follows:</p>
			<p class="code"><span class="mono1">= FILTER(</span><span class="monoitalic">Table</span><span class="mono1">, </span><span class="monoitalic">myFilter</span><span class="mono1">)</span></p>
			<p class="normal">The first parameter, <span class="monoitalic1">Table</span>, is any table from your model, or a function that returns a table, such as <span class="mono">ALL()</span>. The second parameter, <span class="monoitalic1">myFilter</span>, is any expression that evaluates to a <span class="mono">True</span>/<span class="mono">False</span> answer.</p>
			<p class="normal">The <span class="mono">FILTER()</span> function returns a table that contains zero or more rows from the original table. Stated another way, the table returned by <span class="mono">FILTER()</span> can contain zero rows, one row, two rows, or any other number of rows, up to and including the total number of rows in the original table. The purpose of <span class="mono">FILTER()</span>, therefore, is to determine which rows will be retained in the final table result after you use the <span class="monoitalic1">myFilter</span> test.</p>
			<p class="normal">Technically speaking, <span class="mono">FILTER()</span> is an iterating function; it steps through every row in the table (parameter 1) and evaluates the expression to return <span class="mono">True</span> or <span class="mono">False</span> (parameter 2). But rather than think of <span class="mono">FILTER()</span> as being an iterating function, I want you to think about <span class="mono">FILTER()</span> as working like a calculated column in a table. The next section provides a detailed example and walkthrough to illustrate.</p>
			<p class="h"><span class="b2">FILTER() Is Kind of Like a Calculated Column</span></p>
			<p class="normal">The <span class="mono">FILTER()</span> function behaves kind of like a calculated column. To illustrate the point, let me first step you through a calculated column demo before coming back to <span class="mono">FILTER()</span>. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Switch to the Data view and navigate to the Fields pane.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Add a new column by right-clicking the <span class="mono1">Customers</span> table, selecting New Column, and entering the following:</p>
			<p class="codeindented1"><span class="mono1">Test = Customers[YearlyIncome]</span></p>
			<p class="nlc">As you can see in the image below, this creates a new column that simply stores the value from <span class="mono">Customers[YearlyIncome]</span> in the new <span class="mono">Test</span> column.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000273.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Now modify the formula in the calculated column as follows:</p>
			<p class="codeindented1"><span class="mono1">Test = Customers[YearlyIncome] &gt;= 80000</span></p>
			<p class="normal">This revised version of the calculated column returns <span class="mono">True</span> or <span class="mono">False</span>, depending on the yearly income of each of the customers in the table. I sorted the <span class="mono">Customers</span> table shown below on <span class="mono">CustomerKey</span> so you can see some different results for different yearly incomes in this image.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000281.png" alt="" /></p>
			<p class="normal">Stop and think about this for a moment: I have created a calculated column that returns <span class="mono">True</span> or <span class="mono">False</span> to indicate whether each customer has a yearly income greater than or equal to $80,000. Now that I have this new calculated column, I can use the filter buttons at the top of the column (see #1 below) to filter the entire <span class="mono">Customers</span> table to keep only those that are <span class="mono">True</span> (#2). Note the resulting information (#3) indicating that 4,382 customers have a yearly income of at least $80,000.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000289.png" alt="" /></p>
			<p class="normal">A calculated column is evaluated for every row in the table and returns a result (in this case, <span class="mono">True</span> or <span class="mono">False</span>) for each row.</p>
			<p class="h"><span class="b2">Using FILTER() Instead of a Calculated Column</span></p>
			<p class="normal">You can think of <span class="mono">FILTER()</span> behaving in exactly the same way as the calculated column example above. <span class="mono">FILTER()</span> starts with a virtual copy of a table (the first parameter) and then conceptually creates a new virtual calculated column that returns <span class="mono">True</span> or <span class="mono">False</span> inside that new virtual table (the second parameter). Once the virtual column has been created, <span class="mono">FILTER()</span> uses that column to filter only the rows of the table that return <span class="mono">True</span>, just as demonstrated above. Finally, <span class="mono">FILTER()</span> returns a virtual filtered copy of the original table that contains just the rows that evaluate to <span class="mono">True</span>.</p>
			<p class="normal">The big advantage of the <span class="mono">FILTER()</span> function compared to the calculated column option illustrated above is that <span class="mono">FILTER()</span> does not materialise the extra columns needed to complete the task. The columns it needs are created (conceptually at least) at runtime, in memory. The virtual column is used by <span class="mono">FILTER()</span> and then released once it has been used.</p>
			<p class="normal">Now that you understand that <span class="mono">FILTER()</span> is kind of like a calculated column, let me show you the equivalent action using the actual <span class="mono">FILTER()</span> function. Oh, but wait! <span class="mono">FILTER()</span> is a table function, and you cannot write standalone table functions in a measure, right? Just as you can’t use naked columns inside a measure, you can’t use naked tables; it’s not allowed. A measure must return a value of some type, and it can’t return a column or a table. To help you understand this, the next section takes another detour and shows the use of the New Table button again.</p>
			<p class="h"><span class="b2">The New Table Button Strikes Again</span></p>
			<p class="normal">When you see a <span class="mono">FILTER()</span> function, you should try to conceptualise that <span class="mono">FILTER()</span> takes a virtual copy of the <span class="mono">Customers</span> table, generates a new <span class="mono">True</span>/<span class="mono">False</span> virtual column (the second parameter), filters the new table using the new column to keep the values that are <span class="mono">True</span>, and removes the <span class="mono">True</span>/<span class="mono">False</span> column, leaving just the filtered rows in the new virtual table. To help you conceptualise this, this example shows how to use the New Table button again to actually materialise the virtual table. To “see” the <span class="mono">FILTER()</span> function version of the calculated column from above, you can create a new table by using the following formula:</p>
			<p class="code"><span class="mono1">Customers &gt; 80000 Table =</span></p>
			<p class="code"><span class="mono1">    FILTER(Customers, Customers[YearlyIncome] &gt;= 80000)</span></p>
			<p class="normal">If you add this formula as a new table in Power BI and then switch to this new table in the Data view, you can “see” the table and check how many rows there are in the new table. As shown below, it is indeed a filtered copy of the original <span class="mono">Customers</span> table that contains exactly the same number of rows (and columns) as before.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000297.png" alt="" /></p>
			<p class="normal">Remember that I have materialised this table to show you what happens. What is great about <span class="mono">FILTER()</span> <br class="calibre8" />is that you don’t need to create the table for it to work; you can use it as a virtual table inside a measure without ever having to materialise the table at all.</p>
			<p class="h"><span class="b2">Using </span><span class="b2"><a id="calibre_link-220"></a></span><span class="b2">FILTER() Inside a Measure</span></p>
			<p class="normal">This section shows how to use <span class="mono">FILTER()</span> inside a measure. Go to a new report page and set up a new matrix with <span class="mono">Customers[Occupation]</span> on Rows and the measure <span class="mono">[Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers]</span> on Values. The matrix, shown below, indicates how many customers there are in the entire customer database for each occupation type.</p>
			<p class="fp"><img class="_idgenobjectattribute106" src="images/000305.png" alt="" /></p>
			<p class="normal">Now you can write a measure that uses the <span class="mono">FILTER()</span> function to determine how many customers in the database have an income of more than $80,000 per year. Here is the <span class="mono">FILTER()</span> function you used to find this information earlier:</p>
			<p class="code"><span class="mono1">= FILTER(Customers, Customers[YearlyIncome] &gt;= 80000)</span></p>
			<p class="normal">Remember that you can’t use a table function (i.e., a naked table) in a measure unless it is wrapped inside another function. You know from the examples above that this <span class="mono">FILTER()</span> function returns a table that contains the customers who have a yearly income greater than or equal to $80,000, but you can’t use it inside a measure unless you wrap it inside another function. <span class="mono">FILTER()</span> is a table function, so you can wrap it inside a <span class="mono">COUNTROWS()</span> function, as shown here, to count the rows in the resulting table:</p>
			<p class="code"><span class="mono1">Total Customers with Income of $80,000 or above Measure =</span></p>
			<p class="code"><span class="mono1">    COUNTROWS(</span></p>
			<p class="code"><span class="mono1">        FILTER(Customers, Customers[YearlyIncome] &gt;= 80000)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">The result of the <span class="mono">FILTER()</span> portion of this measure is a new virtual table of customers that includes all the customers who have yearly income greater than or equal to $80,000. The <span class="mono">COUNTROWS()</span> function then counts the number of rows in this virtual <span class="mono">FILTER()</span> table, so it converts the table itself into a count of customers in the table. When you place this measure in the matrix, it looks as shown below. You should create this measure now for practice.</p>
			<p class="fp"><img class="_idgenobjectattribute107" src="images/000314.png" alt="" /></p>
			<p class="h"><span class="b2">FILTER() Respects the Initial Filter Context</span></p>
			<p class="normal">You can see from the matrix above that not all occupations have customers that earn at least $80,000 per year. Both clerical and manual occupations return blank in the visual above. This highlights a very important concept that is easy to miss, so focus as I explain it to you!</p>
			<p class="normal">The <span class="mono">FILTER()</span> portion of the measure above is as follows:</p>
			<p class="code"><span class="mono1">FILTER(Customers, Customers[YearlyIncome] &gt;= 80000)</span></p>
			<p class="normal">The first parameter of the <span class="mono">FILTER()</span> function is the table <span class="mono">Customers</span>. But it may not be the entire <span class="mono">Customers</span> table, depending on the circumstances. The first parameter of the <span class="mono">FILTER()</span> function respects the initial filter context coming from the visual. This is important, so let me say it again: The first parameter of the <span class="mono">FILTER()</span> function respects the initial filter context coming from the visual. </p>
			<p class="normal">In the <span class="mono">FILTER()</span> portion of the formula above, it is not the entire <span class="mono">Customers</span> table passed to <span class="mono">FILTER()</span> but a filtered copy of the <span class="mono">Customers</span> table, filtered by the rows in the matrix. This explains why the first row in the table below returns blank for the new measure.</p>
			<p class="fp"><img class="_idgenobjectattribute108" src="images/000322.png" alt="" /></p>
			<p class="normal">The first row of the matrix above is evaluated as follows:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>The matrix visual places a filter on <span class="mono1">Customers[Occupation] = "Clerical"</span>. As a result, the <span class="mono1">Customers</span> table is now filtered to the 2,928 rows that are clerical customers.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>The first parameter of <span class="mono1">FILTER()</span> therefore receives a filtered copy of the <span class="mono1">Customers</span> table, filtered for <span class="mono1">Customers[Occupation] = "Clerical"</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Before <span class="mono1">FILTER() </span>even starts to do its stuff, the <span class="mono1">Customers</span> table has already been filtered by the visual. Instead of the first parameter (the table) having 18,484 rows, it actually has only 2,928 rows because it is already filtered for clerical customers.</p>
			<p class="h"><span class="b2">Key Points to Remember</span></p>
			<p class="normal">These are the key points to take away from the examples above:</p>
			<ul class="calibre2">
				<li class="bl"><span class="mono">FILTER()</span> returns a table. It is a virtual table, and hence you can’t see it.</li>
				<li class="bl">You can think of <span class="mono">FILTER()</span> as operating like a calculated column inside a table&mdash;but better. It is better because it can do everything a calculate column can do (in this case) but doesn’t need to materialise a new column into the table. In Power BI, fewer columns is always better.</li>
				<li class="bl">You can materialise a <span class="mono">FILTER() </span>function by using the New Table option if you want to see how it works.</li>
				<li class="bl">The virtual table returned by <span class="mono">FILTER()</span> has a virtual relationship to its source; this is called lineage. The virtual table and virtual relationship behave in the same way that physical tables and relationships behave.</li>
				<li class="bl">The virtual table returned by <span class="mono">FILTER()</span> can be used inside a measure without the need to materialise the table at all.</li>
				<li class="bl">Materialising can be a great technique to help you visualise what is going on in DAX. You should materialise tables in order to learn and comprehend, but you should not leave such tables in your model. Delete them when you are done using them.</li>
				<li class="bl">You can’t use table functions (naked tables) on their own inside measures; they must be used inside other functions so that they return single values. In the example above, for example, I used <span class="mono">COUNTROWS()</span> to count the rows in the table.</li>
			</ul>
			<p class="h"><span class="b2">A Caution Related to Using FILTER()</span></p>
			<p class="normal">Generally, it is fine to use <span class="mono">FILTER()</span> on lookup tables, but it’s somewhat riskier to use it on data tables, particularly if they are very large (with hundreds of millions of rows). Where to use <span class="mono">FILTER()</span> depends on your data, on the quality of your DAX formulas inside <span class="mono">FILTER()</span>, and on what you need to achieve. You will increase your depth of understanding with practice and experience. When you have a choice, aim to use <span class="mono">FILTER()</span> on the smallest table possible to keep your formulas working efficiently.</p>
			<p class="h"><a id="calibre_link-219"></a><span class="b2">FILTER() Inside CALCULATE()</span></p>
			<p class="normal">As mentioned at the start of this chapter, <span class="mono">FILTER()</span> is most commonly used as a table filter parameter inside <span class="mono">CALCULATE()</span>. <span class="mono">FILTER()</span> is a table function that operates over every row in a table to determine which rows to retain. <span class="mono">FILTER()</span> therefore allows a very granular level of evaluation of a table and is a very powerful tool for altering the filter context of a visual any way you want and at a level of detail, which is not always possible by using a simple filter inside <span class="mono">CALCULATE()</span>.</p>
			<p class="normal">Consider the following measure formula:</p>
			<p class="code"><span class="mono1">Total Customers with Income of $80,000 or above 2 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        Customers[YearlyIncome] &gt;= 80000</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">This measure formula returns exactly the same result as the <span class="mono">COUNTROWS(FILTER())</span> version above. In this <span class="mono">CALCULATE()</span> version, the filter portion of the formula uses a simple filter. A simple filter has a column name on one side of the formula (in this case, <span class="mono">Customers[YearlyIncome]</span>) and a value on the right side (in this case, <span class="mono">80000</span>).</p>
			<p class="normal"><span class="mono">CALCULATE()</span> is designed to accept this type of simple syntax without using the <span class="mono">FILTER()</span> function. But in reality, this is just another example of syntax sugar that makes it easier for you to write measures. Under the hood, the formula using the simple syntax above is converted to the following formula:</p>
			<p class="code"><span class="mono1">Total Customers with Income of $80,000 Under the Hood =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        FILTER(</span></p>
			<p class="code"><span class="mono1">            ALL(Customers[YearlyIncome]),</span></p>
			<p class="code"><span class="mono1">            Customers[YearlyIncome] &gt;= 80000</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">Note the inclusion of <span class="mono">ALL(Customers[YearlyIncome])</span> instead of just <span class="mono">Customers</span> as the first parameter of the <span class="mono">FILTER()</span> function. In Chapter 16 I provide more details on why the <span class="mono">ALL()</span> function is used here.</p>
			<p class="normal">There is a limit to what <span class="mono">CALCULATE()</span> can do with a simple filter. It works only if you have a column name compared to a value. But what if you want to do something more complex? Let’s look at another example.</p>
			<p class="h"><span class="b2">Example: Calculating </span><span class="b2"><a id="calibre_link-260"></a></span><span class="b2">Lifetime Customer Purchases</span></p>
			<p class="normal">Say that you want to know how many customers have purchased more than $5,000 of goods from you over all time. You can’t use the simple filter syntax inside <span class="mono">CALCULATE()</span> in such a case because customers may have purchased from you on many occasions, and you don’t have a column that contains a single value that contains the total sales for each customer over all time. If you tried to write this formula using a simple filter, it would look like this:</p>
			<p class="code"><span class="mono1">Customers with Sales Greater Than $5,000 Doesn't Work =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(COUNTROWS(Customers), [Total Sales] &gt; 5000)</span></p>
			<p class="normal">The second parameter of this <span class="mono">CALCULATE()</span> function is:</p>
			<p class="code"><span class="mono1">[Total Sales] &gt; 5000</span></p>
			<p class="normal">This second parameter has a measure on the left side and a value on the right&mdash;and this is not allowed with a simple filter. A simple filter must have a column compared to a value, so a simple filter doesn’t work in this scenario.</p>
			<p class="normal">In this case, you cannot use the simple filter syntax for <span class="mono">CALCULATE()</span>; you simply must use a table function for the filter parameter instead. The following section shows how to use the <span class="mono">FILTER()</span> function as the filter parameter. (It’s a bit confusing, I know.)</p>
			<p class="h"><span class="b2">Simple Filter Syntax vs. Table Filter Syntax</span></p>
			<p class="normal">As long as you are comparing a column to a value, you can use the simple syntax inside <span class="mono">CALCULATE()</span>. If you keep it simple, <span class="mono">CALCULATE()</span> is able to handle simple filtering just fine. But as soon as you get more complex than comparing a column to a value, <span class="mono">CALCULATE()</span> can’t do it on its own, and it needs help. In such a case, <span class="mono">CALCULATE()</span> calls in the big guns and gets its friend <span class="mono">FILTER()</span> to help out with the more complex formula. <span class="mono">CALCULATE()</span> delegates to the <span class="mono">FILTER()</span> function the job of working out which rows to keep. <span class="mono">FILTER()</span> does the work and provides the filtered table back to <span class="mono">CALCUATE()</span>. The two functions work well together like this.</p>
			<p class="normal">The formula above does not work with the simple syntax, but you can rewrite it as follows with table filter syntax:</p>
			<p class="code"><span class="mono1">Customers with Sales Greater Than $5,000 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(</span></p>
			<p class="code"><span class="mono1">        COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        FILTER(Customers, [Total Sales] &gt;= 5000)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">It is worth understanding how <span class="mono">FILTER()</span> works in this example because there is a slight difference from the earlier example that involved <span class="mono">Customers[YearlyIncome]</span> <span class="mono">&gt;=</span> <span class="mono">80000</span>.</p>
			<p class="normal">The <span class="mono">FILTER()</span> portion of the <span class="mono">CALCULATE()</span> function is evaluated first. With <span class="mono">CALCULATE()</span>, the filter portion is always evaluated first (for both simple filters and table filters).</p>
			<p class="normal">Let’s start by looking at just the <span class="mono">FILTER()</span> portion of the above formula:</p>
			<p class="code"><span class="mono1">FILTER(Customers, [Total Sales] &gt;= 5000)</span></p>
			<p class="normal">I am going to use the same calculated column approach I used earlier in this chapter to help you see what <span class="mono">FILTER()</span> does here. Remember that you can think of <span class="mono">FILTER()</span> as creating a calculated column in the table of choice. (Thinking about it this way will help you understand what’s happening.)</p>
			<p class="normal">In the image below, I have added to the <span class="mono">Customers</span> table the new calculated column <span class="mono">Test</span> <span class="mono">=</span> <span class="mono">[Total</span> <span class="mono">Sales]</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000330.png" alt="" /></p>
			<p class="normal">Here you can see that Deanna Munoz has sales of $8,333.02, Hanna Long has sales of $41.28, etc. Intuitively, you should feel very comfortable with this calculated column because it works as expected. But if you think more deeply about this, you see that there is actually a lot going on here. The measure <span class="mono">[Total</span> <span class="mono">Sales]</span> contains the following formula:</p>
			<p class="code"><span class="mono1">Total Sales = SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">This measure is adding up the <span class="mono">ExtendedAmount</span> column in the <span class="mono">Sales</span> table, but the calculated column is not in the <span class="mono">Sales</span> table; it is in the <span class="mono">Customers</span> table. This formula works exactly as you would expect, but the reason it works is quite complex. You need to learn why it works if you want to be a DAX superhero.</p>
			<p class="h"><span class="b2">Context Transition Revisited</span></p>
			<p class="normal">To see what I mean when I say there is a lot going on here, go back to the calculated column above and replace the measure <span class="mono">[Total</span> <span class="mono">Sales]</span> with the formula <span class="mono">SUM(Sales[ExtendedAmount])</span>. When you do this, you get the result shown below&mdash;which is probably not what you expect!</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000338.png" alt="" /></p>
			<p class="normal">Why does <span class="mono">[Total</span> <span class="mono">Sales]</span> return the total sales of the customer when <span class="mono">SUM(Sales[ExtendedAmount])</span> does not?</p>
			<p class="normal"><span class="b3">This is very important: </span>This occurs because of an implicit <span class="mono">CALCULATE()</span> inside the measure <span class="mono">[Total</span> <span class="mono">Sales]</span>. The hidden <span class="mono">CALCULATE()</span> inside a measure causes context transition: The row context from the calculated column is converted to an equivalent filter context. Because of the context transition, the single row in the <span class="mono">Customers</span> table is converted into a filter, and this filter then propagates down through the relationship from the <span class="mono">Customers</span> table to the <span class="mono">Sales</span> table and, hence, the <span class="mono">Sales</span> table is filtered, too. Only sales for this one customer remain in the filtered state when the measure is evaluated. If you use the formula <span class="mono">SUM(Sales[ExtendedAmount])</span> in the calculated column instead of using a measure in the calculated column, there is no <span class="mono">CALCULATE()</span>, either implicit or explicit. Do you remember this from the end of Chapter 11? (Go back and read it again if you need to brush up.)</p>
			<p class="normal">This is the original calculated column:</p>
			<p class="code"><span class="mono1">Test = [Total Sales]</span></p>
			<p class="normal">You turn this into a <span class="mono">True</span>/<span class="mono">False</span> expression, as follows:</p>
			<p class="code"><span class="mono1">Test = [Total Sales] &gt;=5000</span></p>
			<p class="normal">After you make this change, the table looks as shown in the image below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000346.png" alt="" /></p>
			<p class="normal">You can now see the new calculated column that returns either <span class="mono">True</span> (for sales of $5,000 or more) or <span class="mono">False</span> for each customer. If you put a filter on this new column to keep only the <span class="mono">True</span> customers (see #1 below), you can see that there are 1,732 customers who have sales of at least $5,000 (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000354.png" alt="" /></p>
			<p class="normal">But remember that this is just an illustration to help you learn. This is not really the way to solve this problem as you definitely do not want to create a new column every time you need to do a new calculation. Instead, you need to use <span class="mono">FILTER()</span>. <span class="mono">FILTER()</span> is a function that can add a virtual calculated column to any table without the need to materialise the new column.</p>
			<p class="normal">Here is the full <span class="mono">FILTER()</span> version of the measure again:</p>
			<p class="code"><span class="mono1">Customers with Sales Greater Than $5,000 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(</span></p>
			<p class="code"><span class="mono1">        COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        FILTER(Customers, [Total Sales] &gt;= 5000)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">This formula works as follows:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>The <span class="mono1">FILTER()</span> function creates a new virtual table with a virtual <span class="mono1">True</span>/<span class="mono1">False</span> calculated column.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>The <span class="mono1">FILTER()</span> function applies a filter to keep only the values that are <span class="mono1">True</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span><span class="mono1">FILTER()</span> returns the filtered virtual table so that <span class="mono1">CALCULATE()</span> can use it to filter the model. You can’t see the table, but you can simulate how it works by using the calculated column technique shown earlier or by using the New Table button to materialise the <span class="mono1">FILTER()</span> portion of a formula.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>When <span class="mono1">CALCULATE()</span> is finished with the filtered virtual table, the virtual table is released from memory.</p>
			<p class="normal">Using the <span class="mono">FILTER()</span> function inside <span class="mono">CALCUATE()</span> means there is no permanent storage of new tables or new columns to clog up the data model.</p>
			<p class="h1"><span class="b2">Practice Exercises: FILTER()</span></p>
			<p class="normal">Set up a new matrix with <span class="mono">Products[Category]</span> on Rows and <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values and then write the following two formulas. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="note"><span class="b1">Note: </span>You can simulate what is happening by adding some test calculated columns to the physical tables in your model if you like.</p>
			<p class="h2"><span class="bi">59. [Total Sales of Products That Have Some Sales but Less Than $10,000]</span></p>
			<p class="normal">What you need to do here is use <span class="mono">FILTER()</span> to filter the <span class="mono">Products</span> table to determine whether each product has some sales and also whether the total of those sales is less than $10,000.</p>
			<p class="normal">Note that you can use the double ampersand operator (<span class="mono">&amp;&amp;</span>) as follows if you need more than one condition in your filter expression:</p>
			<p class="code"><span class="monoitalic">Condition1</span><span class="mono1"> &amp;&amp; </span><span class="monoitalic">Condition2</span></p>
			<p class="normal">Alternatively, you can use two separate <span class="mono">FILTER()</span> functions.</p>
			<p class="h2"><span class="bi">60. [Count of Products That Have Some Sales but Less Than $10,000]</span></p>
			<p class="normal">You should end up with a matrix like the one below.</p>
			<p class="fp"><img class="_idgenobjectattribute109" src="images/000003.png" alt="" /></p>
			<p class="normal">Next, add the <span class="mono">ProductName</span> column to Rows in the matrix (see #1 below) and then drill down (#2). Remove <span class="mono">[Total</span> <span class="mono">Sales]</span>. You can see from doing this how useful and flexible such measures can be in a model.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000010.png" alt="" /></p>
			<p class="h"><span class="b2">More on Context Transition</span></p>
			<p class="normal">Context transition is covered in Chapter 11 and again earlier in this chapter, in relationship to using calculated columns to simulate how the <span class="mono">FILTER()</span> function works. The concept of context transition is hard to learn, and it is especially difficult to understand when it occurs inside a virtual table like <span class="mono">FILTER()</span> because you can’t see what is happening. This section walks through the process.</p>
			<p class="normal">The <span class="mono">FILTER()</span> measure from earlier in this chapter is as follows:</p>
			<p class="code"><span class="mono1">Customers with sales greater than $5,000 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        FILTER(Customers, [Total Sales] &gt;= 5000)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">The measure <span class="mono">[Total</span> <span class="mono">Sales]</span> contains the following formula:</p>
			<p class="code"><span class="mono1">[Total Sales] = SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">If you substitute <span class="mono">SUM(Sales[ExtendedAmount])</span> for <span class="mono">[Total</span> <span class="mono">Sales]</span> in the original formula above, you get the following:</p>
			<p class="code"><span class="mono1">Customers with sales greater than $5,000 Version2 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        FILTER(Customers, SUM(Sales[ExtendedAmount]) &gt;= 5000)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">You should go ahead and create this formula so it is clear what is happening. The following image shows both versions of the formula placed in a matrix.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000018.png" alt="" /></p>
			<p class="normal">The new formula returns all customers in the table instead of the correct number of customers with sales of at least $5,000. This is because of the hidden implicit <span class="mono">CALCULATE()</span> that has been mentioned a few times already. Technically speaking, when you write the following measure:</p>
			<p class="code"><span class="mono1">Total Sales = SUM(Sales[ExtendedAmount])</span></p>
			<p class="normal">what is actually happening under the hood is the following formula:</p>
			<p class="code"><span class="mono1">Total Sales = CALCULATE(SUM(Sales[ExtendedAmount]))</span></p>
			<p class="normal">Power BI adds a hidden <span class="mono">CALCULATE()</span> function and wraps it around every measure formula you write. You can’t see this <span class="mono">CALCULATE()</span>, but it is there. We call this “invisible” <span class="mono">CALCULATE()</span> an implicit <span class="mono">CALCULATE()</span>.</p>
			<p class="normal">Okay, let’s get back to the problem at hand: Go back into the new measure you just created and wrap the <span class="mono">SUM()</span> function inside <span class="mono">CALCULATE()</span> as follows:</p>
			<p class="code"><span class="mono1">Customers with Sales Greater Than $5,000 Version2 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        FILTER(Customers,</span></p>
			<p class="code"><span class="mono1">            CALCULATE(SUM(Sales[ExtendedAmount])) &gt;= 5000</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">When you manually place <span class="mono">CALCULATE()</span> like this, it is called an explicit <a id="calibre_link-137" class="calibre3"></a><span class="mono">CALCULATE()</span>. When you make this change, you get an expected result, as shown below.</p>
			<p class="note"><span class="b1">Note: </span>In this image, I have swapped the column <span class="mono1">Products[Category]</span> with <span class="mono1">Territories[Country]</span> to show an alternate view of the data. The measures work regardless of which column you have on Rows in the matrix.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000026.png" alt="" /></p>
			<p class="normal">The point is that without the <span class="mono">CALCULATE()</span> function wrapped around <span class="mono">SUM(Sales[ExtendedAmount])</span>, something stops working. It doesn’t matter if there is an implicit <span class="mono">CALCULATE()</span> that you can’t see (inside another measure) or if there’s an explicit <span class="mono">CALCULATE()</span> that you add yourself. You simply must have a <span class="mono">CALCULATE()</span> if you want this formula to work.</p>
			<p class="normal">Remember that I said in Chapter 11 that row context does not automatically create filter context. In that case, I was talking about the row context in a calculated column, but as you now know, it is exactly the same in the <span class="mono">FILTER()</span> function. If you don’t have this extra <span class="mono">CALCULATE()</span>, the filter that is first applied to the <span class="mono">Customers</span> table will not propagate to the <span class="mono">Sales</span> table as described above. It is the second <span class="mono">CALCULATE()</span> (either implicit or explicit) that causes the filter on the <span class="mono">Customers</span> table to propagate through the relationship to the <span class="mono">Sales</span> table before the rest of the <span class="mono">FILTER()</span> expression is evaluated for each row in the table.</p>
			<p class="note"><span class="b1">Note:</span> The only way to make this formula work is if you use a second <span class="mono1">CALCULATE()</span> function (implicit or explicit) wrapped around <span class="mono1">SUM(Sales[ExtendedAmount])</span>. This topic can take some time to get your head around and often doesn’t really sink in until you have some real-world experience. If you are not getting it, don’t worry. Just remember that sometimes an extra <span class="mono1">CALCULATE()</span> can make the difference between a formula working and not working as expected. When you are good and ready, I recommend that you reread Chapter 11 and this chapter, working the examples along the way, until the idea is clear in your mind.</p>
			<p class="h"><a id="calibre_link-383"></a><span class="b2">Virtual Table Lineage Revisited</span></p>
			<p class="normal">I introduced the topic of lineage and visualising virtual tables in Chapter 13. I revisit the concept here to cement the learning.</p>
			<p class="normal">Let’s jump back to the version of the measure we’ve been working on in this chapter:</p>
			<p class="code"><span class="mono1">Customers with Sales Greater Than $5,000 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE(COUNTROWS(Customers),</span></p>
			<p class="code"><span class="mono1">        FILTER(Customers, [Total Sales] &gt;= 5000)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">I recommend that you think about the new table returned by <span class="mono">FILTER()</span> in the above formula as being a virtual table in your model. A virtual table created by a table function in DAX retains a link to the rest of the data model; this is called lineage. I like to visualise an imaginary temporary table being created above the real table in the data model, as illustrated below.</p>
			<p class="fp"><img class="_idgenobjectattribute110" src="images/000034.png" alt="" /></p>
			<p class="normal">This new temporary table contains a subset of rows, as determined by <span class="mono">FILTER()</span>, but, importantly, it has a relationship back to the original table (lineage). Therefore, when this new temporary table is used inside <span class="mono">CALCULATE()</span> (as is the case here), <span class="mono">CALCULATE()</span> propagates the filters from the filtered copy of the table through the relationships, and any other tables that are connected downstream are filtered, too.</p>
			<p class="normal">Remember that the image above is just an illustration of what is happening under the hood. The imaginary table is never materialised, and you can’t see it, but it behaves as if it were part of the data model, as illustrated here.</p>
			<p class="note"><span class="b1">Note: </span>Don’t confuse lineage as described here with what happens when you use the New Table button in Power BI. The concept of lineage applies only with virtual tables used inside DAX formulas such as measures and calculated columns. At the end of the execution of a DAX formula, a virtual table ceases to exist, and the lineage is gone. On the other hand, the New Table button creates a new (physical) table that is stored in the data model. This new table does not retain lineage to the table it came from. If you want a table created by using the New Table button to filter your data model, you need to connect the new table by creating a physical relationship in the physical model.</p>
		</div>
	</div>


<div id="calibre_link-51" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-428" class="ch"><span class="b2"><a id="calibre_link-19"></a>16: DAX Topic: </span><span class="b2"><a id="calibre_link-371"></a></span><span class="b2">Time Intelligence</span></p>
			<p class="normal">Time intelligence is a very important and powerful feature in DAX. Time intelligence refers to the ability to write formulas that refer to time periods that are not part of a visual without needing to change the date filters. Consider the following matrix, which shows sales for the year 2018.</p>
			<p class="fp"><img class="_idgenobjectattribute111" src="images/000042.png" alt="" /></p>
			<p class="normal">What if you wanted to see the sales for the prior year (2017) as well as the change in sales compared to the prior year? You could, of course, change the filter to see the sales for 2017, or you could place <span class="mono">CalendarYear</span> on Columns and then filter out the years that you are not interested in, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute112" src="images/000050.png" alt="" /></p>
			<p class="normal">But doing it this way may not be the best approach; you can’t get the same result in other matrixes without repeating the process, and besides, you can’t calculate the change compared to the prior year this way.</p>
			<p class="h"><span class="b2">Using Time Intelligence Functions</span></p>
			<p class="normal">The general approach for time intelligence functions is to create measures that operate relative to a point in time. As an example, a measure such as <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">Last</span> <span class="mono">Year]</span> would show the sales from last year compared to a point in time: the year you have selected in the visual. Relative time intelligence functions are very useful as you can display the comparison periods without having to change the date selections in the matrix. This makes everything easier to do, and it also means you can build visuals, like the one shown below, that would not otherwise be possible.</p>
			<p class="fp"><img class="_idgenobjectattribute113" src="images/000059.png" alt="" /></p>
			<p class="normal">The DAX language includes many inbuilt time intelligence functions, and you can also write custom time intelligence functions of your own when needed. There are almost infinite use cases for time intelligence, and it would be impracticable for the inbuilt functions to cater to every single use case. The inbuilt time intelligence functions therefore work only under certain circumstances. Here are a few of the rules for using inbuilt time intelligence functions:</p>
			<ul class="calibre2">
				<li class="bl">You must have a <a id="calibre_link-147" class="calibre3"></a><span class="mono">Calendar</span> table that contains a contiguous range of dates that covers every day in the period you are analysing.</li>
				<li class="bl">The <span class="mono">Calendar</span> table must be at the day level of granularity.</li>
				<li class="bl">Every date must exist once and only once in the <span class="mono">Calendar</span> table.</li>
				<li class="bl">You can’t skip any dates. (For example, you can’t skip weekend dates just because your data doesn’t include weekends.)</li>
				<li class="bl">The <span class="mono">Calendar</span> table must start at the beginning of the year of your first data point and extend to the end of the year of your last data point.</li>
				<li class="bl">Inbuilt time intelligence works only on a standard calendar (where the months are January, February, etc.).</li>
				<li class="bl">You can customize a standard calendar for different financial years. (For example, you can set the end date for a calendar to be June 30 or any other date instead of December 31.)</li>
			</ul>
			<p class="normal">If for some reason these rules can’t be met (e.g., if you have an ISO calendar, a 445 calendar, a weekly calendar, etc.), you can’t use the inbuilt time intelligence functions to extract the results. If inbuilt time intelligence won’t work in a particular situation, you can instead write your own custom time intelligence functions from scratch, typically using <span class="mono">CALCULATE()</span> and <span class="mono">FILTER()</span>. The DAX for this tends to be a bit complex, but don’t worry, you can learn it, and I explain it later in this chapter.</p>
			<p class="h"><span class="b2">Nonstandard Calendars</span></p>
			<p class="normal">In some cases, you may need to use a <a id="calibre_link-294" class="calibre3"></a>nonstandard calendar for your reports. A standard calendar would not work in situations like the following:</p>
			<ul class="calibre2">
				<li class="bl">When you are building a data model using weekly or monthly data, so you use a weekly or monthly calendar instead of a daily calendar.</li>
			</ul>
			<p class="note"><span class="b1">Note:</span> You could load your weekly or monthly data and still use a daily calendar&mdash;and this would work with inbuilt time intelligence as long as all the other criteria were still met. To make it work, your weekly or monthly data would use a single date to represent the time period (e.g., end-of-week date, end-of-month date), and you would then join this date to the standard <span class="mono1">Calendar</span> table. I consider this to be a hack and not best practice, but it can work. I recommend that you instead learn to do it properly, using custom time intelligence, as described later in this chapter.</p>
			<ul class="calibre2">
				<li class="bl">If you use an ISO or <a id="calibre_link-108" class="calibre3"></a>445 calendar for your accounting periods. This is very common in the retail industry, where businesses want to have regular trading periods with full weeks from Monday to Sunday. In a 445 calendar, there are 2 months that consist of 4 calendar weeks followed by 1 month with 5 calendar weeks. This helps smooth the months so they all start on a Monday and finish on a Sunday (for example) while also having 91 days in each quarter (91 × 4 quarters = 364 days).</li>
				<li class="bl">With <a id="calibre_link-107" class="calibre3"></a>13 4-week periods instead of calendar months.</li>
				<li class="bl">With a calendar that uses times as well as dates (e.g., an hourly calendar).</li>
			</ul>
			<p class="normal">There are so many variations that it is impossible to mention them all here, and it is also impossible for Power BI to cater to every possibility with inbuilt functions. So the rule is, if you have a standard calendar, you can use the inbuilt functions. If you don’t have a standard calendar, you need to write your own custom time intelligence using <span class="mono">CALCULATE()</span> and <span class="mono">FILTER()</span>.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-86"></a>Here’s How: Turning Off </span><span class="b2"><a id="calibre_link-123"></a></span><span class="b2">Auto Date/Time</span></p>
			<p class="normal">Power BI has a feature called Auto Date/Time that helps beginners report on day, month, quarter, and year periods without the need to load their own calendar table. I personally do not like this feature. It automatically creates a hidden calendar table for every date column in your data. Each calendar table is standalone, which means these calendars don’t work together. In addition, even though these tables are hidden from view, there can be so many of them that they can make your data models very large very quickly. Besides, you are learning to write DAX, so why not learn to do this reporting properly, with a dedicated calendar table? I recommend that you turn off the Auto Date/Time feature. To do so, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Select File, Options and Settings, Options.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Navigate to the Global section and choose Data Load (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Uncheck Auto Date/Time for New Files (#2).</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>If you already have a workbook that has Auto Date/Time turned on, turn it off by going to the Current File section and selecting Data Load (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute114" src="images/000069.png" alt="" /></p>
			<p class="h"><span class="b2">Inbuilt Time Intelligence</span></p>
			<p class="normal">Before using the inbuilt time intelligence functions, you need to ensure that a few prerequisites are covered.</p>
			<p class="h1"><span class="b2">Using a Contiguous Date Range</span></p>
			<p class="normal">In the sample data that you have been working with, the <span class="mono">Calendar</span> table already contains all the days of the year for the period that covers the <span class="mono">Sales</span> table. It is easy to ensure that all the dates are there. Just create a new matrix, put <span class="mono">'Calendar'[CalendarYear]</span> on Rows, and drop any string-based column (such as <span class="mono">MonthName</span>) into the Values section. After adding <span class="mono">MonthName</span> to the Values section (see #1 below), click the drop-down arrow and change the settings so that Values displays <span class="mono">Count</span> <span class="mono">of</span> <span class="mono">MonthName</span> (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000079.png" alt="" /></p>
			<p class="normal">You’re right: I did tell you not to create implicit measures. However, I often use implicit measures when doing quick tests on my data. This is one of those cases where it is fine to use them. Implicit measures are not wrong; it is just that you can’t reuse them inside other formulas, and you have little control over the name and the formatting of an implicit measure. In this case, you don’t need to reuse this measure, so it is fine to use it. As you can see above, this measure shows that the <span class="mono">Calendar</span> table has half a year for 2016 plus a full year for each of the following three years. After confirming the data in the <span class="mono">Calendar</span> table in this way, you can just remove this implicit measure from the visual as you don’t need it anymore.</p>
			<p class="note"><span class="b1">Note:</span> Technically, the rule is that the <span class="mono1">Calendar</span> table should extend to full years covering all the dates in your model. In my experience, you can be a bit loose with this rule and choose not to extend backward and forward to always have complete years. But you do this at your own risk. If you want to be sure your model will work, you should extend your <span class="mono1">Calendar</span> table to cover full years.</p>
			<p class="normal"><span class="b3"><a id="calibre_link-429" class="calibre3"></a><a id="calibre_link-430" class="calibre3"></a></span><span class="b4"><a id="calibre_link-52" class="calibre3"></a>Here’s How: Using </span><span class="b4"><a id="calibre_link-338" class="calibre3"></a></span><span class="b4">SAMEPERIODLASTYEAR()</span></p>
			<p class="normal">Let’s look at an inbuilt time intelligence function you can use to easily write the <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">Last</span> <span class="mono">Year]</span> measure discussed earlier. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Set up your matrix like the one below, with <span class="mono1">'Calendar'[CalendarYear]</span> on Rows and <span class="mono1">[Total</span> <span class="mono1">Sales] </span>on Values.</p>
			<p class="fp"><img class="_idgenobjectattribute115" src="images/000088.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Right-click on the <span class="mono1">Sales </span>table in the Fields pane, select New Measure, and write the following measure:</p>
			<p class="codeindented1"><span class="mono1">Total Sales LY =</span></p>
			<p class="codeindented1"><span class="mono1">    CALCULATE([Total Sales], SAMEPERIODLASTYEAR('Calendar'[Date]))</span></p>
			<p class="nlc">As shown below, if you pause after typing <span class="mono">SAMEPERIODLASTYEAR(</span>, IntelliSense says that this function will return a set of dates in the current selection from the previous year. This is very helpful, indeed! (Remember that IntelliSense is your friend, and it is worth taking the time to read what it says.)</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000095.png" alt="" /></p>
			<p class="nlc">In this case, you should recognise that <span class="mono">SAMEPERIODLASTYEAR()</span> returns a table of values and that the table is being used inside <span class="mono">CALCULATE() </span>as an advanced filter.</p>
			<p class="note"><span class="b1">Note:</span> Notice in the IntelliSense that <span class="mono1">SAMEPERIODLASTYEAR()</span> takes a single <span class="mono1">Dates</span> parameter as its only input. All inbuilt time intelligence functions ask for this <span class="mono1">Dates</span> parameter, and it always refers to the <span class="mono1">Date</span> column in the <span class="mono1">Calendar</span> table.</p>
			<p class="h1"><span class="b2">How Does SAMEPERIODLASTYEAR() Work?</span></p>
			<p class="normal">In Chapter 15 I explained that <span class="mono">CALCULATE()</span> can take a table as an advanced filter input, and you can imagine the new table being connected to the data model. The table inside <span class="mono">CALCULATE()</span> then filters the rest of the tables in the data model (in this case, the <span class="mono">Calendar</span> table and the <span class="mono">Sales</span> table) before <span class="mono">CALCULATE()</span> completes the calculation. It is exactly the same with <span class="mono">SAMEPERIODLASTYEAR()</span>, as shown here:</p>
			<p class="code"><span class="mono1">Total Sales LY =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales], SAMEPERIODLASTYEAR('Calendar'[Date]))</span></p>
			<p class="normal">In this instance, <span class="mono">SAMEPERIODLASTYEAR()</span> returns a table of dates that are the same dates coming from the matrix for the currently selected year, but <span class="mono">SAMEPERIODLASTYEAR()</span> time shifts the original dates back by one year.</p>
			<p class="normal">Consider the cell highlighted in the matrix below. The function <span class="mono">SAMEPERIODLASTYEAR()</span> first reads the filter context from the current matrix to see which dates apply for “this year.” In this case, the filter is on <span class="mono">CalendarYear</span>, and the filter for this cell is 2018 (see #1 below). So the dates for “this year” are all dates from January 1, 2018, through December 31, 2018. The <span class="mono">SAMEPERIODLASTYEAR()</span> function then takes the dates from the current filter context in the matrix, removes the current filters, time shifts the dates back one year, and returns a table of dates from January 1, 2017, through December 31, 2017.</p>
			<p class="fp"><img class="_idgenobjectattribute116" src="images/000103.png" alt="" /></p>
			<p class="normal">You can imagine the new table created by <span class="mono">SAMEPERIODLASTYEAR()</span> as a temporary table sitting above the <span class="mono">Calendar</span> table and retaining a relationship to the original <span class="mono">Calendar</span> table, as shown below. (Remember that this is logically how it works; you can’t actually see this table.)</p>
			<p class="fp"><img class="_idgenobjectattribute17" src="images/000113.png" alt="" /></p>
			<p class="normal">This table is then passed to <span class="mono">CALCULATE()</span>, and <span class="mono">CALCULATE()</span> uses this temporary table and propagates the filters through the relationships in the model. The temporary table (the table of dates from <span class="mono">SAMEPERIODLASTYEAR()</span>) filters the <span class="mono">Calendar</span> table, which then filters the <span class="mono">Sales</span> table before the calculation for <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">LY]</span> is evaluated.</p>
			<p class="tip"><span class="b1">Tip:</span> Read the paragraph above a couple of times if you need to until you have it clearly in your head.</p>
			<p class="h"><span class="b2">Calculating </span><span class="b2"><a id="calibre_link-393"></a></span><span class="b2">Year-to-Date Sales</span></p>
			<p class="normal">A very common business need is to calculate figures on a year-to-date (YTD) basis. Fortunately, there is an inbuilt DAX function for this. Before you write any YTD formula, it is a good idea to set up a matrix that will give you immediate feedback if your formula is performing as expected. As you do, it is important to set up the matrix so that you have a continuous date range. Set up a new matrix like the one shown below before proceeding. Note the filter on <span class="mono">CalendarYear</span> <span class="mono">=</span> <span class="mono">2018</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute117" src="images/000121.png" alt="" /></p>
			<p class="normal">Note that the periods in the matrix are contiguous (i.e., the months of the year 2018). If you didn’t have a filter on <span class="mono">CalendarYear</span> <span class="mono">=</span> <span class="mono">2018</span> but instead had <span class="mono">CalendarYear</span> <span class="mono">=</span> <span class="mono">ALL</span>, the matrix would show the total sales for January across all years, for February across all years, etc. This would not be a contiguous range, and hence the formula would not work.</p>
			<p class="normal">You can right-click on the <span class="mono">Sales</span> table in the Fields pane, select New Measure, and write the following measure:</p>
			<p class="code"><span class="mono1">Total Sales YTD = TOTALYTD([Total Sales], 'Calendar'[Date])</span></p>
			<p class="normal">Then you can apply appropriate formatting to the measure and add the measure to your matrix.</p>
			<p class="normal">When you are done, it is very easy to check whether the formula is working correctly. As shown in the image below, you can add a new slicer (see #1 below), and you can multi-select the months January, February, and March in the slicer by pressing the Ctrl key while clicking these months. You can then compare the value for March YTD (#2) with the summed total of January, February, and March (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute118" src="images/000130.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> Remember that is very important that you test your measures after you write them. As a data modeller, you are responsible for ensuring that the measures you write return the expected results.</p>
			<p class="normal">This is a really good example of the benefit of writing measures in the context of a matrix. The immediate feedback you get allows you to check whether your formula is correct. Once you have written a formula, you can apply some conditional formatting to your matrix, as shown below, to get another visual clue about whether everything is working well.</p>
			<p class="fp"><img class="_idgenobjectattribute119" src="images/000138.png" alt="" /></p>
			<p class="h1"><span class="b2">Practice Exercises: Time Intelligence</span></p>
			<p class="normal">When writing <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">YTD]</span>, you may have noticed from the IntelliSense tooltip that there are two other functions that are very similar to <span class="mono">TOTALYTD()</span>: <span class="mono">TOTALMTD()</span> and <span class="mono">TOTALQTD()</span>. In the following exercises you’ll get some practice using these two functions. Before you complete these two exercises, make sure you set up a matrix like the one below that will give you feedback about whether your formula is correct. Set up the matrix like this:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Place <span class="mono1">CalendarYear</span> and <span class="mono1">MonthName</span> on Filters.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Filter for <span class="mono1">CalendarYear = 2018</span> and <span class="mono1">MonthName = January</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Put <span class="mono1">'Calendar'[DayNumberOfMonth] </span>on Rows.</p>
			<p class="fp"><img class="_idgenobjectattribute120" src="images/000147.png" alt="" /></p>
			<p class="normal">Write formulas for the following measures. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">61. [Total Sales Month to Date]</span></p>
			<p class="h2"><span class="bi">62. [Total Sales Quarter to Date]</span></p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you set up a matrix with suitable values on Rows, as I showed with <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">YTD]</span> earlier in this chapter? Placing <span class="mono">MonthName</span> on rows will not work for Practice Exercise 61. Instead, you need to put a column such as <span class="mono">DayNumberOfMonth</span> in the matrix if you want to be able to see that the formula is working correctly. For Practice Exercise 62, you can place <span class="mono">MonthName</span> on Rows.</p>
			<p class="normal">Your matrixes should look like the ones below after you add the measures.</p>
			<p class="fp"><img class="_idgenobjectattribute121" src="images/000157.png" alt="" /></p>
			<p class="normal">Note that for this matrix, I added a filter that sets <span class="mono">WeekNumberOfYear</span> to <span class="mono">1</span> to show only the values for the first week in January. The total MTD on Day 7 is equal to the total sales for the 7 days.</p>
			<p class="normal">Your <span class="mono">Total</span> <span class="mono">QTD</span> values should look as shown below with the filter on <span class="mono">CalendarYear</span> <span class="mono">=</span> <span class="mono">2018</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute122" src="images/000011.png" alt="" /></p>
			<p class="h"><span class="b2">Changing Financial Year-Ending Dates</span></p>
			<p class="normal">Many of the inbuilt time intelligence functions allow you to specify a different end-of-year date if required to complete the calculation correctly. In such a case, there is an optional parameter where you specify the year-end date, as shown here:</p>
			<p class="code"><span class="mono1">Total Sales FYTD =</span></p>
			<p class="code"><span class="mono1">    TOTALYTD([Total Sales], 'Calendar'[Date], "YearEndDateHere")</span></p>
			<p class="normal">Here’s an example for a financial year ending June 30:</p>
			<p class="code"><span class="mono1">Total Sales FYTD =</span></p>
			<p class="code"><span class="mono1">    TOTALYTD([Total Sales], 'Calendar'[Date], "30/6")</span></p>
			<table id="calibre_link-431" class="note-table">
				<colgroup class="calibre4">
					<col class="calibre5"></col>
				</colgroup>
				<tbody class="calibre6">
					<tr class="note-table1">
						<td class="note-table2">
							<p class="normal"><span class="b3">Note:</span> This example uses a non-U.S. date format. For the U.S. date format, it looks like this:</p>
							<p class="code"><span class="mono1">Total Sales FYTD USA =<br class="calibre7" />    TOTALYTD([Total Sales], 'Calendar'[Date], "6/30")</span></p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="normal">Notice that there is no need to specify a year when referring to the year-end date. It is simply day and month. In my experience, this year-end date can be pretty much any text string you like that clearly communicates the date, such as <span class="mono">"30-Jun"</span> or <span class="mono">"30</span> <span class="mono">June"</span> or even <span class="mono">"June</span> <span class="mono">30"</span>.</p>
			<p class="h1"><span class="b2">Practice Exercises: Time Intelligence, Continued</span></p>
			<p class="normal">Write formulas for the following measures. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">63. [Total Sales FYTD 30 June]</span></p>
			<p class="h2"><span class="bi">64. [Total Sales FYTD 31 March]</span></p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you set up a matrix like the one below? (To make it easier to spot the pattern, you can apply conditional formatting as shown here by selecting Conditional Formatting, Data Bars.)</p>
			<p class="fp"><img class="_idgenobjectattribute123" src="images/000165.png" alt="" /></p>
			<p class="h"><span class="b2">Setting Calendar Columns Not to Aggregate</span></p>
			<p class="normal">If you look at the Fields pane for the <span class="mono">Calendar</span> table, you will find a ∑ (sigma) icon before some column names, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute124" src="images/000191.png" alt="" /></p>
			<p class="normal">The sigma icon indicates that these columns are set to autosummarize. The sigma symbol generically refers to summing, but in Power BI, it can refer to any of the summarization options available. If you select one of the columns with a sigma next to it and navigate to the Column Tools tab (see #1 below), you can change the column behaviour by setting Summarization to Don’t Summarize (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000183.png" alt="" /></p>
			<p class="normal">When you make this change from within the Report view, you must change the columns one at a time. This is tedious, and there is a better way, as explained next.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-87"></a>Here’s How: Changing Summarization for Multiple <br class="calibre7" />Columns at Once</span></p>
			<p class="normal">It is possible to change the default aggregation behaviour of multiple columns all at once. To set all the <span class="mono">Calendar</span> table columns so they do not summarize, complete the following steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Navigate to the Model view (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the Fields pane, right-click on the <span class="mono1">Calendar</span> table (see #2 below) and select Select Columns (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000200.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Expand the Advanced pane under Properties (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>From the Summarize By drop-down menu (see #2 below), select None (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute125" src="images/000208.png" alt="" /></p>
			<p class="normal">This is how you can change the summarization for all the columns at once.</p>
			<p class="note"><span class="b1">Note: </span>There are other things you can do by taking a similar approach in the Model view. For example, you can change the numeric formatting of columns and measures, and you can move columns and measures into subfolders. It is worth doing some exploration while you are here to see what is possible.</p>
			<p class="h"><span class="b2">Practicing with Other Time Intelligence Functions</span></p>
			<p class="normal">There are a lot of inbuilt time intelligence functions, and it’s easy to tell what most of them do. <span class="mono">PREVIOUSMONTH()</span>, <span class="mono">PREVIOUSQUARTER()</span>, and <span class="mono">PREVIOUSDAY()</span>, for example, all return tables of dates referring to the previous period and probably don’t need further explanation. To see how they work, set up a matrix with contiguous months, as shown below, and complete the following practice exercises.</p>
			<p class="fp"><img class="_idgenobjectattribute126" src="images/000216.png" alt="" /></p>
			<p class="h1"><span class="b2">Practice Exercises: Time Intelligence, Continued</span></p>
			<p class="normal">Write the following formulas. Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="tip"><span class="b1">Tip: </span>If you don’t understand how to build any of these measures, go back and reread the section <a href="#calibre_link-52">"Here’s How: Using SAMEPERIODLASTYEAR()" on page 156</a>. The functions in these practice exercises work exactly like <span class="mono1">SAMEPERIODLASTYEAR()</span>.</p>
			<p class="h2"><span class="bi">65. [Total Sales Previous Month]</span></p>
			<p class="normal">Given that the <span class="mono">PREVIOUSMONTH()</span> function returns a table of dates, you need to embed the time intelligence formula inside a <span class="mono">CALCULATE()</span> function.</p>
			<p class="h2"><span class="bi">66. [Total Sales Previous Day]</span></p>
			<p class="normal">You need to set up a suitable matrix that gives you immediate feedback about whether your formula is working. Put <span class="mono">'Calendar'[DayNumberOfMonth]</span> on Rows and make sure you filter for a single month.</p>
			<p class="h2"><span class="bi">67. [Total Sales Previous Quarter]</span></p>
			<p class="normal">As with Practice Exercise 66, you need to set up a suitable matrix for context. You can work out how to do this one yourself.</p>
			<p class="h"><span class="b2">Using the </span><span class="b2"><a id="calibre_link-180"></a></span><span class="b2">DATEADD() Inbuilt Function</span></p>
			<p class="normal">The DAX inbuilt time intelligence function <span class="mono">DATEADD()</span> can be used to give exactly the same results as some of the formulas already covered in this chapter. The following example shows how to use <span class="mono">DATEADD()</span>:</p>
			<p class="code"><span class="mono1">Total Sales Previous Quarter 2 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales], </span></p>
			<p class="code"><span class="mono1">        DATEADD('Calendar'[Date],MAX('Calendar'[Date]),-1,QUARTER)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">The syntax for <span class="mono">DATEADD()</span> can be difficult to understand when you are learning DAX, and the use of <span class="mono">MAX()</span> in the formula can be particularly challenging to grasp, but don’t worry: I cover that next. Many of the functions I have covered so far in this chapter are actually syntax sugar for <span class="mono">DATEADD()</span>. Microsoft developers have really tried hard to provide simple ways of writing DAX, even for those who have minimal knowledge of how the language works. Instead of having to learn about <span class="mono">CALCULATE()</span> and <span class="mono">DATEADD()</span>, you can leverage the power of DAX time intelligence by using simple functions like the ones at the start of this chapter. But <span class="mono">CALCULATE()</span> is lurking under the hood. <span class="mono">CALCULATE()</span> and its cousin <span class="mono">CALCULATETABLE()</span> are the only DAX functions that can change filtering behaviour. If there are changes to filtering and you can’t see a <span class="mono">CALCULATE()</span> in the function, then you are working with a syntax sugar formula. <span class="mono">SAMEPERIODLASTYEAR()</span>, <span class="mono">PREVIOUSMONTH()</span>, <span class="mono">PREVIOUSDAY()</span>, and <span class="mono">PREVIOUSQUARTER()</span> are all syntax sugar versions of the <span class="mono">DATEADD()</span> function.</p>
			<p class="h"><span class="b2">Writing Your Own Time Intelligence Functions</span></p>
			<p class="normal">As mentioned earlier in this chapter, writing your own time intelligence functions is a bit harder than using the inbuilt functions, particularly when you are new to the concepts. When you use an inbuilt time intelligence function, DAX works out the dates needed to complete the time shift for you. When you write your own time intelligence functions, it is up to you to determine how to select the new set of dates required to complete the time shift. When you get the hang of it, you will find it quite straightforward (and that will be a good sign of how much progress you are making in understanding DAX).</p>
			<p class="normal">There are a couple of strange things in the syntax that you need to get your head around before you can fully understand what you’re doing with custom time intelligence. I explain these things now, and you will be writing your own custom time intelligence functions in no time at all.</p>
			<p class="normal">These are the two concepts you need to get your head around:</p>
			<ul class="calibre2">
				<li class="bl">Concept 1: Thinking “whole of table” when thinking about filter context</li>
				<li class="bl">Concept 2: Knowing how to use <span class="mono">MIN()</span> and <span class="mono">MAX()</span></li>
			</ul>
			<p class="normal">The following sections cover these concepts and provide examples that will help you cement what you learn.</p>
			<p class="h1"><span class="b2">Concept 1: Thinking “</span><span class="b2"><a id="calibre_link-389"></a></span><span class="b2">Whole of Table” When Thinking About Filter Context</span></p>
			<p class="normal">Consider the single row highlighted in the matrix below. (This is the same matrix from the earlier examples.)</p>
			<p class="fp"><img class="_idgenobjectattribute127" src="images/000225.png" alt="" /></p>
			<p class="normal">This matrix is filtered for <span class="mono">'Calendar'[CalendarYear]=2018</span> in the visual card shown above. Also, the highlighted row, January, is also filtered by <span class="mono">'Calendar'[MonthName]="January"</span>, which appears in the Rows drop zone for the matrix. When these two filters are combined, the single cell/value for <span class="mono">[Total</span> <span class="mono">Sales]</span> is filtered for the period January 2018. So there are only 31 days that are used in the <span class="mono">Calendar</span> table in the data model for this one row in the matrix visual. With this in mind, it is possible to imagine this filter applied on the back end.</p>
			<p class="tip"><span class="b1">Tip: </span>Practice using your imagination to think about what tables would look like with filters applied. (For example, in the example above, the <span class="mono1">Calendar</span> table would have only 31 days visible with the filters <span class="mono1">'Calendar'[CalendarYear]=2018</span> and <span class="mono1">'Calendar'[MonthName]="January"</span> applied.) This is all happening in computer memory, on the fly. You can’t see this filtering happening, but it is important that you be able to visualise it happening in your mind. Thinking about the filtering behaviour that is occurring under the hood will make it easier to write custom time intelligence formulas&mdash;as well as other DAX formulas.</p>
			<p class="normal">When thinking about the filtering that is being applied, you should think about the whole table, not just the two columns with filters applied. It is clear that there is only one month visible (January) and only one year visible (2018), but it is also true that there are 31 <span class="mono">DayNumberOfMonth</span> values visible (those from 1 through 31), and there are 5 different <span class="mono">WeekNumberOfYear</span> values (1 through 5). It is possible to reference any and all of these other columns and values in your DAX formulas after the initial filter context is applied, even though these other columns are not directly being filtered.</p>
			<p class="normal">As you can see in the next image, after you filter the <span class="mono">Calendar</span> table based on <span class="mono">Month</span> <span class="mono">=</span> <span class="mono">January</span> and <span class="mono">Year</span> <span class="mono">=</span> <span class="mono">2018</span>, there are only 31 rows remaining in the filtered version of the table. All other columns in the table are now filtered, too. There is no direct filter placed on the <span class="mono">Date</span> column, and yet you can see in the image that the dates have inherited the filter because it is part of the <span class="mono">Calendar</span> table; as a result, only the dates 1/1/2018 through 31/1/2018 remain. This is true for every other column in the table, too. You can reference any columns from any tables in your DAX formulas, even if they are not directly filtered, and with that knowledge, you can write very powerful DAX indeed. But you need to be able to think “whole of table” to be able to understand how it works and what result you will get.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000233.png" alt="" /></p>
			<p class="h1"><span class="b2">Concept 2: Knowing How to Use </span><span class="b2"><a id="calibre_link-283"></a></span><span class="b2">MIN() and MAX()</span></p>
			<p class="normal">It is very common to use the <span class="mono">MIN()</span> and <span class="mono">MAX()</span> functions inside <span class="mono">FILTER()</span> when you write custom time intelligence functions.</p>
			<p class="note"><span class="b1">Note:</span> You can also use <span class="mono1">FIRSTDATE()</span> and <span class="mono1">LASTDATE()</span> if you prefer, although for reasons beyond the scope of this book, it is better to use <span class="mono1">MIN()</span> and <span class="mono1">MAX()</span> in this case.</p>
			<p class="normal">You’ll learn more details in the examples that follow, but for now there is one key concept about <span class="mono">MIN()</span> and <span class="mono">MAX()</span> that you should understand, and it is very important (so focus!): Whenever you use an aggregation function around a column in a DAX formula, it will always respect the initial filter context coming from the visual.</p>
			<p class="normal">To see how this works, let’s go back to the matrix from before, shown again below for convenience.</p>
			<p class="fp"><img class="_idgenobjectattribute128" src="images/000242.png" alt="" /></p>
			<p class="normal">You know that the matrix has filtered the <span class="mono">Calendar</span> table so that only 31 days remain. Consider the following formulas: </p>
			<p class="code"><span class="mono1">= MIN('Calendar'[Date])</span></p>
			<p class="code"><span class="mono1">= MAX('Calendar'[Date])</span></p>
			<p class="normal">Given that <span class="mono">MIN()</span> and <span class="mono">MAX()</span> always respect the current filter context, what would be the results of these DAX formulas for the highlighted row in the matrix above? Answer in your head before moving on. It might help to imagine the filtered version of the table in your head.</p>
			<p class="normal">The answer for the first formula, of course, is January 1, 2018&mdash;the first date in the filter context. It’s not the first date in the <span class="mono">Calendar</span> table but the first date in the current filter context. And the answer for the second formula is January 31, 2018&mdash;the last date in the filter context. This is really important because the <span class="mono">'Calendar'[Date]</span> column was not part of the filter, but that column is indeed filtered by the visual. (This is a good example of thinking “whole of table.”)</p>
			<p class="normal">So you can think of <span class="mono">MIN()</span> and <span class="mono">MAX()</span> as tools that can “harvest” the value from the current filter context, in any available column across the whole table (and any other table for that matter), and you can use the harvested values in your DAX formulas. Remember this fact about <span class="mono">MIN()</span> and <span class="mono">MAX()</span> when you get into the examples below.</p>
			<p class="normal">Because my earlier about <span class="mono">MIN()</span> and <span class="mono">MAX()</span> is so important, I want to repeat it: Whenever you use an aggregation function around a column in a DAX formula, it will always respect the initial filter context coming from the visual.</p>
			<p class="note"><span class="b1">Note:</span> One of the differences between DAX and Excel is that you can use <span class="mono1">MIN()</span> and <span class="mono1">MAX()</span> over non-numeric columns. If you were to write <span class="mono1">MIN('Calendar'[DayName])</span>, the result would be <span class="mono1">Friday</span>, the first day of the week when the <span class="mono1">DayName</span> column is sorted alphabetically.</p>
			<p class="h"><span class="b2">Writing Custom Time Intelligence Functions</span></p>
			<p class="normal">This section shows how to write a custom version of <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">YTD]</span>, using <span class="mono">CALCULATE()</span> and <span class="mono">FILTER()</span>. I strongly encourage you to write this formula yourself for practice. There is a lot that can (and will) go wrong when you type your own custom time intelligence functions, and you need lots of practice to get it right. There are square bracket sets, sets of parentheses, new line spacing to make it easier to read, commas to be added in the right places, etc. So make sure you actually write the following formula on your own computer. Go ahead and type in this formula now:</p>
			<p class="code"><span class="mono1">Total Sales YTD Manual =</span></p>
			<p class="code"><span class="mono1">        CALCULATE([Total Sales],</span></p>
			<p class="code"><span class="mono1">        FILTER(ALL('Calendar'),</span></p>
			<p class="code"><span class="mono1">        'Calendar'[CalendarYear] = MAX('Calendar'[CalendarYear])</span></p>
			<p class="code"><span class="mono1">        &amp;&amp; 'Calendar'[Date] &lt;= MAX('Calendar'[Date])</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">Also make sure to set up a matrix like the one you used earlier so that you can get immediate feedback about whether your formula is correct.</p>
			<p class="normal">This formula needs a bit of explanation. You can see below that lines 4 through 8 are all part of a <span class="mono">FILTER()</span> function because you can see that the <span class="mono">)</span> on line 8 is left aligned to the <span class="mono">F</span> in <span class="mono">FILTER()</span> on line 4.</p>
			<p class="note"><span class="b1">Note:</span> I have used <a href="http://daxformatter.com"><span class="u1">http://daxformatter.com</span></a> below to make it easier to refer to the lines in the formulas. I mentioned DAX Formatter in Chapter 10, and you can see here that it is a great tool for helping you read DAX formulas.</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000250.png" alt="" /></p>
			<p class="normal">This <span class="mono">FILTER()</span> <a id="calibre_link-394" class="calibre3"></a>function returns a table to the function <span class="mono">CALCULATE()</span>. <span class="mono">CALCULATE()</span> then applies a filter for this table of dates and propagates this filter to the <span class="mono">Sales</span> table prior to evaluating <span class="mono">[Total</span> <span class="mono">Sales]</span>. Let’s look more closely at lines 6 and 7 in the <span class="mono">FILTER()</span> function. Line 6 reads:</p>
			<p class="code"><span class="mono1">'Calendar'[CalendarYear] = MAX('Calendar'[CalendarYear])</span></p>
			<p class="normal">Okay, I hear you saying, “How can the calendar year be equal to the <span class="mono">MAX()</span> of the calendar year?” What is really happening is that there is a column name on the left side of the equals sign, and there is a <span class="mono">MAX()</span> function on the right side. Remember from earlier in this chapter that a <span class="mono">MIN()</span> or <span class="mono">MAX()</span> in a formula like this always respects the current filter context. So the way to read line 6 of this formula is as follows: “Add a filter to the table so that the column <span class="mono">'Calendar'[CalendarYear]</span> is equal to the maximum value in my current filter context coming from my matrix.”</p>
			<p class="normal">For example, in the matrix below, the maximum date of the highlighted row is March 31, 2018, and hence <span class="mono">MAX('Calendar'[CalendarYear])</span> <span class="mono">=</span> <span class="mono">2018</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute129" src="images/000259.png" alt="" /></p>
			<p class="normal">See how you need to think “whole of table” here? The initial filter context is applied over the month of March 2018, but the <span class="mono">MAX()</span> formula is working over the <span class="mono">CalendarYear</span> column. To imagine this filter context acting on the table in your data model, mentally apply the filters: There were 31 rows left in the <span class="mono">Calendar</span> table, and for each of these rows, the value in <span class="mono">'Calendar'[CalendarYear]</span> was <span class="mono">2018</span>. As a result (in this case), the <span class="mono">MIN()</span> of <span class="mono">'Calendar'[CalendarYear]</span> would also return <span class="mono">2018</span>&mdash;as would <span class="mono">SUM()</span> and <span class="mono">AVERAGE()</span>, for that matter. So line 6 is really saying “Filter my table where <span class="mono">'Calendar'[CalendarYear]</span> equals the current filter context year,” which is 2018 in this case. If you stopped here, the formula would return the total sales for the current year, which is not what is needed to solve this problem. You only want to keep the sales up until the end of March for the highlighted row in the matrix.</p>
			<p class="normal">Let’s move on. Line 7 starts with the double ampersand operator (which means <span class="mono">AND</span> and says, in this case, to do both line 6 and line 7) and then says:</p>
			<p class="code"><span class="mono1">'Calendar'[Date] &lt;= MAX('Calendar'Date])</span></p>
			<p class="normal">The same applies here as with line 6. <span class="mono">MAX('Calendar'[Date])</span> reads the initial filter context from the matrix and hence returns the value March 31, 2018, for the highlighted row in the matrix. Therefore, this part of the formula adds an <span class="mono">AND</span> condition so that the underlying table is filtered for <span class="mono">'Calendar'[CalendarYear]</span> <span class="mono">=</span> <span class="mono">2018</span> and also for the condition <span class="mono">'Calendar'[Date]</span> is on or before March 31, 2018. As you can deduce, this is all the dates year to date.</p>
			<p class="note"><span class="b1">Note:</span> If you need to visualise what is going on here, go to the Data view and manually apply these filters to the <span class="mono1">'Calendar'[Year]</span> and <span class="mono1">'Calendar'[Date]</span> columns in the Data view table. Doing so can help you build your understanding.</p>
			<p class="normal">Let’s keep going. As you go to the next row in the matrix visual, the calendar year stays the same, but the month-end date moves to the end of the next month. So the number of days that are included increases as you work down the rows in the matrix.</p>
			<p class="note"><span class="b1">Note:</span> it is important to point out that you could not use <span class="mono1">MIN()</span> in line 7 as you could do in line 6; this time, it has to be <span class="mono1">MAX()</span>. If you used <span class="mono1">MIN()</span>, you would get March 1, 2018, as the last date, and the year-to-date result would give you a total up to the start of March instead of up to the end of March; you would be missing almost a full month of sales. It is important to think about what your formulas need and make sure to provide the right formulas to achieve the desired outcome.</p>
			<p class="normal">Now let’s go back to <a id="calibre_link-118" class="calibre3"></a><span class="mono">ALL('Calendar')</span>. Line 5 of the formula refers to <span class="mono">ALL('Calendar')</span> instead of just the <span class="mono">Calendar</span> table (which you have used previously). <span class="mono">ALL()</span>, as discussed in Chapter 14, is the “remove filter” function. (If necessary, go back to Chapter 14 and refresh your memory about <span class="mono">ALL()</span> before moving on.)</p>
			<p class="normal">It is important to use the <span class="mono">ALL()</span> function here because you know that the matrix applies the current filter context before doing the calculation. Probably the easiest way to explain why you need the <span class="mono">ALL()</span> function is to look at what would happen if you didn’t use <span class="mono">ALL()</span>.</p>
			<p class="normal">Consider again the highlighted row in the matrix above (<span class="mono">March</span> <span class="mono">2018</span>). You know that the initial filter context for this row of the matrix is for all 31 days in the month of March 2018. You can imagine that the <span class="mono">Calendar</span> table is filtered behind the scenes so that only these 31 days of March 2018 are visible.</p>
			<p class="normal">Now let’s look at why the <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">YTD</span> <span class="mono">Manual]</span> formula does not work without the <span class="mono">ALL()</span> function. You should write the following formula and add it to your matrix, as shown below. (Don’t miss the opportunity to practice now!)</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000267.png" alt="" /></p>
			<p class="fp"><img class="_idgenobjectattribute130" src="images/000275.png" alt="" /></p>
			<p class="normal">You can see in this matrix that this formula is giving the sales for the current month rather than YTD in each row of the matrix. The reason it doesn’t work is related to the initial filter context discussed earlier. For the <span class="mono">March</span> <span class="mono">2018</span> row, the initial filter context applied a filter so that only the 31 days of March 2018 were “visible” in the <span class="mono">Calendar</span> table (behind the scenes). So how can the formula possibly return sales for all days “year to date,” including the sales from January and February, if only March remains due to the existing filters? The dates in January and February were already filtered out by the initial filter context coming from the matrix, so you can’t get the sales for these months to somehow reappear for the new formula if you write the formula this way.</p>
			<p class="normal">If you want to include sales from January and February in the row next to the actual sales for March, you must first remove the filter created by the matrix. This is what <span class="mono">ALL()</span> does when it is wrapped around the <span class="mono">Calendar</span> table in line 5: It removes the filter context that comes from the matrix that is applied to the <span class="mono">Calendar</span> table. You first remove the filters (using <span class="mono">ALL()</span>) and then reapply the filters you want to use in lines 6 and 7 so that you end up with all the dates YTD.</p>
			<p class="note"><span class="b1">Note: </span>Custom time intelligence always uses some form of <span class="mono1">ALL('Calendar')</span> to remove the initial filter context. The <span class="mono1">FILTER()</span> function therefore operates over an unfiltered copy of the <span class="mono1">Calendar</span> table. But the <span class="mono1">MIN()</span> and <span class="mono1">MAX()</span> functions operate with the initial filter context before the <span class="mono1">ALL()</span> function removes it.</p>
			<p class="tip"><span class="b1">Tip:</span> Go back and read this section again if necessary until you understand it well.</p>
			<p class="h"><span class="b2">Using ID Columns for </span><span class="b2"><a id="calibre_link-144"></a><a id="calibre_link-372"></a></span><span class="b2">Time Intelligence</span></p>
			<p class="normal">Good calendar tables contain ID columns to uniquely identify the time periods you wish to use in your reports, particularly if you want to write custom time intelligence functions. A good example of this is a month ID column. I’m not talking about month number of year here. Month number of year would start at 1, increase by 1 for each month until it reaches 12, and then start again from 1 in the next year. When I talk about ID columns, I am talking about columns for unique IDs. For example, a month ID column would start at 1 for the first month in the calendar, progress through 12 to complete the first year, and then continue counting through 13, 14, 15, and so on, incrementing by 1 for every month in the calendar table. ID columns like this are super helpful when you’re writing custom time intelligence functions, particularly with a non-standard calendar, such as an ISO calendar or a 445 calendar. The benefit of such an ID column is that it gives you a nice clean numeric column to move back and forward through time inside your formulas using DAX. To illustrate this point, in this section I show how to write a formula that calculates a rolling 6-month sales total. As always, I also set up a matrix to help illustrate the learning.</p>
			<p class="normal">In the image below, you can see that I have <span class="mono">CalendarYear</span> and <span class="mono">MonthName</span> on Rows and the <span class="mono">[Total</span> <span class="mono">Sales]</span> measure and <span class="mono">Max</span> <span class="mono">of</span> <span class="mono">Month</span> <span class="mono">ID</span> implicit measure on Values (see #1 below). To create the implicit measure <span class="mono">Max</span> <span class="mono">of</span> <span class="mono">Month</span> <span class="mono">ID</span>, I simply dragged the <span class="mono">Month</span> <span class="mono">ID</span> column to the Values section and changed the aggregation to Maximum (see #2).</p>
			<p class="note"><span class="b1">Note:</span> This is another good example of when to use implicit measures to help understand data. Again, I don’t recommend using implicit measures as a substitute for writing DAX for a final report, but it is a quick way to help visualise what you are doing while writing formulas.</p>
			<p class="normal">The image below shows how the month ID increments for every month in the visual&mdash;excluding the total rows for years, of course (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000283.png" alt="" /></p>
			<p class="normal">In the image above, you can see that the month ID for December 2017 is 18. To write a formula showing sales for the 6 months prior to December 2017, you would need everything from July 2017 through December 2017 inclusive. Another way to say this is that you would need everything from month ID 13 through month ID 18 inclusive. See how much easier it is to get your head around the problem when you lay out a good visual to help?</p>
			<p class="normal">Do you remember the trick using the <span class="mono">MAX()</span> function in DAX to “harvest” a value from a table? The image above uses an implicit measure that is the equivalent of writing <span class="mono">MAX([Month</span> <span class="mono">ID])</span> in DAX and that returns the month ID for each month. With this in mind:</p>
			<ul class="calibre2">
				<li class="bl"><span class="mono">MAX([Month ID])</span> gives the last month needed in the total (December 2017 in this case, or Month ID 18)</li>
				<li class="bl"><span class="mono">MAX([Month ID]) - 5</span> gives the starting month needed in the total (July 2017 in this case, or Month ID 13)</li>
			</ul>
			<p class="normal">Using this information, you can write the following formula:</p>
			<p class="code"><a id="calibre_link-332"></a><span class="mono1">Rolling 6 Months Sales =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales],</span></p>
			<p class="code"><span class="mono1">        FILTER(ALL('Calendar'),</span></p>
			<p class="code"><span class="mono1">        'Calendar'[Month ID] &gt;= MAX('Calendar'[Month ID])-5</span></p>
			<p class="code"><span class="mono1">        &amp;&amp; 'Calendar'[Month ID] &lt;= MAX('Calendar'[Month ID])</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">The results look as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute131" src="images/000291.png" alt="" /></p>
			<p class="normal">This example shows how useful it can be to add ID columns to a <span class="mono">Calendar</span> table. Doing so allows you to write very powerful and otherwise complex custom time intelligence formulas.</p>
			<p class="h1"><span class="b2">Using </span><span class="b2"><a id="calibre_link-182"></a></span><span class="b2">DATESINPERIOD()</span></p>
			<p class="normal">Before moving on, I would like to point out that there is actually an easier way to write the rolling 6-month sales measure shown above&mdash;by using an inbuilt time intelligence function. I am not deliberately trying to show you hard ways to solve problems. I am trying to cover different techniques to solve common problems and to help you learn and understand DAX. The concept of using ID columns as demonstrated above is very powerful indeed, and it will come in handy for times when you can’t use the inbuilt functions (for whatever reason).</p>
			<p class="normal">Here is the inbuilt time intelligence version of the same formula used in the preceding example, just so you know:</p>
			<p class="code"><span class="mono1">Rolling 6 Months Sales 2 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE (</span></p>
			<p class="code"><span class="mono1">        [Total Sales],</span></p>
			<p class="code"><span class="mono1">        DATESINPERIOD ('Calendar'[Date], MAX ('Calendar'[Date]), -6, MONTH)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">This formula uses the inbuilt time intelligence function <span class="mono">DATESINPERIOD()</span> to work out the dates over the past 6 months, using syntax that is pretty easy to understand. Note that I still use <span class="mono">MAX('Calendar'[Date])</span> to find the last date needed in the calculation and to go back in time 6 months from that date. Now you know how <span class="mono">MAX()</span> works inside formulas.</p>
			<p class="h1"><span class="b2">Practice Exercises: Time Intelligence, Continued</span></p>
			<p class="normal">It’s time for some more practice. Write the following formulas. First set up an appropriate matrix so that you will get immediate feedback about whether each formula is correct. (By now you should have an idea what type of matrix would help in this case.) Find the solutions to these practice exercises in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">68. [Total Sales Moving Annual Total]</span></p>
			<p class="normal">With this DAX formula, you need to create a rolling 12-month total of sales. It will always show you 12 months’ worth of sales, up to the end of the current month. Think about the problem using English words first and then convert that to DAX, using the techniques you have learnt here. I show my tips for writing this measure later in this chapter, but you should give it a go now, before you see those tips.</p>
			<p class="normal">Hint: Dates in DAX work as they do in Excel. For example, if you have a date, you can subtract 365 to get the same date last year (though not for leap years, of course). You could also use the <span class="mono">DATESINPERIOD()</span> function I just covered to solve this problem. However, you should try this practice exercise as a custom time intelligence function first.</p>
			<p class="h2"><span class="bi">69. [Total Sales Rolling 90 Days]</span></p>
			<p class="normal">This is the same as the formula for Practice Exercise 68, but instead of delivering a rolling 12-month total, you should deliver a rolling 90-day total. Try to complete this practice exercise from scratch using custom time intelligence, without referencing Practice Exercise 68. It is good practice to try thinking like the DAX engine.</p>
			<p class="h1"><span class="b2">Tips for Writing a </span><span class="b2"><a id="calibre_link-286"></a></span><span class="b2">Moving Annual Total</span></p>
			<p class="normal">This section walks through how to create the formula in Practice Exercise 68. Start by setting up a new matrix with <span class="mono">Years</span> and <span class="mono">Months</span> on Rows and <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute132" src="images/000299.png" alt="" /></p>
			<p class="normal">Then write this formula:</p>
			<p class="code"><span class="mono1">Total Sales Moving Annual Total =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales],</span></p>
			<p class="code"><span class="mono1">        FILTER(ALL('Calendar'),</span></p>
			<p class="code"><span class="mono1">            'Calendar'[Date] &gt; MAX('Calendar'[Date]) &ndash; 365</span></p>
			<p class="code"><span class="mono1">            &amp;&amp; 'Calendar'[Date] &lt;= MAX('Calendar'[Date])</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="note"><span class="b1">Note: </span>This is not the only way to write this formula. Just as in Excel, there are often multiple ways to write a formula in Power BI. If you have something different and it works, that’s great. Also note that this formula may not work with <a id="calibre_link-259"></a>leap years, depending on how your business handles the extra day. (Some businesses ignore the extra day and actually have 6 × 364-day years followed by 1 × 371-day extraordinary year, so it depends.)</p>
			<p class="normal">Now check your formulas against the matrix, as shown below. You can check <span class="mono">Moving</span> <span class="mono">Annual</span> <span class="mono">Total</span> at the end of December 2017 (see #1 below) against the matrix-calculated total (#2) to validate that the formula is working.</p>
			<p class="fp"><img class="_idgenobjectattribute133" src="images/000307.png" alt="" /></p>
			<p class="normal">One thing to note is that the first <span class="mono">FILTER()</span> line in the formula says greater than, and the last <span class="mono">FILTER()</span> line says less than or equal to. It is easy to get these things wrong when writing formulas, but you should not worry about this because it is easy to check and verify. As long as you set up a matrix so that you can test the formulas you are writing, you can just take a guess and then change it if you need to (i.e., if you got it wrong). In this example, if you used greater than or equal to, you would end up with 366 days, which is incorrect.</p>
			<p class="h1"><span class="b2">But What About the First Year?</span></p>
			<p class="normal">Technically, the <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">Moving</span> <span class="mono">Annual</span> <span class="mono">Total]</span> result really doesn’t make sense in the first 11 months of the sales data because you didn’t have a full year of sales until the end of June 2017. There are many ways to solve this problem by using the <span class="mono">IF()</span> function. Here is one solution:</p>
			<p class="code"><span class="mono1">Total Sales MAT Improved =</span></p>
			<p class="code"><span class="mono1">    IF(MAX('Calendar'[Date])&gt;=DATE(2017,7,1),</span></p>
			<p class="code"><span class="mono1">        CALCULATE([Total Sales],</span></p>
			<p class="code"><span class="mono1">            FILTER(ALL('Calendar'),</span></p>
			<p class="code"><span class="mono1">                'Calendar'[Date] &gt; MAX('Calendar'[Date]) &ndash; 365</span></p>
			<p class="code"><span class="mono1">            &amp;&amp; 'Calendar'[Date] &lt;= MAX('Calendar'[Date])</span></p>
			<p class="code"><span class="mono1">            )</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="tip"><span class="b1">Tip: </span>By now you may have realised that it is easiest to copy one formula and then edit the copied version to create a new formula. Indeed, this is a good idea, but try to keep the copying and changing to a minimum while you are learning. It’s a good idea to get as much DAX writing practice as you can. When you really know how to do it, using copy and paste is a great way to work more quickly.</p>
			<p class="h1"><span class="b2">Total Sales MAT DATESINPERIOD() Version</span></p>
			<p class="normal">For completeness, this section shows the inbuilt time intelligence function that can calculate the same formula as above. Here is the function:</p>
			<p class="code"><span class="mono1">Total Sales MAT Improved 2 =</span></p>
			<p class="code"><span class="mono1">IF (</span></p>
			<p class="code"><span class="mono1">    MAX ('Calendar'[Date]) &gt;= DATE (2017, 7, 1),</span></p>
			<p class="code"><span class="mono1">    CALCULATE (</span></p>
			<p class="code"><span class="mono1">        [Total Sales],</span></p>
			<p class="code"><span class="mono1">        DATESINPERIOD ('Calendar'[Date], MAX ('Calendar'[Date]), -1, YEAR)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="code"><span class="mono1">)</span></p>
			<p class="normal">This inbuilt version has the benefit of automatically handling the leap year in a standard way: When it compares two years and one of them is a <a id="calibre_link-258" class="calibre3"></a>leap year, the leap year has 366 days, and the other year has 365 days automatically assigned and managed.</p>
			<p class="h"><span class="b2">Researching </span><span class="b2"><a id="calibre_link-187"></a></span><span class="b2">DAX Functions</span></p>
			<p class="normal">There are many time intelligence functions that you can use to write time-based DAX formulas. A key piece of advice as you learn how to use all the time intelligence functions (and, indeed, all other DAX functions) is to do a quick online search and read the relevant information in the documentation. To do this, do a web search for the function name followed by the word DAX. In the image below, for example, I have searched for “dateadd dax.”</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000316.png" alt="" /></p>
			<p class="normal"><a id="calibre_link-181" class="calibre3"></a>The first result returned is normally the official Microsoft documentation site. When you click on this Microsoft link, you see something like the following.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000323.png" alt="" /></p>
			<p class="normal">In many cases, the official documentation is not as useful as other websites. But there is some very important information that you can get from Microsoft documentation: the syntax, parameters, and return value. You can find the syntax and parameters by typing a formula directly into the Power BI formula bar, but sometimes the IntelliSense help doesn’t clearly tell you the <a id="calibre_link-331" class="calibre3"></a>return value&mdash;and this is where doing a web search can help. The return value is a key piece of information that helps you understand how to use a function. In the case of <span class="mono">DATEADD()</span> above, the return value is a table, and hence you would use <span class="mono">DATEADD()</span> inside <span class="mono">CALCULATE()</span> to do a time shift. So you might write something like this:</p>
			<p class="code"><span class="mono1">Total Sales LY DATEADD =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales], DATEADD('Calendar'[Date],-1,Year))</span></p>
			<p class="normal">This formula works on various different time horizons, including quarters as well as years, as shown below. (You might realise that this is basically the same as the <span class="mono">SAMEPERIODLASTYEAR()</span> example shown earlier in this chapter.)</p>
			<p class="fp"><img class="_idgenobjectattribute134" src="images/000333.png" alt="" /></p>
			<p class="normal">As another example, when you do a quick search for “<a id="calibre_link-228" class="calibre3"></a>firstdate,” you find the Microsoft documentation site right away.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000341.png" alt="" /></p>
			<p class="normal">If you click through to the Microsoft documentation site, you can see that the returned value is a special table that has a single column and a single row, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000349.png" alt="" /></p>
			<p class="normal">Note in the image above that <span class="mono">FIRSTDATE()</span> returns a table. Because it is a table, it can be used as the filter parameter inside <span class="mono">CALCULATE()</span>&mdash;for example to return the total sales on the first date from the <span class="mono">Calendar</span> table&mdash;as shown here:</p>
			<p class="code"><span class="mono1">Total Sales First Date = CALCULATE([Total Sales],FIRSTDATE('Calendar'[Date]))</span></p>
			<p class="normal">But <span class="mono">FIRSTDATE()</span> is a very special function. In addition to returning a table, it can also be used on its own inside a measure, as follows:</p>
			<p class="code"><span class="mono1">First Date = FIRSTDATE('Calendar'[Date])</span></p>
			<p class="normal">This syntax is normally not valid. Under normal circumstances, you cannot use a table function inside a measure in this way. This measure is valid, however, and can be placed into a matrix, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute135" src="images/000357.png" alt="" /></p>
			<p class="normal">The resulting date is returned as a scalar value for each cell in the matrix. In the first example, <span class="mono">FIRSTDATE()</span> returns a table as a filter parameter inside <span class="mono">CALCULATE()</span>. In the second example, <span class="mono">FIRSTDATE()</span> returns a scalar value and can be used as a measure. This is unique behaviour in DAX.</p>
			<p class="h"><span class="b2">Other Time Intelligence Functions</span></p>
			<p class="normal">Here is a list of some of the time intelligence functions that you might want to explore:</p>
			<p class="code"><span class="mono1">DATESINPERIOD(</span><span class="monoitalic">date_column</span><span class="mono1">, </span><span class="monoitalic">start_date</span><span class="mono1">, </span><span class="monoitalic">number_of_intervals</span><span class="mono1">, </span><span class="monoitalic">intervals</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">DATESBETWEEN(</span><span class="monoitalic">column</span><span class="mono1">, </span><span class="monoitalic">start_date</span><span class="mono1">, </span><span class="monoitalic">end_date</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">DATEADD(</span><span class="monoitalic">date_column</span><span class="mono1">, </span><span class="monoitalic">number_of_intervals</span><span class="mono1">, </span><span class="monoitalic">interval</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">FIRSTDATE(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">LASTDATE(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">LASTNONBLANKDATE(</span><span class="monoitalic">date_column</span><span class="mono1">, [</span><span class="monoitalic">expression</span><span class="mono1">])</span></p>
			<p class="code"><span class="mono1">STARTOFMONTH(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">STARTOFQUARTER(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">STARTOFYEAR(</span><span class="monoitalic">date_column</span><span class="mono1"> [,</span><span class="monoitalic">YE_date</span><span class="mono1">])</span></p>
			<p class="code"><span class="mono1">ENDOFMONTH(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">ENDOFQUARTER(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">ENDOFYEAR(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">PARALLELPERIOD(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">PREVIOUSDAY(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">PREVIOUSMONTH(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">PREVIOUSQUARTER(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">PREVIOUSYEAR(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">NEXTDAY(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">NEXTMONTH(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">NEXTQUARTER(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">NEXTYEAR(</span><span class="monoitalic">date_column</span><span class="mono1"> [,</span><span class="monoitalic">YE_date</span><span class="mono1">])</span></p>
			<p class="code"><span class="mono1">DATESMTD(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">DATESQTD(</span><span class="monoitalic">date_column</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">DATESYTD(</span><span class="monoitalic">date_column</span><span class="mono1"> [,</span><span class="monoitalic">YE_date</span><span class="mono1">])</span></p>
			<p class="code"><span class="mono1">TOTALMTD(</span><span class="monoitalic">expression</span><span class="mono1">, </span><span class="monoitalic">dates</span><span class="mono1">, </span><span class="monoitalic">filter</span><span class="mono1">)</span></p>
			<p class="code"><span class="mono1">TOTALQTD(</span><span class="monoitalic">expression</span><span class="mono1">, </span><span class="monoitalic">dates</span><span class="mono1">, </span><span class="monoitalic">filter</span><span class="mono1">)</span></p>
			<p class="h1"><span class="b2">A Free Quick Reference Guide</span></p>
			<p class="normal">I have produced (and I maintain for new functions) a quick reference guide of all DAX functions in PDF format that you may like to download and use. The DAX Reference Guide PDF is not meant to replace the online Microsoft documentation but to supplement it. As shown below, the PDF is fully indexed, and you can jump to the relevant sections by clicking on the hyperlinks in the table of contents.</p>
			<p class="normal">You can download the <a id="calibre_link-186" class="calibre3"></a>DAX Reference Guide for free by visiting my online shop at <a href="http://xbi.com.au/online-shop" class="calibre3"><span class="u">http://xbi.com.au/online-shop</span></a> and then navigating to the Books section.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000295.png" alt="" /></p>
			<p class="h1">DAX Function Quick Reference List</p>
			<p class="normal">In addition to the full Quick Reference Guide mentioned above, I have included a DAX function quick reference list in <a href="#calibre_link-29" class="calibre3">"Appendix B - DAX Quick Reference List" on page 272</a>.  It contains all the valid DAX functions along with the syntax, categorised in the same groupings as above.  This DAX function quick reference list doesn’t contain detail about how each function is used, however awareness of the existence of a function can be half the challenge. This simple list should help with that.</p>
		</div>
	</div>


<div id="calibre_link-53" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-432" class="ch"><span class="b2"><a id="calibre_link-20"></a>17: DAX Topic: </span><span class="b2"><a id="calibre_link-188"></a><a id="calibre_link-380"></a></span><span class="b2">Variables in DAX</span></p>
			<p class="normal">This chapter introduces a new concept in DAX called variables. Variables have been a feature of DAX since 2015. If you have any programming experience, then you will probably already have a good sense of what you may be able to do with variables. Even if you have not done any programming, you may be able to remember learning some simple algebra at school. Here is a simple example for you to consider.</p>
			<p class="normal">Assume the following:</p>
			<p class="code"><span class="mono1">X = 5</span></p>
			<p class="code"><span class="mono1">Y = 3</span></p>
			<p class="normal">What is the value of <span class="mono">X</span> + <span class="mono">Y</span>?</p>
			<p class="normal">The answer, of course, is 8. <span class="mono">X</span> + <span class="mono">Y</span> = 8 in this case because <span class="mono">X</span> has been assigned the value of 5, and <span class="mono">Y</span> has been assigned the value of 3. This is exactly how variables work in DAX. You first assign a value (or a table) to a variable, and then you can use the variable inside the rest of your DAX formulas.</p>
			<p class="h"><span class="b2">Rules for Using Variables</span></p>
			<p class="normal">Here are a few simple rules related to using variables in DAX:</p>
			<ul class="calibre2">
				<li class="bl">You assign a variable by using the <span class="mono">VAR</span> keyword with the following syntax:<p class="codeindented"><span class="mono1">VAR </span><span class="monoitalic">variableName</span><span class="mono1"> = &lt;</span><span class="monoitalic">something</span><span class="mono1">&gt;</span></p></li>
				<li class="bl">You can create as many variables as you want in a formula. You must define them all before using the <a id="calibre_link-330" class="calibre3"></a><span class="mono">RETURN</span> keyword.</li>
				<li class="bl">There is no comma after each defined variable. (You will see this below.)</li>
				<li class="bl">After you define at least one variable name, you must use the keyword <span class="mono">RETURN</span> to complete the formula.</li>
				<li class="bl">Variables can be values or tables.</li>
				<li class="bl">A variable name cannot begin with an integer as the first character, but you can use integers as subsequent characters in a name (e.g., 1stYear is not allowed, but Year1 is fine).</li>
				<li class="bl">Variable names cannot contain special characters (e.g., %)</li>
				<li class="bl">Variable names cannot be reserved words, such as function names.</li>
				<li class="bl">Once a variable has been assigned a value, that value cannot change prior to the <span class="mono">RETURN</span> keyword.</li>
				<li class="bl">Variables are local in scope to the formula. You cannot refer to a variable declared in one measure from within a different measure.</li>
			</ul>
			<p class="tip"><span class="b1">Tip:</span> You should use meaningful, descriptive names for your variables. Doing so makes your formulas easier to read and understand.</p>
			<p class="h"><span class="b2">Total Sales MAT Revisited</span></p>
			<p class="normal">Let’s jump back to this measure from Chapter 16:</p>
			<p class="code"><span class="mono1">Total Sales MAT Improved =</span></p>
			<p class="code"><span class="mono1">    IF(MAX('Calendar'[Date])&gt;=DATE(2017,7,1),</span></p>
			<p class="code"><span class="mono1">        CALCULATE([Total Sales],</span></p>
			<p class="code"><span class="mono1">            FILTER(ALL('Calendar'),</span></p>
			<p class="code"><span class="mono1">                'Calendar'[Date] &gt; MAX('Calendar'[Date]) - 365</span></p>
			<p class="code"><span class="mono1">                &amp;&amp; 'Calendar'[Date] &lt;= MAX('Calendar'[Date])</span></p>
			<p class="code"><span class="mono1">            )</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">Now let’s look at the same formula written using variables. Take a good look at the formula below and see what you think. (I have formatted it in DAX Formatter to make it easier to read and so I can refer to the line numbers.) What are your observations about this variable version of the formula?</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000006.png" alt="" /></p>
			<p class="normal">Here are the key points I want you to take away from this latest version of the formula using the <span class="mono">VAR</span> syntax:</p>
			<ul class="calibre2">
				<li class="bl">Variables make the formula easier to read and understand.</li>
				<li class="bl">Good variable names effectively self-document the logic of the formula and make it easier to understand.</li>
				<li class="bl">A variable can be assigned a constant (line 3), a table (line 5), or a value that can vary depending on the filter context (line 7).</li>
				<li class="bl">A variable is reused inside the formula to create other variables (line 8).</li>
			</ul>
			<p class="normal">Now notice line 9 in the formula above. Why did I assign the result to a variable and then return the variable at the end? Why didn’t I simply replace line 9 with <span class="mono">RETURN</span>? Well, when you write a variable formula this way, it is very easy to later go back and check each of the component input variables for debugging purposes. With the formula written this way, I can easily replace line 22 with one of the other variable names (e.g., <span class="mono">startDate</span>) to check what that variable is doing. This is a very powerful debugging technique.</p>
			<p class="h"><span class="b2">Performance Impacts of Variables</span></p>
			<p class="normal">One thing that is not obvious about the use of variables is that they can improve the overall performance of your formulas. For example, let’s look again at the <span class="mono">[Margin</span> <span class="mono">%]</span> measure from Chapter 4 and consider expanded versions with and without using variables. Here is the version without variables:</p>
			<p class="code"><span class="mono1">Margin % full = DIVIDE([Total Sales] &ndash; [Total Cost],[Total Sales])</span></p>
			<p class="normal">The variable version is shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute136" src="images/000014.png" alt="" /></p>
			<p class="normal">The first version of this formula is calculating the <span class="mono">[Total</span> <span class="mono">Sales]</span> measure twice: once in the numerator (to calculate the margin) and then in the denominator (to work out the percentage). The second version of the formula calculates <span class="mono">[Total</span> <span class="mono">Sales]</span> only once and assigns it to a variable (line 2). As illustrated here, sometimes variables can help improve the performance of your formulas.</p>
			<p class="note"><span class="b1">Note:</span> The Power BI engine is constantly being updated and improved. The developers are always finding new ways to make the engine more efficient. It is possible (even likely) that some uses of variables that would appear to make a formula more efficient may actually not make improvements at all due to the developers’ great work to improve the engine. Even so, it is still a great idea to use variables to write your formulas as doing so makes the formulas easier to use.</p>
			<p class="h"><span class="b2">Variables Are </span><span class="b2"><a id="calibre_link-244"></a></span><span class="b2">Immutable</span></p>
			<p class="normal">If you have a programming background, you are very familiar with the concept of variables.<span class="b3"> </span>But<span class="b3"> </span>a word of caution here: Variables in DAX are really more akin to the constants in other programming languages than they are to variables. Variables in DAX are immutable; this means that once a variable has been assigned a value, that value cannot change. So in most programming languages, you could write the following:</p>
			<p class="code"><span class="mono1">X = 5</span></p>
			<p class="code"><span class="mono1">X = X +1</span></p>
			<p class="normal">In doing so, you would change the value of <span class="mono">X</span> from 5 to 6.</p>
			<p class="normal">This is not possible in DAX. Once a value has been assigned to a variable in DAX, that value cannot be changed; the variable retains the same value until after <span class="mono">RETURN</span> keyword is used.</p>
			<p class="normal">Here is another example, similar to one from Chapter 9:</p>
			<p class="code"><span class="mono1">Total Sales to Females =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Sales], Customers[Gender] = "F")</span></p>
			<p class="normal">You could write this same formula using variables in a number of ways. One option is shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000021.png" alt="" /></p>
			<p class="normal">Because variables are immutable, this formula using variables will not give the correct result. This example shows a value being assigned to the variable <span class="mono">TotalSales</span> in line 2. It is therefore incorrect to try to change the value of the variable in line 4. As a result, this formula will return simply total sales and not total sales to females.</p>
		</div>
	</div>


<div id="calibre_link-54" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-433" class="ch"><span class="b2"><a id="calibre_link-21"></a>18: DAX Topic: </span><span class="b2"><a id="calibre_link-321"></a></span><span class="b2">RANKX() and TOPN()</span></p>
			<p class="normal">This chapter introduces the functions <span class="mono">RANKX()</span> and <span class="mono">TOPN()</span>. These functions are similar in the types of problems they solve, but technically they are very different. In this chapter, I use two scenarios to explain these functions:</p>
			<ul class="calibre2">
				<li class="bl">Which are the <a id="calibre_link-129" class="calibre3"></a>best-selling products?</li>
				<li class="bl">What are the sales from the top 10 best-selling products?</li>
			</ul>
			<p class="h"><span class="b2">RANKX() vs. TOPN()</span></p>
			<p class="normal"><span class="mono">RANKX()</span> is a function that returns a scalar value&mdash;that is, a number that can be displayed in the Values section of a visual. <span class="mono">TOPN()</span>, on the other hand, is a table function. <span class="mono">TOPN()</span> returns a table containing the top number of specified rows (<span class="mono">N</span>) in a table, as determined by a rule of your choice (e.g., <span class="mono">Total</span> <span class="mono">Sales</span>, <span class="mono">Total</span> <span class="mono">Profit</span>). As you should be well aware by now, a function that returns a value can be used on its own as a measure, but a naked table cannot be used on its own as a measure. Although you can’t use a naked table on its own as a measure, you can use the table as an input to some other function, typically as a filter parameter inside <span class="mono">CALCULATE()</span>.</p>
			<p class="normal">A naked table is not allowed as a measure because it returns a table, not a value. Consider these examples:</p>
			<p class="code"><span class="mono1">Invalid Measure 1 = TOPN(10,Products)</span></p>
			<p class="code"><span class="mono1">Invalid Measure 2 = FILTER(ALL(Products),Products[Category]="Bikes")</span></p>
			<p class="normal">Both of these formulas return tables, and so it is not valid to use them like this as measures. To be a valid measure, a formula must return a single value. But this doesn’t mean you can’t use table functions in measures. These next three measures all contain table functions, but they all return values:</p>
			<p class="code"><span class="mono1">Valid Measure 1 = RANKX(ALL(Products),[Total Sales])</span></p>
			<p class="code"><span class="mono1">Valid Measure 2 = CALCULATE([Total Sales], TOPN(10,Products))</span></p>
			<p class="code"><span class="mono1">Valid Measure 3 = COUNTROWS(FILTER(ALL(Products),Products[Category]=<br class="calibre7" />	"Bikes"))</span></p>
			<p class="normal">You can use table functions in measures as long as the functions are part of an overall formula that returns a value. It’s awesome to use table functions this way!</p>
			<p class="h"><span class="b2">RANKX()</span></p>
			<p class="normal">The syntax for <span class="mono">RANKX()</span> is as follows:</p>
			<p class="code"><span class="mono1">RANKX(</span><span class="monoitalic">table</span><span class="mono1">,</span><span class="monoitalic">expression</span><span class="mono1">,[</span><span class="monoitalic">value</span><span class="mono1">],[</span><span class="monoitalic">order</span><span class="mono1">],[</span><span class="monoitalic">ties</span><span class="mono1">])</span></p>
			<p class="normal">In this syntax, there are two mandatory parameters and three optional parameters. I cover the mandatory parameters here, and you can explore the optional parameters yourself when you are ready.</p>
			<p class="normal">Even though <span class="mono">RANKX()</span> is not a table function, it does take a table as the first parameter. Most functions in DAX that take a table as the first parameter operate with row context. There are some exceptions, however, such as <span class="mono">UNION()</span>.</p>
			<p class="normal">So you can more easily learn and comprehend this, I have set up a table in Power BI and placed <span class="mono">Products[ProductKey]</span>, <span class="mono">Products[ProductName]</span>, and <span class="mono">[Total</span> <span class="mono">Sales]</span> into the table visual. I have also sorted on <span class="mono">[Total</span> <span class="mono">Sales]</span> descending by clicking on the <span class="mono">Total</span> <span class="mono">Sales</span> column title in the table visual. The following image shows what it looks like.</p>
			<p class="fp"><img class="_idgenobjectattribute137" src="images/000029.png" alt="" /></p>
			<p class="normal">Note that the total is $29.4 million. Every product is displayed in this table, but there is a way to filter this visual so that it shows just the top 10 products. If you want to filter a visual in Power BI to the top N items, you need to follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Expand the Filters pane (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Select the visual and then navigate to the section Filters on This Visual (#2).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Find the item you want to rank, which in this case is <span class="mono1">ProductKey</span> (#3).</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Change Filter Type (#4) from Advanced Filtering to <a id="calibre_link-376"></a>Top N (#5).</p>
			<p class="fp"><img class="_idgenobjectattribute138" src="images/000037.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Specify how many items you want to keep (see #1 below) and how you will rank the top items. For example, to rank them based on the measure <span class="mono1">[Total Sales]</span>, add the measure <span class="mono1">[Total Sales] </span>to the By Value section of the filter (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute139" src="images/000045.png" alt="" /></p>
			<p class="normal">This example uses the filter capabilities of the visual to display just the top N values. This is not the same as the <span class="mono">TOPN()</span> function in DAX. The difference between the method just described and the <span class="mono">TOPN()</span> function can be confusing. Basically, <span class="mono">TOPN()</span> is a function that returns a table that can be used in a DAX formula. (I cover the <span class="mono">TOPN()</span> function later in this chapter.)</p>
			<p class="normal">A Top N filter exists inside most visuals in Power BI. With this filter, you specify how many items you want to keep in the visual, and you specify how you will select the top items.</p>
			<p class="normal">One interesting thing about a Top N filter is that you can use any measure or column as the test to rank the products, regardless of whether that measure or column is used in the visual. The following version of the visual from above shows total sales by product key (and product name). However, the Top N filter is showing the top 10 products by highest margin percentage, and the actual margin percentage is not shown in the visual at all. Interesting!</p>
			<p class="fp"><img class="_idgenobjectattribute140" src="images/000053.png" alt="" /></p>
			<p class="normal">Now let’s look again at using the <span class="mono">RANKX()</span> function with this data set. The following image shows my original filtered list of the top 10 best-selling products.</p>
			<p class="fp"><img class="_idgenobjectattribute141" src="images/000063.png" alt="" /></p>
			<p class="normal">To rank all these products to see which is number 1, which is number 2, and so on, you can use the <span class="mono">RANKX()</span> function. The role of <span class="mono">RANKX()</span> is to compare a single item against many items to determine its rank/position. Here is an incorrect version of the formula:</p>
			<p class="code"><span class="mono1">Product Rank Wrong = RANKX(Products,[Total Sales])</span></p>
			<p class="normal">When you add this measure to the table above, you get the results shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute142" src="images/000073.png" alt="" /></p>
			<p class="normal">Now, I want you to stop reading for a moment, look at the formula and the table above, and see if you can work out what is wrong. Why is each product returning the same value, 1?</p>
			<p class="note"><span class="b1">Note: </span>Analysing the results in a visual and working out how the answer is calculated are core skills of a competent DAX user. You should practice whenever you get a chance. Before you read further, do your best to figure out what is wrong above.</p>
			<p class="normal">Okay, let me explain. First of all, whenever you see measures not doing what you expect them to do, you should first and foremost suspect that unexpected filtering behaviour is causing the issue. This is not always the case, but in my experience, filtering behaviour causes most of the problems most of the time.</p>
			<p class="normal">Let’s go through the debugging process with this example. Start at the first line in the visual above (product 312). The job of <span class="mono">RANKX()</span> is to rank the total sales (parameter 2) of this product (product 312) against the products in the <span class="mono">Products</span> table. Seems simple enough, right? Well yes, but then again no. The following test measure can help illustrate the point:</p>
			<p class="code"><span class="mono1">Test= COUNTROWS(Products)</span></p>
			<p class="normal">It can be difficult to learn how to deal with virtual tables in DAX. Because you can’t see virtual tables, it is hard to be clear on what they are doing. Wrapping <span class="mono">COUNTROWS()</span> around a table function in a test measure can really help your understanding in this area. To illustrate, I have placed the <span class="mono">[Test]</span> measure in the table visual below.</p>
			<p class="tip"><span class="b1">Tip:</span> Writing test measures is a great way to learn how DAX operates.</p>
			<p class="normal">Before you peek below, what do you expect the result to be in each row of the visual? After you’ve thought about it and made your guess, take a look and see.</p>
			<p class="fp"><img class="_idgenobjectattribute143" src="images/000083.png" alt="" /></p>
			<p class="normal">Is this what you were expecting? If yes, then great: You are on your way to being great at DAX! If no, then don’t worry; I am covering this point now to help you learn. The thing about table parameters inside functions is that they are affected by the filters coming from your visuals. Remember that this is the measure being used here:</p>
			<p class="code"><span class="mono1">Product Rank Wrong = RANKX(Products,[Total Sales])</span></p>
			<p class="normal">Look at the first parameter, which is the <span class="mono">Products</span> table. Because the formula says <span class="mono">Products</span>, you can be excused for assuming that it is all the products in the table, but actually it is the <span class="mono">Products</span> table after it has been filtered by the visual. That is why the measure returns <span class="mono">1</span> for the first 10 rows of the table and <span class="mono">10</span> at the total level. With this in mind, let’s look at the first row in the visual again. </p>
			<p class="normal">The first row in the visual is product key 312, the “Road-150 Red, 48” bike. The <span class="mono">RANKX()</span> measure for the first row in the visual has the <span class="mono">Products</span> table as the first parameter and <span class="mono">[Total</span> <span class="mono">Sales]</span> as the second. But not all products are in the <span class="mono">Products</span> table. The table contains just one product, product key 312&mdash;the only product left in the table after it has been filtered by the visual. So <span class="mono">RANKX()</span> is trying to rank the sales of the first item in the visual (product 312) against a table containing only one product&mdash;the very same product filtered by the visual (product 312). The net result is that the product in the visual always ranks first when ranked against itself. The same is true for every row in the visual.</p>
			<p class="normal">Ranking a product against itself doesn’t solve the problem. Instead, you need to rank each product in the visual against all products in the data model. Here is the formula you need for this:</p>
			<p class="code"><span class="mono1">Product Rank = RANKX(ALL(Products),[Total Sales])</span></p>
			<p class="normal">You use the <span class="mono">ALL()</span> function to remove the filters from the <span class="mono">Products</span> table and then rank the single product filtered by the visual against all other products in the table, ensuring that the <span class="mono">Products</span> table is not filtered by the visual. The image below shows the correct ranking.</p>
			<p class="fp"><img class="_idgenobjectattribute144" src="images/000173.png" alt="" /></p>
			<p class="h"><span class="b2">Filter Context Revisited</span></p>
			<p class="normal">I made a very important point above, and I want to restate it and expand on it here. Table parameters used inside functions are affected by filters coming from visuals. When you see a table function as a parameter in a function placed in a visual, it is not the entire table that is used; it is a copy of the table that is filtered by the visual. If you want an unfiltered copy of the table, you have to remove the filters first by wrapping the table inside <span class="mono">ALL()</span>.</p>
			<p class="normal">Measures and aggregation functions are also impacted by the filters coming from your visuals. The image below shows one of the custom time intelligence formulas from Chapter 16.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000148.png" alt="" /></p>
			<p class="normal">Notice the use of <span class="mono">MAX()</span> in lines 3, 9, and 10. Each use of <span class="mono">MAX()</span> above is not finding the max of the entire column but the max of a column that is filtered by the visual. But wait! The <span class="mono">MAX()</span> functions on lines 9 and 10 are inside a <span class="mono">FILTER()</span> function that has <span class="mono">ALL()</span> as the first parameter. Doesn’t this mean that the <span class="mono">MAX()</span> functions that are part of the second parameter inside <span class="mono">FILTER()</span> are operating over the unfiltered copy of the table? In short, no. The <span class="mono">FILTER()</span> function above is stepping through an unfiltered copy of the <span class="mono">Calendar</span> table (parameter 1), but that has nothing to do with the <span class="mono">MAX()</span> functions inside the <span class="mono">FILTER()</span> function (parameter 2).</p>
			<p class="normal">The <span class="mono">[Total</span> <span class="mono">Sales]</span> measure on line 5 is also filtered by the visual (and the measure is also filtered by the filter function inside <span class="mono">CALCULATE()</span>, of course).</p>
			<p class="normal">Finally, the <span class="mono">Calendar</span> table on line 7 is also filtered by the visual, but in this case, the <span class="mono">ALL()</span> function removes that filter coming from the visual, so <span class="mono">ALL('Calendar')</span> is an unfiltered copy of the <span class="mono">Calendar</span> table.</p>
			<p class="normal">Alberto <a id="calibre_link-215" class="calibre3"></a>Ferrari has a great quote that he attributes to one of his past DAX students: “DAX is simple, but it’s not easy.” DAX has a few simple rules that you need to learn related to filter behaviour and row-by-row evaluation (filter context and row context). Learning the rules is easy. Mastering how the rules interact inside formulas takes practice and experience.</p>
			<p class="normal">Let’s get back to <span class="mono">RANKX()</span>. Now that the formula is working and you understand how it works, let’s look at how it behaves in two use cases. First, the image below shows what happens when you sort the visual on <span class="mono">ProductKey</span> instead of <span class="mono">[Total</span> <span class="mono">Sales]</span> descending.</p>
			<p class="fp"><img class="_idgenobjectattribute145" src="images/000107.png" alt="" /></p>
			<p class="normal">This image does not show Excel; it does not show a list of products with the numbers 1 through 10 next to each product. <span class="mono">RANKX()</span> is a function that operates (in this case) over any product that is passed to it in a visual, and it tells you how that one product ranks against its peers, regardless of the display order. You can also see this by adding <span class="mono">ProductName</span> to a slicer and adding <span class="mono">[Product</span> <span class="mono">Rank]</span> to a card, as shown below. Then, when you select a product from the slicer, the card indicates where that product ranks.</p>
			<p class="fp"><img class="_idgenobjectattribute136" src="images/000022.png" alt="" /></p>
			<p class="normal">This visual example is interesting. The column <span class="mono">Products[ProductName]</span> is not even used inside the <span class="mono">RANKX()</span> formula, but clicking a slicer using this column works. Why? Because of filtering behaviour. The column <span class="mono">Products[ProductName]</span> is filtering the entire <span class="mono">Products</span> table. When there is a single product name filtered, there is only a single product key that remains. The column <span class="mono">Products[ProductKey]</span> is used in the <span class="mono">RANKX()</span> formula, so it works. DAX is simple, but it’s not easy.</p>
			<p class="h"><span class="b2"><a id="calibre_link-375"></a></span><span class="b2">TOPN()</span></p>
			<p class="normal">Fortunately, the <span class="mono">TOPN()</span> function is a lot more straightforward than <span class="mono">RANKX()</span>. The syntax is as follows:</p>
			<p class="code"><span class="mono1">TOPN(</span><span class="monoitalic">n_value</span><span class="mono1">, </span><span class="monoitalic">table</span><span class="mono1">, [</span><span class="monoitalic">order by 1</span><span class="mono1">], [</span><span class="monoitalic">order by 2</span><span class="mono1">], ...)</span></p>
			<p class="normal">In this section I show you how to use the two mandatory parameters, and you can research the optional parameters yourself.</p>
			<p class="normal"><span class="mono">TOPN()</span> is a table function, so the most common usage is as a filter parameter inside a <span class="mono">CALCULATE()</span> function. To calculate sales of the top 10 best-selling products, for example, the formula would be as follows:</p>
			<p class="code"><span class="mono1">Sales from Top 10 Products =</span></p>
			<p class="code"><span class="mono1">    CALCULATE ([Total Sales],</span></p>
			<p class="code"><span class="mono1">        TOPN (10, Products,[Total Sales])</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">When you place this formula in a card, with no filters on any table, you get the same number from earlier in this chapter (the total sales for the top 10 products in the table visual).</p>
			<p class="fp"><img class="_idgenobjectattribute146" src="images/000324.png" alt="" /></p>
			<p class="normal">Note in the formula above that this time <span class="mono">ALL(Products)</span> is not used inside <span class="mono">TOPN()</span>. It is not needed there because there are no filters in the visuals. This is neither right nor wrong; how you handle it depends on what you want to do. Because of the way the formula is written, you can use this new measure in a table like the one below.</p>
			<p class="fp"><img class="_idgenobjectattribute147" src="images/000237.png" alt="" /></p>
			<p class="normal">Because there is no <span class="mono">ALL()</span> around the <span class="mono">Products</span> table, the measure is impacted by any filter coming from the visual. In the table visual above, you can now see the total sales of the top 10 products by category. If you used <span class="mono">ALL(Products)</span> inside the measure, the measure would ignore any filters coming from the visual, and instead it would always return the sales from the top 10 products, regardless of the filters coming from the <span class="mono">Products</span> table in the visual.</p>
		</div>
	</div>


<div id="calibre_link-55" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-434" class="ch"><span class="b2"><a id="calibre_link-22"></a>19: DAX Topic: </span><span class="b2"><a id="calibre_link-385"></a><a id="calibre_link-325"></a><a id="calibre_link-324"></a></span><span class="b2">RELATED() and RELATEDTABLE()</span></p>
			<p class="normal">The functions <span class="mono">RELATED()</span> and <span class="mono">RELATEDTABLE()</span> are typically used in calculated columns to reference relevant records in other tables, although they can be used in measures, too. They are a bit like <span class="mono">VLOOKUP()</span> functions for tables that have a relationship. As mentioned briefly in Chapter 11, row context exists in a single table, and it does not follow a relationship to impact other tables. So there may be a relationship between two tables, but row context cannot use this relationship&mdash;unless you use <span class="mono">RELATED()</span> or <span class="mono">RELATEDTABLE()</span> to trigger its use. Basically, <span class="mono">RELATED()</span> and <span class="mono">RELATEDTABLE()</span> allow row context to leverage an existing relationship so it can access columns in related tables.</p>
			<p class="h"><span class="b2">When to Use RELATED() vs. RELATEDTABLE()</span></p>
			<p class="normal">To understand when to use the <span class="mono">RELATED()</span> and <span class="mono">RELATEDTABLE()</span> functions, you need to understand what each one returns. As you know, you can use IntelliSense in the formula bar to find out what each of these functions returns.</p>
			<p class="normal">You can see below that <span class="mono">RELATED()</span> returns a single value from another table. In particular, it returns a single value from the “one” side of another related table. <span class="mono">RELATED()</span> always works from the “many” side of a relationship to the “one” side of the relationship.</p>
			<p class="fp"><img class="_idgenobjectattribute148" src="images/000181.png" alt="" /></p>
			<p class="normal">As shown below, <span class="mono">RELATEDTABLE()</span> returns a table. It works in the other direction from <span class="mono">RELATED()</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute149" src="images/000223.png" alt="" /></p>
			<p class="normal">Remember from Chapter 2 that relationships between tables in Power BI are normally of the type one to many. Also remember from Chapter 2 that best practice (especially for people coming from an Excel background) is to lay out tables in the Model view with the lookup tables at the top (the “one” side of the relationships) and the data tables at the bottom (the “many” side of the relationships), as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute150" src="images/000128.png" alt="" /></p>
			<p class="normal">The <span class="mono">RELATED()</span> and <span class="mono">RELATEDTABLE()</span> functions allow you to refer to columns in another connected table. So if you want to add a custom column in a table on the “one” side of the relationship&mdash;that is, add a new column in a lookup table (a table above the line in the image above)&mdash;it is highly likely that there will be multiple rows on the “many” side of the relationship. When writing a formula in a calculated column on a lookup table, you must use the <span class="mono">RELATEDTABLE()</span> function because it fetches a table of values, including all the matching values in the data table. Conversely, if you are writing a calculated column in a table on the “many” side of the relationship (i.e., a data table), there will be only one matching row in the lookup table, and hence you use <span class="mono">RELATED()</span> to return that single value.</p>
			<p class="h"><span class="b2">The RELATED() Function</span></p>
			<p class="normal">This section provides an example of bringing a value from a column in a lookup table into a table on the “many” side of the relationship. For the sake of this example, assume that your business has a new management layer, and you want to add a new level of reporting to cover this new management layer. In effect, you need to enhance the <span class="mono">Territories</span> table to add a new geographic region. To achieve this, you could do the following:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a new table that contains the logic of the new management layer.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Import the new table into the data model.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Join the new table to the existing <span class="mono1">Territories</span> table.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Create a new calculated column in the <span class="mono1">Territories</span> table (on the “many” side of the relationship) and bring in the new management layer from the new table into the <span class="mono1">Territories</span> table as a new column.</p>
			<p class="normal">This will all make more sense as you work through the following example, which also shows how you can manually add new tables of data in Power BI.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-88"></a>Here’s How: </span><span class="b2"><a id="calibre_link-205"></a></span><span class="b2">Manually Adding Data to Power BI</span></p>
			<p class="normal">This section shows how to add data directly into Power BI without having to use another tool, such as Excel:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>On the Home tab in Power BI Desktop, click Enter Data.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Click the * shown below to add a new column.</p>
			<p class="fp"><img class="_idgenobjectattribute151" src="images/000111.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Change the column names by double-clicking them and typing the names shown below and then enter the data as shown below. Rename the table <span class="mono1">Hemisphere</span> and then click Load.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000057.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Switch to the Model view and rearrange the tables so that the new table is sitting above the current <span class="mono1">Territories</span> table, as shown below. This new lookup table is a lookup table to another lookup table and will be on the “one” side of the new relationship. Power BI should automatically join the tables.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000067.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>The <span class="mono1">Territories</span> table now has two roles. It is now acting as a lookup table to the <span class="mono1">Sales</span> table and as a data table to the new <span class="mono1">Hemisphere</span> table.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Bring the data that resides in the <a id="calibre_link-241"></a><span class="mono1">Hemisphere[Hemisphere]</span> column into a new calculated column inside the <span class="mono1">Territories</span> table. Switch to the Data view, right-click on the <span class="mono1">Territories</span> table in the Fields pane, select New Column, and then type in the formula shown below. After you press Enter, you see all the values appear in the new calculated column. It is a lot like <span class="mono1">VLOOKUP()</span>!</p>
			<p class="fp"><img class="_idgenobjectattribute152" src="images/000077.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Finally, to hide the <span class="mono1">Hemisphere</span> table from the client tools, in the Data view, right-click the table in the Fields pane (see #1 below) and select Hide in Report View (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute65" src="images/000145.png" alt="" /></p>
			<p class="normal">It is good practice to bring data from an add-on table like this <span class="mono">Hemisphere</span> table into the main <span class="mono">Territories</span> table as an additional column rather than use the data in an additional lookup table. It is possible to leave the <span class="mono">Territories</span> table untouched and use the columns from the <span class="mono">Hemisphere</span> table in your matrix. But the problem is that this can be confusing to users. It doesn’t make business sense to have all the geographic information in the <span class="mono">Territories</span> table except for the hemisphere information, which is in the <span class="mono">Hemisphere</span> table. So for consistency and simplicity for the end user, it is better to bring all the “like data” into the same table.</p>
			<p class="note"><span class="b1">Note: </span>Better practice is to bring data from an add-on table into a new column when you load the data using Power Query, but you can also do it as shown here. And best practice is to change the <span class="mono1">Territories</span> table back at the source to include the new <span class="mono1">Hemisphere</span> column in the source <span class="mono1">Territories</span> table. However, the person responsible for making changes to the source table may not do it according to your time frame (if at all); this approach allows you to do it yourself right away.</p>
			<p class="h"><span class="b2">The RELATEDTABLE() Function</span></p>
			<p class="normal">As discussed earlier, <span class="mono">RELATEDTABLE()</span> is used to reference a table on the “many” side of a relationship. A simple example is to add a new calculated column to count the number of sales for each product. Once again, I generally don’t recommend that you do this (because you can do it in a measure), but there may be valid reasons to do it in some cases.</p>
			<p class="normal">To see how to use <span class="mono">RELATEDTABLE()</span>, add the following calculated column in the <span class="mono">Products</span> table:</p>
			<p class="code"><span class="mono1">= COUNTROWS(RELATEDTABLE(Sales))</span></p>
			<p class="normal">As you know, <span class="mono">RELATEDTABLE()</span> returns a table, and <span class="mono">COUNTROWS()</span> counts the rows in that table. This calculated column in the <span class="mono">Products</span> table therefore takes the row context in the calculated column and leverages the relationship with the <span class="mono">Sales</span> table to count the rows in the <span class="mono">Sales</span> table for just the single product. As a result, you end up with a new column that indicates the number of items sold (over all time) for each product in the <span class="mono">Products</span> table. (The quantity for each line in the <span class="mono">Sales</span> table is always 1 in this sample data.)</p>
			<p class="note"><span class="b1">Note: </span>You do not need to use <span class="mono1">CALCULATE()</span> with <span class="mono1">RELATEDTABLE()</span> to force context transition and convert the row context to filter context. In this case, <span class="mono1">RELATEDTABLE()</span> works on its own; this is another example of syntax sugar.</p>
			<p class="normal">One valid use case for <span class="mono">RELATEDTABLE()</span> would be if you want to create a slicer to filter on products that sell slowly, moderately, and quickly. If you want to use a slicer, you must write your DAX as a calculated column. (Remember that you can’t place measures in slicers.) You could first create a calculated column and then use a banding technique, as discussed in the next chapter, to group products into slow-, moderate-, and fast-moving categories. (Park this thought for now and come back after you have read Chapter 20 if you want to try out this technique.)</p>
		</div>
	</div>


<div id="calibre_link-56" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-435" class="ch"><span class="b2"><a id="calibre_link-23"></a>20: Concept: </span><span class="b2"><a id="calibre_link-197"></a></span><span class="b2">Disconnected Tables</span></p>
			<p class="normal">So far as you have worked through this book, you have loaded tables into the data model and then connected them to other tables. This is a fundamental technique with Power BI that allows you to work across multiple tables without using <span class="mono">VLOOKUP()</span>. However, you are not required to join tables together in the data model, and indeed there are some instances when it doesn’t make sense to do so. This chapter discusses two techniques that do not involve connecting tables using relationships:</p>
			<ul class="calibre2">
				<li class="bl">What-if analysis</li>
				<li class="bl">Banding</li>
			</ul>
			<p class="h"><span class="b2">Using </span><span class="b2"><a id="calibre_link-388"></a></span><span class="b2">What-If Analysis</span></p>
			<p class="normal">Power BI is not Excel, and you can’t just type any number into a cell and see that number impact the rest of your report. However, with Power BI’s what-if parameters, you can accept user interaction with a report, and that interaction then flows through to other calculations. Let’s look at an example that demonstrates how to use the Power BI what-if parameters.</p>
			<p class="normal">Say that your profit result is directly impacted by your sales result. You have some sales data and want to see what impact an increase in sales will have on your total profit result. You could write a new measure and hard code a sales increase such as 10%, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute153" src="images/000198.png" alt="" /></p>
			<p class="normal">The resulting matrix would look as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute37" src="images/000155.png" alt="" /></p>
			<p class="normal">But what if you wanted to see what it looks like for a 5% increase in sales, or 15%, or some other percentage? Well, you could change this measure every time you want to see a different growth percentage, but that works only when you are using Power BI Desktop. You cannot edit measures after a workbook is published to PowerBI.com. And it would be inefficient to create lots of new measures, one for each possible value of sales growth that you want to consider. A better approach is to use the what-if analysis capability provided by Power BI.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-89"></a>Here’s How: Using What-If</span></p>
			<p class="normal">To use what-if parameters in Power BI, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a new blank page in your Power BI workbook.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Navigate to the Modeling tab and click New <a id="calibre_link-300"></a>Parameter, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute154" src="images/000174.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Enter minimum and maximum values that will be used inside the what-if analysis, along with the increment. The figure below shows a range of integers from 0 to 15 and an increment of 1 for a parameter named <span class="mono1">Increase</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute100" src="images/000350.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Click OK.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Notice that there is a new table (including the new measure <span class="mono1">[Increase Value]</span> in the Fields pane (see #1 below) and also a new slicer (#2) on the report.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000303.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Write the following new measure, which utilises the <span class="mono1">[Increase Value] </span>measure: </p>
			<p class="codeindented1"><span class="mono1">Total Margin with Selected Increase =</span></p>
			<p class="codeindented1"><span class="mono1">    VAR NewSales = [Total Sales] * (100 + [Increase Value])/100</span></p>
			<p class="codeindented1"><span class="mono1">    VAR NewMargin = NewSales &ndash; [Total Cost]</span></p>
			<p class="codeindented1"><span class="mono1">    RETURN NewMargin</span></p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Add the new measure to the matrix from before, as shown below. (Note that there is still a visual-level filter on <span class="mono1">CalendarYear = 2018</span>.) You can now use the slicer (see #1 below) to vary the sales increase and see what impact the change has on <span class="mono1">[Total Margin with Selected Increase]</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute155" src="images/000312.png" alt="" /></p>
			<p class="h"><span class="b2">How It Works</span></p>
			<p class="normal">When you click the New Parameter button in Power BI, Power BI automatically creates three things: a new table of possible values that can be used by the parameter, a new measure, and a new slicer (which is optional but is created by default).</p>
			<p class="h1"><span class="b2">The New Table</span></p>
			<p class="normal">Select the new <span class="mono">Increase</span> table that was just created from the Fields pane (see #1 below). This new table is a calculated table that uses the formula shown below (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000328.png" alt="" /></p>
			<p class="normal">It is pretty easy to work out the syntax of the function <span class="mono">GENERATESERIES()</span> just by looking at the formula above. <span class="mono">GENERATESERIES()</span> is a DAX function in Power BI Desktop that you can use any time you want to create a new table of values with a constant increment between values.</p>
			<p class="normal">If you switch to the Model view, you see the new table. (You may need to select Fit to Screen to be able to see it.) The table is not currently joined to any other table; it is a disconnected table. You can just position it somewhere so it is easy to see on the screen, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000027.png" alt="" /></p>
			<p class="h1"><span class="b2">The New </span><span class="b2"><a id="calibre_link-348"></a></span><span class="b2">Slicer</span></p>
			<p class="normal">If you switch back to the Report view, you can see the new slicer that was automatically created. This slicer uses the only column in the table, <span class="mono">Increase[Increase]</span>, as the input field. The slicer allows a user to select a single value to represent the increase in sales required for analysis.</p>
			<p class="h1"><span class="b2">The New Measure</span></p>
			<p class="normal">If you now click on the <span class="mono">[Increase</span> <span class="mono">Value]</span> measure, you see that the measure formula is as follows:</p>
			<p class="code"><span class="mono1">Increase Value = SELECTEDVALUE(Increase[Increase])</span></p>
			<p class="normal">This measure uses the function <span class="mono">SELECTEDVALUE()</span>. Recall from Chapter 13 that this function returns the single value selected in the filter context, or it is blank if there is more than one value selected. This is the secret sauce of this what-if parameter: The <span class="mono">SELECTEDVALUE()</span> function “harvests” the selection from the user (when the user clicks on the slicer) and then passes that selected value to the formula. If the user hasn’t selected a single value, it returns <span class="mono">BLANK()</span> by default (though this can be changed via an optional final parameter in the <span class="mono">SELECTEDVALUE()</span> function).</p>
			<p class="note"><span class="b1">Note: </span>The behaviour of slicers tends to change as Microsoft improves and further develops Power BI. At this writing, there are a number of different configuration choices for slicers. You can click the drop-down arrow in the top-right corner of a slicer to change the way the slicer is displayed.</p>
			<p class="h1"><span class="b2">Seeing All What-If Variants at Once</span></p>
			<p class="normal">In addition to using the slicer to see one of the what-if numbers at a time, you can use the <span class="mono">Increase[Increase]</span> column on Rows in a matrix to see all the possible values at once. For example, you can modify the matrix from earlier as shown below. In this example, <span class="mono">Products[Category]</span> has been removed from Rows, and <span class="mono">Increase[Increase]</span> has been added to Rows in its place (see #1 below). This example also shows the selection from the slicer cleared so you can see the full list of values. Finally, some conditional formatting has been added to make the changes in the measure more obvious.</p>
			<p class="normal"><img class="_idgenobjectattribute156" src="images/000355.png" alt="Table  Description automatically generated with medium confidence" /></p>
			<p class="h1"><span class="b2">Practice Exercise: </span><span class="b2"><a id="calibre_link-239"></a></span><span class="b2">Harvester Measures</span></p>
			<p class="normal">In Chapter 9, you created the following DAX formula:</p>
			<p class="code"><span class="mono1">Total Customers Born Before 1970 =</span></p>
			<p class="code"><span class="mono1">    CALCULATE([Total Number of Customers],</span></p>
			<p class="code"><span class="mono1">        Customers[BirthDate] &lt; DATE(1970,1,1)</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="normal">In the next practice exercise, you will write a measure that allows you to change the “before year” by using the what-if feature.</p>
			<p class="normal">Write the following new DAX formula. Find the solution to this practice exercise in <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">70. [Total </span><span class="bi"><a id="calibre_link-170"></a></span><span class="bi">Customers Born Before Selected Year]</span></p>
			<p class="normal">Using the technique described above, create a new matrix (on a new page) that allows the user to select from a list of years in a slicer by using a new what-if parameter. Change the measure <span class="mono">[Total</span> <span class="mono">Customers</span> <span class="mono">Born</span> <span class="mono">Before</span> <span class="mono">1970]</span> from being hard coded to 1970 so that the year can be selected from the slicer.</p>
			<p class="normal">This is quite a difficult problem, and you will have to think back on what you have learnt in previous chapters to make it work. You should try to do it yourself. If you get stuck, read the start of the worked-through solution below and then try again to solve the problem.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-90"></a>Here’s How: Solving Practice Exercise 70</span></p>
			<p class="normal">There is a trick to this practice exercise. The original measure you created uses a simple filter in <span class="mono">CALCULATE()</span>. If you replace the year value 1970 from the first formula with the what-if measure <span class="mono">[Year</span> <span class="mono">Value]</span>, you get the error message shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000004.png" alt="" /></p>
			<p class="normal">The problem is that you cannot use measures in a “simple” <span class="mono">CALCULATE()</span> formula. If you want to use measures (as you do in this case), you must use the <span class="mono">FILTER()</span> function inside <span class="mono">CALCULATE()</span>. So instead of writing this:</p>
			<p class="code"><span class="mono1">Customers[BirthDate] &lt; DATE ( [Year Value], 1, 1 )</span></p>
			<p class="normal">you need to write a <span class="mono">FILTER()</span> function that filters the <span class="mono">Customers</span> table to replace the line above.</p>
			<p class="normal">Go back and give it a go: See if you can write the correct formula by using the <span class="mono">FILTER()</span> function. If you still need more help, read on to see the correct formula.</p>
			<p class="normal">Here is the worked-through solution for Practice Exercise 70:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a new what-if parameter using values such as 1900 through 2000. Give the parameter a name such as <span class="mono1">Year</span>. If you create a parameter called <span class="mono1">Year</span>, the what-if parameter automatically creates a new measure called <span class="mono1">[Year Value]</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Write the following measure and then add it to your matrix:</p>
			<p class="codeindented1"><span class="mono1">Total Customers Born Before Selected Year =</span></p>
			<p class="codeindented1"><span class="mono1">    CALCULATE([Total Number of Customers],</span></p>
			<p class="codeindented1"><span class="mono1">        FILTER(Customers,</span></p>
			<p class="codeindented1"><span class="mono1">            Customers[BirthDate] &lt; DATE([Year Value], 1, 1)</span></p>
			<p class="codeindented1"><span class="mono1">        )</span></p>
			<p class="codeindented1"><span class="mono1">    )</span></p>
			<p class="normal">You should end up with something that looks as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute157" src="images/000012.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>I have changed the <a id="calibre_link-351"></a>slicer layout here to be a list of values. You can change a slicer’s layout by using the drop-down arrow in the top-right corner of the slicer, as shown above.</p>
			<p class="normal">When you click on a year in the slicer, the <span class="mono">[Year</span> <span class="mono">Value]</span> measure updates, and the results for <span class="mono">[Total</span> <span class="mono">Customers</span> <span class="mono">Born</span> <span class="mono">Before</span> <span class="mono">Selected</span> <span class="mono">Year]</span> update to show the value for the year selected in the slicer.</p>
			<p class="h"><span class="b2">The </span><span class="b2"><a id="calibre_link-366"></a></span><span class="b2">SWITCH() Function Revisited</span></p>
			<p class="normal">In Chapter 12, I introduced you to the <span class="mono">SWITCH()</span> function. One really cool feature of <span class="mono">SWITCH()</span> is that you can create a switch measure that allows you to toggle between multiple other measures. For example, take a look at the image below.</p>
			<p class="fp"><img class="_idgenobjectattribute158" src="images/000347.png" alt="" /></p>
			<p class="normal">The left side of the image shows Total Sales selected in the slicer (see #1 above). When Total Sales is selected, the chart updates to show total sales (#2). When the user selects Total Cost (#3), the chart changes to show total cost (#4). This toggle effect is really engaging for the report user and makes it possible to create very complex and useful interactive reports.</p>
			<p class="normal"><span class="b3"><a id="calibre_link-436" class="calibre3"></a></span><span class="b4"><a id="calibre_link-437" class="calibre3"></a>Here’s How: Creating a Morphing Switch Measure</span></p>
			<p class="normal">To create a morphing switch measure, you need to create a disconnected table and a harvester measure by completing these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>On the Home tab in Power BI, click Enter Data.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Enter three rows of data, as shown below. Name the table <span class="mono1">DisplayMeasure</span> and click Load.</p>
			<p class="fp"><img class="_idgenobjectattribute159" src="images/000071.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Navigate to the Data view, click the new <span class="mono1">DisplayMeasure </span>table in the Fields pane, go to the Modeling tab, and change the sort order of the <span class="mono1">Measure</span> column to sort by the <span class="mono1">Measure ID </span>column instead. (Do you remember how? If not, review Chapter 13.)</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Right-click the <span class="mono1">DisplayMeasure</span> table in the Fields pane, select New Measure, and add this new measure:</p>
			<p class="codeindented1"><span class="mono1">Selected Measure = SELECTEDVALUE(DisplayMeasure[Measure ID])</span></p>
			<p class="nlc">I call this a harvester measure, and it uses the same technique used with what-if earlier in the chapter: It checks to see if there is a single value selected for <span class="mono">DisplayMeasure[Measure ID]</span>, and if so, it returns that value; otherwise, it returns <span class="mono">BLANK</span>. It “harvests” the selection from the user when it is used with a slicer.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Go back to the Report view and create a new page. Place a <a id="calibre_link-148"></a>card on the report (see #1 below) and add the <span class="mono1">DisplayMeasure[Measure]</span> column to the card Fields list (#2). Then place a slicer on the report (#3) and place <span class="mono1">DisplayMeasure[Measure]</span> on the slicer (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute110" src="images/000339.png" alt="" /></p>
			<p class="nlc">Now when you click on the slicer, the card updates to show which measure you have selected. This card will be the title for the chart that will be added next.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Click on the card, go to the Format pane, and turn off Category Label.</p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Right-click on the <span class="mono1">Sales</span> table in the Fields pane, select New Measure, and write the following measure:</p>
			<p class="codeindented1"><span class="mono1">Measure to Display =</span></p>
			<p class="codeindented1"><span class="mono1">    SWITCH([Selected Measure],</span></p>
			<p class="codeindented1"><span class="mono1">        1,[Total Sales],</span></p>
			<p class="codeindented1"><span class="mono1">        2,[Total Cost],</span></p>
			<p class="codeindented1"><span class="mono1">        3,[Total Margin $]</span></p>
			<p class="codeindented1"><span class="mono1">    )</span></p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>Add a new column chart to the report. (Either a clustered or stacked column chart will work.) Place<span class="mono1"> CalendarYear </span>on Axis and the new <span class="mono1">[Measure to Display] </span>measure on Values, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000331.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">9.</span>Go to the Format pane for the chart and turn off the default title. Also expand the X-axis section and set Type to Categorical.</p>
			<p class="normal">You should now have an interactive chart that displays the measure that a user selects in the slicer.</p>
			<p class="h1"><span class="b2">Expression-Based Formatting</span></p>
			<p class="normal">The example above uses a card as the report <a id="calibre_link-213" class="calibre3"></a><a id="calibre_link-373" class="calibre3"></a>title. This works, but there is a better way: You can use expression-based formatting. Expression-based formatting exists in many areas throughout Power BI, and you can use it in more ways with each new release. If you navigate back to the Format pane and turn on the title of the chart, you see an Fx button like the one highlighted in the image below. The Fx button allows you to apply expression-based formatting. Any time a formatting option has an Fx button, you know that you can write a DAX formula to control the formatting item (the chart title in this instance).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000035.png" alt="" /></p>
			<p class="normal">To create this chart, I created the following new measure:</p>
			<p class="code"><span class="mono1">Chart Title = SELECTEDVALUE(DisplayMeasure[Measure])</span></p>
			<p class="normal">I then clicked on the Fx button next to the chart title and set the title text as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute160" src="images/000043.png" alt="" /></p>
			<p class="normal">Thanks to this change, the card at the top is no longer needed, and the title in the chart automatically updates with the selection in the slicer, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000019.png" alt="" /></p>
			<p class="h"><span class="b2">Using </span><span class="b2"><a id="calibre_link-113"></a><a id="calibre_link-128"></a></span><span class="b2">Banding</span></p>
			<p class="normal">Banding is a disconnected table technique I learnt about from Marco <a id="calibre_link-337" class="calibre3"></a>Russo and Alberto <a id="calibre_link-216" class="calibre3"></a>Ferrari at <a href="http://sqlbi.com" class="calibre3"><span class="u">http://sqlbi.com</span></a>.</p>
			<p class="normal">To understand banding, think about the earlier example in which you created a slicer based on the year the customer was born. A more common and practical need is to be able to analyse customers based on their age groups rather than their actual ages, like this:</p>
			<ul class="calibre2">
				<li class="bl">Under 20</li>
				<li class="bl">20 but less than 30</li>
				<li class="bl">30 to less than 40</li>
				<li class="bl">40 to less than 50</li>
				<li class="bl">50 to less than 60</li>
				<li class="bl">60 and over</li>
			</ul>
			<p class="normal">You could write a calculated column in the <span class="mono">Customers</span> table that creates these age group bands. But it would require a very complex formula that would be hard to edit.</p>
			<p class="note"><span class="b1">Note: </span>For the sake of the exercise, I use January 1, 2018, as the “current date” from which to work out the age of each customer. Of course, in reality, each customer’s age band will change over time, but I have ignored that fact for this example so that the results you see onscreen will be the same as my results shown below. If I used <a id="calibre_link-374"></a><span class="mono1">TODAY()</span> in this exercise, my results would be different from yours; this is why I have not done so in this case.</p>
			<p class="normal">A hard-coded calculated column formula for age group might look like this:</p>
			<p class="code"><span class="mono1">= IF(</span></p>
			<p class="code"><span class="mono1">    ((date(2018,1,1) - Customers[BirthDate])/365) &lt; 20,</span></p>
			<p class="code"><span class="mono1">        "Less than 20",</span></p>
			<p class="code"><span class="mono1">        IF (((date(2018,1,1) - Customers[BirthDate])/365) &lt; 30,</span></p>
			<p class="code"><span class="mono1">            "20 to less than 30",</span></p>
			<p class="code"><span class="mono1">            IF(((date(2018,1,1) - Customers[BirthDate])/365) &lt; 40,</span></p>
			<p class="code"><span class="mono1">            "30 to less than 40",</span></p>
			<p class="code"><span class="mono1">            IF(((date(2018,1,1) - Customers[BirthDate])/365) &lt; 50,</span></p>
			<p class="code"><span class="mono1">            "40 to less than 50",</span></p>
			<p class="code"><span class="mono1">            IF(((date(2018,1,1) - Customers[BirthDate])/365) &lt; 60,</span></p>
			<p class="code"><span class="mono1">            "50 to less than 60",</span></p>
			<p class="code"><span class="mono1">            "Greater than 60"</span></p>
			<p class="code"><span class="mono1">                )</span></p>
			<p class="code"><span class="mono1">            )</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="code"><span class="mono1">    )</span></p>
			<p class="code"><span class="mono1">)</span></p>
			<p class="normal">This DAX works, but it is not very user friendly, it is hard to write, and it is even harder to read and maintain. A better approach is to use banding.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-91"></a>Here’s How: Applying Banding</span></p>
			<p class="normal">The first step in applying banding is to create a table of data that contains the upper and lower values for each band, as well as text descriptions. You can type these values directly into Power BI. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>On the Home tab in Power BI, click Enter Data.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Enter data into the form as shown below. Name the table <span class="mono1">AgeBands</span> and then click Load.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000060.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>It is important to set up the banding table so there is no crossover of ages between the low and high ranges. The table above covers all possible ages between 0 and 999, without any duplication. Of course, the 999 value is an arbitrarily large value to catch everyone.</p>
			<p class="note"><span class="b1">Note: </span>There is no need to join this table to any other table in the data model. In fact, there is no workable way you can do that. Even if there were an age column in the <span class="mono1">Customers</span> table, you still couldn’t join this table to the age column. This banding table doesn’t contain all the possible ages for customers; it just has the age bands. So if you first create a customer age column and then join the <span class="mono1">Low</span> column to this new column, the data will only match for customers who are 20, 30, 40, etc. There will be no match for customers with ages that don’t end in a zero (e.g., 21, 22, 23)&mdash;so that is not going to work. Because this table is not joined, it is called a disconnected table.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>In the Data view, right-click the <span class="mono1">Customers</span> table in the Fields pane, select New Column, and enter the following formula:</p>
			<p class="codeindented1"><span class="mono1">Age =(DATE(2018,1,1) - Customers[BirthDate])/365</span></p>
			<table id="calibre_link-438" class="note-table">
				<colgroup class="calibre4">
					<col class="calibre5"></col>
				</colgroup>
				<tbody class="calibre6">
					<tr class="note-table1">
						<td class="note-table2">
							<p class="normal"><span class="b3">Note: </span>Although it is not required to make this banding technique work, you could enhance this formula with some rounding, as follows:</p>
							<p class="code"><span class="mono1">Age = ROUNDDOWN((DATE(2018,1,1) - <br class="calibre7" />      Customers[BirthDate])/365, 0)</span></p>
							<p class="normal">Now you have a new calculated column, as shown below, and you can write some DAX to create the banding column.</p>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000070.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Right-click the <span class="mono1">Customers</span> table in the Fields pane, select New Column, and enter the following formula:</p>
			<p class="codeindented1"><span class="mono1">Age Group =</span></p>
			<p class="codeindented1"><span class="mono1">    CALCULATE(VALUES(AgeBands[Band]),</span></p>
			<p class="codeindented1"><span class="mono1">        FILTER(AgeBands,</span></p>
			<p class="codeindented1"><span class="mono1">            Customers[Age] &gt;= AgeBands[Low]</span></p>
			<p class="codeindented1"><span class="mono1">            &amp;&amp; Customers[Age] &lt; AgeBands[High]</span></p>
			<p class="codeindented1"><span class="mono1">        )</span></p>
			<p class="codeindented1"><span class="mono1">    )</span></p>
			<p class="nlc">The key to this formula is the <span class="mono">FILTER()</span> function. This function iterates over the <span class="mono">AgeBands</span> table and checks each customer’s age against the low and high values for each band. There is only ever one single row in the <span class="mono">AgeBands</span> table that matches the age of the customer. The <span class="mono">FILTER()</span> function inside <span class="mono">CALCULATE()</span> first filters the <span class="mono">AgeBands</span> table so that only the one row that matches the age band is left visible. Then <span class="mono">CALCULATE() </span>evaluates the expression <span class="mono">VALUES(AgeBands[Band])</span>, and because there is only one row visible, <span class="mono">VALUES()</span> returns the name of the band as a text value into the column.</p>
			<p class="normal">There are two main benefits of taking this approach to banding:</p>
			<ul class="calibre2">
				<li class="bl">The DAX formula is easier to read and understand. Once you get used to the concept, it is easier to write, too.</li>
				<li class="bl">It is easy to make changes in the future. For example, if you want to add another age band to your analysis (e.g., a new “Greater than 70” age band), all you need to do is add another row to your <span class="mono">AgeBands</span> table and then click Refresh.</li>
			</ul>
			<p class="h1"><span class="b2">Power Query or </span><span class="b2"><a id="calibre_link-189"></a></span><span class="b2">DAX?</span></p>
			<p class="normal">Quite a few scenarios in this book could be handled by using Power Query rather than DAX. When should you use each of them? This is a DAX book, so I am teaching you how to solve these problems with DAX, but using Power Query may often be a better approach. The rules I use to decide which approach to use are as follows:</p>
			<ul class="calibre2">
				<li class="bl">Do the work as close to the source as possible: Change it in the source data if possible; otherwise, do it in Power Query.</li>
				<li class="bl">Use a DAX calculated column when:<ul class="calibre9"><li class="subbl">You need to use a measure from your model as part of the calculation.</li><li class="subbl">You need to leverage the relationships in the model as part of the calculation.</li><li class="subbl">You don’t know how to do it in Power Query.</li></ul></li>
			</ul>
			<p class="normal">Say that you wanted to add the column <span class="mono">Large</span> <span class="mono">Customers</span> to your <span class="mono">Customers</span> table. How would you do this in Power Query? You would have to do a table merge between customers and sales in Power Query, you would need to aggregate all the sales in the <span class="mono">Sales</span> table per customer, and then you would need to create a new conditional column to group the customers into small, medium, and large categories. It would be a lot easier to do this in DAX because you already have the relationship between the two tables, and you already have the <span class="mono">[Total</span> <span class="mono">Sales]</span> measure.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-92"></a>Here’s How: </span><span class="b2"><a id="calibre_link-204"></a></span><span class="b2">Editing a Table Previously Created with the Enter Data Feature</span></p>
			<p class="normal">It’s not immediately obvious how to edit data that you have created by using the Enter Data feature in Power BI. This example shows you how to do it. To add a new row to the table, you do the following:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Right-click the <span class="mono1">AgeBands</span> table in the Fields pane and select Edit Query.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the Query Editor (shown below), click on the cog next to the Source step.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000080.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>In the dialog box that appears, enter the data to add the new bands of data. Your table should look like the one shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000089.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Click OK.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Click Close &amp; Apply on the Query Editor tab and then save the .pbix workbook. </p>
			<p class="note"><span class="b1">Note: </span>Maintaining a banding table like this is much easier than editing a complex nested <span class="mono1">IF()</span> statement.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>To use this new calculated column in a visual, create a new matrix on a new page, put <span class="mono1">Customers[Age Group] </span>on Rows, and add the following measures, which you wrote in Practice Exercises 1 and 15:</p>
			<p class="codeindented1"><span class="mono1">[Total Sales]</span></p>
			<p class="codeindented1"><span class="mono1">[Total Customers That Have Purchased]</span></p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Add some conditional formatting so that the matrix is easier to read, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute161" src="images/000096.png" alt="" /></p>
			<p class="normal">It is easy to see the power of banding. You are unlikely to ever want to analyse a business based on sales to customers age 20 or 21 or 22. Grouping customers into age brackets is more practical, and this disconnected table banding technique makes such grouping easy.</p>
			<p class="h1"><span class="b2"><a id="calibre_link-356"></a></span><span class="b2">Houston, We Have a Problem</span></p>
			<p class="normal">Do you see the problem in the image above? The <span class="mono">Age</span> <span class="mono">Group</span> column is sorted alphanumerically, so “Less than 20” appears last in the list but should appear first. There are two ways to solve this issue. You either need to name the columns in such a way that they sort correctly (alphanumerically), or you need to add another column that can be used as a sort override. To add another column, you simply copy the calculated column from above and use the DAX to create a new column with a few minor changes. In the following measure, <span class="mono">VALUES()</span> now returns the low value in place of the band:</p>
			<p class="code"><span class="mono1">Age Group Sort =</span></p>
			<p class="code"><span class="mono1">    VAR Age = ROUNDDOWN((DATE(2018,1,1) - Customers[BirthDate])/365,0)</span></p>
			<p class="code"><span class="mono1">    RETURN</span></p>
			<p class="code"><span class="mono1">        CALCULATE(VALUES(AgeBands[Low]),</span></p>
			<p class="code"><span class="mono1">            FILTER(AgeBands,</span></p>
			<p class="code"><span class="mono1">                Age &gt;= AgeBands[Low] &amp;&amp;</span></p>
			<p class="code"><span class="mono1">                Age &lt; AgeBands[High]</span></p>
			<p class="code"><span class="mono1">            )</span></p>
			<p class="code"><span class="mono1">        )</span></p>
			<p class="normal">You then sort the <span class="mono">Age</span> <span class="mono">Group</span> column based on the <span class="mono">Age</span> <span class="mono">Group</span> <span class="mono">Sort</span> column, as discussed in Chapter 13. After you make this change, the matrix looks as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute162" src="images/000104.png" alt="" /></p>
			<p class="h"><a id="calibre_link-252"></a><span class="b2">Interim Calculated Columns</span></p>
			<p class="normal">In the banding example, you first created an <span class="mono">Age</span> calculated column and then created an <span class="mono">Age</span> <span class="mono">Group</span> calculated column. Breaking the problem into parts like this makes the DAX easier to read, write, and debug. However, you should be aware that it is generally not considered good practice to leave interim calculated columns in a data model&mdash;unless you want to use these columns in your data model as well, of course&mdash;as they inefficiently take up extra space. What you really should do after you get your model working as expected is combine all the unwanted interim columns into a single final calculated column and then delete the interim columns. This saves space in your workbook, which improves reporting and refresh efficiency. However, making such a change could also make the formula harder to read (although it is almost always easier if you use variables). In this case, the <span class="mono">Age</span> column is useful, so you can keep it. But if the interim columns you create are not useful in your model, you are better off removing them and hard coding the needed information into the final calculated column.</p>
			<p class="h1"><span class="b2">Variables Syntax for the Final Calculated Column</span></p>
			<p class="normal">The formula for the <span class="mono">Age</span> <span class="mono">Group</span> calculated column is shown below, using variables.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000114.png" alt="" /></p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-93"></a>Here’s How: Deleting Interim Calculated Columns</span></p>
			<p class="normal">Follow these steps to combine the interim column into the final banding calculated column and then delete the interim column:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Navigate to the <span class="mono1">Age</span> interim calculated column in the table.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Highlight the formula, as shown below, and then press Ctrl+C to copy the entire formula from the interim column.</p>
			<p class="fp"><img class="_idgenobjectattribute163" src="images/000122.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Navigate to the final <span class="mono1">Age Group</span> banding calculated column. You can enlarge the formula bar by clicking the drop-down arrow at the top right, if needed.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Create two new blank lines after the = in the formula by pressing Shift+Enter. The formula bar should now look as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute33" src="images/000131.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Type the keyword <span class="mono1">VAR</span> (see #1 below), paste in the <span class="mono1">Age</span> column code (#2), and then type the <span class="mono1">RETURN</span> keyword (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000139.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Replace the two instances of the original column named <span class="mono1">Customers[Age]</span> with the reference to the variable <span class="mono1">Age</span>, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute164" src="images/000149.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Delete the interim column <span class="mono1">Customers[Age]</span>.</p>
			<p class="note"><span class="b1">Note: </span>Of course, if you need the interim column in your table, you should keep it. But if you don’t need it, you should remove it by using the process shown here. You can find deeper coverage of the use of variables at my blog: <a href="http://xbi.com.au/variables"><span class="u1">http://xbi.com.au/variables</span></a>.</p>
		</div>
	</div>


<div id="calibre_link-57" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-439" class="ch"><span class="b2"><a id="calibre_link-24"></a>21: Concept: </span><span class="b2"><a id="calibre_link-287"></a></span><span class="b2">Multiple Data Tables</span></p>
			<p class="normal">So far in this book, we have used only a single data table, the <span class="mono">Sales</span> table. It is quite likely that you will want or need to use multiple data tables in your data models. When bringing a second data table into Power BI, people sometimes think that they should join the new data table to the original data table, but this is incorrect. The correct way to join a second data table to a data model is to treat the new data table exactly the same as the first data table; data tables should be joined to lookup tables.</p>
			<p class="normal">To better understand how to handle multiple data tables, let’s look at a common business scenario in which a business wants to load a <span class="mono">Budget</span> table as well as a <span class="mono">Sales</span> table. One of the challenges in this scenario is that a budget and sales are often at different levels of granularity. For example, sales may be captured and reported every day for every individual product, but budgets may be set only for each month and for each product category.</p>
			<p class="normal">Before we step through the process of modelling this data, let me explain a problem that needs to be solved.</p>
			<p class="h"><a id="calibre_link-265"></a><span class="b2">Many-to-Many Relationships</span></p>
			<p class="normal">The <a id="calibre_link-134" class="calibre3"></a><span class="mono">Budget</span> table has data that looks as shown below. There is a <span class="mono">Category</span> column with repeating values and a <span class="mono">Period</span> column with repeating values. These are the columns that need to be used to join the new data table to the rest of the model.</p>
			<p class="fp"><img class="_idgenobjectattribute165" src="images/000158.png" alt="" /></p>
			<p class="normal">The <span class="mono">Category</span> column needs to be joined to the <span class="mono">Products</span> table, and the <span class="mono">Period</span> column needs to be joined to the <span class="mono">Calendar</span> table.</p>
			<p class="normal">The image below shows a subset of the <span class="mono">Products</span> table (on the left) and a subset of the <span class="mono">Calendar</span> table (on the right). Take a close look. Do you see the problems?</p>
			<p class="normal"><span class="mono">Products</span> Table</p>
			<p class="fp"><img class="_idgenobjectattribute166" src="images/000166.png" alt="" /></p>
			<p class="normal"><span class="mono">Calendar</span> Table</p>
			<p class="normal"><img class="_idgenobjectattribute36" src="images/000175.png" alt="" /></p>
			<p class="normal">There are two main problems:</p>
			<ul class="calibre2">
				<li class="bl">The <span class="mono">Budget[Category]</span> column needs to be joined to the <span class="mono">Product[Category]</span> column, but both columns contain duplicate values.</li>
				<li class="bl">The <span class="mono">Budget[Period] </span>column needs to be joined to the <span class="mono">'Calendar'[Period]</span> column, but both columns contain duplicate values.</li>
			</ul>
			<p class="normal">Power BI is optimised for one-to-many relationships. The “one” side (the lookup table) should have a column of unique values (a primary key), and the “many” side (the data table) can have duplicate values (a foreign key). Power BI is built and optimised to work this way. If you try to join two tables that have duplicate values in both columns, you get a warning message like the one shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute167" src="images/000184.png" alt="" /></p>
			<p class="normal">There is a very good reason that there is a warning message at the bottom of this dialog. Creating many-to-many relationships is very dangerous in Power BI, particularly if you don’t know what you are doing. It can be done successfully under certain conditions in Power BI (although you cannot do this in Power Pivot for Excel). This is a big topic that is mostly beyond the scope of this book, but there is a way to model the data without the need for many-to-many relationships: by using bridging tables.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-94"></a>Here’s How: </span><span class="b2"><a id="calibre_link-133"></a></span><span class="b2">Bridging a Budget Table</span></p>
			<p class="normal">The following steps walk you through the process of importing a budget table, loading the required bridging tables, and writing measures for the budget:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>In Power BI, click Get Data, Excel and navigate to the Excel file you used in Chapter 2.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Select the <span class="mono1">Budget </span>and <span class="mono1">BudgetPeriod</span> tables from the Navigator list, as shown below. In this case, the <span class="mono1">Budget</span> table is the data table, and the <span class="mono1">BudgetPeriod</span> table is a bridging table.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000192.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Click Load. As shown below, the <span class="mono1">Budget</span> table has a monthly sales budget for each category, and the <span class="mono1">Period</span> column is in the format YYYYMM for year and month.</p>
			<p class="fp"><img class="_idgenobjectattribute168" src="images/000201.png" alt="" /></p>
			<p class="nlc">The <span class="mono">BudgetPeriod</span> table is both a bridging table and a type of calendar table, but it is a different type of calendar table from what you have used so far. Technically, it is still a calendar table, but it is a monthly calendar table instead of a daily calendar table. Like the <span class="mono">Budget</span> table, it contains a <span class="mono">Period</span> column in the format YYYYMM, as shown below.</p>
			<p class="normal"><img class="_idgenobjectattribute169" src="images/000209.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>You need a <span class="mono1">ProductCategory </span>bridging table, too, but there is not one in the source, so create one using DAX by clicking the New Table button and typing the formula shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute170" src="images/000217.png" alt="" /></p>
			<p class="nlc">As you can see above, the new <span class="mono">ProductCategory</span> table has a list of the four possible product categories.</p>
			<p class="note"><span class="b1">Note:</span> How all these bridging tables will be used will make sense shortly.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Switch to the Model view.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Rearrange the tables as shown below: Place the <span class="mono1">BudgetPeriod</span> table (see #1 below) above the <span class="mono1">Calendar</span> table and place the <span class="mono1">Budget</span> table (#2) next to the <span class="mono1">Sales</span> table. Put the <span class="mono1">ProductCategory</span> table (#3) above the <span class="mono1">Products</span> table, as shown.</p>
			<p class="note"><span class="b1">Note: </span>The relationship between <span class="mono1">BudgetPeriod</span> and <span class="mono1">Budget</span> is a physical relationship that Power BI automatically created when the new <span class="mono1">BudgetPeriod</span> table was created.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000226.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>To see why you need the bridging tables, try to join the <span class="mono1">Budget</span> table to the <span class="mono1">Calendar</span> table. When you try to create a new relationship between the <span class="mono1">Budget[Period] </span>column and the <span class="mono1">'Calendar'[Period]</span> column, you get the warning message shown earlier and repeated below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000234.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>Click Cancel to close the Create Relationship window.</p>
			<p class="nlc">The <span class="mono">Calendar</span> table is a daily calendar, but the <span class="mono">Budget</span> table is a monthly budget (a very common business scenario). The <span class="mono">'Calendar'[Period]</span> column has between 28 and 31 entries for each month, and the <span class="mono">Budget[Period]</span> column has repeating values, too. Technically, you can create a many-to-many relationship in Power BI, but as mentioned earlier, such a relationship can be inefficient and also dangerous, and I don’t teach that method in this book.</p>
			<p class="nlc">To solve this data modelling problem, you can use bridging tables in order to join the tables using only one-to-many relationships. The <span class="mono">BudgetPeriod</span> table is a bridging table, and it has a <span class="mono">Period</span> column that contains unique values (a primary key). You can therefore join the <span class="mono">Budget</span> table to the <span class="mono">BudgetPeriod</span> table by using a one-to-many relationship. In fact, this relationship (see #1 below) was auto-created when the data was loaded.</p>
			<p class="nl1"><span class="_idgenbnmarker">9.</span>Join the <span class="mono1">Calendar</span> table to the <span class="mono1">BudgetPeriod</span> table by dragging the <span class="mono1">'Calendar'[Period]</span> column to the <span class="mono1">BudgetPeriod[Period]</span> column (see #2 below).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000243.png" alt="" /></p>
			<p class="nlc">Now you need to join the <span class="mono">ProductCategory</span> table (which is also a bridging table) to the <span class="mono">Budget</span> table. If you try to join the <span class="mono">Budget[Category] </span>column to the <span class="mono">Products[Category]</span> column, you get the same warning as before.</p>
			<p class="nl1"><span class="_idgenbnmarker">10.</span>To join the <span class="mono1">Budget</span> table to the <span class="mono1">ProductCategory</span> bridging table, click and drag the column <span class="mono1">Budget[Category] </span>to <span class="mono1">ProductCategory[Category]</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">11.</span>To join the <span class="mono1">Products</span> table to the <span class="mono1">ProductCategory</span> table, click and drag the column <span class="mono1">Products[Category]</span> to the <span class="mono1">ProductCategory[Category]</span> column.</p>
			<p class="normal">When you are finished, you should have something like the layout shown below. Notice that it becomes difficult to keep track of all the relationships when you have lots of tables in a data model. This is one reason I recommend arranging the tables using the Collie layout methodology, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000251.png" alt="" /></p>
			<p class="normal">As you can see in the image above, the tables on the “many” side of the relationships are down below, and the tables on the “one” side of the relationships are up high. The filters flow downhill, and this layout makes it much easier to understand how the tables interact with each other. If you place a filter on the <span class="mono">BudgetPeriod</span> table (see #1 above), this table directly filters the <span class="mono">Budget</span> table (#4) via the direct relationship. In addition, the <span class="mono">BudgetPeriod</span> table (#1) directly filters the <span class="mono">Calendar</span> table (#2), and the <span class="mono">Calendar</span> table (#2) filters the <span class="mono">Sales</span> table (#3). The net result is that any filter you apply to the <span class="mono">BudgetPeriod</span> table (#1) filters both the <span class="mono">Sales</span> table (#3) and the <span class="mono">Budget</span> table (#4). The same concept applies with the <span class="mono">ProductCategory</span> table (#5).</p>
			<p class="normal">When working with data tables of different granularities, as in this case, it is important to use the correct tables and columns in your matrix filters. So when working with both the <span class="mono">Sales</span> table and the <span class="mono">Budget</span> table in a model like this, you should use the columns from the <span class="mono">BudgetPeriod</span> table and <span class="mono">ProductCategory</span> table in your visuals; columns from the <span class="mono">Calendar</span> table and <span class="mono">Products</span> table will not correctly filter both the <span class="mono">Sales</span> and <span class="mono">Budget</span> tables.</p>
			<p class="h"><span class="b2">Using One Table for Each Object</span></p>
			<p class="normal">One of the general rules I introduced in Chapter 2 is that you should aim to use one table (e.g., <span class="mono">Calendar</span>, <span class="mono">Product</span>) for each object. One reason for this is that it makes it easier for people using your data model to find what they are looking for. As mentioned earlier, when you have the bridging tables loaded as shown above, you must use the bridging table columns in your visuals instead of the columns in the lookup tables. Only the bridging table columns can filter both the <span class="mono">Budget</span> table (directly) and the <span class="mono">Sales</span> table (indirectly, via the lookup tables). This can be confusing to people building new visuals in your reports. Take a look at the tables that now appear in the Fields pane.</p>
			<p class="fp"><img class="_idgenobjectattribute171" src="images/000260.png" alt="" /></p>
			<p class="normal">There are two calendar tables (<span class="mono">Calendar</span> and <span class="mono">BudgetPeriod</span>) and two product tables (<span class="mono">Products</span> and <span class="mono">ProductCategory</span>). If the report writer uses the wrong table, the results will be wrong. In the image below, the <span class="mono">Category</span> column comes from the <span class="mono">Products</span> table, not the <span class="mono">ProductCategory</span> table, so the <span class="mono">Budget</span> table is not filtered.</p>
			<p class="fp"><img class="_idgenobjectattribute172" src="images/000268.png" alt="" /></p>
			<p class="normal">In addition, there are columns (e.g., <span class="mono">Year</span>) in the <span class="mono">Calendar</span> table that you might want to use in the reports that don’t exist in the bridging table. This is one of the few situations in which I recommend using bidirectional cross-filtering in a data model.</p>
			<p class="h"><span class="b2">Enter </span><span class="b2"><a id="calibre_link-130"></a></span><span class="b2">Bidirectional Cross-Filtering</span></p>
			<p class="normal">Generally speaking, you should aim for single-directional cross-filtering; that is, the lookup tables should filter the data tables&mdash;and not the other way around. But in this case, I highly recommend using bidirectional cross-filtering, where each table filters the other, because it solves both problems mentioned above:</p>
			<ul class="calibre2">
				<li class="bl">It removes confusion about which columns to use for reports. (It restores the concept of using one table for each object&mdash;at least as presented to the end users.)</li>
				<li class="bl">It opens up use of the other columns in the lookup tables to roll up your data to a higher level of aggregation.</li>
			</ul>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-95"></a>Here’s How: Enabling Bidirectional Cross-Filtering</span></p>
			<p class="normal">To enable bidirectional cross-filtering, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Switch to the Model view.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Double-click the relationship between the <span class="mono1">Calendar</span> table and the <span class="mono1">BudgetPeriod</span> table (shown below).</p>
			<p class="fp"><img class="_idgenobjectattribute173" src="images/000276.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Change the Cross Filter Direction setting from Single to Both, as shown below, and click OK.</p>
			<p class="fp"><img class="_idgenobjectattribute174" src="images/000284.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Repeat this process for the relationship between the <span class="mono1">ProductCategory</span> table and the <span class="mono1">Products</span> table. The image below shows the Model view after these changes are made.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000292.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> The relationships now indicate that filters flow in both directions. The implications are that if you use a column in the <span class="mono1">Calendar</span> table, it will directly filter the <span class="mono1">Sales</span> table (the same as before you changed the cross-filter direction), but the <span class="mono1">Calendar</span> table will also now filter the <span class="mono1">BudgetPeriod</span> bridging table. The <span class="mono1">BudgetPeriod</span> table directly filters the <span class="mono1">Budget</span> table, so now the <span class="mono1">Calendar</span> table will filter both the <span class="mono1">Sales</span> and the <span class="mono1">Budget</span> tables. The same is true for the <span class="mono1">Products</span> table.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Hide the <span class="mono1">BudgetPeriod</span> <a id="calibre_link-242"></a>bridging table from the end user by clicking the eyeball icon, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute175" src="images/000300.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Repeat these steps for the other bridging table.</p>
			<p class="normal">After you make these changes, everything just works. The reports can now use the <span class="mono">Products[Category]</span> column (see #1 below), the end user cannot see any confusing bridging tables in the Fields pane, and the budget numbers work (#2). In addition, the reports can now use the <span class="mono">Calendar</span> table instead of the <span class="mono">BudgetPeriod</span> bridging table.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000308.png" alt="" /></p>
			<p class="h1"><span class="b2">Aggregating </span><span class="b2"><a id="calibre_link-333"></a></span><span class="b2">Rolls Up, Not Down</span></p>
			<p class="normal">One thing you should note at this point is that the budget data is at the month and product category level; this is the lowest level of granularity contained in the budget data. The lowest level of data can be easily aggregated up (e.g., months can be aggregated up to create yearly data), but the data cannot automatically <a id="calibre_link-196" class="calibre3"></a>disaggregate to create a lower level of granularity (e.g., categories do not automatically disaggregate into subcategories). To illustrate this point, the image below shows <span class="mono">'Calendar'[Year]</span> and <span class="mono">Products[SubCategory]</span> in a matrix.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000317.png" alt="" /></p>
			<p class="normal">The years (columns in the matrix) are correctly adding up the budget from months to years (i.e., the budget numbers add up correctly horizontally across the matrix). However, the subcategories (rows on the matrix) are all showing the same budget total (vertically down the matrix). It is technically possible to write a budget measure that will apportion the category budget down to the subcategory level by using sales history (for example). You could have a go at writing the formula yourself if you are feeling brave. I do not provide a solution in this book, but I do suggest the following process steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a plan for how to solve the problem. Do it in Excel first, if that helps.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Use what you have learnt about using the <span class="mono1">ALL()</span> function in calculating the percentage of a column (see Chapter 14) to work out the historical sales percentage for each subcategory.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Break the problem into pieces, using variables, and solve each part of the problem before moving on. Check each variable component in a visual before moving on.</p>
			<p class="normal">Good luck. Feel free to contact me via my website (<a href="http://xbi.com.au/contact-matt" class="calibre3"><span class="u">http://xbi.com.au/contact-matt</span></a>) and tell me how you did with this challenge.</p>
			<p class="h1"><span class="b2">Practice Exercises: Multiple Data Tables</span></p>
			<p class="normal">It’s time to get some practice writing new DAX formulas across the two data tables <span class="mono">Budget</span> and <span class="mono">Sales</span>. First, create a new matrix. Then put <span class="mono">Products[Category]</span> on Rows, put <span class="mono">'Calendar'[Period]</span> on Rows, and put <span class="mono">[Total</span> <span class="mono">Sales]</span> on Values.</p>
			<p class="normal">When your matrix is set up, click on the Expand All Down One Level in the Hierarchy icon, as shown below, to expand all levels in the matrix.</p>
			<p class="fp"><img class="_idgenobjectattribute176" src="images/000325.png" alt="" /></p>
			<p class="normal">To create the following measures, right-click the <span class="mono">Budget</span> table in the Fields pane, select New Measure, and then write each measure. Find the solutions to these practice exercises in  <a href="#calibre_link-28" class="calibre3">"Appendix A: Answers to Practice Exercises" on page 264</a>.</p>
			<p class="h2"><span class="bi">71. [Total Budget]</span></p>
			<p class="h2"><span class="bi">72. [Change in Sales vs. Budget]</span></p>
			<p class="h2"><span class="bi">73. [% Change in Sales vs. Budget]</span></p>
			<p class="h1"><span class="b2">How Did It Go?</span></p>
			<p class="normal">Did you end up with a matrix like the one below (which has conditional formatting added)?</p>
			<p class="fp"><img class="_idgenobjectattribute177" src="images/000334.png" alt="" /></p>
		</div>
	</div>


<div id="calibre_link-58" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-440" class="ch"><span class="b2"><a id="calibre_link-25"></a>22: Concept: Using Analyze in Excel and Cube Formulas</span></p>
			<p class="normal">So far in this book, you have consumed and visualised the information from data models in reports directly inside Power BI Desktop. But even after you have invested so much time and effort building Power BI data models, you may want to get to the data by using good old traditional Excel. Fortunately, there is an easy way to do this from PowerBI.com. As long as you have a Power BI Pro licence, you can use Analyze in Excel to directly connect to the data model. Before you can use Analyze in Excel, however, you must first publish your Power BI Desktop file to PowerBI.com.</p>
			<p class="note"><span class="b1">Note: </span>If for some reason you are not able to use Analyze in Excel from PowerBI.com, you can still complete the cube formulas exercises later in this chapter. Simply go to my website, <a href="http://xbi.com.au/local-host"><span class="u1">http://xbi.com.au/local-host</span></a>and follow the instructions on how to connect Excel to a local instance of Power BI Desktop running on your PC.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-96"></a>Here’s How: </span><span class="b2"><a id="calibre_link-313"></a></span><span class="b2">Publishing a Report to PowerBI.com</span></p>
			<p class="normal">Follow these steps to publish a report to PowerBI.com:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Save the Power BI workbook.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>On the Home tab (see #1 below), click the Publish button (#2).</p>
			<p class="normal"><img class="_idgenobjectattribute9" src="images/000342.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>If this is the first time you are using PowerBI.com, you are prompted to create an account. Simply follow the instructions to create a new account for yourself. If you already have an account, just sign in using your credentials. You get a success message when the file has been loaded to PowerBI.com. If you are creating an account for the first time, you need to activate the 60-day Pro trial in order to use Analyze in Excel.</p>
			<p class="note"><span class="b1">Note:</span> Your access to PowerBI.com may be controlled by your IT department. If you cannot create an account as described here, you may need to contact your IT department for support. Also, as of this writing, it is not possible to sign up to PowerBI.com by using a generic email address such as @gmail.com or @hotmail.com. You need to use a business or school email address.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>In a browser, navigate to <a href="http://powerbi.com"><span class="u1">http://powerbi.com</span></a> and click the sign-in link in the top-right corner of the website, using the same credentials you specified in step 3.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Once you are logged in, expand the menu on the left-hand side (see #1 below) and open the workspace where you uploaded your workbook, such as My Workspace (#2).</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Locate your data model under Datasets (see #3 below) and all your reports in the Reports section (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000358.png" alt="" /></p>
			<p class="normal"><span class="b3"><a id="calibre_link-441" class="calibre3"></a></span><span class="b4"><a id="calibre_link-442" class="calibre3"></a>Here’s How: Installing </span><span class="b4"><a id="calibre_link-210" class="calibre3"></a></span><span class="b4"><a id="calibre_link-121" class="calibre3"></a></span><span class="b4">Analyze in Excel</span></p>
			<p class="normal">Before you can use Analyze in Excel the first time, you need to install the Analyze in Excel updates. Follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Click on the download arrow in the top-right corner of the browser (see #1 below) and select Analyze in Excel Updates (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute120" src="images/000051.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>After the update is downloaded, run the downloaded file on your PC. You need admin rights on your computer to be able to complete the installation.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-97"></a>Here’s How: Using Analyze in Excel</span></p>
			<p class="normal">Using Analyze in Excel could not be easier. Simply follow these instructions:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Navigate to either Reports (see #1 below) or Datasets (#2) on the left-hand side, click on the ellipsis to open the menu, and then select Analyze in Excel (#3). An Excel file is downloaded to your PC.</p>
			<p class="fp"><img class="_idgenobjectattribute178" src="images/000030.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Find the Excel file that was downloaded (probably in your Downloads folder, depending on your browser settings) and double-click to open it.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>When the Excel file opens, and you are prompted to log in to Power BI, use your Power BI login credentials to log in.</p>
			<p class="note"><span class="b1">Note: </span>The first time you do this, you may be prompted to log in with your credentials and enable editing view, enable external data connections, etc. You should check for messages and follow the instructions to enable this process. When you sign in, make sure you sign in using the same approach and credentials you use for PowerBI.com.</p>
			<p class="normal">If everything has gone well, you should now have a new pivot table in a new Excel workbook that looks like the one shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000038.png" alt="" /></p>
			<p class="normal">The really cool thing about this Excel workbook/pivot table is that it has a direct, live connection to <br class="calibre8" />PowerBI.com. The data model remains at PowerBI.com, and only the data needed to display the pivot table is stored in the Excel workbook. The data model could be 10 GB or larger on PowerBI.com, but the Excel workbook could be as small as 20 KB. These workbooks are commonly referred to as “<a id="calibre_link-370" class="calibre3"></a>thin workbooks.”</p>
			<p class="normal">The PivotTable Fields list on the right-hand side of Excel looks slightly different from this list for a regular pivot table. There are measure tables and also column tables, sometimes with the same names and differentiated only by the two different icons shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute179" src="images/000046.png" alt="" /></p>
			<p class="normal">One important difference between Analyze in Excel pivot tables and Power BI visuals is that Analyze in Excel does not support implicit measures. You cannot drag a column from one of the column tables into the Values section of a pivot table. If you want to aggregate data in an Analyze in Excel pivot table, you must first write an explicit measure in the data model.</p>
			<p class="normal">When you have a connection, you should be able to build pivot tables similar to the matrixes you have already built in Power BI Desktop. (See the example below.)</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000054.png" alt="" /></p>
			<p class="h"><span class="b2">Using </span><span class="b2"><a id="calibre_link-168"></a></span><span class="b2">Cube Formulas</span></p>
			<p class="normal">The final concept topic in this book is one of my favourites: cube formulas. Cube formulas have been around for many years. But before Power BI was launched, the main way you could use cube formulas was to connect to a SQL Server Analysis Services (SSAS) multidimensional cube. Some large companies have SSAS multidimensional set up. Some of those companies may connect directly to SSAS from Excel, and some of the ones that do may have discovered cube formulas. But given how rare this scenario is, most people have not come across cube formulas prior to discovering Power BI.</p>
			<p class="normal">Pivot tables in Excel are great, and I use them all the time, but they do have some limitations. The biggest limitation is that a pivot table locks you into a particular format (or shape/structure). What if you want to put a single value in a single cell in a workbook? In that case, you could create a pivot table and set it to show just the number you want, but that involves a lot of overhead. In addition, if the pivot table changes shape at any time (e.g., on refresh), it is likely that the cell positions will change, which could mean that other parts of your workbook might break. The best-case scenario is that you realise there is a problem. The worst-case scenario is that your formula points to another similar cell in the pivot table, and you don’t even notice that it is wrong!</p>
			<p class="normal">“What about <a id="calibre_link-237" class="calibre3"></a><span class="mono">GETPIVOTDATA()</span>?” you might ask. Well, yes, you can use <span class="mono">GETPIVOTDATA()</span>, but you still have the overhead of the pivot table, and the bottom line is that using cube formulas is often a much better solution. The easiest way to get started with cube formulas is to convert an existing pivot table to cube formulas. The following section walks you through how to do this.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-98"></a>Here’s How: Converting a Pivot Table to Cube Formulas</span></p>
			<p class="normal">Follow these steps to convert a pivot table in a thin workbook to cube formulas:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a new blank sheet in an Excel workbook and insert a pivot table like the one shown below, which is the same one you created earlier in this chapter.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000064.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Put <span class="mono1">'Calendar'[CalendarYear] </span>on Rows, <span class="mono1">Products[Category]</span> on Columns, and <span class="mono1">[Total Sales] </span>on Values. Also add a slicer for <span class="mono1">Customers[Occupation]</span>. Click on the slicer and make sure it works before proceeding.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Click inside the pivot table and then select the PivotTable Analyze tab (see #1 below), click OLAP Tools (#2), and select <a id="calibre_link-160"></a>Convert to Formulas (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000074.png" alt="" /></p>
			<p class="normal">Bam! As shown below, your pivot table is converted to a stack of standalone formulas that you can move around as you want on the spreadsheet.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000084.png" alt="" /></p>
			<p class="normal">What’s more, the slicer still works! Go ahead and drag the formulas around to new locations in your spreadsheet and then click on the slicer to verify that it works.</p>
			<p class="fp"><img class="_idgenobjectattribute180" src="images/000091.png" alt="" /></p>
			<p class="h"><span class="b2">Writing Your Own Cube Formulas</span></p>
			<p class="normal">Converting a pivot table to cube formulas is dead easy, but there is a better way: You can easily write your own cube formulas from scratch once you know how. There are seven cube formulas in total, and they all start with the word <span class="mono">CUBE</span>. You can see the list by typing <span class="mono">=CUBE</span> into any cell of a workbook, as shown below.</p>
			<p class="fp"><img class="_idgenobjectattribute181" src="images/000099.png" alt="" /></p>
			<p class="normal">This book covers the two most commonly used cube formulas, <span class="mono">CUBEVALUE()</span> and <span class="mono">CUBEMEMBER()</span>. Once you have mastered these two formulas, you can do some research to learn about the other five.</p>
			<p class="h1"><span class="b2">CUBEVALUE() vs. CUBEMEMBER()</span></p>
			<p class="normal">To get an idea of the difference between <span class="mono">CUBEVALUE()</span> and <span class="mono">CUBEMEMBER()</span>, go back to the pivot table that you just converted and double-click inside the grand total cell (see #1 below) so that Excel is in Edit mode. Notice in the formula bar that this grand total cell is a <span class="mono">CUBEVALUE()</span> formula (#2), and it points to a number of other cells (#3). The formulas inside each of these other cells (#3) are <span class="mono">CUBEMEMBER()</span> formulas.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000108.png" alt="" /></p>
			<p class="normal"><span class="mono">CUBEVALUE()</span> is used to extract the value of a measure from the data model, and <span class="mono">CUBEMEMBER()</span> is used to extract a value from a column/lookup table. When they are used together, <span class="mono">CUBEMEMBER()</span> filters the data model and then calculates the <span class="mono">CUBEVALUE()</span> expression.</p>
			<p class="normal">Now that you know about cube formulas, you can build a pivot table that contains the cube formulas you want in your spreadsheet and then simply select PivotTable Analyze, OLAP Tools, Convert to Formulas. Once you have done this, you can copy and paste the resulting formulas wherever you want. But it actually isn’t very hard to write cube formulas from scratch, and the following section shows how.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-99"></a>Here’s How: Writing </span><span class="b2"><a id="calibre_link-169"></a></span><span class="b2">CUBEVALUE() from Scratch</span></p>
			<p class="normal">The important keyboard keys when writing cube formulas are the double quote, the square brackets, and the full stop (or period). This information will make sense as you work through these steps. Be sure to follow these steps exactly:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Click in an empty cell in a workbook and type <span class="mono1">=CUBEVALUE(</span>. Notice the tooltip that pops up, asking for a connection and one or more member expressions. The member expressions can be either measures or table columns from your data model.</p>
			<p class="fp"><img class="_idgenobjectattribute182" src="images/000117.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Type <span class="mono1">" </span>(a double quote). You are presented with a list of connections available to the workbook. Given that this is a thin workbook created using Analyze in Excel, you should have a connection string that looks something like the one shown below.</p>
			<p class="note"><span class="b1">Note: </span>The long number (GUID) is unique to your instance of Power BI. Anyone who can access your Power BI data set (e.g., someone else in your organisation who has access) will also be able to interact with this thin workbook when it is done.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000125.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>If you are writing a cube formula using my localhost workbook <a href="http://xbi.com.au/local-host"><span class="u1">http://xbi.com.au/local-host</span></a>, you will get a different connection string experience than shown above.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Press the Tab key to select the connection and then type <span class="mono1">" </span>(a double quote) again.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Type <span class="mono1">, </span>(a comma).</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Type <span class="mono1">" </span>(a double quote) again to start the next parameter. This time notice that the tooltip shows a list of all the tables in the data model (as shown below). There is also one additional item in the list, <span class="mono1">[Measures]</span>. All your DAX formulas are stored in <span class="mono1">[Measures]</span>.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000134.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Type <span class="mono1">[ </span>and then <span class="mono1">M</span> and press Tab to select <span class="mono1">[Measures]</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Type <span class="mono1">. </span>(a full stop/period), and you see a list of all the measures that exist in the data model. From here you can either keep typing <span class="mono1">[ </span>followed by the name of the measure or use the up and down arrow keys on the keyboard to navigate to the measure you want to select.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000142.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>Type <span class="mono1">[ </span>and then type <span class="mono1">Total S</span>. This brings the <span class="mono1">[Total Sales]</span> measure to the top.</p>
			<p class="nl1"><span class="_idgenbnmarker">9.</span>Press Tab, type <span class="mono1">")</span>, and press Enter.</p>
			<p class="normal">If you follow these instructions exactly, you end up with a value in a cell, as shown below. This is your first handwritten cube formula:</p>
			<p class="code"><span class="mono1">= CUBEVALUE(&lt;</span><span class="monoitalic">your connection string</span><span class="mono1">&gt;,"[Measures].[Total Sales]")</span></p>
			<p class="note"><span class="b1">Note: </span>In the formula above, I have used <span class="mono1">&lt;</span><span class="monoitalic">your connection string</span><span class="mono1">&gt;</span> in place of the actual connection string because what you have on your screen will be different.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000152.png" alt="" /></p>
			<p class="normal">You have probably noticed that the value you end up with after writing this cube formula is the grand total for all the data in the data model. It should therefore be clear that the data model is completely unfiltered. It is possible to filter this formula just as in a pivot table by adding some column parameters to the formula (sort of like adding a column to Rows in a pivot table).</p>
			<p class="note"><span class="b1">Note: </span>Before moving on, you should rewrite the formula above a couple of times for practice. Remember that the most important keys on your keyboard in this process are double quotes, square brackets, and the full stop/period, along with Tab to select the highlighted selection. Practice the rhythm of writing these formulas using these keys on the keyboard. Do it four or five times with a few different measures until you get the hang of it. Trust me, you will better understand the process if you do this.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-100"></a>Here’s How: Applying Filters to Cube Formulas</span></p>
			<p class="normal">To filter an existing formula, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Select one of the formulas you have already written.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Start editing the formula by deleting the last <span class="mono1">) </span>and then typing <span class="mono1">, </span>(a comma). The tooltip asks for <span class="monoitalic">member_expression2</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Type <span class="mono1">"[</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Use the down arrow key to select <span class="mono1">[Calendar]</span> and then press Tab.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>Type <span class="mono1">. </span>(full stop/period) and use the down arrow key to select <span class="mono1">[CalendarYear]</span>. Then press Tab.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>Type <span class="mono1">. </span>(full stop/period) and notice that the tooltip offers only a single choice, <span class="mono1">[All]</span>. Select <span class="mono1">[All] </span>and then press Tab.</p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Type . (full stop/period) again and notice that you now have a list of the possible years to select from. Select <span class="mono1">[2018]</span>.</p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>Finish the formula by typing <span class="mono1">") </span>and pressing Enter.</p>
			<p class="nlc">This is the final formula:</p>
			<p class="codeindented1"><span class="mono1">= CUBEVALUE(&lt;</span><span class="monoitalic">your connection string</span><span class="mono1">&gt;, "[Measures].[Total Sales]",</span></p>
			<p class="codeindented1"><span class="mono1">"[Calendar].[CalendarYear].[All].[2018]")</span></p>
			<p class="nl1"><span class="_idgenbnmarker">9.</span>Go back into this formula again and delete the closing bracket, <span class="mono1">)</span>, add another <span class="mono1">, </span>(a comma), and then follow the same process as above to add another cube member, this time for <span class="mono1">Products[Category] = "Clothing"</span>. This is the formula you need:</p>
			<p class="codeindented1"><span class="mono1">= CUBEVALUE(&lt;</span><span class="monoitalic">your connection string</span><span class="mono1">&gt;, "[Measures].[Total Sales]",</span></p>
			<p class="codeindented1"><span class="mono1">    "[Calendar].[CalendarYear].[All].[2018]",</span></p>
			<p class="codeindented1"><span class="mono1">    "[Products].[Category].[All].[Clothing]")</span></p>
			<p class="normal">You can add to your spreadsheet any measure from your data model by writing a cube formula like this. You can further filter the measure in your cube formula by adding additional column parameters inside the cube formula you are writing.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-101"></a>Here’s How: Adding a </span><span class="b2"><a id="calibre_link-350"></a></span><span class="b2">Slicer Without a Pivot Table</span></p>
			<p class="normal">Connecting your cube formulas to slicers is surprisingly easy. You should have a slicer for <span class="mono">Customers[Occupation]</span> on the sheet already. If you don’t have this slicer, then go ahead and add it now. Here are the steps to add a slicer when there is no pivot table:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Select Insert, Slicer.</p>
			<p class="note"><span class="b1">Note: </span>In this case, you can’t right-click on a column in the PivotTable Fields list because there is no pivot table.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the Existing Connections dialog that appears, select the Connections tab (see #1 below), and under Connections in This Workbook (#2), select <span class="mono1">&lt;</span><span class="monoitalic">your connection string</span><span class="mono1">&gt;</span> (#3). Then click Open.</p>
			<p class="fp"><img class="_idgenobjectattribute19" src="images/000161.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Find the <span class="mono1">Products[color]</span> column in the list, select the correct check box, and click OK. You now have a slicer on your sheet. (However, it is not connected to your formula.)</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-102"></a>Here’s How: Connecting a Slicer to a Cube Formula</span></p>
			<p class="normal">Follow these steps to connect a slicer to a cube formula:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Check the unique name for the slicer you want to connect by right-clicking on the slicer and selecting Slicer Settings.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>In the Slicer Settings dialog that appears, note and memorise the value that appears next to Name to Use in Formulas. You will need this name in the next step. In the example shown here, the name is <span class="mono1">Slicer_Products</span>. In your case, the name may be different. Once you’ve noted the slicer name, click Cancel.</p>
			<p class="fp"><img class="_idgenobjectattribute183" src="images/000169.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Write a new version of the <span class="mono1">Total Sales</span> cube formula, this time adding the slicer to the formula. Simply add a comma after <span class="mono1">[Total Sales]</span>, <a id="calibre_link-349"></a>followed by the slicer name from step 2, and then type <span class="mono1">)</span>. Your formula should now look something like this (though your slicer may have a slightly different name):</p>
			<p class="codeindented1"><span class="mono1">= CUBEVALUE(&lt;</span><span class="monoitalic">your connection string</span><span class="mono1">&gt;,</span></p>
			<p class="codeindented1"><span class="mono1">    "[Measures].[Total Sales]", Slicer_Products)</span></p>
			<p class="nlc">When you add a slicer name as a parameter inside a cube formula like this, the slicer is acting as a filter back to the data model.</p>
			<p class="fp"><img class="_idgenobjectattribute184" src="images/000178.png" alt="" /></p>
			<p class="note"><span class="b1">Note: </span>You do not use double quotes around slicer names. This is an unfortunate inconsistency, but this is just how it works.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>Now test it: Click on your slicer and watch your cube formula update.</p>
			<p class="normal">Take a deep breath and be amazed. How cool are cube formulas?!</p>
			<p class="h"><span class="b2">Writing CUBEMEMBER() Formulas</span></p>
			<p class="normal">In addition to referencing a column name inside a <span class="mono">CUBEVALUE()</span> formula, it is possible to write a <span class="mono">CUBEMEMBER()</span> formula directly in a cell in a workbook. This formula can be used to extract column values from your data model.</p>
			<p class="normal">Here is an example of a <span class="mono">CUBEMEMBER()</span> formula:</p>
			<p class="code"><span class="mono1">= CUBEMEMBER(&lt;Your Connection String&gt;,</span></p>
			<p class="code"><span class="mono1">    "[Customers].[Occupation].[All].[Manual]")</span></p>
			<p class="normal">You can see a lot more of these formulas if you go back to the original pivot table that you converted and click in the column and row headings. If you write a <span class="mono">CUBEMEMBER()</span> formula as a standalone formula in a cell, you can reference that cell from within your <span class="mono">CUBEVALUE()</span> formula by using cell references. Once again, you can see this by examining the formula in your converted pivot table.</p>
			<p class="h"><span class="b2">Concatenating Formulas</span></p>
			<p class="normal">If you are not amazed already, then here is a parting thought for you to ponder: When you move away from the structure of a pivot table and move into the world of cube formulas, all the things that you can do in regular Excel formulas become possible. So think about formula concatenation in Excel. It is possible (and not too hard) to build cube formulas in such a way that you can allow users to manually enter a value (e.g., a product code) in a cell and then have the cube formula concatenate the value from that user cell into a master formula. The formula may look something like this:</p>
			<p class="code"><span class="mono1">=CUBEVALUE(</span></p>
			<p class="code"><span class="mono1">    "pbiazure://api.powerbi.com 175b2867-59d9-46e7-9c9f-3d23d0d83 Model",</span></p>
			<p class="code"><span class="mono1">    "[Measures].[Total Sales]",</span></p>
			<p class="code"><span class="mono1">    "[Products].[ProductKey].[All].[" </span></p>
			<p class="code"><span class="mono1">    &amp; D2 &amp; "]"</span></p>
			<p class="code"><span class="mono1">)</span></p>
			<p class="normal">This cube formula concatenates the value in cell D2 to extract the sales for the product number entered. This is a very powerful capability indeed!</p>
		</div>
	</div>


<div id="calibre_link-59" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-443" class="ch"><span class="b2"><a id="calibre_link-26"></a>23: Concept: Transferring DAX Skills to Excel</span></p>
			<p class="normal"><span class="b3"><a id="calibre_link-208" class="calibre3"></a></span>Power BI is a relatively new product from Microsoft, certainly compared to Excel. Power BI first became generally available in July 2015, and the pace of change over the years since its release has been phenomenal. The fact that you have purchased this book and have now arrived at this point probably means that you already know this. But the truth is that the main data technologies inside Power BI were first released as Power Pivot and Power Query for Microsoft Excel. Microsoft didn’t (and still doesn’t) do a really great job at marketing the existence of these products as part of Excel, and as a result, many (most?) people who could benefit from the technologies inside Excel don’t know they exist. The good news, however, is that the skills you have learnt in this book are completely transferable to Power Pivot for Microsoft Excel. This chapter is here to help you with the transfer.</p>
			<p class="h"><span class="b2">Differences Between </span><span class="b2"><a id="calibre_link-306"></a></span><span class="b2">Power BI and Power Pivot for Excel</span></p>
			<p class="normal">There are a couple differences between Power BI and the various versions of Power Pivot for Excel that you should be aware of, as explained here.</p>
			<table id="calibre_link-444" class="note-table">
				<colgroup class="calibre4">
					<col class="calibre5"></col>
				</colgroup>
				<tbody class="calibre6">
					<tr class="note-table1">
						<td class="note-table2">
							<p class="normal"><span class="b3">Note: </span>I use the following terminology in this section:</p>
							<ul class="calibre2">
								<li class="bl">Power Pivot is a data modelling engine that is an add-in for Excel. Power BI Desktop also has this data modelling engine, but it is not called Power Pivot inside Power BI.</li>
								<li class="bl">Power Query is the data acquisition tool that exists in both Excel and Power BI Desktop.</li>
							</ul>
						</td>
					</tr>
				</tbody>
			</table>
			<p class="h1"><span class="b2">All Versions of Excel</span></p>
			<p class="normal">Different versions of Excel may have different versions of Power Pivot, and not all DAX functions are available in all versions. Power BI contains the latest and most up-to-date version of the data modelling engine. I keep an up-to-date quick guide to all the DAX functions that you can download from <a href="http://xbi.com.au/dax-functions" class="calibre3"><span class="u">http://xbi.com.au/dax-functions</span>.</a></p>
			<p class="normal">There is also a DAX function quick reference list at the back of this book. See <a href="#calibre_link-29" class="calibre3">"Appendix B - DAX Quick Reference List" on page 272</a>.</p>
			<p class="normal">All Excel versions of Power Pivot support one-to-many relationships; they do not support the one-to-one or many-to-many relationships that are supported in Power BI. This is not a major issue, however, as one-to-one and many-to-many are not common relationship types.</p>
			<p class="normal">There is no bidirectional cross-filtering available in any of the Excel versions of Power Pivot.</p>
			<p class="normal">You can convert the data models produced in Excel 2010 to Excel 2013 or 2016 data models, but you can’t go back the other way. That is, you can upgrade but not downgrade.</p>
			<p class="normal">Excel 2013/2016 data models can be opened in both Excel 2013 and Excel 2016.</p>
			<p class="normal">Excel 2010 and 2013 have a different user experience in the Diagram view compared to Excel 2016 and Power BI Desktop. You can see the differences between the different UIs in the image below. The earlier versions of Excel (see #1 below) have an arrow pointing to the “one” side of the relationship (#3) and a black dot on the “many” side (#5). Excel 2016 and Power BI have a new, improved UI (#2) with a 1 on the “one” side of the relationship (#4) and an asterisk (*) on the “many” side (#6).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000187.png" alt="" /></p>
			<p class="h1"><span class="b2">Excel 2013</span></p>
			<p class="normal">In Excel 2013, the term calculated field is used instead of measure. This was an unfortunate change made in Excel 2013 that&mdash;thankfully&mdash;lasted for this one version of Excel only.</p>
			<p class="h1"><span class="b2">Excel 2010</span></p>
			<p class="normal">The ribbon in Excel 2010 is unique in that it has a PowerPivot Window option (as shown below) instead of Manage, which appears in later versions of Excel. The Power Pivot icon is the same in all Excel versions.</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000195.png" alt="" /></p>
			<p class="normal">Excel 2010 is the only version that uses a completely separate add-in to deploy Power Pivot, and this means there are two completely different field lists for pivot tables. The first time you stumble on the traditional PivotTable Field List pane, you might be confused about what is happening; being forewarned allows you to be forearmed. In the image below, note the different titles in the two different field list panes. The one on the left (see #1 below) is the newer PowerPivot Field List pane; this is the one you should be using when working with Power Pivot. The one on the right (#2) is the original PivotTable Field List pane, and you don’t use it with Power Pivot pivot tables. However, it is possible to have both of these panes open at the same time, and, confusingly, you can accidently open the wrong one without realising it. The key visual clues about which one you have open are easy to spot: The titles are different, the PivotTable Field List pane has special icons (#3), and the PowerPivot Field List pane has a slicer drop zone (#4).</p>
			<p class="fp"><img class="_idgenobjectattribute185" src="images/000204.png" alt="" /></p>
			<p class="h1"><span class="b2">Excel 2010</span></p>
			<p class="normal">For Excel 2010 you can download the free Power Pivot add-in from the Microsoft website. You can use a browser to search for the add-in. Just make sure you find and install Service Pack 2. You should search for Power Pivot for Excel 2010 SP2.</p>
			<p class="h1"><span class="b2">Excel 2013/2016</span></p>
			<p class="normal">For Excel 2013 and 2016, you need to purchase a Microsoft Office box set or Office 365 in order to get the Power Pivot add-in. The most common version of Excel for organisations these days is Office 365 E3.</p>
			<p class="h"><a id="calibre_link-310"></a><span class="b2">Power Query</span></p>
			<p class="h1"><span class="b2">Excel 2010/2013</span></p>
			<p class="normal">Power Query is a free add-in that you can download from Microsoft. If you use Excel 2010 or 2013, just search for Power Query in a web browser. After you install it, you see a new tab called Power Query.</p>
			<p class="h1"><span class="b2">Excel 2016</span></p>
			<p class="normal">Power Query comes bundled with Excel 2016. There are many different versions of Excel 2016, and the way it integrates Power Query does vary. You will find it on the Data tab either as Get and Transform or Get External Data.</p>
			<p class="h"><span class="b2">Migrating Data from Power BI to Excel</span></p>
			<p class="normal">If you read this heading and got excited, then I am sorry to tell you that you cannot migrate a Power BI Desktop data model into Power Pivot for Excel. It is possible to migrate the other way, though (from Excel to Power BI), as described below.</p>
			<p class="normal">Don’t forget that it is possible to use Analyze in Excel to create a new Excel workbook that points to a Power BI workbook loaded to PowerBI.com (see Chapter 22). This feature does require a Power BI Pro licence, however.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-103"></a></span><span class="b2"><a id="calibre_link-445"></a>Here’s How: </span><span class="b2"><a id="calibre_link-245"></a></span><span class="b2">Importing Excel Power Pivot Workbooks to Power BI Desktop</span></p>
			<p class="normal">It is possible to import a Power Pivot data model from an Excel workbook into Power BI Desktop, along with all the data connections, relationships, and measures. Unfortunately, any reports you have created in Excel are not migrated and need to be re-created in Power BI.</p>
			<p class="normal">Follow these steps to import a Power Pivot workbook from Excel into Power BI Desktop:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>In Power BI Desktop, select File, New. A new blank Power BI Desktop file opens.</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Select File, Import (see #1 below), Power Query, Power Pivot, <a id="calibre_link-311"></a>Power View (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute186" src="images/000212.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Navigate to the Excel workbook you want to migrate, select it, and click OK.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>When you get the message shown below, click Start.</p>
			<p class="fp"><img class="_idgenobjectattribute187" src="images/000220.png" alt="" /></p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>When you get the choice to copy the data from your queries or keep the connection (as shown below), click <a id="calibre_link-256"></a>Keep Connection.</p>
			<p class="fp"><img class="_idgenobjectattribute188" src="images/000229.png" alt="" /></p>
			<p class="note"><span class="b1">Note:</span> Power BI Desktop doesn’t include the concept of linked tables. When you import an Excel workbook that contains linked tables into Power BI Desktop, you can either bring the data in as a one-off migration or retain the link to the original linked table in the original Excel workbook.</p>
			<p class="normal">The Excel workbook data model is imported into Power BI Desktop, and you can proceed to use Power BI Desktop instead of Excel and build your own visualisations on top of the Power Pivot data model.</p>
			<p class="h"><span class="b2">Writing </span><span class="b2"><a id="calibre_link-185"></a></span><span class="b2">DAX Measures in Excel</span></p>
			<p class="normal">If you have learnt how to use Power BI from this book and want to try out Power Pivot for Excel, you need to be aware of a few differences (mainly related to the user interfaces).</p>
			<p class="normal">There are three places you can write DAX measures in Power Pivot for Excel:</p>
			<ul class="calibre2">
				<li class="bl">You can write a measure in the formula bar in the Power Pivot window, as shown below. If you use this method, you must specify the measure name followed by a colon and then the formula.</li>
			</ul>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000238.png" alt="" /></p>
			<ul class="calibre2">
				<li class="bl">You can write and edit measures in any empty cell in the calculation area at the bottom of the Power Pivot window, as shown below. You also need to add a colon when writing a measure here.</li>
			</ul>
			<p class="fp"><img class="_idgenobjectattribute17" src="images/000246.png" alt="" /></p>
			<ul class="calibre2">
				<li class="bl">You can write measures in the Measure dialog in Excel, as shown below.</li>
			</ul>
			<p class="fp"><img class="_idgenobjectattribute189" src="images/000254.png" alt="" /></p>
			<p class="nlc">You open this dialog in Excel by navigating to the Power Pivot tab (see #1 below) and selecting Measures (#2), New Measure (#3).</p>
			<p class="fp"><img class="_idgenobjectattribute2" src="images/000263.png" alt="" /></p>
			<p class="nlc">You can also open the Measure dialog by right-clicking the table name (see #1 below) in the PivotTable Fields pane and choosing Add Measure (#2).</p>
			<p class="fp"><img class="_idgenobjectattribute190" src="images/000271.png" alt="" /></p>
			<p class="nlc">However, at this writing, adding a measure by right-clicking and selecting Add Measure is problematic, and I do not recommend that you do it this way. The UI looks the same as when you select Measure, New Measure, but the Measure dialog box is actually a completely different piece of code. The behaviour of the Tab key when editing the measure is completely different (frustratingly so), and there is no colour coding of the formula language. For these reasons, I recommend that you not use the right-clicking and selecting Add Measure approach. I have to say, however, that it is very difficult to avoid doing it this way as it comes naturally after you learn to write measures in Power BI Desktop.</p>
			<p class="tip"><span class="b1">Tip:</span> In general, I recommend that Excel users write DAX in the Measure dialog box in Excel. I also recommend first creating a pivot table that provides some context for the measure you are about to write. If you do it this way, you will immediately see the measure appear in the pivot table when you click OK, and this helps you quickly see whether the formula looks correct.</p>
			<p class="h2-hh"><span class="b2"><a id="calibre_link-104"></a>Here’s How: </span><span class="b2"><a id="calibre_link-209"></a></span><span class="b2">Writing Measures</span></p>
			<p class="normal">To create a new measure in Power Pivot for Excel, follow these steps:</p>
			<p class="nl"><span class="_idgenbnmarker">1.</span>Create a new blank pivot table connected to your data model (or use an existing one if you already have something appropriate).</p>
			<p class="nl1"><span class="_idgenbnmarker">2.</span>Add some relevant data to the rows in your pivot table (see #1 below).</p>
			<p class="nl1"><span class="_idgenbnmarker">3.</span>Click inside the pivot table, navigate to the Power Pivot tab, click the Measures drop-down arrow (#2), and then select New Measure (#3). The Measure dialog appears.</p>
			<p class="fp"><img class="_idgenobjectattribute191" src="images/000279.png" alt="" /></p>
			<p class="tip"><span class="b1">Tip: </span>You should use the Measure dialog shown below as a process flow/guide. If you don’t do this, you risk missing one or more of the steps. Missing a step will end up costing you time and causing rework. Get in the good habit of following the process steps I describe here, using the dialog as a reminder of all the steps. Always follow the order outlined here.</p>
			<p class="nl1"><span class="_idgenbnmarker">4.</span>In the Table Name drop-down (see #1 below), select the table where your measure will be stored.</p>
			<p class="nl1"><span class="_idgenbnmarker">5.</span>In the Measure Name text box (#2), give the new measure a name.</p>
			<p class="nl1"><span class="_idgenbnmarker">6.</span>In the Formula box (#3) write the DAX formula.</p>
			<p class="nl1"><span class="_idgenbnmarker">7.</span>Click <a id="calibre_link-150"></a>Check Formula (#4) to check whether the formula you wrote is syntactically correct. Fix any errors that occur.</p>
			<p class="nl1"><span class="_idgenbnmarker">8.</span>Select an appropriate formatting option from the Category list (#5), including a suitable symbol and decimal places in the area to the right of the Category list.</p>
			<p class="nl1"><span class="_idgenbnmarker">9.</span>Click OK (#6) to save the measure.</p>
			<p class="note"><span class="b1">Note: </span>I generally don’t enter anything in the Description box, but it is there for you to use if you like. It’s for reference only and doesn’t impact the behaviour of the formulas.</p>
			<p class="fp"><img class="_idgenobjectattribute192" src="images/000287.png" alt="" /></p>
		</div>
	</div>


<div id="calibre_link-60" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-446" class="ch"><span class="b2"><a id="calibre_link-27"></a>24: Concept: Next Steps on Your DAX Journey</span></p>
			<p class="normal">You have almost finished reading all the chapters of this book. Now what? First of all, let me assure you that this is just the start, not the end, of your journey to learning how to supercharge Power BI (and Excel) by learning to write DAX. As I have been saying all through the book, the most important thing is to practice, practice, practice. Start using your new skills at work and at play so that you build your depth of skill and knowledge. It will take you a few months of using your new skills to become competent (if you practice regularly), but you are well on your way already. Now that you have a basic understanding of Power BI and DAX, you can incrementally learn and improve over time. But there are some things that will help you learn more and faster.</p>
			<p class="h"><span class="b2">Guided Online Learning</span></p>
			<p class="normal">You might have found certain DAX concepts&mdash;such as filter propagation, evaluation contexts, context transition, and custom time intelligence&mdash;difficult to master, and you may not yet have the solid understanding you need to apply them to your real-life business problems. If this is the case, you might want to enrol in my Supercharge Power BI online training (<a href="http://xbi.com.au/scpbi-online-training" class="calibre3"><span class="u">http://xbi.com.au/scpbi-online-training</span></a>), which includes the following:</p>
			<ul class="calibre2">
				<li class="bl">Guided study of DAX with this book</li>
				<li class="bl">Online videos to cement your learning</li>
				<li class="bl">Weekly online live Q&amp;A sessions with me, where you can bring your questions/problems and get answers/solutions from me </li>
				<li class="bl">A video recording of each live Q&amp;A session you attend that you can download and keep for future reference</li>
			</ul>
			<p class="normal">What’s more, when you enrol in the training, you get access to the online videos for one year and can attend any of the Q&amp;A sessions throughout the year.</p>
			<p class="h"><a id="calibre_link-382"></a><span class="b2">Video Training</span></p>
			<p class="normal">I offer video training for learning DAX. You can find more details at <a href="http://xbi.com.au/dax-online-training" class="calibre3"><span class="u">http://xbi.com.au/dax-online-training</span></a>.</p>
			<p class="h"><a id="calibre_link-261"></a><span class="b2">Live Instructor-Led Classroom and </span><span class="b2"><a id="calibre_link-295"></a></span><span class="b2">Online Training</span></p>
			<p class="normal">Some people learn best in a classroom environment. If you’re one of them, you might want to attend a live instructor-led training.</p>
			<p class="normal">If you are in Australia, you can attend live classroom training courses delivered personally by me or my accredited trainers. For details about upcoming events, see <a href="http://xbi.com.au/live-training" class="calibre3"><span class="u">http://xbi.com.au/live-training</span></a>.</p>
			<p class="normal">If you are outside Australia, you can attend online live training courses delivered personally by me or my accredited trainers. For details about upcoming training sessions, see <a href="http://xbi.com.au/live-online-training" class="calibre3"><span class="u">http://xbi.com.au/live-online-training</span></a>. I am also considering licensing some training providers outside Australia. If I do that in the future, you will be able to find the announcement at <a href="http://xbi.com.au/global-training" class="calibre3"><span class="u">http://xbi.com.au/global-training</span></a>.</p>
			<p class="normal">I also deliver customised in-house training for companies that have larger groups of users and are looking for a more personalised experience. Once again, this can be at the company premises if in Australia (see <a href="http://xbi.com.au/inhouse-training" class="calibre3"><span class="u">http://xbi.com.au/inhouse-training</span></a>) or can be live online training for those outside Australia (see <a href="http://xbi.com.au/live-online-inhouse-training" class="calibre3"><span class="u">http://xbi.com.au/live-online-inhouse-training</span></a>). Contact me on my website for details.</p>
			<p class="normal">There are many great things about these training courses, but one super benefit is that my accredited trainers and I teach DAX using the same techniques I have used in this book. By attending one of our live training courses, you will continue to learn using the same methodology used in this book.</p>
			<p class="h"><span class="b2">Reports and </span><span class="b2"><a id="calibre_link-171"></a></span><span class="b2">Dashboards</span></p>
			<p class="normal">In this book I have used only a few basic visuals to teach you how to write DAX. But Power BI supports literally hundreds of other visuals and has many interactivity concepts that can set your reports apart from the pack. To learn more about what Power BI has to offer, you might want to consider my video training course “Foundations of Power BI&mdash;Data to Dashboard” (<a href="http://xbi.com.au/d2d-online-training" class="calibre3"><span class="u">http://xbi.com.au/d2d-online-training</span></a>).</p>
			<p class="h"><span class="b2">Power Query</span></p>
			<p class="normal">Power Query is a desktop ETL (extract, transform, and load) tool for Power BI and Excel users. It is the same technology that comes bundled with Power BI and Excel. Power Query allows you to connect to data from anywhere, change the shape of that data, and then load it into your workbooks. Once the data is loaded with Power Query, you can easily refresh data at any time with a single click or, better still, with an automated refresh. Power Query has its own language, called M, but it also has a simple-to-use interface that allows you to do most common tasks without the need to learn M.</p>
			<p class="normal">I offer a Power Query video course (<a href="http://xbi.com.au/pq-training" class="calibre3"><span class="u">http://xbi.com.au/pq-training</span></a>) created in collaboration with Ken Puls and Miguel Escobar. You can start with the free course Power Query Fundamentals and proceed from there.</p>
			<p class="h"><span class="b2">Advanced DAX</span></p>
			<p class="normal">When you are making progress with DAX and have been using it regularly for 6 to 18 months, you may be ready to take your learning to the next level. I have an excellent follow-up training course called Demystifying DAX (<a href="http://xbi.com.au/adv-dax-training" class="calibre3"><span class="u">http://xbi.com.au/adv-dax-training</span></a>) that will help you move to the next level.</p>
			<p class="h"><span class="b2">Enhancing Your Skills</span></p>
			<p class="normal">Once you learn Power BI, you need to keep yourself up to date with the latest developments in the product. (Remember that Power BI is evolving continuously at a rapid phase.) You also need to be aware of a number of tips and tricks. There are many ways of accomplishing this, as described in the following sections.</p>
			<p class="h1"><span class="b2">Third-Person Teaching/Learning</span></p>
			<p class="normal">I am a big believer in “third-person teaching/learning.” I first heard of this concept from Stephen <a id="calibre_link-166" class="calibre3"></a>Covey, at one of his seminars. The basic idea is that you learn more when you learn with the intent to teach others, and you learn more from the process of teaching others. For this reason, I really believe in the benefits of participating in user forums. As I mentioned at the start of the book, I have set up a <a id="calibre_link-235" class="calibre3"></a>forum at <a href="http://xbi.com.au/scpbiforum" class="calibre3"><span class="u">http://xbi.com.au/scpbi-forum</span></a>, and it is free for anyone and everyone to ask questions and also to help others. If you want to really cement your new skills and knowledge, then sign up and ask for help. Even better, answer questions and teach others on the forum. When you teach others, you cement your knowledge and become better and stronger with your DAX. There is also an excellent Power BI community and forum at <a href="http://community.powerbi.com." class="calibre3"><span class="u">http://community.powerbi.com</span></a>. You can participate in the forums and maybe also join a local Power BI <a id="calibre_link-378" class="calibre3"></a>user group in your region. The Sydney Power BI user group is at <a href="http://xbi.com.au/syd-pug" class="calibre3"><span class="u">http://xbi.com.au/syd-pug</span></a>. You can use <a href="http://xbi.com.au/all-pug" class="calibre3"><span class="u">http://xbi.com.au/all-pug</span></a><span class="u"> </span>to search for a group in your area.</p>
			<p class="h1"><a id="calibre_link-132"></a><span class="b2">Blogs</span></p>
			<p class="normal">There are a number of Power BI blogs that I recommend you subscribe to. Reading blogs is a great way to keep in touch with the latest thinking from people who spend their life working with Power BI. Here are some that I think are especially useful:</p>
			<ul class="calibre2">
				<li class="bl">My blog: <a href="http://xbi.com.au/matt-blog" class="calibre3"><span class="u">http://xbi.com.au/matt-blog</span></a></li>
				<li class="bl">Marco Russo and Alberto Ferrari’s blog: <a href="http://sqlbi.com/" class="calibre3"><span class="u">http://sqlbi.com</span></a></li>
				<li class="bl"><span class="u"><a id="calibre_link-320" class="calibre3"></a></span>Reza Rad’s blog: <a href="http://radacad.com/blog" class="calibre3"><span class="u">http://radacad.com/blog</span></a></li>
				<li class="bl"><span class="u"><a id="calibre_link-318" class="calibre3"></a></span>Gilbert Quevauvilliers’ blog: <a href="https://www.fourmoo.com/" class="calibre3"><span class="u">https://www.fourmoo.com/</span></a></li>
				<li class="bl"><span class="u"><a id="calibre_link-314" class="calibre3"></a></span>Ken Puls’ blog: <a href="http://www.excelguru.ca/blog/" class="calibre3"><span class="u">http://www.excelguru.ca/blog/</span></a></li>
				<li class="bl"><span class="u"><a id="calibre_link-386" class="calibre3"></a></span>Chris Webb’s blog: <a href="http://blog.crossjoin.co.uk/" class="calibre3"><span class="u">http://blog.crossjoin.co.uk/</span></a></li>
				<li class="bl"><span class="u"><a id="calibre_link-322" class="calibre3"></a></span>Gil Raviv’s blog: <a href="https://datachant.com" class="calibre3"><span class="u">https://datachant.com</span></a></li>
			</ul>
			<p class="h1"><span class="b2">Books</span></p>
			<p class="normal">There are a few really good DAX books that I recommend (and have mentioned previously). I keep a list of books I recommend on my website and update it over time. You can always find an updated list at <a href="http://xbi.com.au/power-books" class="calibre3"><span class="u">http://xbi.com.au/power-books</span></a>.</p>
			<p class="h"><span class="b2">That’s All, Folks</span></p>
			<p class="normal">I hope you have enjoyed this book and that it has successfully started you on your journey to becoming a DAX superstar. If you like this book, please tell your Power BI and Excel friends and colleagues so they, too, can become DAX superstars. I have had feedback from many hundreds of people that my book has helped them immensely. If I have helped you, the best way you can say thanks is to write a positive review of the book at Amazon.com.</p>
		</div>
	</div>


<div id="calibre_link-61" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-447" class="ch"><span class="b2"><a id="calibre_link-28"></a>Appendix A: Answers to Practice Exercises</span></p>
			<p class="normal">This appendix provides answers to the practice exercises scattered throughout the book. The answers appear in the same order as the exercises in the book and are numbered so you can easily match up the exercises and the answers.</p>
			<p class="h"><span class="b2">SUM()</span></p>
			<p class="normal">These practice exercises appear in Chapter 4. As you compare your answers to the ones shown here, consider the following questions: Did you remember to put your measures in the correct table? Did you put the measure in the table the data comes from? Did you format with an appropriate number format? Have you used a matrix visual with relevant fields to check the values of the measure?</p>
			<p class="normal">1. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">=</span> <span class="mono">SUM(Sales[ExtendedAmount])</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">Total Sales = SUM(Sales[SalesAmount])</span></p>
			<p class="normal">2. <span class="mono">Total</span> <span class="mono">Cost</span> <span class="mono">=</span> <span class="mono">SUM(Sales[TotalProductCost])</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">Total Cost = SUM(Sales[ProductStandardCost])</span></p>
			<p class="normal">3. <span class="mono">Total</span> <span class="mono">Margin</span> <span class="mono">$</span> <span class="mono">=</span> <span class="mono">[Total</span> <span class="mono">Sales]</span> <span class="mono">-</span> <span class="mono">[Total</span> <span class="mono">Cost]</span></p>
			<p class="normal">4. <span class="mono">Total</span> <span class="mono">Margin</span> <span class="mono">%</span> <span class="mono">=</span> <span class="mono">[Total</span> <span class="mono">Margin</span> <span class="mono">$]</span> <span class="mono">/</span> <span class="mono">[Total</span> <span class="mono">Sales]</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">Total Margin % = DIVIDE([Total Margin $], [Total Sales]</span></p>
			<p class="note"><span class="b1">Note:</span> I haven’t covered <span class="mono1">DIVIDE()</span> yet, but that is coming later in Chapter 4.</p>
			<p class="normal">5. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Tax</span> <span class="mono">Paid</span> <span class="mono">=</span> <span class="mono">SUM(Sales[TaxAmt])</span></p>
			<p class="normal">6. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Including</span> <span class="mono">Tax</span> <span class="mono">=</span> <span class="mono">[Total</span> <span class="mono">Sales]</span> <span class="mono">+</span> <span class="mono">[Total</span> <span class="mono">Sales</span> <span class="mono">Tax</span> <span class="mono">Paid]</span></p>
			<p class="normal">7. <span class="mono">Total</span> <span class="mono">Order</span> <span class="mono">Quantity</span> <span class="mono">=</span> <span class="mono">SUM(Sales[OrderQuantity])</span></p>
			<p class="h"><span class="b2">COUNT()</span></p>
			<p class="normal">These practice exercises appear in Chapter 4.</p>
			<p class="normal">8. <span class="mono">Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products</span> <span class="mono">=</span> <span class="mono">COUNT(Products[ProductKey])</span></p>
			<p class="normal">9. <span class="mono">Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers</span> <span class="mono">=</span> <span class="mono">COUNT(Customers[CustomerKey])</span></p>
			<p class="note"><span class="b1">Note: </span>Counting the “key” columns is generally pretty safe because, by definition, each one must have a value. Technically, you can count any column that has a value in each cell, and you will get the same answer. Just be careful if you are counting a column that may have blank values because <span class="mono1">COUNT()</span> does not count blanks. Try it out with the <span class="mono1">Products[Status]</span> column. You can verify your results in the Data view by manually placing a filter on the <span class="mono1">Products[Status]</span> column at the top of the table.</p>
			<p class="h"><span class="b2">COUNTROWS()</span></p>
			<p class="normal">These practice exercises appear in Chapter 4.</p>
			<p class="note"><span class="b1">Note:</span> Remember that <span class="mono1">COUNTROWS()</span> takes a table, not a column, as input.</p>
			<p class="normal">10. <span class="mono">Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Products</span> <span class="mono">COUNTROWS</span> <span class="mono">Version</span> <span class="mono">=</span> <span class="mono">COUNTROWS(Products)</span></p>
			<p class="normal">11. <span class="mono">Total</span> <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Customers</span> <span class="mono">COUNTROWS</span> <span class="mono">Version</span> <span class="mono">=</span> <span class="mono">COUNTROWS(Customers)</span></p>
			<p class="h"><span class="b2">DISTINCTCOUNT()</span></p>
			<p class="normal">These practice exercises appear in Chapter 4.</p>
			<p class="normal">12. <span class="mono">Total</span> <span class="mono">Customers</span> <span class="mono">in</span> <span class="mono">Database</span> <span class="mono">DISTINCTCOUNT</span> <span class="mono">Version</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">DISTINCTCOUNT(Customers[CustomerKey])</span></p>
			<p class="normal">13. <span class="mono">Count</span> <span class="mono">of</span> <span class="mono">Occupation</span> <span class="mono">=</span> <span class="mono">DISTINCTCOUNT(Customers[Occupation])</span></p>
			<p class="normal">14. <span class="mono">Count</span> <span class="mono">of</span> <span class="mono">Country</span> <span class="mono">=</span> <span class="mono">DISTINCTCOUNT(Territories[Country])</span></p>
			<p class="normal">15. <span class="mono">Total</span> <span class="mono">Customers</span> <span class="mono">That</span> <span class="mono">Have</span> <span class="mono">Purchased</span> <span class="mono">=</span> <span class="mono">DISTINCTCOUNT(Sales[CustomerKey])</span></p>
			<p class="h"><span class="b2">MAX(), MIN(), and AVERAGE()</span></p>
			<p class="normal">These practice exercises appear in Chapter 4.</p>
			<p class="normal">16. <span class="mono">Maximum</span> <span class="mono">Tax</span> <span class="mono">Paid</span> <span class="mono">on</span> <span class="mono">a</span> <span class="mono">Product</span> <span class="mono">=</span> <span class="mono">MAX(Sales[TaxAmt])</span></p>
			<p class="normal">17. <span class="mono">Minimum</span> <span class="mono">Price</span> <span class="mono">Paid</span> <span class="mono">for</span> <span class="mono">a</span> <span class="mono">Product</span> <span class="mono">=</span> <span class="mono">MIN(Sales[ExtendedAmount])</span></p>
			<p class="normal">18. <span class="mono">Average</span> <span class="mono">Price</span> <span class="mono">Paid</span> <span class="mono">for</span> <span class="mono">a</span> <span class="mono">Product</span> <span class="mono">=</span> <span class="mono">AVERAGE(Sales[ExtendedAmount])</span></p>
			<p class="h"><span class="b2">COUNTBLANK()</span></p>
			<p class="normal">These practice exercises appear in Chapter 4.</p>
			<p class="normal">19. <span class="mono">Customers</span> <span class="mono">Without</span> <span class="mono">Address</span> <span class="mono">Line</span> <span class="mono">2</span> <span class="mono">=</span> <span class="mono">COUNTBLANK(Customers[AddressLine2])</span></p>
			<p class="normal">20. <span class="mono">Products</span> <span class="mono">Without</span> <span class="mono">Weight</span> <span class="mono">Values</span> <span class="mono">=</span> <span class="mono">COUNTBLANK(Products[Weight])</span></p>
			<p class="h"><span class="b2">DIVIDE()</span></p>
			<p class="normal">These practice exercises appear in Chapter 4.</p>
			<p class="normal">21. <span class="mono">Margin</span> <span class="mono">%</span> <span class="mono">=</span> <span class="mono">DIVIDE([Total</span> <span class="mono">Margin</span> <span class="mono">$],</span> <span class="mono">[Total</span> <span class="mono">Sales])</span></p>
			<p class="normal">22. <span class="mono">Markup</span> <span class="mono">%</span> <span class="mono">=</span> <span class="mono">DIVIDE([Total</span> <span class="mono">Margin</span> <span class="mono">$],</span> <span class="mono">[Total</span> <span class="mono">Cost])</span></p>
			<p class="normal">23. <span class="mono">Tax</span> <span class="mono">%</span> <span class="mono">=</span> <span class="mono">DIVIDE([Total</span> <span class="mono">Sales</span> <span class="mono">Tax</span> <span class="mono">Paid],</span> <span class="mono">[Total</span> <span class="mono">Sales])</span></p>
			<p class="h"><span class="b2">Calculated Columns</span></p>
			<p class="normal">This practice exercise appears in Chapter 7.</p>
			<p class="normal">24. <span class="mono">=</span> <span class="mono">IF(</span></p>
			<p class="pe-answer"><span class="mono">    OR('Calendar'[CalendarQuarter]=1, 'Calendar'[CalendarQuarter]=2),</span></p>
			<p class="pe-answer"><span class="mono">    "H1","H2"</span></p>
			<p class="pe-answer"><span class="mono">)</span></p>
			<p class="pe-answer-body-text">or you could write:</p>
			<p class="pe-answer"><span class="mono">= IF(</span></p>
			<p class="pe-answer"><span class="mono">    'Calendar'[CalendarQuarter] in {1,2),</span></p>
			<p class="pe-answer"><span class="mono">    "H1","H2"</span></p>
			<p class="pe-answer"><span class="mono">)</span></p>
			<p class="note"><span class="b1">Note: </span>There are a number of ways to write this calculated column. If yours is different from this but works, then all is well and good.</p>
			<p class="h"><span class="b2">SUMX()</span></p>
			<p class="normal">These practice exercises appear in Chapter 8.</p>
			<p class="normal">25. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">SUMX</span> <span class="mono">Version</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    SUMX(Sales, Sales[OrderQuantity] * Sales[UnitPrice])</span></p>
			<p class="note"><span class="b1">Note:</span> In this sample database, the order quantity is always 1.</p>
			<p class="normal">26. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Including</span> <span class="mono">Tax</span> <span class="mono">SUMX</span> <span class="mono">Version</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    SUMX(Sales,Sales[ExtendedAmount] + Sales[TaxAmt])</span></p>
			<p class="normal">27. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Including</span> <span class="mono">Freight</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    SUMX(Sales,Sales[ExtendedAmount] + Sales[Freight])</span></p>
			<p class="normal">28. <span class="mono">Dealer</span> <span class="mono">Margin</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    SUMX (Products,Products[ListPrice] - Products[DealerPrice])</span></p>
			<p class="h"><span class="b2">AVERAGEX()</span></p>
			<p class="normal">These practice exercises appear in Chapter 8.</p>
			<p class="normal">29. <span class="mono">Average</span> <span class="mono">Selling</span> <span class="mono">Price</span> <span class="mono">Including</span> <span class="mono">Tax</span> <span class="mono">per</span> <span class="mono">Item</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    AVERAGEX(Sales, Sales[ExtendedAmount] + Sales[TaxAmt])</span></p>
			<p class="note"><span class="b1">Note:</span> There are a few columns in the <span class="mono1">Sales</span> table that have the same value. If you used one of the others and got the same answer, then that is fine.</p>
			<p class="normal">30. <span class="mono">Average</span> <span class="mono">Profit</span> <span class="mono">Per</span> <span class="mono">Item</span> <span class="mono">Sold</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    AVERAGEX(Sales, Sales[ExtendedAmount] - Sales[ProductStandardCost])</span></p>
			<p class="normal">31. <span class="mono">Average</span> <span class="mono">Value</span> <span class="mono">of</span> <span class="mono">Safety</span> <span class="mono">Stock</span> <span class="mono">Per</span> <span class="mono">Product</span> <span class="mono">=<br class="calibre8" /></span></p>
			<p class="pe-answer"><span class="mono">    AVERAGEX(Products, Products[SafetyStockLevel] <br class="calibre8" />* Products[ListPrice])</span></p>
			<p class="h"><span class="b2">CALCULATE() with a Single Table</span></p>
			<p class="normal">These practice exercises appear in Chapter 9.</p>
			<p class="normal">32. <span class="mono">Total</span> <span class="mono">Male</span> <span class="mono">Customers</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Number of Customers], Customers[Gender] = "M")</span></p>
			<p class="normal">33. <span class="mono">Total</span> <span class="mono">Customers</span> <span class="mono">Born</span> <span class="mono">Before</span> <span class="mono">1970</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Number of Customers],</span></p>
			<p class="pe-answer"><span class="mono">        Customers[BirthDate] &lt; DATE(1970,1,1)</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="normal">34. <span class="mono">Total</span> <span class="mono">Customers</span> <span class="mono">Born</span> <span class="mono">in</span> <span class="mono">January</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Number of Customers],</span></p>
			<p class="pe-answer"><span class="mono">        MONTH(Customers[BirthDate]) = 1</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="normal">35. <span class="mono">Customers</span> <span class="mono">Earning</span> <span class="mono">at</span> <span class="mono">Least</span> <span class="mono">$100,000</span> <span class="mono">per</span> <span class="mono">Year</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Number of Customers],</span></p>
			<p class="pe-answer"><span class="mono">        Customers[YearlyIncome] &gt; =100000</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="h"><span class="b2">CALCULATE() with Multiple Tables</span></p>
			<p class="normal">These practice exercises appear in Chapter 9.</p>
			<p class="normal">36. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">of</span> <span class="mono">Clothing</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales],</span></p>
			<p class="pe-answer"><span class="mono">        Products[Category]="Clothing"</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="normal">37. <span class="mono">Sales</span> <span class="mono">to</span> <span class="mono">Female</span> <span class="mono">Customers</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales], Customers[Gender]="F")</span></p>
			<p class="normal">38. <span class="mono">Sales</span> <span class="mono">of</span> <span class="mono">Bikes</span> <span class="mono">to</span> <span class="mono">Married</span> <span class="mono">Men</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales],</span></p>
			<p class="pe-answer"><span class="mono">        Customers[MaritalStatus]="M",</span></p>
			<p class="pe-answer"><span class="mono">        Customers[Gender]="M",</span></p>
			<p class="pe-answer"><span class="mono">        Products[Category]="Bikes"</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="h"><span class="b2">VALUES()</span></p>
			<p class="normal">These practice exercises appear in Chapter 13.</p>
			<p class="normal">39. <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Color</span> <span class="mono">Variants</span> <span class="mono">=</span> <span class="mono">COUNTROWS(VALUES(Products[Color]))</span></p>
			<p class="normal">40. <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">SubCategories</span> <span class="mono">=</span> <span class="mono">COUNTROWS(VALUES(Products[SubCategory]))</span></p>
			<p class="normal">41. <span class="mono">Number</span> <span class="mono">of</span> <span class="mono">Size</span> <span class="mono">Ranges</span> <span class="mono">=</span> <span class="mono">COUNTROWS(VALUES(Products[SizeRange]))</span></p>
			<p class="normal">42. <span class="mono">Product</span> <span class="mono">Category</span> <span class="mono">(Values)</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    IF(HASONEVALUE(Products[Category]), VALUES(Products[Category]))</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">SELECTEDVALUE(Products[Category])</span></p>
			<p class="normal">43. <span class="mono">Product</span> <span class="mono">Subcategory</span> <span class="mono">(Values)</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    IF(HASONEVALUE(Products[SubCategory]),</span></p>
			<p class="pe-answer"><span class="mono">        VALUES(Products[SubCategory])</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">SELECTEDVALUE(Products[SubCategory])</span></p>
			<p class="normal">44. <span class="mono">Product</span> <span class="mono">Color</span> <span class="mono">(Values)</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    IF(HASONEVALUE(Products[color]),</span></p>
			<p class="pe-answer"><span class="mono">        VALUES(Products[color])</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">     SELECTEDVALUE(Products[color])</span></p>
			<p class="normal">45<span class="mono">.</span> <span class="mono">Product</span> <span class="mono">SubCategory</span> <span class="mono">(Values)</span> <span class="mono">edited</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    IF(HASONEVALUE(Products[SubCategory]),</span></p>
			<p class="pe-answer"><span class="mono">        VALUES(Products[SubCategory]),</span></p>
			<p class="pe-answer"><span class="mono">        "More than 1 SubCategory"</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">= SELECTEDVALUE(Products[SubCategory],"More than 1 SubCategory")</span></p>
			<p class="normal">46. <span class="mono">Product</span> <span class="mono">Color</span> <span class="mono">(Values)</span> <span class="mono">edited</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    IF(HASONEVALUE(Products[color]),</span></p>
			<p class="pe-answer"><span class="mono">        VALUES(Products[color]),</span></p>
			<p class="pe-answer"><span class="mono">        "More than 1 Color"</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">= SELECTEDVALUE((Products[color],"More than 1 Color")</span></p>
			<p class="h"><span class="b2">ALL(), ALLEXCEPT(), and ALLSELECTED()</span></p>
			<p class="normal">These practice exercises appear in Chapter 14.</p>
			<p class="normal">47. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">to</span> <span class="mono">All</span> <span class="mono">Customers</span> <span class="mono">=</span> <span class="mono">CALCULATE([Total</span> <span class="mono">Sales],</span> <span class="mono">All(Customers))</span></p>
			<p class="note"><span class="b1">Note:</span> This measure belongs in the <span class="mono1">Sales</span> table, not the <span class="mono1">Customers</span> table.</p>
			<p class="normal">48. <span class="mono">%</span> <span class="mono">of</span> <span class="mono">All</span> <span class="mono">Customer</span> <span class="mono">Sales</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">        DIVIDE([Total Sales], [Total Sales to All Customers])</span></p>
			<p class="normal">49. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">to</span> <span class="mono">Selected</span> <span class="mono">Customers</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">        CALCULATE([Total Sales], ALLSELECTED(Customers))</span></p>
			<p class="normal">50. <span class="mono">%</span> <span class="mono">of</span> <span class="mono">Sales</span> <span class="mono">to</span> <span class="mono">Selected</span> <span class="mono">Customers</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">        DIVIDE([Total Sales], [Total Sales to Selected Customers])</span></p>
			<p class="normal">51. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">for</span> <span class="mono">All</span> <span class="mono">Days</span> <span class="mono">Selected</span> <span class="mono">Dates</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">        CALCULATE([Total Sales], ALLSELECTED('Calendar'))</span></p>
			<p class="note"><span class="b1">Note:</span> Did you know to use <span class="mono1">ALLSELECTED()</span> and not <span class="mono1">ALLEXCEPT()</span>?</p>
			<p class="normal">52. <span class="mono">%</span> <span class="mono">Sales</span> <span class="mono">for</span> <span class="mono">All</span> <span class="mono">Days</span> <span class="mono">Selected</span> <span class="mono">Dates</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">        DIVIDE([Total Sales],[Total Sales for All Days Selected Dates])</span></p>
			<p class="normal">53. <span class="mono">Total</span> <span class="mono">Orders</span> <span class="mono">All</span> <span class="mono">Customers</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">        CALCULATE([Total Order Quantity], ALL(Customers))</span></p>
			<p class="normal">54. <span class="mono">Baseline</span> <span class="mono">Orders</span> <span class="mono">for</span> <span class="mono">All</span> <span class="mono">Customers</span> <span class="mono">with</span> <span class="mono">This</span> <span class="mono">Occupation</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Order Quantity],</span></p>
			<p class="pe-answer"><span class="mono">        ALLEXCEPT(Customers, Customers[Occupation])</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="normal">55. <span class="mono">Baseline</span> <span class="mono">%</span> <span class="mono">This</span> <span class="mono">Occupation</span> <span class="mono">of</span> <span class="mono">All</span> <span class="mono">Customer</span> <span class="mono">Orders</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    DIVIDE(</span></p>
			<p class="pe-answer"><span class="mono">        [Baseline Orders for All customers with this Occupation],</span></p>
			<p class="pe-answer"><span class="mono">        [Total Orders All Customers]</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="normal">56. <span class="mono">Total</span> <span class="mono">Orders</span> <span class="mono">Selected</span> <span class="mono">Customers</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Order Quantity], ALLSELECTED(Customers])</span></p>
			<p class="normal">57. <span class="mono">Occupation</span> <span class="mono">%</span> <span class="mono">of</span> <span class="mono">Selected</span> <span class="mono">Customers</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    DIVIDE([Total Order Quantity], [Total Orders Selected Customers])</span></p>
			<p class="normal">58. <span class="mono">Percentage</span> <span class="mono">Point</span> <span class="mono">Variation</span> <span class="mono">to</span> <span class="mono">Baseline</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    [Occupation % of Selected Customers] -</span></p>
			<p class="pe-answer"><span class="mono">    [Baseline % this Occupation is of All Customer Orders]</span></p>
			<p class="h"><span class="b2">FILTER()</span></p>
			<p class="normal">These practice exercises appear in Chapter 15.</p>
			<p class="normal">59. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">of</span> <span class="mono">Products</span> <span class="mono">That</span> <span class="mono">Have</span> <span class="mono">Some</span> <span class="mono">Sales</span> <span class="mono">but</span> <span class="mono">Less</span> <span class="mono">Than</span> <span class="mono">$10,000</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales],</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(Products,</span></p>
			<p class="pe-answer"><span class="mono">            [Total Sales] &lt; 10000 &amp;&amp; [Total Sales] &gt;0</span></p>
			<p class="pe-answer"><span class="mono">        )</span></p>
			<p class="pe-answer"><span class="mono">        )</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">    = CALCULATE([Total Sales],</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(Products, [Total Sales] &lt;10000),</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(Products, [Total Sales] &gt;0)</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="normal">60. <span class="mono">Count</span> <span class="mono">of</span> <span class="mono">Products</span> <span class="mono">That</span> <span class="mono">Have</span> <span class="mono">Some</span> <span class="mono">Sales</span> <span class="mono">but</span> <span class="mono">Less</span> <span class="mono">Than</span> <span class="mono">$10,000</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE(COUNTROWS(Products),</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(Products, [Total Sales]&lt;10000 &amp;&amp; [Total Sales] &gt;0)</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="pe-answer-body-text">or:</p>
			<p class="pe-answer"><span class="mono">    = CALCULATE(COUNTROWS(Products),</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(Products, [Total Sales] &lt;10000),</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(Products, [Total Sales] &gt;0)</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="h"><span class="b2">Time Intelligence</span></p>
			<p class="normal">These practice exercises appear in Chapter 16.</p>
			<p class="normal">61. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Month</span> <span class="mono">to</span> <span class="mono">Date</span> <span class="mono">=</span> <span class="mono">TOTALMTD([Total</span> <span class="mono">Sales],</span> <span class="mono">'Calendar'[Date])</span></p>
			<p class="normal">62. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Quarter</span> <span class="mono">to</span> <span class="mono">Date</span> <span class="mono">=</span> <span class="mono">TOTALQTD([Total</span> <span class="mono">Sales],</span> <span class="mono">'Calendar'[Date])</span></p>
			<p class="normal">63. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">FYTD</span> <span class="mono">30</span> <span class="mono">June</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    TOTALYTD([Total Sales],'Calendar'[Date],"30/6")</span></p>
			<p class="normal">64. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">FYTD</span> <span class="mono">31</span> <span class="mono">March</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    TOTALYTD([Total Sales],'Calendar'[Date],"31/3")</span></p>
			<p class="normal">65. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Previous</span> <span class="mono">Month</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales], PREVIOUSMONTH('Calendar'[Date]))</span></p>
			<p class="normal">66. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Previous</span> <span class="mono">Day</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales], PREVIOUSDAY('Calendar'[Date]))</span></p>
			<p class="normal">67. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Previous</span> <span class="mono">Quarter</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales], PREVIOUSQUARTER('Calendar'[Date]))</span></p>
			<p class="normal">68. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Moving</span> <span class="mono">Annual</span> <span class="mono">Total</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Sales],</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(ALL('Calendar'),</span></p>
			<p class="pe-answer"><span class="mono">            'Calendar'[Date] &gt; MAX('Calendar'[Date]) - 365</span></p>
			<p class="pe-answer"><span class="mono">            &amp;&amp; 'Calendar'[Date] &lt;= MAX('Calendar'[Date])</span></p>
			<p class="pe-answer"><span class="mono">        )</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="normal">69. <span class="mono">Total</span> <span class="mono">Sales</span> <span class="mono">Rolling</span> <span class="mono">90</span> <span class="mono">Days</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    IF(MAX('Calendar'[ID])&gt;=90,</span></p>
			<p class="pe-answer"><span class="mono">        CALCULATE([Total Sales],</span></p>
			<p class="pe-answer"><span class="mono">            FILTER(ALL('Calendar'),</span></p>
			<p class="pe-answer"><span class="mono">                'Calendar'[Date] &gt; MAX('Calendar'[Date]) - 90</span></p>
			<p class="pe-answer"><span class="mono">                &amp;&amp; 'Calendar'[Date] &lt;= MAX('Calendar'[Date])</span></p>
			<p class="pe-answer"><span class="mono">            )</span></p>
			<p class="pe-answer"><span class="mono">        )</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="h"><span class="b2">Harvester Measures</span></p>
			<p class="normal">This practice exercise appears in Chapter 20.</p>
			<p class="normal">70. <span class="mono">Total</span> <span class="mono">Customers</span> <span class="mono">Born</span> <span class="mono">Before</span> <span class="mono">Selected</span> <span class="mono">Year</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    CALCULATE([Total Number of Customers],</span></p>
			<p class="pe-answer"><span class="mono">        FILTER(Customers,</span></p>
			<p class="pe-answer"><span class="mono">            Customers[BirthDate] &lt; DATE([Selected Year],1,1)</span></p>
			<p class="pe-answer"><span class="mono">        )</span></p>
			<p class="pe-answer"><span class="mono">    )</span></p>
			<p class="h"><span class="b2">Multiple Data Tables</span></p>
			<p class="normal">These practice exercises appear in Chapter 21.</p>
			<p class="normal">71. <span class="mono">Total</span> <span class="mono">Budget</span> <span class="mono">=</span> <span class="mono">SUM(Budget[Budget])</span></p>
			<p class="note"><span class="b1">Note: </span>This measure should be placed in the <span class="mono1">Budget</span> table.</p>
			<p class="normal">72. <span class="mono">Change</span> <span class="mono">in</span> <span class="mono">Sales</span> <span class="mono">vs.</span> <span class="mono">Budget</span> <span class="mono">=</span> <span class="mono">[Total</span> <span class="mono">Sales]</span> <span class="mono">-</span> <span class="mono">[Total</span> <span class="mono">Budget]</span></p>
			<p class="note"><span class="b1">Note: </span>This measure could be placed in either the <span class="mono1">Sales</span> table or the <span class="mono1">Budget</span> table. I normally place it in the <span class="mono1">Sales</span> table because the name of the measure is <span class="mono1">[Change in Sales vs. Budget]</span>.</p>
			<p class="normal">73. <span class="mono">%</span> <span class="mono">Change</span> <span class="mono">in</span> <span class="mono">Sales</span> <span class="mono">vs.</span> <span class="mono">Budget</span> <span class="mono">=</span></p>
			<p class="pe-answer"><span class="mono">    DIVIDE([Change in Sales vs. Budget], [Total Budget])</span></p>
			<p class="note"><span class="b1">Note: </span>Also place this measure in the <span class="mono1">Sales</span> table.</p>
		</div>
	</div>


<div id="calibre_link-62" lang="en-US" lang="en-US" class="calibre">
		<div class="_idgenobjectstyleoverride">
			<p id="calibre_link-448" class="ch"><a id="calibre_link-29"></a><a id="calibre_link-449"></a><span class="b2">Appendix B - DAX Quick Reference List</span></p>
			<p class="normal">This DAX function quick reference list contains all the current DAX functions in an easy-to-use categorised list. Due to limited space in this book, this is simply a list of the function names.  I have prepared a more comprehensive quick reference guide that contains details about how each function works and can be used.  You can download a free PDF copy of the full quick reference guide at http://xbi.com.au/online-shop.</p>
			<p class="h">DAX Aggregation Functions (Aggregators)</p>
			<p class="normal">DAX Aggregation Functions (called aggregators for short) take a column or a table as the argument and aggregate the values.</p>
			<p class="codedaxref">AVERAGE(column)</p>
			<p class="codedaxref">AVERAGEA(column)</p>
			<p class="codedaxref">COUNT(column)</p>
			<p class="codedaxref">COUNTA(column)</p>
			<p class="codedaxref">COUNTBLANK(column)</p>
			<p class="codedaxref">COUNTROWS(table)</p>
			<p class="codedaxref">DISTINCTCOUNT(column)</p>
			<p class="codedaxref">DISTINCTCOUNTNOBLANK(column)</p>
			<p class="codedaxref">MAX(column)</p>
			<p class="codedaxref">MAX(expression1, expression2)</p>
			<p class="codedaxref">MAXA(column)</p>
			<p class="codedaxref">MIN(column)</p>
			<p class="codedaxref">MIN(expression1, expression2)</p>
			<p class="codedaxref">MINA(column)</p>
			<p class="codedaxref">PRODUCT(column)</p>
			<p class="codedaxref">SUM(column)</p>
			<p class="codedaxref">TOPN(n_value, tablename, orderByexpression1, [Order], <br class="calibre7" />    [orderByexpression2, [Order]], …)</p>
			<p class="h2indaxref">DAX Date and Time Functions</p>
			<p class="normal">You can use DAX Date and Time Functions in the calculations based on dates and time. DAX Date and Time Functions are like the Excel date and time functions but use a datetime data type and can take values from a column as an argument.</p>
			<p class="codedaxref">CALENDAR(startdate, enddate)</p>
			<p class="codedaxref">CALENDARAUTO([endmonthoffiscalyear])</p>
			<p class="codedaxref">DATE(year, month, day)</p>
			<p class="codedaxref">DATEDIFF(startdate, enddate, interval)</p>
			<p class="codedaxref">DATEVALUE(datetext)</p>
			<p class="codedaxref">DAY(date)</p>
			<p class="codedaxref">EDATE(startdate, months)</p>
			<p class="codedaxref">EOMONTH(startdate, months)</p>
			<p class="codedaxref">HOUR(datetimevalue)</p>
			<p class="codedaxref">MINUTE(datetimevalue)</p>
			<p class="codedaxref">MONTH(datetimevalue)</p>
			<p class="codedaxref">NOW()</p>
			<p class="codedaxref">QUARTER(datetimevalue)</p>
			<p class="codedaxref">SECOND(datetimevalue)</p>
			<p class="codedaxref">TIME(hour, minute, second)</p>
			<p class="codedaxref">TIMEVALUE(timetext)</p>
			<p class="codedaxref">TODAY()</p>
			<p class="codedaxref">UTCNOW()</p>
			<p class="codedaxref">UTCTODAY()</p>
			<p class="codedaxref">WEEKDAY(date, returntype)</p>
			<p class="codedaxref">WEEKNUM(date, returntype)</p>
			<p class="codedaxref">YEAR(datetimevalue)</p>
			<p class="codedaxref">YEARFRAC(start_date, end_date, [basis])</p>
			<p class="h2indaxref">DAX Filter Functions</p>
			<p class="normal">DAX Filter Functions are very different to Excel functions. They are used to (typically) return filtered tables that can be used in your data model. These new “virtual” tables retain lineage with the physical data model and hence they can “filter” the physical data model on the fly. Lookup functions work by using tables and relationships between them. Filtering functions let you manipulate data context to create dynamic calculations.</p>
			<p class="normal">DAX FILTER and VALUES functions are the most complex and powerful functions.</p>
			<p class="codedaxref">ADDMISSINGITEMS(showAllColumn[, showAllColumn] …, table, <br class="calibre8" />    groupingColumn[, groupingColumn]…[, filterTable] …)</p>
			<p class="codedaxref">ADDMISSINGITEMS(showAllColumn[, showAllColumn]…, table, <br class="calibre8" />    [ROLLUPISSUBTOTAL(]groupingColumn[, isSubtotal_columnName]<br class="calibre8" />    [, groupingColumn][, isSubtotal_columnName] … [)], <br class="calibre8" />    [, filterTable] …)</p>
			<p class="codedaxref">ALL([TableOrColumn][, TableOrColumn] …)</p>
			<p class="codedaxref">ALLCROSSFILTERED(table)</p>
			<p class="codedaxref">ALLEXCEPT(table, column[, column] …)</p>
			<p class="codedaxref">ALLNOBLANKROW(table|column)</p>
			<p class="codedaxref">ALLSELECTED([tableName|columnName])</p>
			<p class="codedaxref">CALCULATE(expression[, filter1][, filter2]…)</p>
			<p class="codedaxref">CALCULATETABLE(expression, filter1, filter2, …)</p>
			<p class="codedaxref">CROSSFILTER(columnName1, columnName2, direction)</p>
			<p class="codedaxref">DISTINCT(column)</p>
			<p class="codedaxref">DISTINCT(table)</p>
			<p class="codedaxref">EARLIER(column[, number])</p>
			<p class="codedaxref">EARLIEST(column)</p>
			<p class="codedaxref">FILTER(table, filter)</p>
			<p class="codedaxref">FILTERS(columnName)</p>
			<p class="codedaxref">HASONEFILTER(columnName)</p>
			<p class="codedaxref">HASONEVALUE(columnName)</p>
			<p class="codedaxref">ISCROSSFILTERED(columnName)</p>
			<p class="codedaxref">ISFILTERED(columnName)</p>
			<p class="codedaxref">KEEPFILTERS(expression)</p>
			<p class="codedaxref">RELATED(column)</p>
			<p class="codedaxref">RELATEDTABLE(tableName)</p>
			<p class="codedaxref">REMOVEFILTERS([table|column[, column[, column[, …]]]])</p>
			<p class="codedaxref">SELECTEDVALUE(columnName[, alternateResult])</p>
			<p class="codedaxref">SUBSTITUTEWITHINDEX(table, indexColumnName, indexColumnsTable, <br class="calibre8" />    orderBy_expression[, order][, orderBy_expression[, order]] …)</p>
			<p class="codedaxref">TREATAS(table_expression, column1[, column2][, column3] …)</p>
			<p class="codedaxref">USERELATIONSHIP(columnName1, columnName2)</p>
			<p class="codedaxref">VALUES(TableNameOrColumnName)</p>
			<p class="h2indaxref">DAX Financial Functions</p>
			<p class="normal">DAX Financial Functions are used in formulas that perform financial calculations. These functions are similar to Excel financial functions.</p>
			<p class="codedaxref">ACCRINT(issue, first_interest, settlement, rate, par, frequency<br class="calibre7" />    [, basis[, calc_method]])</p>
			<p class="codedaxref">ACCRINTM(issue, maturity, rate, par[, basis])</p>
			<p class="codedaxref">AMORDEGRC(cost, date_purchased, first_period, salvage, period, rate<br class="calibre7" />    [, basis])</p>
			<p class="codedaxref">AMORLINC(cost, date_purchased, first_period, salvage, period, rate<br class="calibre7" />    [, basis])</p>
			<p class="codedaxref">COUPDAYBS(settlement, maturity, frequency[, basis])</p>
			<p class="codedaxref">COUPDAYS(settlement, maturity, frequency[, basis])</p>
			<p class="codedaxref">COUPDAYSNC(settlement, maturity, frequency[, basis])</p>
			<p class="codedaxref">COUPNCD(settlement, maturity, frequency[, basis])</p>
			<p class="codedaxref">COUPNUM(settlement, maturity, frequency[, basis])</p>
			<p class="codedaxref">COUPPCD(settlement, maturity, frequency[, basis])</p>
			<p class="codedaxref">CUMIPMT(rate, nper, pv, start_period, end_period, type)</p>
			<p class="codedaxref">CUMPRINC(rate, nper, pv, start_period, end_period, type)</p>
			<p class="codedaxref">DB(cost, salvage, life, period[, month])</p>
			<p class="codedaxref">DDB(cost, salvage, life, period[, factor])</p>
			<p class="codedaxref">DISC(settlement, maturity, pr, redemption[, basis])</p>
			<p class="codedaxref">DOLLARDE(fractional_dollar, fraction)</p>
			<p class="codedaxref">DOLLARFR(decimal_dollar, fraction)</p>
			<p class="codedaxref">DURATION(settlement, maturity, coupon, yld, frequency[, basis])</p>
			<p class="codedaxref">EFFECT(nominal_rate, npery)</p>
			<p class="codedaxref">FV(rate, nper, pmt[, pv[, type]])</p>
			<p class="codedaxref">INTRATE(settlement, maturity, investment, redemption[, basis])</p>
			<p class="codedaxref">IPMT(rate, per, nper, pv[, fv[, type]])</p>
			<p class="codedaxref">ISPMT(rate, per, nper, pv)</p>
			<p class="codedaxref">MDURATION(settlement, maturity, coupon, yld, frequency[, basis])</p>
			<p class="codedaxref">NOMINAL(effect_rate, npery)</p>
			<p class="codedaxref">NPER(rate, pmt, pv[, fv[, type]])</p>
			<p class="codedaxref">ODDFPRICE(settlement, maturity, issue, first_coupon, rate, yld, <br class="calibre7" />    redemption, frequency[, basis])</p>
			<p class="codedaxref">ODDFYIELD(settlement, maturity, issue, first_coupon, rate, pr, <br class="calibre7" />    redemption, frequency[, basis])</p>
			<p class="codedaxref">ODDLPRICE(settlement, maturity, last_interest, rate, yld, <br class="calibre7" />    redemption, frequency[, basis])</p>
			<p class="codedaxref">ODDLYIELD(settlement, maturity, last_interest, rate, pr, <br class="calibre7" />    redemption, frequency[, basis])</p>
			<p class="codedaxref">PDURATION(rate, pv, fv)</p>
			<p class="codedaxref">PMT(rate, nper, pv[, fv[, type]])</p>
			<p class="codedaxref">PPMT(rate, per, nper, pv[, fv[, type]])</p>
			<p class="codedaxref">PRICE(settlement, maturity, rate, yld, redemption, frequency[, basis])</p>
			<p class="codedaxref">PRICEDISC(settlement, maturity, discount, redemption[, basis])</p>
			<p class="codedaxref">PRICEMAT(settlement, maturity, issue, rate, yld[, basis])</p>
			<p class="codedaxref">PV(rate, nper, pmt[, fv[, type]])</p>
			<p class="codedaxref">RATE(nper, pmt, pv[, fv[, type[, guess]]])</p>
			<p class="codedaxref">RECEIVED(settlement, maturity, investment, discount[, basis])</p>
			<p class="codedaxref">RRI(nper, pv, fv)</p>
			<p class="codedaxref">SLN(cost, salvage, life)</p>
			<p class="codedaxref">SYD(cost, salvage, life, per)</p>
			<p class="codedaxref">TBILLEQ(settlement, maturity, discount)</p>
			<p class="codedaxref">TBILLPRICE(settlement, maturity, discount)</p>
			<p class="codedaxref">TBILLYIELD(settlement, maturity, pr)</p>
			<p class="codedaxref">VDB(cost, salvage, life, start_period, end_period[, factor<br class="calibre7" />    [, no_switch]])</p>
			<p class="codedaxref">XIRR(table, values, dates[, guess])</p>
			<p class="codedaxref">XNPV(table, values, dates, rate)</p>
			<p class="codedaxref">YIELD(settlement, maturity, rate, pr, redemption, frequency[, basis])</p>
			<p class="codedaxref">YIELDDISC(settlement, maturity, pr, redemption[, basis])</p>
			<p class="codedaxref">YIELDMAT(settlement, maturity, issue, rate, pr[, basis])</p>
			<p class="h2indaxref">DAX Information Functions</p>
			<p class="normal">DAX Information Functions provide required information based on the given argument.</p>
			<p class="codedaxref">CONTAINS(table, columnName, value[, columnName, value]…)</p>
			<p class="codedaxref">CONTAINSROW(table, scalarexpression1[, scalarexpression2, …])</p>
			<p class="codedaxref">CUSTOMDATA()</p>
			<p class="codedaxref">Scalarexpression IN table<br class="calibre7" />    OR<br class="calibre7" />    (scalarexpression1, scalarexpression2, …) IN table</p>
			<p class="codedaxref">ISBLANK(value)</p>
			<p class="codedaxref">ISEMPTY(table_expression)</p>
			<p class="codedaxref">ISERROR(value)</p>
			<p class="codedaxref">ISEVEN(number)</p>
			<p class="codedaxref">ISINSCOPE(column)</p>
			<p class="codedaxref">ISLOGICAL(value)</p>
			<p class="codedaxref">ISNONTEXT(value)</p>
			<p class="codedaxref">ISNUMBER(value)</p>
			<p class="codedaxref">ISODD(number)</p>
			<p class="codedaxref">ISONORAFTER(scalarexpression, scalarexpression[, sortorder]<br class="calibre7" />    [, scalarexpression, scalarexpression[, sortorder]], …)</p>
			<p class="codedaxref">ISTEXT(value)</p>
			<p class="codedaxref">LOOKUPVALUE(result_columnName, search_columnName, search_value[, <br class="calibre7" />    search_columnName, search_value], … [, &lt;alternateResult&gt;])</p>
			<p class="codedaxref">USERNAME()</p>
			<p class="h2indaxref">DAX Logical Functions</p>
			<p class="normal">DAX Logical Functions return values based on the conditional results.</p>
			<p class="codedaxref">AND(logical_value, logical_value)</p>
			<p class="codedaxref">COALESCE(expression, expression[, expression] …)</p>
			<p class="codedaxref">FALSE()</p>
			<p class="codedaxref">IF(logicaltest, value_if_true[, value_if_false])</p>
			<p class="codedaxref">IFERROR(value, value_if_error)</p>
			<p class="codedaxref">NOT(logical_value)</p>
			<p class="codedaxref">OR(logical_value, logical_value)</p>
			<p class="codedaxref">SWITCH(Expression, value1, expression1[, value2, expression2] … [, else, expression])</p>
			<p class="codedaxref">TRUE()</p>
			<p class="h2indaxref">DAX Math and Trig Functions</p>
			<p class="normal">DAX Math and Trig Functions are similar to Excel mathematical and trigonometric functions.</p>
			<p class="codedaxref">ABS(number)</p>
			<p class="codedaxref">ACOS(number)</p>
			<p class="codedaxref">ACOSH(number)</p>
			<p class="codedaxref">ASIN(number)</p>
			<p class="codedaxref">ASINH(number)</p>
			<p class="codedaxref">ATAN(number)</p>
			<p class="codedaxref">ATANH(number)</p>
			<p class="codedaxref">CEILING(number, significance)</p>
			<p class="codedaxref">COMBIN(number, number_chosen)</p>
			<p class="codedaxref">COMBINA(number, number_chosen)</p>
			<p class="codedaxref">COS(number)</p>
			<p class="codedaxref">COSH(number)</p>
			<p class="codedaxref">CURRENCY(value)</p>
			<p class="codedaxref">DEGREES(angle)</p>
			<p class="codedaxref">DIVIDE(numerator, denominator[, alternate-result])</p>
			<p class="codedaxref">EVEN(number)</p>
			<p class="codedaxref">EXP(number)</p>
			<p class="codedaxref">FACT(number)</p>
			<p class="codedaxref">FLOOR(number, significance)</p>
			<p class="codedaxref">GCD(number1[, number2] …)</p>
			<p class="codedaxref">INT(number)</p>
			<p class="codedaxref">ISO.CEILING(number[, significance])</p>
			<p class="codedaxref">LCM(number1[, number2] …)</p>
			<p class="codedaxref">LN(number)</p>
			<p class="codedaxref">LOG(number, [base])</p>
			<p class="codedaxref">LOG10(number)</p>
			<p class="codedaxref">MOD(number, divisor)</p>
			<p class="codedaxref">MROUND(number, multiple)</p>
			<p class="codedaxref">ODD(number)</p>
			<p class="codedaxref">PERMUT(number, number_chosen)</p>
			<p class="codedaxref">PI()</p>
			<p class="codedaxref">POWER(number, power)</p>
			<p class="codedaxref">QUOTIENT(numerator, denominator)</p>
			<p class="codedaxref">RADIANS(angle)</p>
			<p class="codedaxref">RAND()</p>
			<p class="codedaxref">RANDBETWEEN(bottom, top)</p>
			<p class="codedaxref">ROUND(number, num_digits)</p>
			<p class="codedaxref">ROUNDDOWN(number, num_digits)</p>
			<p class="codedaxref">ROUNDUP(number, num_digits)</p>
			<p class="codedaxref">SIGN(number)</p>
			<p class="codedaxref">SIN(number)</p>
			<p class="codedaxref">SINH(number)</p>
			<p class="codedaxref">SQRT(number)</p>
			<p class="codedaxref">SQRTPI(number)</p>
			<p class="codedaxref">TAN(number)</p>
			<p class="codedaxref">TANH(number)</p>
			<p class="codedaxref">TRUNC(number, num_digits)</p>
			<p class="h2indaxref">DAX Other Functions</p>
			<p class="normal">These functions perform unique actions that cannot be defined by any of the categories.</p>
			<p class="codedaxref">CONVERT(Expression, Datatype)</p>
			<p class="codedaxref">ERROR(text) </p>
			<p class="codedaxref">VAR VarName = Expression </p>
			<p class="h2indaxref">DAX Other Special Functions (X-Functions / Iterators)</p>
			<p class="normal">These functions perform specific actions that complement the other DAX functions.</p>
			<p class="normal">DAX Iterator Functions, called iterators for short, take a column or a table as the argument and aggregate the values just as aggregation functions&mdash;but using a different approach. These functions aggregate the values in a row context.</p>
			<p class="normal">These are “X-functions" (i.e., any function that has an X on the end of the name). The iterators given below also include statistical iterator functions.</p>
			<p class="normal">DAX also has two financial functions that got added in Excel 2016.</p>
			<p class="codedaxref">AVERAGEX(table, expression)</p>
			<p class="codedaxref">CONCATENATEX(table, expression[, delimiter])</p>
			<p class="codedaxref">COUNTAX(table, expression)</p>
			<p class="codedaxref">COUNTX(table, expression)</p>
			<p class="codedaxref">GEOMEANX(table, expression)</p>
			<p class="codedaxref">MAXX(table, expression)</p>
			<p class="codedaxref">MEDIANX(table, expression)</p>
			<p class="codedaxref">MINX(table, expression)</p>
			<p class="codedaxref">PERCENTILEX.EXC(table, expression, k)</p>
			<p class="codedaxref">PERCENTILEX.INC(table, expression, k)</p>
			<p class="codedaxref">PRODUCTX(table, expression)</p>
			<p class="codedaxref">RANKX(table, expression, [value], [order], [ties])</p>
			<p class="codedaxref">STDEVX.P(table, expression)</p>
			<p class="codedaxref">SUMX(table, expression)</p>
			<p class="codedaxref">VARX.P(table, expression)</p>
			<p class="codedaxref">VARX.S(table, expression)</p>
			<p class="h2indaxref">DAX Other Special Functions (Argument Functions)</p>
			<p class="normal">In DAX, there are also some special functions that have a very specific purpose of usability in other DAX functions only. i.e., they can be used only as arguments to certain DAX functions. These functions cannot be used as standalone functions.</p>
			<p class="codedaxref">CURRENTGROUP()</p>
			<p class="codedaxref">IGNORE(expression)</p>
			<p class="codedaxref">NONVISUAL(expression)</p>
			<p class="codedaxref">ROLLUPADDISSUBTOTAL(groupBy_columnName, isSubtotal_columnName, <br class="calibre7" />    [groupBy_columnName, isSubtotal_columnName], …)</p>
			<p class="codedaxref">ROLLUPGROUP(groupBy_columnName, groupBy_columnName)</p>
			<p class="codedaxref">ROLLUPISSUBTOTAL(groupingColumn, isSubtotal_columnName, <br class="calibre7" />    [groupingColumn, isSubtotal_columnName], …)</p>
			<p class="h2indaxref">DAX Parent and Child Functions</p>
			<p class="normal">DAX Parent and Child functions help to manage data that is presented as a parent/child hierarchy in the data model.</p>
			<p class="normal">For more information read Understanding Functions for Parent-Child Hierarchies in DAX (https://msdn.microsoft.com/en-us/library/gg492192.aspx).</p>
			<p class="codedaxref">PATH(ID_columnName, parent_columnName)</p>
			<p class="codedaxref">PATHCONTAINS(path, item)</p>
			<p class="codedaxref">PATHITEM(path, position, [type])</p>
			<p class="codedaxref">PATHITEMREVERSE(path, position, [type])</p>
			<p class="codedaxref">PATHLENGTH(path)</p>
			<p class="h2indaxref">DAX Query Functions</p>
			<p class="normal">These DAX functions are helpful in writing queries in DAX.  These functions return tables that can be used in other DAX functions as input. The resulting tables are virtual and are not materialised.</p>
			<p class="normal"><a id="calibre_link-190" class="calibre3"></a>DAX Studio is a great way to learn about table functions because you can “see” the tables materialised on the screen. Read about DAX Studio as a tool to query your data model here http://xbi.com.au/dax-studio.</p>
			<p class="codedaxref">ADDCOLUMNS(table, name, expression[, name, expression] …)</p>
			<p class="codedaxref">CROSSJOIN(table, table[, table] …)</p>
			<p class="codedaxref">DATATABLE(ColumnName1, DataType1, ColumnName2, DataType2, …, <br class="calibre7" />    {{Value1, Value2 …}, {Value1, Value2…}, …})</p>
			<p class="codedaxref">EXCEPT(table_expression1, table_expression2)</p>
			<p class="codedaxref">GENERATE(table1, table2)</p>
			<p class="codedaxref">GENERATEALL(table1, table2)</p>
			<p class="codedaxref">GROUPBY(table, [&lt;groupBy_columnName1&gt;], [&lt;name, expression&gt;] …)</p>
			<p class="codedaxref">GENERATESERIES(StartValue, EndValue[, IncrementValue])</p>
			<p class="codedaxref">INTERSECT(table, table)</p>
			<p class="codedaxref">NATURALINNERJOIN(leftJoinTable, rightJoinTable)</p>
			<p class="codedaxref">NATURALLEFTOUTERJOIN(leftJoinTable, rightJoinTable)</p>
			<p class="codedaxref">ROW(name, expression[, name, expression] …)</p>
			<p class="codedaxref">SELECTCOLUMNS(table, name, scalar_expression<br class="calibre7" />    [, name, scalar_expression] …)</p>
			<p class="codedaxref">SUMMARIZE(table, groupBy_columnName[, groupBy_columnName] …, <br class="calibre7" />    name, expression, [name, expression] …)</p>
			<p class="codedaxref">SUMMARIZECOLUMNS(groupBy_columnName[, groupBy_columnName] …, <br class="calibre7" />    [filterTable] … [, name, expression] …)</p>
			<p class="codedaxref">TableConstructor {scalar_expression1, scalar_expression2, …}<br class="calibre7" />    {(scalar_expression11, scalar_expression12, …, scalar_expression1N),<br class="calibre7" />    (scalar_expression21), scalar_expression22, …, scalar_expression2N), <br class="calibre7" />    …}</p>
			<p class="codedaxref">UNION(table_expression1, table_expression2)</p>
			<p class="h2indaxref">DAX Statistical Functions</p>
			<p class="normal">Following are the DAX Statistical Functions:</p>
			<p class="codedaxref">BETA.DIST(x, alpha, beta, cumulative[, A][, B])</p>
			<p class="codedaxref">BETA.INV(probability, alpha, beta[, A][, B])</p>
			<p class="codedaxref">CHISQ.INV(probability, deg_freedom)</p>
			<p class="codedaxref">CHISQ.INV.RT(probability, deg_freedom)</p>
			<p class="codedaxref">CONFIDENCE.NORM(alpha, standard_dev, size)</p>
			<p class="codedaxref">CONFIDENCE.T(alpha, standard_dev, size)</p>
			<p class="codedaxref">EXPON.DIST(x, lambda, cumulative)</p>
			<p class="codedaxref">GEOMEAN(column)</p>
			<p class="codedaxref">MEDIAN(column)</p>
			<p class="codedaxref">NORM.DIST(X, Mean, Standard_dev, Cumulative)</p>
			<p class="codedaxref">NORM.INV(Probability, Mean, Standard_dev)</p>
			<p class="codedaxref">NORM.S.DIST(Z, Cumulative)</p>
			<p class="codedaxref">NORM.S.INV(Probability)</p>
			<p class="codedaxref">PERCENTILE.EXC(column, k)</p>
			<p class="codedaxref">PERCENTILE.INC(column, k)</p>
			<p class="codedaxref">POISSON.DIST(x, mean, cumulative)</p>
			<p class="codedaxref">RANK.EQ(value, columnName, [order])</p>
			<p class="codedaxref">SAMPLE(n_value, table, orderBy_expression, [order][, orderBy_expression,<br class="calibre7" />    [order], …])</p>
			<p class="codedaxref">STDEV.P(ColumnName)</p>
			<p class="codedaxref">STDEV.S(ColumnName)</p>
			<p class="codedaxref">T.DIST(X, Deg_freedom, Cumulative)</p>
			<p class="codedaxref">T.DIST.2T(X, Deg_freedom)</p>
			<p class="codedaxref">T.DIST.RT(X, Deg_freedom)</p>
			<p class="codedaxref">T.INV(Probability, Deg_freedom)</p>
			<p class="codedaxref">T.INV.2T(Probability, Deg_freedom)</p>
			<p class="codedaxref">VAR.P(ColumnName)</p>
			<p class="codedaxref">VAR.S(ColumnName)</p>
			<p class="h2indaxref">DAX Text Functions</p>
			<p class="normal">DAX Text Functions are based on the Excel string functions but have been modified to work with tables and columns.</p>
			<p class="codedaxref">BLANK()</p>
			<p class="codedaxref">CODE(text)</p>
			<p class="codedaxref">COMBINEVALUES(delimiter, expression, expression[, expression] …)</p>
			<p class="codedaxref">CONCATENATE(text1, text2)</p>
			<p class="codedaxref">CONTAINSSTRING(within_text, find_text)</p>
			<p class="codedaxref">CONTAINSSTRINGEXACT(within_text, find_text)</p>
			<p class="codedaxref">FIND(find_text, within_text[, start_num][, NotFoundValue])</p>
			<p class="codedaxref">FIXED(number, decimals[, no_commas])</p>
			<p class="codedaxref">FORMAT(value, format_string)</p>
			<p class="codedaxref">LEFT(text[, num_chars])</p>
			<p class="codedaxref">LEN(text)</p>
			<p class="codedaxref">LOWER(text)</p>
			<p class="codedaxref">MID(text, start_num, num_chars)</p>
			<p class="codedaxref">REPLACE(old_text, start_num, num_chars, new_text)</p>
			<p class="codedaxref">REPT(text, num_times)</p>
			<p class="codedaxref">RIGHT(text, [num_chars])</p>
			<p class="codedaxref">SEARCH(find_text, within_text[, start_num], [, NotFoundValue])</p>
			<p class="codedaxref">SUBSTITUTE(text, old_text, new_text, instance_num)</p>
			<p class="codedaxref">TRIM(text)</p>
			<p class="codedaxref">UNICHAR(number)</p>
			<p class="codedaxref">UPPER(text)</p>
			<p class="codedaxref">VALUE(text)</p>
			<p class="h2indaxref">DAX Time Intelligence Functions</p>
			<p class="normal">DAX Time Intelligence Functions enable you to manipulate data using time periods, including days, months, quarters and years, and then build and compare calculations over those periods. </p>
			<p class="normal">There are 3 classes of DAX Time Intelligence functions based on their return value.</p>
			<ul class="calibre2">
				<li class="bl">Those that return scalar values (e.g. TOTALYTD). They are stand-alone functions and so can be used as a stand-alone measure/function.</li>
				<li class="bl">Those that return a table containing a single column and single row with a date value (e.g. FIRSTNONBLANK). They can be used either as stand-alone functions to define a measure (as a scalar value) or as an argument to any function that requires a table in its arguments. These types of functions therefore behave as both a scalar value and a table, depending on the use case.</li>
				<li class="bl">Those that return a table of dates (e.g. DATESYTD) and are designed to be used inside a CALCULATE function.</li>
			</ul>
			<p class="h3indaxref">DAX Time Intelligence Functions that return Scalar Values</p>
			<p class="codedaxref">CLOSINGBALANCEMONTH(expression, dates, [filter])</p>
			<p class="codedaxref">CLOSINGBALANCEQUARTER(expression, dates, [filter])</p>
			<p class="codedaxref">CLOSINGBALANCEYEAR(expression, dates, [filter], [year_end_date])</p>
			<p class="codedaxref">OPENINGBALANCEMONTH(expression, dates[, filter])</p>
			<p class="codedaxref">OPENINGBALANCEQUARTER(expression, dates[, filter])</p>
			<p class="codedaxref">OPENINGBALANCEYEAR(expression, dates[, filter])</p>
			<p class="codedaxref">TOTALMTD(expression, dates[, filter])</p>
			<p class="codedaxref">TOTALQTD(expression, dates[, filter])</p>
			<p class="codedaxref">TOTALYTD(expression, dates[, filter][, year_end_date])</p>
			<p class="h3indaxref">DAX Time Intelligence Functions that return both a Table and a Scalar</p>
			<p class="normal">These functions return a table containing a single column and single row with a date value (can be used as a scalar value or a table input to another function).</p>
			<p class="codedaxref">ENDOFMONTH(dates)</p>
			<p class="codedaxref">ENDOFQUARTER(dates)</p>
			<p class="codedaxref">ENDOFYEAR(dates[, year_end_date])</p>
			<p class="codedaxref">FIRSTDATE(dates)</p>
			<p class="codedaxref">FIRSTNONBLANK(column, expression)</p>
			<p class="codedaxref">FIRSTNONBLANKVALUE(column, expression)</p>
			<p class="codedaxref">LASTDATE(dates)</p>
			<p class="codedaxref">LASTNONBLANK(column, expression)</p>
			<p class="codedaxref">LASTNONBLANKVALUE(column, expression)</p>
			<p class="codedaxref">STARTOFMONTH(dates)</p>
			<p class="codedaxref">STARTOFQUARTER(dates)</p>
			<p class="codedaxref">STARTOFYEAR(Dates, [yearenddate])</p>
			<p class="h3indaxref">DAX Time Intelligence Functions that return a Table of Dates</p>
			<p class="codedaxref">DATEADD(dates, number_of_intervals, interval)</p>
			<p class="codedaxref">DATESBETWEEN(dates, start_date, end_date)</p>
			<p class="codedaxref">DATESINPERIOD(dates, start_date, number_of_intervals, interval)</p>
			<p class="codedaxref">DATESMTD(dates)</p>
			<p class="codedaxref">DATESQTD(dates)</p>
			<p class="codedaxref">DATESYTD(dates[, year_end_date])</p>
			<p class="codedaxref">NEXTDAY(dates)</p>
			<p class="codedaxref">NEXTMONTH(dates)</p>
			<p class="codedaxref">NEXTQUARTER(dates)</p>
			<p class="codedaxref">NEXTYEAR(dates[, year_end_date])</p>
			<p class="codedaxref">PARALLELPERIOD(dates, number_of_intervals, interval)</p>
			<p class="codedaxref">PREVIOUSDAY(dates)</p>
			<p class="codedaxref">PREVIOUSMONTH(dates)</p>
			<p class="codedaxref">PREVIOUSQUARTER(dates)</p>
			<p class="codedaxref">PREVIOUSYEAR(dates[, year_end_date])</p>
			<p class="codedaxref">SAMEPERIODLASTYEAR(dates)</p>
		</div>
		<div class="_idgenobjectlayout1">
			<div id="calibre_link-450" class="cautionimage">
			</div>
		</div>
	</div>


<div id="calibre_link-63" lang="en-US" lang="en-US" class="calibre">
		<div id="calibre_link-451" class="_idgenobjectstyleoverride">
		</div>
	</div>


<div id="calibre_link-64" lang="en-US" lang="en-US" class="calibre">
		<div id="calibre_link-452" class="_idgenobjectstyleoverride" type="toc">
			<p class="ch"><span class="b2"><a id="calibre_link-32"></a>Table of Here's How Sections</span></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-65" class="calibre3"><span class="b3">Here’s How: Getting Power BI Desktop</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-35" class="calibre3"><span class="b3">Here’s How: Loading Data from a New Source</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-66" class="calibre3"><span class="b3">Here’s How: Creating Relationships in Power BI Desktop</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-67" class="calibre3"><span class="b3">Here’s How: Making Changes to a Table That Is Already Loaded</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-68" class="calibre3"><span class="b3">Here’s How: Deleting Steps in a Query</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-69" class="calibre3"><span class="b3">Here’s How: Importing New Tables</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-70" class="calibre3"><span class="b3">Here’s How: Changing the File Location of an Existing Connection</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-71" class="calibre3"><span class="b3">Here’s How: Inserting a Matrix</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-72" class="calibre3"><span class="b3">Here’s How: Writing Measures</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-73" class="calibre3"><span class="b3">Here’s How: Increasing the Matrix Font Size</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-38" class="calibre3"><span class="b3">Here’s How: Using IntelliSense</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-74" class="calibre3"><span class="b3">Here’s How: Editing </span><span class="b3">Measures</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-75" class="calibre3"><span class="b3">Here’s How: Adding Comments to Measures</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-76" class="calibre3"><span class="b3">Here’s How: Creating New Pages in Power BI</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-77" class="calibre3"><span class="b3">Here’s How: Changing Display Names in Visuals</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-78" class="calibre3"><span class="b3">Here’s How: Word Wrapping in a Visual</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-79" class="calibre3"><span class="b3">Here’s How: Applying Conditional Formatting</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-80" class="calibre3"><span class="b3">Here’s How: Drilling Through Rows in a Matrix</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-81" class="calibre3"><span class="b3">Here’s How: Moving an Existing Measure to a Different Home Table</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-82" class="calibre3"><span class="b3">Here’s How: A Basic (but Wrong!) Calculated Column</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-83" class="calibre3"><span class="b3">Here’s How: Creating a Day Type Calculated Column</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-84" class="calibre3"><span class="b3">Here’s How: Changing the Month Name Sort Order</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-85" class="calibre3"><span class="b3">Here’s How: Using ALLEXCEPT()</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-86" class="calibre3"><span class="b3">Here’s How: Turning Off Auto Date/Time</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-87" class="calibre3"><span class="b3">Here’s How: Changing Summarization for Multiple Columns at Once</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-88" class="calibre3"><span class="b3">Here’s How: Manually Adding Data to Power BI</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-89" class="calibre3"><span class="b3">Here’s How: Using What-If</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-90" class="calibre3"><span class="b3">Here’s How: Solving Practice Exercise 70</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-91" class="calibre3"><span class="b3">Here’s How: Applying Banding</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-92" class="calibre3"><span class="b3">Here’s How: Editing a Table Previously Created with the Enter Data Feature</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-93" class="calibre3"><span class="b3">Here’s How: Deleting Interim Calculated Columns</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-94" class="calibre3"><span class="b3">Here’s How: Bridging a Budget Table</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-95" class="calibre3"><span class="b3">Here’s How: Enabling Bidirectional Cross-Filtering</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-96" class="calibre3"><span class="b3">Here’s How: Publishing a Report to PowerBI.com</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-97" class="calibre3"><span class="b3">Here’s How: Using Analyze in Excel</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-98" class="calibre3"><span class="b3">Here’s How: Converting a Pivot Table to Cube Formulas</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-99" class="calibre3"><span class="b3">Here’s How: Writing CUBEVALUE() from Scratch</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-100" class="calibre3"><span class="b3">Here’s How: Applying Filters to Cube Formulas</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-101" class="calibre3"><span class="b3">Here’s How: Adding a Slicer Without a Pivot Table</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-102" class="calibre3"><span class="b3">Here’s How: Connecting a Slicer to a Cube Formula</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-103" class="calibre3"><span class="b3">Here’s How: Importing Excel Power Pivot Workbooks to Power BI Desktop</span></a></p>
			<p class="toc-hh-body-text"><a href="#calibre_link-104" class="calibre3"><span class="b3">Here’s How: Writing Measures</span></a></p>
		</div>
	</div>


<div id="calibre_link-105" lang="en-US" lang="en-US" class="calibre">
		<div id="calibre_link-453" class="_idgenobjectstyleoverride" type="index">
			<p id="calibre_link-454" class="ch"><a id="calibre_link-30"></a>Index</p>
			<p class="index-section-head">Symbols</p>
			<p class="index-level">|| OR operator  <a href="#calibre_link-106">76</a></p>
			<p class="index-level">13 4-week periods  <a href="#calibre_link-107">154</a></p>
			<p class="index-level">445 calendar  <a href="#calibre_link-108">153</a></p>
			<p class="index-level">&amp;&amp; AND operator  <a href="#calibre_link-109">77</a></p>
			<p class="index-level">/* */ comment  <a href="#calibre_link-110">39</a></p>
			<p class="index-level">// comment character  <a href="#calibre_link-111">39</a></p>
			<p class="index-section-head">A</p>
			<p class="index-level">AdventureWorks  <a href="#calibre_link-112">4</a></p>
			<p class="index-level">Age bands  <a href="#calibre_link-113">214</a></p>
			<p class="index-level">Aggregation choices  <a href="#calibre_link-114">36</a></p>
			<p class="index-level">Aggregators vs. X-functions</p>
			<p class="index-level">  <a href="#calibre_link-115">83</a></p>
			<p class="index-level">ALL  <a href="#calibre_link-116">121</a></p>
			<p class="index-level1">inside CALCULATE  <a href="#calibre_link-117">125</a></p>
			<p class="index-level1">with Calendar  <a href="#calibre_link-118">173</a></p>
			<p class="index-level">ALLEXCEPT  <a href="#calibre_link-119">132</a></p>
			<p class="index-level">ALLSELECTED  <a href="#calibre_link-120">132</a></p>
			<p class="index-level">Analyze in Excel  <a href="#calibre_link-121">239</a></p>
			<p class="index-level">AND  <a href="#calibre_link-122">77</a></p>
			<p class="index-level">Auto Date/Time  <a href="#calibre_link-123">154</a></p>
			<p class="index-level">AVERAGE  <a href="#calibre_link-124">56</a></p>
			<p class="index-level">Averages in total row  <a href="#calibre_link-125">86</a></p>
			<p class="index-level">AVERAGEX  <a href="#calibre_link-126">81</a>, <a href="#calibre_link-127">87</a></p>
			<p class="index-section-head">B</p>
			<p class="index-level">Banding  <a href="#calibre_link-128">214</a></p>
			<p class="index-level">Best-selling  <a href="#calibre_link-129">189</a></p>
			<p class="index-level">Bidirectional cross-filtering  <a href="#calibre_link-130">231</a></p>
			<p class="index-level">BLANK  <a href="#calibre_link-131">112</a></p>
			<p class="index-level">Blogs  <a href="#calibre_link-132">262</a></p>
			<p class="index-level">Bridging tables  <a href="#calibre_link-133">224</a></p>
			<p class="index-level">Budget table  <a href="#calibre_link-134">222</a></p>
			<p class="index-section-head">C</p>
			<p class="index-level">Caesar salad  <a href="#calibre_link-135">89</a></p>
			<p class="index-level">CALCULATE  <a href="#calibre_link-136">89</a></p>
			<p class="index-level1">Explicit  <a href="#calibre_link-137">149</a></p>
			<p class="index-level1">Multiple tables  <a href="#calibre_link-138">92</a></p>
			<p class="index-level1">Table Filters  <a href="#calibre_link-139">93</a></p>
			<p class="index-level">Calculated columns  <a href="#calibre_link-140">72</a></p>
			<p class="index-level1">Problem with  <a href="#calibre_link-141">75</a></p>
			<p class="index-level">Calculated Columns</p>
			<p class="index-level1">for Slicers  <a href="#calibre_link-142">75</a></p>
			<p class="index-level">Calculated fields  <a href="#calibre_link-143">30</a></p>
			<p class="index-level">Calendar</p>
			<p class="index-level1">ID column  <a href="#calibre_link-144">175</a></p>
			<p class="index-level">CALENDAR  <a href="#calibre_link-145">55</a></p>
			<p class="index-level">Calendar example  <a href="#calibre_link-146">108</a></p>
			<p class="index-level">Calendar table  <a href="#calibre_link-147">153</a></p>
			<p class="index-level">Card  <a href="#calibre_link-148">211</a></p>
			<p class="index-level">Cardinality  <a href="#calibre_link-149">85</a></p>
			<p class="index-level">Check Formula  <a href="#calibre_link-150">259</a></p>
			<p class="index-level">Collie layout  <a href="#calibre_link-151">20</a></p>
			<p class="index-level">Collie, Rob  <a href="#calibre_link-152">20</a></p>
			<p class="index-level">Colour scales  <a href="#calibre_link-153">55</a></p>
			<p class="index-level">Column width  <a href="#calibre_link-154">47</a></p>
			<p class="index-level">Compression  <a href="#calibre_link-155">68</a></p>
			<p class="index-level">CONCATENATEX  <a href="#calibre_link-156">115</a></p>
			<p class="index-level">Conditional formatting  <a href="#calibre_link-157">50</a></p>
			<p class="index-level">Connectors  <a href="#calibre_link-158">15</a></p>
			<p class="index-level">Context transition</p>
			<p class="index-level">  <a href="#calibre_link-159">96</a></p>
			<p class="index-level">Convert to formulas  <a href="#calibre_link-160">244</a></p>
			<p class="index-level">COUNT  <a href="#calibre_link-161">44</a></p>
			<p class="index-level">COUNTAX  <a href="#calibre_link-162">88</a></p>
			<p class="index-level">COUNTBLANK  <a href="#calibre_link-163">58</a></p>
			<p class="index-level">COUNTROWS  <a href="#calibre_link-164">46</a></p>
			<p class="index-level">COUNTX  <a href="#calibre_link-165">88</a></p>
			<p class="index-level">Covey, Stephen  <a href="#calibre_link-166">262</a></p>
			<p class="index-level">Cross-filtering  <a href="#calibre_link-167">61</a></p>
			<p class="index-level">Cube formulas  <a href="#calibre_link-168">243</a></p>
			<p class="index-level">CUBEVALUE  <a href="#calibre_link-169">245</a></p>
			<p class="index-level">Customers born before  <a href="#calibre_link-170">208</a></p>
			<p class="index-section-head">D</p>
			<p class="index-level">Dashboards  <a href="#calibre_link-171">261</a></p>
			<p class="index-level">Data Bars  <a href="#calibre_link-172">50</a></p>
			<p class="index-level">Database vs. spreadsheet  <a href="#calibre_link-173">7</a></p>
			<p class="index-level">Data Model  <a href="#calibre_link-174">8</a></p>
			<p class="index-level">Data modelling  <a href="#calibre_link-175">7</a></p>
			<p class="index-level">Data sources  <a href="#calibre_link-176">15</a></p>
			<p class="index-level">Data tables  <a href="#calibre_link-177">21</a></p>
			<p class="index-level">Data Tables</p>
			<p class="index-level1">versus Flattened  <a href="#calibre_link-178">67</a></p>
			<p class="index-level">Data view  <a href="#calibre_link-179">12</a></p>
			<p class="index-level">DATEADD  <a href="#calibre_link-180">167</a>, <a href="#calibre_link-181">180</a></p>
			<p class="index-level">DATESINPERIOD  <a href="#calibre_link-182">177</a></p>
			<p class="index-level">DAX</p>
			<p class="index-level1">Easy to read  <a href="#calibre_link-183">94</a></p>
			<p class="index-level1">Formatter  <a href="#calibre_link-184">94</a></p>
			<p class="index-level1">in Excel  <a href="#calibre_link-185">256</a></p>
			<p class="index-level1">Reference Guide  <a href="#calibre_link-186">184</a></p>
			<p class="index-level1">Researching  <a href="#calibre_link-187">180</a></p>
			<p class="index-level1">Variables  <a href="#calibre_link-188">186</a></p>
			<p class="index-level1">versus Power Query  <a href="#calibre_link-189">216</a></p>
			<p class="index-level">DAX Studio  <a href="#calibre_link-190">280</a></p>
			<p class="index-level">Day calculated column  <a href="#calibre_link-191">76</a></p>
			<p class="index-level">de Jonge, Kasper  <a href="#calibre_link-192">37</a></p>
			<p class="index-level">Deleting steps  <a href="#calibre_link-193">23</a></p>
			<p class="index-level">Dimensional modelling course  <a href="#calibre_link-194">19</a></p>
			<p class="index-level">DirectQuery  <a href="#calibre_link-195">9</a></p>
			<p class="index-level">Disaggregating  <a href="#calibre_link-196">235</a></p>
			<p class="index-level">Disconnected tables  <a href="#calibre_link-197">203</a></p>
			<p class="index-level">Display names  <a href="#calibre_link-198">46</a></p>
			<p class="index-level">DISTINCTCOUNT  <a href="#calibre_link-199">48</a></p>
			<p class="index-level">DIVIDE  <a href="#calibre_link-200">60</a></p>
			<p class="index-level">Drag direction  <a href="#calibre_link-201">17</a></p>
			<p class="index-level">Drilling Through  <a href="#calibre_link-202">53</a></p>
			<p class="index-section-head">E</p>
			<p class="index-level">Easy to read DAX  <a href="#calibre_link-203">94</a></p>
			<p class="index-level">Editing a table  <a href="#calibre_link-204">217</a></p>
			<p class="index-level">Enter data manually  <a href="#calibre_link-205">199</a></p>
			<p class="index-level">Error checking  <a href="#calibre_link-206">95</a></p>
			<p class="index-level">Evaluation context  <a href="#calibre_link-207">96</a></p>
			<p class="index-level">Excel</p>
			<p class="index-level1">Power Pivot  <a href="#calibre_link-208">251</a></p>
			<p class="index-level1">Writing measures</p>
			<p class="index-level1">  <a href="#calibre_link-209">258</a></p>
			<p class="index-level">Excel, analyze in  <a href="#calibre_link-210">239</a></p>
			<p class="index-level">Exercise data</p>
			<p class="index-level">  <a href="#calibre_link-211">4</a></p>
			<p class="index-level">Expand to next level  <a href="#calibre_link-212">55</a></p>
			<p class="index-level">Expression-based formatting  <a href="#calibre_link-213">212</a></p>
			<p class="index-section-head">F</p>
			<p class="index-level">Ferrari, Alberto  <a href="#calibre_link-214">94</a>, <a href="#calibre_link-215">196</a>, <a href="#calibre_link-216">214</a></p>
			<p class="index-level">File location, changing</p>
			<p class="index-level">  <a href="#calibre_link-217">25</a></p>
			<p class="index-level">FILTER  <a href="#calibre_link-218">139</a></p>
			<p class="index-level1">in CALCULATE  <a href="#calibre_link-219">144</a></p>
			<p class="index-level1">Inside measure  <a href="#calibre_link-220">141</a></p>
			<p class="index-level">Filter context  <a href="#calibre_link-221">96</a></p>
			<p class="index-level">Filter direction  <a href="#calibre_link-222">98</a></p>
			<p class="index-level">Filter, flow  <a href="#calibre_link-223">64</a></p>
			<p class="index-level">Filter, initial  <a href="#calibre_link-224">63</a></p>
			<p class="index-level">Filter propagation  <a href="#calibre_link-225">61</a>, <a href="#calibre_link-226">65</a></p>
			<p class="index-level">FIND  <a href="#calibre_link-227">105</a></p>
			<p class="index-level">FIRSTDATE  <a href="#calibre_link-228">182</a></p>
			<p class="index-level">Fit to screen  <a href="#calibre_link-229">13</a></p>
			<p class="index-level">Flattened tables  <a href="#calibre_link-230">67</a></p>
			<p class="index-level">Font size  <a href="#calibre_link-231">35</a></p>
			<p class="index-level">Formula bar  <a href="#calibre_link-232">30</a></p>
			<p class="index-level1">expanding</p>
			<p class="index-level1">  <a href="#calibre_link-233">39</a></p>
			<p class="index-level">Forum  <a href="#calibre_link-234">1</a>, <a href="#calibre_link-235">262</a></p>
			<p class="index-level">Free vs. pro  <a href="#calibre_link-236">4</a></p>
			<p class="index-section-head">G</p>
			<p class="index-level">GETPIVOTDATA  <a href="#calibre_link-237">243</a></p>
			<p class="index-section-head">H</p>
			<p class="index-level">Half-year calculation  <a href="#calibre_link-238">78</a></p>
			<p class="index-level">Harvester measures  <a href="#calibre_link-239">207</a></p>
			<p class="index-level">HASONEVALUE  <a href="#calibre_link-240">112</a></p>
			<p class="index-level">Hemisphere  <a href="#calibre_link-241">201</a></p>
			<p class="index-level">Hiding table  <a href="#calibre_link-242">234</a></p>
			<p class="index-section-head">I</p>
			<p class="index-level">IF  <a href="#calibre_link-243">105</a></p>
			<p class="index-level">Immutable  <a href="#calibre_link-244">188</a></p>
			<p class="index-level">Importing from Power Pivot  <a href="#calibre_link-245">254</a></p>
			<p class="index-level">Importing table  <a href="#calibre_link-246">23</a></p>
			<p class="index-level">Import vs. DirectQuery</p>
			<p class="index-level">  <a href="#calibre_link-247">9</a></p>
			<p class="index-level">IN  <a href="#calibre_link-248">76</a></p>
			<p class="index-level">Initial filter  <a href="#calibre_link-249">63</a></p>
			<p class="index-level">IntelliSense  <a href="#calibre_link-250">38</a></p>
			<p class="index-level1">Problems  <a href="#calibre_link-251">42</a></p>
			<p class="index-level">Interim calculated columns  <a href="#calibre_link-252">219</a></p>
			<p class="index-level">Interim measures  <a href="#calibre_link-253">133</a></p>
			<p class="index-level">Iterators  <a href="#calibre_link-254">79</a></p>
			<p class="index-section-head">J</p>
			<p class="index-level">Joining tables  <a href="#calibre_link-255">15</a></p>
			<p class="index-section-head">K</p>
			<p class="index-level">Keep Connection  <a href="#calibre_link-256">255</a></p>
			<p class="index-level">Kimball methodology  <a href="#calibre_link-257">19</a></p>
			<p class="index-section-head">L</p>
			<p class="index-level">Leap year  <a href="#calibre_link-258">180</a></p>
			<p class="index-level1">7-year system  <a href="#calibre_link-259">178</a></p>
			<p class="index-level">Lifetime Purchases  <a href="#calibre_link-260">144</a></p>
			<p class="index-level">Live training  <a href="#calibre_link-261">261</a></p>
			<p class="index-level">Loading data  <a href="#calibre_link-262">9</a></p>
			<p class="index-level">Lookup tables  <a href="#calibre_link-263">20</a></p>
			<p class="index-level">Lookup Tables</p>
			<p class="index-level1">versus Flattened  <a href="#calibre_link-264">67</a></p>
			<p class="index-section-head">M</p>
			<p class="index-level">Many-to-many relationships  <a href="#calibre_link-265">222</a></p>
			<p class="index-level">Matrix</p>
			<p class="index-level1">Adding fields  <a href="#calibre_link-266">32</a></p>
			<p class="index-level">Matrix, inserting</p>
			<p class="index-level">  <a href="#calibre_link-267">28</a></p>
			<p class="index-level">MAX  <a href="#calibre_link-268">56</a></p>
			<p class="index-level">MAXX  <a href="#calibre_link-269">88</a></p>
			<p class="index-level">Measures  <a href="#calibre_link-270">30</a></p>
			<p class="index-level1">Adding comments  <a href="#calibre_link-271">39</a></p>
			<p class="index-level1">Default name  <a href="#calibre_link-272">33</a></p>
			<p class="index-level1">Editing  <a href="#calibre_link-273">39</a></p>
			<p class="index-level1">Formatting  <a href="#calibre_link-274">33</a></p>
			<p class="index-level1">Implicit  <a href="#calibre_link-275">36</a></p>
			<p class="index-level1">Interim  <a href="#calibre_link-276">133</a></p>
			<p class="index-level1">Moving  <a href="#calibre_link-277">57</a></p>
			<p class="index-level1">Quick  <a href="#calibre_link-278">129</a></p>
			<p class="index-level1">Reusing  <a href="#calibre_link-279">43</a></p>
			<p class="index-level1">Work in process  <a href="#calibre_link-280">39</a></p>
			<p class="index-level">Microsoft Store  <a href="#calibre_link-281">3</a></p>
			<p class="index-level">MIN  <a href="#calibre_link-282">56</a></p>
			<p class="index-level1">versus FIRSTDATE  <a href="#calibre_link-283">170</a></p>
			<p class="index-level">MINX  <a href="#calibre_link-284">88</a></p>
			<p class="index-level">Model view  <a href="#calibre_link-285">12</a></p>
			<p class="index-level">Moving annual total  <a href="#calibre_link-286">178</a></p>
			<p class="index-level">Multiple data tables  <a href="#calibre_link-287">222</a></p>
			<p class="index-section-head">N</p>
			<p class="index-level">Naked column  <a href="#calibre_link-288">42</a></p>
			<p class="index-level">Naked Columns  <a href="#calibre_link-289">74</a></p>
			<p class="index-level">Naming conventions  <a href="#calibre_link-290">6</a></p>
			<p class="index-level">Navigator pane  <a href="#calibre_link-291">11</a></p>
			<p class="index-level">New measure  <a href="#calibre_link-292">30</a></p>
			<p class="index-level">New table  <a href="#calibre_link-293">118</a></p>
			<p class="index-level">Nonstandard calendar  <a href="#calibre_link-294">153</a></p>
			<p class="index-section-head">O</p>
			<p class="index-level">Online training  <a href="#calibre_link-295">261</a></p>
			<p class="index-level">OR function  <a href="#calibre_link-296">76</a></p>
			<p class="index-level">Other data sources  <a href="#calibre_link-297">15</a></p>
			<p class="index-section-head">P</p>
			<p class="index-level">Pages, adding  <a href="#calibre_link-298">40</a></p>
			<p class="index-level">Pages, duplicating  <a href="#calibre_link-299">40</a></p>
			<p class="index-level">Parameter  <a href="#calibre_link-300">204</a></p>
			<p class="index-level">Percentage of total  <a href="#calibre_link-301">125</a></p>
			<p class="index-level">Percent of selected  <a href="#calibre_link-302">132</a></p>
			<p class="index-level">Physical vs virtual tables  <a href="#calibre_link-303">108</a></p>
			<p class="index-level">Pivot table alternative</p>
			<p class="index-level">  <a href="#calibre_link-304">27</a></p>
			<p class="index-level">Power BI Desktop, downloading</p>
			<p class="index-level">  <a href="#calibre_link-305">1</a></p>
			<p class="index-level">Power BI vs. Power Pivot  <a href="#calibre_link-306">251</a></p>
			<p class="index-level">Power Pivot for Excel  <a href="#calibre_link-307">7</a></p>
			<p class="index-level">Power Query  <a href="#calibre_link-308">11</a></p>
			<p class="index-level1">Course  <a href="#calibre_link-309">11</a></p>
			<p class="index-level1">in Excel  <a href="#calibre_link-310">254</a></p>
			<p class="index-level">Power View  <a href="#calibre_link-311">254</a></p>
			<p class="index-level">Pro vs. free  <a href="#calibre_link-312">4</a></p>
			<p class="index-level">Publishing to PowerBI  <a href="#calibre_link-313">238</a></p>
			<p class="index-level">Puls, Ken</p>
			<p class="index-level">  <a href="#calibre_link-314">262</a></p>
			<p class="index-section-head">Q</p>
			<p class="index-level">Query, deleting steps</p>
			<p class="index-level">  <a href="#calibre_link-315">23</a></p>
			<p class="index-level">Query editor  <a href="#calibre_link-316">21</a></p>
			<p class="index-level">Query Editor  <a href="#calibre_link-317">11</a></p>
			<p class="index-level">Quevauvilliers, Gilbert</p>
			<p class="index-level">  <a href="#calibre_link-318">262</a></p>
			<p class="index-level">Quick measure  <a href="#calibre_link-319">129</a></p>
			<p class="index-section-head">R</p>
			<p class="index-level">Rad, Reza</p>
			<p class="index-level">  <a href="#calibre_link-320">262</a></p>
			<p class="index-level">RANKX  <a href="#calibre_link-321">189</a></p>
			<p class="index-level">Raviv, Gil</p>
			<p class="index-level">  <a href="#calibre_link-322">262</a></p>
			<p class="index-level">Refreshing data  <a href="#calibre_link-323">9</a></p>
			<p class="index-level">RELATED  <a href="#calibre_link-324">198</a></p>
			<p class="index-level">RELATEDTABLE  <a href="#calibre_link-325">198</a></p>
			<p class="index-level">Relationships  <a href="#calibre_link-326">69</a></p>
			<p class="index-level1">Creating  <a href="#calibre_link-327">15</a></p>
			<p class="index-level">REMOVEFILTERS  <a href="#calibre_link-328">131</a></p>
			<p class="index-level">Renaming tables  <a href="#calibre_link-329">12</a></p>
			<p class="index-level">RETURN  <a href="#calibre_link-330">186</a></p>
			<p class="index-level">Return value  <a href="#calibre_link-331">181</a></p>
			<p class="index-level">Rolling sales  <a href="#calibre_link-332">176</a></p>
			<p class="index-level">Rolls up but not down  <a href="#calibre_link-333">235</a></p>
			<p class="index-level">Row-by-row evaluation  <a href="#calibre_link-334">74</a></p>
			<p class="index-level">Row context</p>
			<p class="index-level1">versus Filter context  <a href="#calibre_link-335">100</a></p>
			<p class="index-level">Russo, Marco  <a href="#calibre_link-336">94</a>, <a href="#calibre_link-337">214</a></p>
			<p class="index-section-head">S</p>
			<p class="index-level">SAMEPERIODLASTYEAR  <a href="#calibre_link-338">156</a></p>
			<p class="index-level">Sample data</p>
			<p class="index-level">  <a href="#calibre_link-339">4</a></p>
			<p class="index-level">Saving  <a href="#calibre_link-340">18</a></p>
			<p class="index-level">Select Case  <a href="#calibre_link-341">105</a></p>
			<p class="index-level">SELECTEDVALUE  <a href="#calibre_link-342">115</a></p>
			<p class="index-level">Shaping data  <a href="#calibre_link-343">18</a></p>
			<p class="index-level">Sheets, adding  <a href="#calibre_link-344">40</a></p>
			<p class="index-level">Shift+Enter  <a href="#calibre_link-345">39</a></p>
			<p class="index-level">Show next level  <a href="#calibre_link-346">55</a></p>
			<p class="index-level">Skinny tables, prefer  <a href="#calibre_link-347">71</a></p>
			<p class="index-level">Slicer  <a href="#calibre_link-348">206</a></p>
			<p class="index-level1">in Cube formula  <a href="#calibre_link-349">249</a></p>
			<p class="index-level1">in Excel  <a href="#calibre_link-350">248</a></p>
			<p class="index-level1">Layout  <a href="#calibre_link-351">209</a></p>
			<p class="index-level">Snowflake schema  <a href="#calibre_link-352">20</a>, <a href="#calibre_link-353">25</a>, <a href="#calibre_link-354">70</a></p>
			<p class="index-level">Sort order  <a href="#calibre_link-355">116</a>, <a href="#calibre_link-356">219</a></p>
			<p class="index-level">Spreadsheet vs. database  <a href="#calibre_link-357">7</a></p>
			<p class="index-level">SQL Server  <a href="#calibre_link-358">9</a></p>
			<p class="index-level">SSAS Tabular  <a href="#calibre_link-359">7</a></p>
			<p class="index-level">Star schema  <a href="#calibre_link-360">19</a>, <a href="#calibre_link-361">69</a></p>
			<p class="index-level">SUM  <a href="#calibre_link-362">42</a></p>
			<p class="index-level">SUMIFS like CALCULATE  <a href="#calibre_link-363">89</a></p>
			<p class="index-level">SUMX  <a href="#calibre_link-364">79</a></p>
			<p class="index-level">SWITCH  <a href="#calibre_link-365">105</a></p>
			<p class="index-level">SWITCHing measures  <a href="#calibre_link-366">209</a></p>
			<p class="index-level">Syntax sugar  <a href="#calibre_link-367">85</a></p>
			<p class="index-section-head">T</p>
			<p class="index-level">Table Filters  <a href="#calibre_link-368">93</a></p>
			<p class="index-level">Tabular Editor  <a href="#calibre_link-369">30</a></p>
			<p class="index-level">Thin workbooks  <a href="#calibre_link-370">241</a></p>
			<p class="index-level">Time intelligence  <a href="#calibre_link-371">152</a></p>
			<p class="index-level1">ID column  <a href="#calibre_link-372">175</a></p>
			<p class="index-level">Title, expression-based  <a href="#calibre_link-373">212</a></p>
			<p class="index-level">TODAY  <a href="#calibre_link-374">214</a></p>
			<p class="index-level">TOPN  <a href="#calibre_link-375">197</a></p>
			<p class="index-level">Top N filter  <a href="#calibre_link-376">190</a></p>
			<p class="index-section-head">U</p>
			<p class="index-level">Updating Power BI Desktop  <a href="#calibre_link-377">3</a></p>
			<p class="index-level">User groups  <a href="#calibre_link-378">262</a></p>
			<p class="index-section-head">V</p>
			<p class="index-level">VALUES  <a href="#calibre_link-379">108</a></p>
			<p class="index-level">Variables  <a href="#calibre_link-380">186</a></p>
			<p class="index-level">VertiPaq  <a href="#calibre_link-381">68</a></p>
			<p class="index-level">Video training  <a href="#calibre_link-382">261</a></p>
			<p class="index-level">Virtual Table</p>
			<p class="index-level1">Lineage  <a href="#calibre_link-383">150</a></p>
			<p class="index-level">Virtual vs. physical tables  <a href="#calibre_link-384">108</a></p>
			<p class="index-level">VLOOKUP equivalent  <a href="#calibre_link-385">198</a></p>
			<p class="index-section-head">W</p>
			<p class="index-level">Webb, Chris</p>
			<p class="index-level">  <a href="#calibre_link-386">262</a></p>
			<p class="index-level">Weekend calculation  <a href="#calibre_link-387">76</a></p>
			<p class="index-level">What-If analysis  <a href="#calibre_link-388">203</a></p>
			<p class="index-level">Whole of table  <a href="#calibre_link-389">168</a></p>
			<p class="index-level">Woods, Tiger  <a href="#calibre_link-390">vi</a></p>
			<p class="index-level">Word wrapping  <a href="#calibre_link-391">47</a></p>
			<p class="index-section-head">X</p>
			<p class="index-level">X-functions vs. aggregators</p>
			<p class="index-level">  <a href="#calibre_link-392">83</a></p>
			<p class="index-section-head">Y</p>
			<p class="index-level">Year-to-Date  <a href="#calibre_link-393">158</a></p>
			<p class="index-level1">Custom  <a href="#calibre_link-394">172</a></p>
		</div>
		<div class="_idgenobjectlayout">
			<div id="calibre_link-455" class="calibre1">
				<img class="_idgenobjectattribute" src="images/000320.png" alt="" />
			</div>
		</div>
		<div class="_idgenobjectlayout">
			<div id="calibre_link-456" class="calibre10">
				<img class="_idgenobjectattribute" src="images/000081.png" alt="" />
			</div>
		</div>
		<div id="calibre_link-457" class="_idgenobjectstyleoverride">
			<p class="_idgenobjectstyleoverride">Inside Back Cover - This page is blank</p>
		</div>
		<div class="_idgenobjectlayout">
			<div id="calibre_link-458" class="calibre1">
				<img class="_idgenobjectattribute" src="images/000061.png" alt="" />
			</div>
		</div>
	</div>


</body></html>